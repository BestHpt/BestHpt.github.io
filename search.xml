<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Zapæ—¥å¿—åº“å®è·µ</title>
      <link href="/2021/11/19/10.Golang/Zap%20%E6%97%A5%E5%BF%97%E5%BA%93%E5%AE%9E%E8%B7%B5/"/>
      <url>/2021/11/19/10.Golang/Zap%20%E6%97%A5%E5%BF%97%E5%BA%93%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†éå¸¸æµè¡Œçš„ Uber å¼€æºçš„ zap æ—¥å¿—åº“ï¼ŒåŒæ—¶ä»‹ç»äº†å¦‚ä½•æ­é… Lumberjackã€Rotatelogs å®ç°æ—¥å¿—çš„åˆ‡å‰²å’Œå½’æ¡£ã€‚</p><h1 id="1ã€æ—¥å¿—éœ€æ±‚"><a href="#1ã€æ—¥å¿—éœ€æ±‚" class="headerlink" title="1ã€æ—¥å¿—éœ€æ±‚"></a>1ã€æ—¥å¿—éœ€æ±‚</h1><p>æˆ‘ä»¬é‡æ¸©ä¸€ä¸‹ä¸€ä¸ªå¥½çš„æ—¥å¿—è®°å½•å™¨éƒ½éœ€è¦èƒ½å¤Ÿæä¾›ä¸‹é¢å“ªäº›åŠŸèƒ½ï¼Ÿ</p><ol><li>è‰¯å¥½æ—¥å¿—å†™å…¥æ€§èƒ½</li><li>æ”¯æŒä¸åŒçš„æ—¥å¿—çº§åˆ«ã€‚å¹¶ä¸”å¯åˆ†ç¦»æˆå¤šä¸ªæ—¥å¿—æ–‡ä»¶</li><li>å¤šè¾“å‡º ï¼ åŒæ—¶æ”¯æŒæ ‡å‡†è¾“å‡ºï¼Œæ–‡ä»¶ç­‰</li><li>èƒ½å¤Ÿæ‰“å°åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚è°ƒç”¨æ–‡ä»¶ / å‡½æ•°åå’Œè¡Œå·ï¼Œæ—¥å¿—æ—¶é—´ç­‰</li><li>å¯è¯»æ€§ä¸ç»“æ„åŒ–ï¼ŒJsonæ ¼å¼æˆ–æœ‰åˆ†éš”ç¬¦ï¼Œæ–¹ä¾¿åç»­çš„æ—¥å¿—é‡‡é›†ã€ç›‘æ§ç­‰</li><li>æ–‡ä»¶åˆ‡å‰²ï¼Œå¯æŒ‰å°æ—¶ã€å¤©è¿›è¡Œæ—¥å¿—æ‹†åˆ†ï¼Œæˆ–è€…æŒ‰æ–‡ä»¶å¤§å°</li><li>æ—¥å¿—ä¹¦å†™å‹å¥½ï¼Œæ”¯æŒé€šè¿‡contextè‡ªåŠ¨log traceç­‰</li><li>æ–‡ä»¶å®šæ—¶åˆ é™¤</li><li>å¼€æºæ€§ï¼Œä¸å…¶ä»–å¼€æºæ¡†æ¶æ”¯æŒè¾ƒå¥½</li></ol><h1 id="2ã€Uber-go-Zap"><a href="#2ã€Uber-go-Zap" class="headerlink" title="2ã€Uber-go Zap"></a>2ã€Uber-go Zap</h1><p><a href="https://github.com/uber-go/zap" target="_blank" rel="noopener">Zap</a> æ˜¯éå¸¸å¿«çš„ã€ç»“æ„åŒ–çš„ï¼Œåˆ†æ—¥å¿—çº§åˆ«çš„ Go æ—¥å¿—åº“ã€‚</p><h2 id="2-1-ä¸ºä»€ä¹ˆé€‰æ‹©-Uber-go-zap"><a href="#2-1-ä¸ºä»€ä¹ˆé€‰æ‹©-Uber-go-zap" class="headerlink" title="2.1 ä¸ºä»€ä¹ˆé€‰æ‹© Uber-go zap"></a>2.1 ä¸ºä»€ä¹ˆé€‰æ‹© Uber-go zap</h2><p>æœ‰å…³æŠ€æœ¯é€‰å‹å¯ä»¥è§ï¼š<a href="https://www.yuque.com/jinsesihuanian/gpwou5/aduc5c" target="_blank" rel="noopener">https://www.yuque.com/jinsesihuanian/gpwou5/aduc5c</a><br>â€‹</p><h2 id="2-2-å®‰è£…"><a href="#2-2-å®‰è£…" class="headerlink" title="2.2 å®‰è£…"></a>2.2 å®‰è£…</h2><p>è¿è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… zap</p><pre><code class="go">go get -u go.uber.org/zap</code></pre><h2 id="2-3-é…ç½®-Zap-Logger"><a href="#2-3-é…ç½®-Zap-Logger" class="headerlink" title="2.3 é…ç½® Zap Logger"></a>2.3 é…ç½® Zap Logger</h2><p>Zap æä¾›äº†ä¸¤ç§ç±»å‹çš„æ—¥å¿—è®°å½•å™¨â€”<code>Sugared Logger</code>å’Œ<code>Logger</code>ã€‚</p><p>åœ¨æ€§èƒ½å¾ˆå¥½ä½†ä¸æ˜¯å¾ˆå…³é”®çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä½¿ç”¨<code>SugaredLogger</code>ã€‚å®ƒæ¯”å…¶ä»–ç»“æ„åŒ–æ—¥å¿—è®°å½•åŒ…å¿« 4-10 å€ï¼Œå¹¶ä¸”æ”¯æŒç»“æ„åŒ–å’Œ printf é£æ ¼çš„æ—¥å¿—è®°å½•ã€‚<br>åœ¨æ¯ä¸€å¾®ç§’å’Œæ¯ä¸€æ¬¡å†…å­˜åˆ†é…éƒ½å¾ˆé‡è¦çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä½¿ç”¨<code>Logger</code>ã€‚å®ƒç”šè‡³æ¯”<code>SugaredLogger</code>æ›´å¿«ï¼Œå†…å­˜åˆ†é…æ¬¡æ•°ä¹Ÿæ›´å°‘ï¼Œä½†å®ƒåªæ”¯æŒå¼ºç±»å‹çš„ç»“æ„åŒ–æ—¥å¿—è®°å½•ã€‚</p><h3 id="2-3-1-Logger"><a href="#2-3-1-Logger" class="headerlink" title="2.3.1 Logger"></a>2.3.1 Logger</h3><ul><li>é€šè¿‡è°ƒç”¨<code>zap.NewProduction()</code>/<code>zap.NewDevelopment()</code>æˆ–è€…<code>zap.Example()</code>åˆ›å»ºä¸€ä¸ª Loggerã€‚</li><li>ä¸Šé¢çš„æ¯ä¸€ä¸ªå‡½æ•°éƒ½å°†åˆ›å»ºä¸€ä¸ª loggerã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨äºå®ƒå°†è®°å½•çš„ä¿¡æ¯ä¸åŒã€‚ä¾‹å¦‚ production logger é»˜è®¤è®°å½•è°ƒç”¨å‡½æ•°ä¿¡æ¯ã€æ—¥æœŸå’Œæ—¶é—´ç­‰ã€‚</li><li>é€šè¿‡ Logger è°ƒç”¨ Info/Error ç­‰ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹æ—¥å¿—éƒ½ä¼šæ‰“å°åˆ°åº”ç”¨ç¨‹åºçš„ console ç•Œé¢ã€‚</li></ul><pre><code class="go">var logger *zap.Loggerfunc main() {    InitLogger()  defer logger.Sync()    simpleHttpGet(&quot;www.baidu.com&quot;)    simpleHttpGet(&quot;http://www.baidu.com&quot;)}func InitLogger() {    logger, _ = zap.NewProduction()}func simpleHttpGet(url string) {    resp, err := http.Get(url)    if err != nil {        logger.Error(            &quot;Error fetching url..&quot;,            zap.String(&quot;url&quot;, url),            zap.Error(err))    } else {        logger.Info(&quot;Success..&quot;,            zap.String(&quot;statusCode&quot;, resp.Status),            zap.String(&quot;url&quot;, url))        resp.Body.Close()    }}</code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª Loggerï¼Œç„¶åä½¿ç”¨ Info/ Error ç­‰ Logger æ–¹æ³•è®°å½•æ¶ˆæ¯ã€‚</p><p>æ—¥å¿—è®°å½•å™¨æ–¹æ³•çš„è¯­æ³•æ˜¯è¿™æ ·çš„ï¼š</p><pre><code>func (log *Logger) MethodXXX(msg string, fields ...Field)</code></pre><p>å…¶ä¸­<code>MethodXXX</code>æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°ï¼Œå¯ä»¥æ˜¯ Info / Error/ Debug / Panic ç­‰ã€‚æ¯ä¸ªæ–¹æ³•éƒ½æ¥å—ä¸€ä¸ªæ¶ˆæ¯å­—ç¬¦ä¸²å’Œä»»æ„æ•°é‡çš„<code>zapcore.Field</code>åœºå‚æ•°ã€‚</p><p>æ¯ä¸ª<code>zapcore.Field</code>å…¶å®å°±æ˜¯ä¸€ç»„é”®å€¼å¯¹å‚æ•°ã€‚</p><p>æˆ‘ä»¬æ‰§è¡Œä¸Šé¢çš„ä»£ç ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºç»“æœï¼š</p><pre><code class="go">{&quot;level&quot;:&quot;error&quot;,&quot;ts&quot;:1572159218.912792,&quot;caller&quot;:&quot;zap_demo/temp.go:25&quot;,&quot;msg&quot;:&quot;Error fetching url..&quot;,&quot;url&quot;:&quot;www.baidu.com&quot;,&quot;error&quot;:&quot;Get www.sogo.com: unsupported protocol scheme \&quot;\&quot;&quot;,&quot;stacktrace&quot;:&quot;main.simpleHttpGet\n\t/Users/q1mi/zap_demo/temp.go:25\nmain.main\n\t/Users/q1mi/zap_demo/temp.go:14\nruntime.main\n\t/usr/local/go/src/runtime/proc.go:203&quot;}{&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1572159219.1227388,&quot;caller&quot;:&quot;zap_demo/temp.go:30&quot;,&quot;msg&quot;:&quot;Success..&quot;,&quot;statusCode&quot;:&quot;200 OK&quot;,&quot;url&quot;:&quot;http://www.baidu.com&quot;}</code></pre><h3 id="2-3-2-Sugared-Logger"><a href="#2-3-2-Sugared-Logger" class="headerlink" title="2.3.2 Sugared Logger"></a>2.3.2 Sugared Logger</h3><p>ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨ Sugared Logger æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p><ul><li>å¤§éƒ¨åˆ†çš„å®ç°åŸºæœ¬éƒ½ç›¸åŒã€‚</li><li>æƒŸä¸€çš„åŒºåˆ«æ˜¯ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ä¸» logger çš„<code>. Sugar()</code>æ–¹æ³•æ¥è·å–ä¸€ä¸ª<code>SugaredLogger</code>ã€‚</li><li>ç„¶åä½¿ç”¨<code>SugaredLogger</code>ä»¥<code>printf</code>æ ¼å¼è®°å½•è¯­å¥</li></ul><p>ä¸‹é¢æ˜¯ä¿®æ”¹è¿‡åä½¿ç”¨<code>SugaredLogger</code>ä»£æ›¿<code>Logger</code>çš„ä»£ç ï¼š</p><pre><code class="go">var sugarLogger *zap.SugaredLoggerfunc main() {    InitLogger()    defer sugarLogger.Sync()    simpleHttpGet(&quot;www.baidu.com&quot;)    simpleHttpGet(&quot;http://www.baidu.com&quot;)}func InitLogger() {  logger, _ := zap.NewProduction()    sugarLogger = logger.Sugar()}func simpleHttpGet(url string) {    sugarLogger.Debugf(&quot;Trying to hit GET request for %s&quot;, url)    resp, err := http.Get(url)    if err != nil {        sugarLogger.Errorf(&quot;Error fetching URL %s : Error = %s&quot;, url, err)    } else {        sugarLogger.Infof(&quot;Success! statusCode = %s for URL %s&quot;, resp.Status, url)        resp.Body.Close()    }}</code></pre><p>å½“ä½ æ‰§è¡Œä¸Šé¢çš„ä»£ç ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><pre><code class="go">{&quot;level&quot;:&quot;error&quot;,&quot;ts&quot;:1572159149.923002,&quot;caller&quot;:&quot;logic/temp2.go:27&quot;,&quot;msg&quot;:&quot;Error fetching URL www.baidu.com : Error = Get www.baidu.com: unsupported protocol scheme \&quot;\&quot;&quot;,&quot;stacktrace&quot;:&quot;main.simpleHttpGet\n\t/Users/zap_demo/logic/temp2.go:27\nmain.main\n\t/Users/zap_demo/logic/temp2.go:14\nruntime.main\n\t/usr/local/go/src/runtime/proc.go:203&quot;}{&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1572159150.192585,&quot;caller&quot;:&quot;logic/temp2.go:29&quot;,&quot;msg&quot;:&quot;Success! statusCode = 200 OK for URL http://www.baidu.com&quot;}</code></pre><p>ä½ åº”è¯¥æ³¨æ„åˆ°çš„äº†ï¼Œåˆ°ç›®å‰ä¸ºæ­¢è¿™ä¸¤ä¸ª logger éƒ½æ‰“å°è¾“å‡º JSON ç»“æ„æ ¼å¼ã€‚<br>åœ¨æœ¬åšå®¢çš„åé¢éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°è®¨è®º SugaredLoggerï¼Œå¹¶äº†è§£å¦‚ä½•è¿›ä¸€æ­¥é…ç½®å®ƒã€‚</p><h2 id="2-4-å®šåˆ¶-logger"><a href="#2-4-å®šåˆ¶-logger" class="headerlink" title="2.4 å®šåˆ¶ logger"></a>2.4 å®šåˆ¶ logger</h2><h3 id="2-4-1-å°†æ—¥å¿—å†™å…¥æ–‡ä»¶è€Œä¸æ˜¯ç»ˆç«¯"><a href="#2-4-1-å°†æ—¥å¿—å†™å…¥æ–‡ä»¶è€Œä¸æ˜¯ç»ˆç«¯" class="headerlink" title="2.4.1 å°†æ—¥å¿—å†™å…¥æ–‡ä»¶è€Œä¸æ˜¯ç»ˆç«¯"></a>2.4.1 å°†æ—¥å¿—å†™å…¥æ–‡ä»¶è€Œä¸æ˜¯ç»ˆç«¯</h3><p>æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä¸ªæ›´æ”¹æ˜¯æŠŠæ—¥å¿—å†™å…¥æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ‰“å°åˆ°åº”ç”¨ç¨‹åºæ§åˆ¶å°ã€‚<br>â€‹</p><ul><li>æˆ‘ä»¬å°†ä½¿ç”¨<code>zap.New(â€¦)</code>æ–¹æ³•æ¥æ‰‹åŠ¨ä¼ é€’æ‰€æœ‰é…ç½®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åƒ<code>zap.NewProduction()</code>è¿™æ ·çš„é¢„ç½®æ–¹æ³•æ¥åˆ›å»º loggerã€‚<pre><code>func New(core zapcore.Core, options ...Option) *Logger</code></pre></li></ul><p><code>zapcore.Core</code>éœ€è¦ä¸‰ä¸ªé…ç½®â€”â€”<code>Encoder</code>ï¼Œ<code>WriteSyncer</code>ï¼Œ<code>LogLevel</code>ã€‚</p><p>1.<strong>Encoder</strong>: ç¼–ç å™¨ (<strong>å†™å…¥æ—¥å¿—æ ¼å¼</strong>)ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å¼€ç®±å³ç”¨çš„<code>NewJSONEncoder()</code>ï¼Œå¹¶ä½¿ç”¨é¢„å…ˆè®¾ç½®çš„<code>ProductionEncoderConfig()</code>ã€‚</p><pre><code>zapcore.NewJSONEncoder(zap.NewProductionEncoderConfig())</code></pre><p>2.<strong>WriterSyncer</strong> ï¼šæŒ‡å®š<strong>æ—¥å¿—å†™åˆ°å“ªé‡Œ</strong>å»ã€‚æˆ‘ä»¬ä½¿ç”¨<code>zapcore.AddSync()</code>å‡½æ•°å¹¶ä¸”å°†æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ä¼ è¿›å»ã€‚</p><pre><code>file, _ := os.Create(&quot;./test.log&quot;)   writeSyncer := zapcore.AddSync(file)</code></pre><p>3.<strong>Log Level</strong>ï¼šå“ªç§çº§åˆ«çš„æ—¥å¿—å°†è¢«å†™å…¥ã€‚<br>æˆ‘ä»¬å°†ä¿®æ”¹ä¸Šè¿°éƒ¨åˆ†ä¸­çš„ Logger ä»£ç ï¼Œå¹¶é‡å†™<code>InitLogger()</code>æ–¹æ³•ã€‚å…¶ä½™æ–¹æ³•â€”<code>main()</code> /<code>SimpleHttpGet()</code>ä¿æŒä¸å˜ã€‚</p><pre><code class="go">func InitLogger() {    writeSyncer := getLogWriter()    encoder := getEncoder()    core := zapcore.NewCore(encoder, writeSyncer, zapcore.DebugLevel)    logger := zap.New(core)    sugarLogger = logger.Sugar()}func getEncoder() zapcore.Encoder {    return zapcore.NewJSONEncoder(zap.NewProductionEncoderConfig())}func getLogWriter() zapcore.WriteSyncer {    file, _ := os.Create(&quot;./test.log&quot;)    return zapcore.AddSync(file)}</code></pre><p>å½“ä½¿ç”¨è¿™äº›ä¿®æ”¹è¿‡çš„ logger é…ç½®è°ƒç”¨ä¸Šè¿°éƒ¨åˆ†çš„<code>main()</code>å‡½æ•°æ—¶ï¼Œä»¥ä¸‹è¾“å‡ºå°†æ‰“å°åœ¨æ–‡ä»¶â€”â€”<code>test.log</code>ä¸­ã€‚</p><pre><code>{&quot;level&quot;:&quot;debug&quot;,&quot;ts&quot;:1572160754.994731,&quot;msg&quot;:&quot;Trying to hit GET request for www.baidu.com&quot;}{&quot;level&quot;:&quot;error&quot;,&quot;ts&quot;:1572160754.994982,&quot;msg&quot;:&quot;Error fetching URL www.sogo.com : Error = Get www.baidu.com: unsupported protocol scheme \&quot;\&quot;&quot;}{&quot;level&quot;:&quot;debug&quot;,&quot;ts&quot;:1572160754.994996,&quot;msg&quot;:&quot;Trying to hit GET request for http://www.baidu.com&quot;}{&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1572160757.3755069,&quot;msg&quot;:&quot;Success! statusCode = 200 OK for URL http://www.baidu.com&quot;}</code></pre><h3 id="2-4-2-å°†-JSON-Encoder-æ›´æ”¹ä¸ºæ™®é€šçš„-Log-Encoder"><a href="#2-4-2-å°†-JSON-Encoder-æ›´æ”¹ä¸ºæ™®é€šçš„-Log-Encoder" class="headerlink" title="2.4.2 å°† JSON Encoder æ›´æ”¹ä¸ºæ™®é€šçš„ Log Encoder"></a>2.4.2 å°† JSON Encoder æ›´æ”¹ä¸ºæ™®é€šçš„ Log Encoder</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¸Œæœ›å°†ç¼–ç å™¨ä» JSON Encoder æ›´æ”¹ä¸ºæ™®é€š Encoderã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†<code>NewJSONEncoder()</code>æ›´æ”¹ä¸º<code>NewConsoleEncoder()</code>ã€‚</p><pre><code class="go">return zapcore.NewConsoleEncoder(zap.NewProductionEncoderConfig())</code></pre><p>å½“ä½¿ç”¨è¿™äº›ä¿®æ”¹è¿‡çš„ logger é…ç½®è°ƒç”¨ä¸Šè¿°éƒ¨åˆ†çš„<code>main()</code>å‡½æ•°æ—¶ï¼Œä»¥ä¸‹è¾“å‡ºå°†æ‰“å°åœ¨æ–‡ä»¶â€”â€”<code>test.log</code>ä¸­ã€‚</p><pre><code class="go">1.572161051846623e+09    debug    Trying to hit GET request for www.baidu.com1.572161051846828e+09    error    Error fetching URL www.sogo.com : Error = Get www.baidu.com: unsupported protocol scheme &quot;&quot;1.5721610518468401e+09    debug    Trying to hit GET request for http://www.baidu.com1.572161052068744e+09    info    Success! statusCode = 200 OK for URL http://www.baidu.com</code></pre><h3 id="2-4-3-æ›´æ”¹æ—¶é—´ç¼–ç å¹¶æ·»åŠ è°ƒç”¨è€…è¯¦ç»†ä¿¡æ¯"><a href="#2-4-3-æ›´æ”¹æ—¶é—´ç¼–ç å¹¶æ·»åŠ è°ƒç”¨è€…è¯¦ç»†ä¿¡æ¯" class="headerlink" title="2.4.3 æ›´æ”¹æ—¶é—´ç¼–ç å¹¶æ·»åŠ è°ƒç”¨è€…è¯¦ç»†ä¿¡æ¯"></a>2.4.3 æ›´æ”¹æ—¶é—´ç¼–ç å¹¶æ·»åŠ è°ƒç”¨è€…è¯¦ç»†ä¿¡æ¯</h3><p>é‰´äºæˆ‘ä»¬å¯¹é…ç½®æ‰€åšçš„æ›´æ”¹ï¼Œæœ‰ä¸‹é¢ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>æ—¶é—´æ˜¯ä»¥éäººç±»å¯è¯»çš„æ–¹å¼å±•ç¤ºï¼Œä¾‹å¦‚ 1.572161051846623e+09</li><li>è°ƒç”¨æ–¹å‡½æ•°çš„è¯¦ç»†ä¿¡æ¯æ²¡æœ‰æ˜¾ç¤ºåœ¨æ—¥å¿—ä¸­</li></ul><p>æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯è¦†ç›–é»˜è®¤çš„<code>ProductionConfig()</code>ï¼Œå¹¶è¿›è¡Œä»¥ä¸‹æ›´æ”¹:</p><ul><li>ä¿®æ”¹æ—¶é—´ç¼–ç å™¨</li><li>åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ä½¿ç”¨å¤§å†™å­—æ¯è®°å½•æ—¥å¿—çº§åˆ«<pre><code class="go">func getEncoder() zapcore.Encoder {  encoderConfig := zap.NewProductionEncoderConfig()  encoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder  encoderConfig.EncodeLevel = zapcore.CapitalLevelEncoder  return zapcore.NewConsoleEncoder(encoderConfig)}</code></pre></li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¿®æ”¹ zap logger ä»£ç ï¼Œæ·»åŠ å°†è°ƒç”¨å‡½æ•°ä¿¡æ¯è®°å½•åˆ°æ—¥å¿—ä¸­çš„åŠŸèƒ½ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨<code>zap.New(..)</code>å‡½æ•°ä¸­æ·»åŠ ä¸€ä¸ª<code>Option</code>ã€‚</p><pre><code class="go">logger := zap.New(core, zap.AddCaller())</code></pre><p>å½“ä½¿ç”¨è¿™äº›ä¿®æ”¹è¿‡çš„ logger é…ç½®è°ƒç”¨ä¸Šè¿°éƒ¨åˆ†çš„<code>main()</code>å‡½æ•°æ—¶ï¼Œä»¥ä¸‹è¾“å‡ºå°†æ‰“å°åœ¨æ–‡ä»¶â€”â€”<code>test.log</code>ä¸­ã€‚</p><pre><code>2019-10-27T15:33:29.855+0800    DEBUG    logic/temp2.go:47    Trying to hit GET request for www.baidu.com2019-10-27T15:33:29.855+0800    ERROR    logic/temp2.go:50    Error fetching URL www.sogo.com : Error = Get www.baidu.com: unsupported protocol scheme &quot;&quot;2019-10-27T15:33:29.856+0800    DEBUG    logic/temp2.go:47    Trying to hit GET request for http://www.baidu.com2019-10-27T15:33:30.125+0800    INFO    logic/temp2.go:52    Success! statusCode = 200 OK for URL http://www.baidu.com</code></pre><h1 id="3ã€ä½¿ç”¨-Lumberjack-è¿›è¡Œæ—¥å¿—åˆ‡å‰²å½’æ¡£"><a href="#3ã€ä½¿ç”¨-Lumberjack-è¿›è¡Œæ—¥å¿—åˆ‡å‰²å½’æ¡£" class="headerlink" title="3ã€ä½¿ç”¨ Lumberjack è¿›è¡Œæ—¥å¿—åˆ‡å‰²å½’æ¡£"></a>3ã€ä½¿ç”¨ Lumberjack è¿›è¡Œæ—¥å¿—åˆ‡å‰²å½’æ¡£</h1><p>_Zap æœ¬èº«ä¸æ”¯æŒåˆ‡å‰²å½’æ¡£æ—¥å¿—æ–‡ä»¶ï¼Œ_ä¸ºäº†æ·»åŠ æ—¥å¿—åˆ‡å‰²å½’æ¡£åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ <a href="https://github.com/natefinch/lumberjack" target="_blank" rel="noopener">Lumberjack</a> æ¥å®ç°ã€‚</p><h2 id="3-1-å®‰è£…"><a href="#3-1-å®‰è£…" class="headerlink" title="3.1 å®‰è£…"></a>3.1 å®‰è£…</h2><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… Lumberjack</p><pre><code>go get -u github.com/natefinch/lumberjack</code></pre><h2 id="3-2-zap-loggerä¸­åŠ å…¥Lumberjack"><a href="#3-2-zap-loggerä¸­åŠ å…¥Lumberjack" class="headerlink" title="3.2 zap loggerä¸­åŠ å…¥Lumberjack"></a>3.2 zap loggerä¸­åŠ å…¥Lumberjack</h2><p>è¦åœ¨ zap ä¸­åŠ å…¥ Lumberjack æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹<code>WriteSyncer</code>ä»£ç ã€‚æˆ‘ä»¬å°†æŒ‰ç…§ä¸‹é¢çš„ä»£ç ä¿®æ”¹<code>getLogWriter()</code>å‡½æ•°ï¼š</p><pre><code class="go">func getLogWriter() zapcore.WriteSyncer {    lumberJackLogger := &amp;lumberjack.Logger{        Filename:   &quot;./test.log&quot;,        MaxSize:    10,        MaxBackups: 5,        MaxAge:     30,        Compress:   false,    }    return zapcore.AddSync(lumberJackLogger)}</code></pre><p>Lumberjack Logger é‡‡ç”¨ä»¥ä¸‹å±æ€§ä½œä¸ºè¾“å…¥:</p><ul><li>Filename: æ—¥å¿—æ–‡ä»¶çš„ä½ç½®</li><li>MaxSizeï¼šåœ¨è¿›è¡Œåˆ‡å‰²ä¹‹å‰ï¼Œæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼ˆä»¥ MB ä¸ºå•ä½ï¼‰</li><li>MaxBackupsï¼šä¿ç•™æ—§æ–‡ä»¶çš„æœ€å¤§ä¸ªæ•°</li><li>MaxAgesï¼šä¿ç•™æ—§æ–‡ä»¶çš„æœ€å¤§å¤©æ•°</li><li>Compressï¼šæ˜¯å¦å‹ç¼© / å½’æ¡£æ—§æ–‡ä»¶<h2 id="3-3-æµ‹è¯•"><a href="#3-3-æµ‹è¯•" class="headerlink" title="3.3 æµ‹è¯•"></a>3.3 æµ‹è¯•</h2>æœ€ç»ˆï¼Œä½¿ç”¨ Zap/Lumberjack logger çš„å®Œæ•´ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</li></ul><pre><code class="go">package mainimport (    &quot;net/http&quot;    &quot;github.com/natefinch/lumberjack&quot;    &quot;go.uber.org/zap&quot;    &quot;go.uber.org/zap/zapcore&quot;)var sugarLogger *zap.SugaredLoggerfunc main() {    InitLogger()    defer sugarLogger.Sync()    simpleHttpGet(&quot;www.sogo.com&quot;)    simpleHttpGet(&quot;http://www.sogo.com&quot;)}func InitLogger() {    writeSyncer := getLogWriter()    encoder := getEncoder()    core := zapcore.NewCore(encoder, writeSyncer, zapcore.DebugLevel)    logger := zap.New(core, zap.AddCaller())    sugarLogger = logger.Sugar()}func getEncoder() zapcore.Encoder {    encoderConfig := zap.NewProductionEncoderConfig()    encoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder    encoderConfig.EncodeLevel = zapcore.CapitalLevelEncoder    return zapcore.NewConsoleEncoder(encoderConfig)}func getLogWriter() zapcore.WriteSyncer {    lumberJackLogger := &amp;lumberjack.Logger{        Filename:   &quot;./test.log&quot;,        MaxSize:    1,        MaxBackups: 5,        MaxAge:     30,        Compress:   false,    }    return zapcore.AddSync(lumberJackLogger)}func simpleHttpGet(url string) {    sugarLogger.Debugf(&quot;Trying to hit GET request for %s&quot;, url)    resp, err := http.Get(url)    if err != nil {        sugarLogger.Errorf(&quot;Error fetching URL %s : Error = %s&quot;, url, err)    } else {        sugarLogger.Infof(&quot;Success! statusCode = %s for URL %s&quot;, resp.Status, url)        resp.Body.Close()    }}</code></pre><p>æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œä¸‹é¢çš„å†…å®¹ä¼šè¾“å‡ºåˆ°æ–‡ä»¶â€”â€”test.log ä¸­ã€‚</p><pre><code>2019-10-27T15:50:32.944+0800    DEBUG    logic/temp2.go:48    Trying to hit GET request for www.sogo.com2019-10-27T15:50:32.944+0800    ERROR    logic/temp2.go:51    Error fetching URL www.sogo.com : Error = Get www.sogo.com: unsupported protocol scheme &quot;&quot;2019-10-27T15:50:32.944+0800    DEBUG    logic/temp2.go:48    Trying to hit GET request for http://www.sogo.com2019-10-27T15:50:33.165+0800    INFO    logic/temp2.go:53    Success! statusCode = 200 OK for URL http://www.sogo.com</code></pre><p>åŒæ—¶ï¼Œå¯ä»¥åœ¨<code>main</code>å‡½æ•°ä¸­å¾ªç¯è®°å½•æ—¥å¿—ï¼Œæµ‹è¯•æ—¥å¿—æ–‡ä»¶æ˜¯å¦ä¼šè‡ªåŠ¨åˆ‡å‰²å’Œå½’æ¡£ï¼ˆæ—¥å¿—æ–‡ä»¶æ¯ 1MB ä¼šåˆ‡å‰²å¹¶ä¸”åœ¨å½“å‰ç›®å½•ä¸‹æœ€å¤šä¿å­˜ 5 ä¸ªå¤‡ä»½ï¼‰ã€‚<br>â€‹</p><h1 id="4ã€ä½¿ç”¨rotatelogså®ç°æ—¥å¿—æ–‡ä»¶å¤„ç†"><a href="#4ã€ä½¿ç”¨rotatelogså®ç°æ—¥å¿—æ–‡ä»¶å¤„ç†" class="headerlink" title="4ã€ä½¿ç”¨rotatelogså®ç°æ—¥å¿—æ–‡ä»¶å¤„ç†"></a>4ã€ä½¿ç”¨rotatelogså®ç°æ—¥å¿—æ–‡ä»¶å¤„ç†</h1><h2 id="4-1-å½“å‰é—®é¢˜"><a href="#4-1-å½“å‰é—®é¢˜" class="headerlink" title="4.1 å½“å‰é—®é¢˜"></a>4.1 å½“å‰é—®é¢˜</h2><p>æˆ‘ä»¬å½“å‰è¿˜å­˜åœ¨ç€ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>ç”Ÿæˆçš„æ—¥å¿—å¹¶æœªåŒ…å«æ—¥æœŸåç¼€ï¼ŒLumberjackåœ¨å¤‡ä»½æ—¶ä¼šåŒ…å«</li><li>æ‰€æœ‰çº§åˆ«çš„æ—¥å¿—éƒ½å†™åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­äº†ï¼Œéœ€è¦æ ¹æ®æ—¥å¿—çº§åˆ«å†™å…¥ä¸åŒæ–‡ä»¶</li></ol><p>è¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ªåŸºäºzap + â€œgithub.com/lestrrat/go-file-rotatelogsâ€ å·¥å…·çš„å·¥å…·ç±»ï¼Œå®Œæˆè‡ªåŠ¨è¿½åŠ æ—¥æœŸåç¼€ï¼Œå¹¶å°†ä¸åŒæ—¥å¿—çº§åˆ«çš„æ—¥å¿—å†™å…¥ä¸åŒçš„æ–‡ä»¶ã€‚æ•ˆæœå¦‚ä¸‹ï¼š<br><img alt="image.png" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1636536668444-0231425e-4af9-422b-abc3-2ed8dcee7567.png" class="lazyload"></p><h2 id="4-2-æ—¥å¿—å·¥å…·ç±»ï¼š"><a href="#4-2-æ—¥å¿—å·¥å…·ç±»ï¼š" class="headerlink" title="4.2 æ—¥å¿—å·¥å…·ç±»ï¼š"></a>4.2 æ—¥å¿—å·¥å…·ç±»ï¼š</h2><pre><code class="go">package zaplogimport (    rotatelogs &quot;github.com/lestrrat/go-file-rotatelogs&quot;    &quot;go.uber.org/zap&quot;    &quot;go.uber.org/zap/zapcore&quot;    &quot;os&quot;    &quot;path/filepath&quot;    &quot;sync&quot;    &quot;time&quot;)type Options struct {    LogFileDir    string    //æ—¥å¿—è·¯å¾„    AppName       string    // Filenameæ˜¯è¦å†™å…¥æ—¥å¿—çš„æ–‡ä»¶å‰ç¼€    ErrorFileName string    WarnFileName  string    InfoFileName  string    DebugFileName string    MaxSize       int    // ä¸€ä¸ªæ–‡ä»¶å¤šå°‘ï¼­å¤§äºè¯¥æ•°å­—å¼€å§‹åˆ‡åˆ†æ–‡ä»¶    MaxBackups    int    // MaxBackupsæ˜¯è¦ä¿ç•™çš„æœ€å¤§æ—§æ—¥å¿—æ–‡ä»¶æ•°    MaxAge        int    // MaxAgeæ˜¯æ ¹æ®æ—¥æœŸä¿ç•™æ—§æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤©æ•°    zap.Config}var (    logger                         *Logger    sp                             = string(filepath.Separator)    errWS, warnWS, infoWS, debugWS zapcore.WriteSyncer       // IOè¾“å‡º    debugConsoleWS                 = zapcore.Lock(os.Stdout) // æ§åˆ¶å°æ ‡å‡†è¾“å‡º    errorConsoleWS                 = zapcore.Lock(os.Stderr))func init() {    logger = &amp;Logger{        Opts: &amp;Options{},    }}type Logger struct {    *zap.SugaredLogger    sync.RWMutex    Opts      *Options `json:&quot;opts&quot;`    zapConfig zap.Config    inited    bool}func initLogger(cf ...*Options) {    logger.Lock()    defer logger.Unlock()    if logger.inited {        logger.Info(&quot;[initLogger] logger Inited&quot;)        return    }    if len(cf) &gt; 0 {        logger.Opts = cf[0]    }    logger.loadCfg()    logger.init()    logger.Info(&quot;[initLogger] zap plugin initializing completed&quot;)    logger.inited = true}// GetLogger returns loggerfunc GetLogger() (ret *Logger) {    return logger}func (l *Logger) init() {    l.setSyncers()    var err error    mylogger, err := l.zapConfig.Build(l.cores())    if err != nil {        panic(err)    }    l.SugaredLogger = mylogger.Sugar()    defer l.SugaredLogger.Sync()}func (l *Logger) loadCfg() {    if l.Opts.Development {        l.zapConfig = zap.NewDevelopmentConfig()        l.zapConfig.EncoderConfig.EncodeTime = timeEncoder    } else {        l.zapConfig = zap.NewProductionConfig()        l.zapConfig.EncoderConfig.EncodeTime = timeUnixNano    }    if l.Opts.OutputPaths == nil || len(l.Opts.OutputPaths) == 0 {        l.zapConfig.OutputPaths = []string{&quot;stdout&quot;}    }    if l.Opts.ErrorOutputPaths == nil || len(l.Opts.ErrorOutputPaths) == 0 {        l.zapConfig.OutputPaths = []string{&quot;stderr&quot;}    }    // é»˜è®¤è¾“å‡ºåˆ°ç¨‹åºè¿è¡Œç›®å½•çš„logså­ç›®å½•    if l.Opts.LogFileDir == &quot;&quot; {        l.Opts.LogFileDir, _ = filepath.Abs(filepath.Dir(filepath.Join(&quot;.&quot;)))        l.Opts.LogFileDir += sp + &quot;logs&quot; + sp    }    if l.Opts.AppName == &quot;&quot; {        l.Opts.AppName = &quot;app&quot;    }    if l.Opts.ErrorFileName == &quot;&quot; {        l.Opts.ErrorFileName = &quot;error.log&quot;    }    if l.Opts.WarnFileName == &quot;&quot; {        l.Opts.WarnFileName = &quot;warn.log&quot;    }    if l.Opts.InfoFileName == &quot;&quot; {        l.Opts.InfoFileName = &quot;info.log&quot;    }    if l.Opts.DebugFileName == &quot;&quot; {        l.Opts.DebugFileName = &quot;debug.log&quot;    }    if l.Opts.MaxSize == 0 {        l.Opts.MaxSize = 100    }    if l.Opts.MaxBackups == 0 {        l.Opts.MaxBackups = 30    }    if l.Opts.MaxAge == 0 {        l.Opts.MaxAge = 30    }}func (l *Logger) setSyncers() {    f := func(fN string) zapcore.WriteSyncer {        //return zapcore.AddSync(&amp;lumberjack.Logger{        //    Filename:   logger.Opts.LogFileDir + sp + logger.Opts.AppName + &quot;-&quot; + fN,        //    MaxSize:    logger.Opts.MaxSize,        //    MaxBackups: logger.Opts.MaxBackups,        //    MaxAge:     logger.Opts.MaxAge,        //    Compress:   true,        //    LocalTime:  true,        //})        // æ¯å°æ—¶ä¸€ä¸ªæ–‡ä»¶        logf, _ := rotatelogs.New(l.Opts.LogFileDir + sp + l.Opts.AppName + &quot;-&quot; + fN +&quot;.%Y_%m%d_%H&quot;,            rotatelogs.WithLinkName(l.Opts.LogFileDir + sp + l.Opts.AppName + &quot;-&quot; + fN),            rotatelogs.WithMaxAge(30*24*time.Hour),            rotatelogs.WithRotationTime(time.Minute),        )        return zapcore.AddSync(logf)    }    errWS = f(l.Opts.ErrorFileName)    warnWS = f(l.Opts.WarnFileName)    infoWS = f(l.Opts.InfoFileName)    debugWS = f(l.Opts.DebugFileName)    return}func (l *Logger) cores() zap.Option {    fileEncoder := zapcore.NewJSONEncoder(l.zapConfig.EncoderConfig)    //consoleEncoder := zapcore.NewConsoleEncoder(logger.zapConfig.EncoderConfig)    encoderConfig := zap.NewDevelopmentEncoderConfig()    encoderConfig.EncodeTime = timeEncoder    consoleEncoder := zapcore.NewConsoleEncoder(encoderConfig)    errPriority := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool {        return lvl &gt; zapcore.WarnLevel &amp;&amp; zapcore.WarnLevel-l.zapConfig.Level.Level() &gt; -1    })    warnPriority := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool {        return lvl == zapcore.WarnLevel &amp;&amp; zapcore.WarnLevel-l.zapConfig.Level.Level() &gt; -1    })    infoPriority := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool {        return lvl == zapcore.InfoLevel &amp;&amp; zapcore.InfoLevel-l.zapConfig.Level.Level() &gt; -1    })    debugPriority := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool {        return lvl == zapcore.DebugLevel &amp;&amp; zapcore.DebugLevel-l.zapConfig.Level.Level() &gt; -1    })    cores := []zapcore.Core{        zapcore.NewCore(fileEncoder, errWS, errPriority),        zapcore.NewCore(fileEncoder, warnWS, warnPriority),        zapcore.NewCore(fileEncoder, infoWS, infoPriority),        zapcore.NewCore(fileEncoder, debugWS, debugPriority),    }    if l.Opts.Development {        cores = append(cores, []zapcore.Core{            zapcore.NewCore(consoleEncoder, errorConsoleWS, errPriority),            zapcore.NewCore(consoleEncoder, debugConsoleWS, warnPriority),            zapcore.NewCore(consoleEncoder, debugConsoleWS, infoPriority),            zapcore.NewCore(consoleEncoder, debugConsoleWS, debugPriority),        }...)    }    return zap.WrapCore(func(c zapcore.Core) zapcore.Core {        return zapcore.NewTee(cores...)    })}func timeEncoder(t time.Time, enc zapcore.PrimitiveArrayEncoder) {    enc.AppendString(t.Format(&quot;2006-01-02 15:04:05&quot;))}func timeUnixNano(t time.Time, enc zapcore.PrimitiveArrayEncoder) {    enc.AppendInt64(t.UnixNano() / 1e6)}</code></pre><h2 id="4-3-æµ‹è¯•"><a href="#4-3-æµ‹è¯•" class="headerlink" title="4.3 æµ‹è¯•"></a>4.3 æµ‹è¯•</h2><pre><code class="go">package zaplogimport (    &quot;fmt&quot;    &quot;go.uber.org/zap&quot;    &quot;testing&quot;    &quot;time&quot;)func TestZapLog(t *testing.T) {    data := &amp;Options{        LogFileDir: &quot;/Users/didi/code/golang/learn-go/zap_log/v3/logs&quot;,        AppName:    &quot;logtool&quot;,        MaxSize:    30,        MaxBackups: 7,        MaxAge:     7,        Config:     zap.Config{},    }    data.Development = true    initLogger(data)    for i := 0; i &lt; 2; i++ {        time.Sleep(time.Second)        logger.Debug(fmt.Sprint(&quot;debug log &quot;, i), zap.Int(&quot;line&quot;, 999))        logger.Info(fmt.Sprint(&quot;Info log &quot;, i), zap.Any(&quot;level&quot;, &quot;1231231231&quot;))        logger.Warn(fmt.Sprint(&quot;warn log &quot;, i), zap.String(&quot;level&quot;, `{&quot;a&quot;:&quot;4&quot;,&quot;b&quot;:&quot;5&quot;}`))        logger.Error(fmt.Sprint(&quot;err log &quot;, i), zap.String(&quot;level&quot;, `{&quot;a&quot;:&quot;7&quot;,&quot;b&quot;:&quot;8&quot;}`))    }}</code></pre><p>è‡³æ­¤ï¼Œæˆ‘ä»¬æ€»ç»“äº†å¦‚ä½•å°† Zap æ—¥å¿—ç¨‹åºé›†æˆåˆ° Go åº”ç”¨ç¨‹åºé¡¹ç›®ä¸­ã€‚ç°åœ¨æ•´ä¸ªgolangçš„æ—¥å¿—ä½“ç³»å°±æ¯”è¾ƒå®Œå¤‡äº†ï¼Œå”¯ä¸€æ¬ ç¼ºä¸€ç‚¹çš„å°±æ˜¯æ—¥å¿—ä¸­æœªæ¥å…¥traceï¼Œä¸èƒ½å½¢æˆå®Œæ•´çš„æ—¥å¿—é“¾è·¯è¿½è¸ªï¼Œåç»­æˆ‘ä¼šåœ¨zapç»“åˆginæ¡†æ¶ä½¿ç”¨ä¸€æ–‡ä¸­å°†æ­¤åŠŸèƒ½åˆ†äº«å‡ºæ¥ã€‚æˆ‘ä»¬ä¸‹æœŸè§ï¼ŒPeaceğŸ˜˜</p><blockquote><p>æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä¸ªåŠ±å¿—ç”¨æœ€ç®€å•çš„è¯­è¨€ï¼Œæè¿°æœ€å¤æ‚é—®é¢˜çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚<strong>æ±‚ç‚¹èµï¼Œæ±‚å…³æ³¨</strong>ï¼Œå¦‚æœä½ å¯¹æ­¤ç¯‡æ–‡ç« æœ‰ä»€ä¹ˆç–‘æƒ‘ï¼Œæ¬¢è¿åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ä¸­ç•™è¨€ï¼Œæˆ‘è¿˜å¯ä»¥ä¸ºä½ æä¾›ä»¥ä¸‹å¸®åŠ©ï¼š</p><ul><li>å¸®åŠ©å»ºç«‹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»</li><li>äº’è”ç½‘çœŸå®é«˜å¹¶å‘åœºæ™¯å®æˆ˜è®²è§£</li><li>ä¸å®šæœŸåˆ†äº«Golangã€Javaç›¸å…³ä¸šå†…çš„ç»å…¸åœºæ™¯å®è·µ</li></ul><p>æˆ‘çš„åšå®¢ï¼š<a href="https://besthpt.github.io/" target="_blank" rel="noopener">https://besthpt.github.io/</a><br>æˆ‘çš„å¾®ä¿¡ï¼šbestbear666<br>å¾®ä¿¡å…¬ä¼—å·ï¼š<br><img alt="image.png" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1633094381436-599e5e08-34bf-4d7a-88fb-e9a4b30ebea3.png" class="lazyload"></p></blockquote><blockquote><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://liwenzhou.com/posts/Go/zap/" target="_blank" rel="noopener">https://liwenzhou.com/posts/Go/zap/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golangæ—¥å¿—å…¥é—¨ä¸æŠ€æœ¯é€‰å‹</title>
      <link href="/2021/11/17/10.Golang/Golang%E6%97%A5%E5%BF%97%E5%85%A5%E9%97%A8%E4%B8%8E%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%20(1)/"/>
      <url>/2021/11/17/10.Golang/Golang%E6%97%A5%E5%BF%97%E5%85%A5%E9%97%A8%E4%B8%8E%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%20(1)/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://liwenzhou.com/posts/Go/zap/" target="_blank" rel="noopener">https://liwenzhou.com/posts/Go/zap/</a></p></blockquote><p>æ— è®ºæ˜¯è½¯ä»¶å¼€å‘çš„è°ƒè¯•é˜¶æ®µè¿˜æ˜¯è½¯ä»¶ä¸Šçº¿ä¹‹åçš„è¿è¡Œé˜¶æ®µï¼Œæ—¥å¿—ä¸€ç›´éƒ½æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªç¯èŠ‚ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥å…»æˆåœ¨ç¨‹åºä¸­è®°å½•æ—¥å¿—çš„å¥½ä¹ æƒ¯ã€‚<br>Go è¯­è¨€å†…ç½®çš„<code>log</code>åŒ…å®ç°äº†ç®€å•çš„æ—¥å¿—æœåŠ¡ã€‚æœ¬æ–‡ä»‹ç»äº†æ ‡å‡†åº“<code>log</code>çš„åŸºæœ¬ä½¿ç”¨å’Œç¬¬ä¸‰æ—¥å¿—åº“çš„é€‰å‹å’Œä½¿ç”¨ã€‚</p><h1 id="1ã€åŸç”ŸLogger"><a href="#1ã€åŸç”ŸLogger" class="headerlink" title="1ã€åŸç”ŸLogger"></a>1ã€åŸç”ŸLogger</h1><p>log åŒ…å®šä¹‰äº† Logger ç±»å‹ï¼Œè¯¥ç±»å‹æä¾›äº†ä¸€äº›æ ¼å¼åŒ–è¾“å‡ºçš„æ–¹æ³•ã€‚æœ¬åŒ…ä¹Ÿæä¾›äº†ä¸€ä¸ªé¢„å®šä¹‰çš„ â€œæ ‡å‡†â€loggerï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨å‡½æ•°<code>Printç³»åˆ—</code>(Print|Printf|Printlnï¼‰ã€<code>Fatalç³»åˆ—</code>ï¼ˆFatal|Fatalf|Fatallnï¼‰ã€å’Œ<code>Panicç³»åˆ—</code>ï¼ˆPanic|Panicf|Paniclnï¼‰æ¥ä½¿ç”¨ï¼Œæ¯”è‡ªè¡Œåˆ›å»ºä¸€ä¸ª logger å¯¹è±¡æ›´å®¹æ˜“ä½¿ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢çš„ä»£ç ä¸€æ ·ç›´æ¥é€šè¿‡<code>log</code>åŒ…æ¥è°ƒç”¨ä¸Šé¢æåˆ°çš„æ–¹æ³•ï¼Œé»˜è®¤å®ƒä»¬ä¼šå°†æ—¥å¿—ä¿¡æ¯æ‰“å°åˆ°ç»ˆç«¯ç•Œé¢ï¼š</p><pre><code class="go">package mainimport (    &quot;log&quot;)func main() {    log.Println(&quot;è¿™æ˜¯ä¸€æ¡å¾ˆæ™®é€šçš„æ—¥å¿—ã€‚&quot;)    v := &quot;å¾ˆæ™®é€šçš„&quot;    log.Printf(&quot;è¿™æ˜¯ä¸€æ¡%sæ—¥å¿—ã€‚\n&quot;, v)    log.Fatalln(&quot;è¿™æ˜¯ä¸€æ¡ä¼šè§¦å‘fatalçš„æ—¥å¿—ã€‚&quot;)    log.Panicln(&quot;è¿™æ˜¯ä¸€æ¡ä¼šè§¦å‘panicçš„æ—¥å¿—ã€‚&quot;)}</code></pre><p>ç¼–è¯‘å¹¶æ‰§è¡Œä¸Šé¢çš„ä»£ç ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><pre><code>2017/06/19 14:04:17 è¿™æ˜¯ä¸€æ¡å¾ˆæ™®é€šçš„æ—¥å¿—ã€‚2017/06/19 14:04:17 è¿™æ˜¯ä¸€æ¡å¾ˆæ™®é€šçš„æ—¥å¿—ã€‚2017/06/19 14:04:17 è¿™æ˜¯ä¸€æ¡ä¼šè§¦å‘fatalçš„æ—¥å¿—ã€‚</code></pre><p>logger ä¼šæ‰“å°æ¯æ¡æ—¥å¿—ä¿¡æ¯çš„æ—¥æœŸã€æ—¶é—´ï¼Œé»˜è®¤è¾“å‡ºåˆ°ç³»ç»Ÿçš„æ ‡å‡†é”™è¯¯ã€‚Fatal ç³»åˆ—å‡½æ•°ä¼šåœ¨å†™å…¥æ—¥å¿—ä¿¡æ¯åè°ƒç”¨ os.Exit(1)ã€‚Panic ç³»åˆ—å‡½æ•°ä¼šåœ¨å†™å…¥æ—¥å¿—ä¿¡æ¯å panicã€‚</p><h2 id="1-1-é…ç½®-loggeré…ç½®"><a href="#1-1-é…ç½®-loggeré…ç½®" class="headerlink" title="1.1 é…ç½® loggeré…ç½®"></a>1.1 é…ç½® loggeré…ç½®</h2><p>é»˜è®¤æƒ…å†µä¸‹çš„ logger åªä¼šæä¾›æ—¥å¿—çš„æ—¶é—´ä¿¡æ¯ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬å¸Œæœ›å¾—åˆ°æ›´å¤šä¿¡æ¯ï¼Œæ¯”å¦‚è®°å½•è¯¥æ—¥å¿—çš„æ–‡ä»¶åå’Œè¡Œå·ç­‰ã€‚<code>log</code>æ ‡å‡†åº“ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†å®šåˆ¶è¿™äº›è®¾ç½®çš„æ–¹æ³•ã€‚<br><code>log</code>æ ‡å‡†åº“ä¸­çš„<code>Flags</code>å‡½æ•°ä¼šè¿”å›æ ‡å‡† logger çš„è¾“å‡ºé…ç½®ï¼Œè€Œ<code>SetFlags</code>å‡½æ•°ç”¨æ¥è®¾ç½®æ ‡å‡† logger çš„è¾“å‡ºé…ç½®ã€‚</p><pre><code>func Flags() intfunc SetFlags(flag int)</code></pre><h3 id="1-1-1-flag-é€‰é¡¹"><a href="#1-1-1-flag-é€‰é¡¹" class="headerlink" title="1.1.1 flag é€‰é¡¹"></a>1.1.1 flag é€‰é¡¹</h3><p><code>log</code>æ ‡å‡†åº“æä¾›äº†å¦‚ä¸‹çš„ flag é€‰é¡¹ï¼Œå®ƒä»¬æ˜¯ä¸€ç³»åˆ—å®šä¹‰å¥½çš„å¸¸é‡ã€‚</p><pre><code class="go">const (    // æ§åˆ¶è¾“å‡ºæ—¥å¿—ä¿¡æ¯çš„ç»†èŠ‚ï¼Œä¸èƒ½æ§åˆ¶è¾“å‡ºçš„é¡ºåºå’Œæ ¼å¼ã€‚    // è¾“å‡ºçš„æ—¥å¿—åœ¨æ¯ä¸€é¡¹åä¼šæœ‰ä¸€ä¸ªå†’å·åˆ†éš”ï¼šä¾‹å¦‚2009/01/23 01:23:23.123123 /a/b/c/d.go:23: message    Ldate         = 1 &lt;&lt; iota     // æ—¥æœŸï¼š2009/01/23    Ltime                         // æ—¶é—´ï¼š01:23:23    Lmicroseconds                 // å¾®ç§’çº§åˆ«çš„æ—¶é—´ï¼š01:23:23.123123ï¼ˆç”¨äºå¢å¼ºLtimeä½ï¼‰    Llongfile                     // æ–‡ä»¶å…¨è·¯å¾„å+è¡Œå·ï¼š /a/b/c/d.go:23    Lshortfile                    // æ–‡ä»¶å+è¡Œå·ï¼šd.go:23ï¼ˆä¼šè¦†ç›–æ‰Llongfileï¼‰    LUTC                          // ä½¿ç”¨UTCæ—¶é—´    LstdFlags     = Ldate | Ltime // æ ‡å‡†loggerçš„åˆå§‹å€¼)</code></pre><p>ä¸‹é¢æˆ‘ä»¬åœ¨è®°å½•æ—¥å¿—ä¹‹å‰å…ˆè®¾ç½®ä¸€ä¸‹æ ‡å‡† logger çš„è¾“å‡ºé€‰é¡¹å¦‚ä¸‹ï¼š</p><pre><code class="go">func main() {    log.SetFlags(log.Llongfile | log.Lmicroseconds | log.Ldate)    log.Println(&quot;è¿™æ˜¯ä¸€æ¡å¾ˆæ™®é€šçš„æ—¥å¿—ã€‚&quot;)}</code></pre><p>ç¼–è¯‘æ‰§è¡Œåå¾—åˆ°çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code class="go">2017/06/19 14:05:17.494943 .../log_demo/main.go:11: è¿™æ˜¯ä¸€æ¡å¾ˆæ™®é€šçš„æ—¥å¿—ã€‚</code></pre><h3 id="1-1-2-é…ç½®æ—¥å¿—å‰ç¼€"><a href="#1-1-2-é…ç½®æ—¥å¿—å‰ç¼€" class="headerlink" title="1.1.2 é…ç½®æ—¥å¿—å‰ç¼€"></a>1.1.2 é…ç½®æ—¥å¿—å‰ç¼€</h3><p><code>log</code>æ ‡å‡†åº“ä¸­è¿˜æä¾›äº†å…³äºæ—¥å¿—ä¿¡æ¯å‰ç¼€çš„ä¸¤ä¸ªæ–¹æ³•ï¼š</p><pre><code class="go">func Prefix() stringfunc SetPrefix(prefix string)</code></pre><p>å…¶ä¸­<code>Prefix</code>å‡½æ•°ç”¨æ¥æŸ¥çœ‹æ ‡å‡† logger çš„è¾“å‡ºå‰ç¼€ï¼Œ<code>SetPrefix</code>å‡½æ•°ç”¨æ¥è®¾ç½®è¾“å‡ºå‰ç¼€ã€‚</p><pre><code class="go">func main() {    log.SetFlags(log.Llongfile | log.Lmicroseconds | log.Ldate)    log.Println(&quot;è¿™æ˜¯ä¸€æ¡å¾ˆæ™®é€šçš„æ—¥å¿—ã€‚&quot;)    log.SetPrefix(&quot;[å°ç‹å­]&quot;)    log.Println(&quot;è¿™æ˜¯ä¸€æ¡å¾ˆæ™®é€šçš„æ—¥å¿—ã€‚&quot;)}</code></pre><p>ä¸Šé¢çš„ä»£ç è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code>[å°ç‹å­]2017/06/19 14:05:57.940542 .../log_demo/main.go:13: è¿™æ˜¯ä¸€æ¡å¾ˆæ™®é€šçš„æ—¥å¿—ã€‚</code></pre><p>è¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨ä»£ç ä¸­ä¸ºæˆ‘ä»¬çš„æ—¥å¿—ä¿¡æ¯æ·»åŠ æŒ‡å®šçš„å‰ç¼€ï¼Œæ–¹ä¾¿ä¹‹åå¯¹æ—¥å¿—ä¿¡æ¯è¿›è¡Œæ£€ç´¢å’Œå¤„ç†ã€‚</p><h3 id="1-1-3-é…ç½®æ—¥å¿—è¾“å‡ºä½ç½®"><a href="#1-1-3-é…ç½®æ—¥å¿—è¾“å‡ºä½ç½®" class="headerlink" title="1.1.3 é…ç½®æ—¥å¿—è¾“å‡ºä½ç½®"></a>1.1.3 é…ç½®æ—¥å¿—è¾“å‡ºä½ç½®</h3><pre><code class="go">func SetOutput(w io.Writer)</code></pre><p><code>SetOutput</code>å‡½æ•°ç”¨æ¥è®¾ç½®æ ‡å‡† logger çš„è¾“å‡ºç›®çš„åœ°ï¼Œé»˜è®¤æ˜¯æ ‡å‡†é”™è¯¯è¾“å‡ºã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ä¼šæŠŠæ—¥å¿—è¾“å‡ºåˆ°åŒç›®å½•ä¸‹çš„<code>xx.log</code>æ–‡ä»¶ä¸­ã€‚</p><pre><code class="go">func main() {    logFile, err := os.OpenFile(&quot;./xx.log&quot;, os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0644)    if err != nil {        fmt.Println(&quot;open log file failed, err:&quot;, err)        return    }    log.SetOutput(logFile)    log.SetFlags(log.Llongfile | log.Lmicroseconds | log.Ldate)    log.Println(&quot;è¿™æ˜¯ä¸€æ¡å¾ˆæ™®é€šçš„æ—¥å¿—ã€‚&quot;)    log.SetPrefix(&quot;[å°ç‹å­]&quot;)    log.Println(&quot;è¿™æ˜¯ä¸€æ¡å¾ˆæ™®é€šçš„æ—¥å¿—ã€‚&quot;)}</code></pre><p>å¦‚æœä½ è¦ä½¿ç”¨æ ‡å‡†çš„ loggerï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæŠŠä¸Šé¢çš„é…ç½®æ“ä½œå†™åˆ°<code>init</code>å‡½æ•°ä¸­ã€‚</p><pre><code class="go">func init() {    logFile, err := os.OpenFile(&quot;./xx.log&quot;, os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0644)    if err != nil {        fmt.Println(&quot;open log file failed, err:&quot;, err)        return    }    log.SetOutput(logFile)    log.SetFlags(log.Llongfile | log.Lmicroseconds | log.Ldate)}</code></pre><h2 id="1-2-åˆ›å»º-logger"><a href="#1-2-åˆ›å»º-logger" class="headerlink" title="1.2 åˆ›å»º logger"></a>1.2 åˆ›å»º logger</h2><p><code>log</code>æ ‡å‡†åº“ä¸­è¿˜æä¾›äº†ä¸€ä¸ªåˆ›å»ºæ–° logger å¯¹è±¡çš„æ„é€ å‡½æ•°â€“<code>New</code>ï¼Œæ”¯æŒæˆ‘ä»¬åˆ›å»ºè‡ªå·±çš„ logger ç¤ºä¾‹ã€‚<code>New</code>å‡½æ•°çš„ç­¾åå¦‚ä¸‹ï¼š</p><pre><code class="go">func New(out io.Writer, prefix string, flag int) *Logger</code></pre><p>New åˆ›å»ºä¸€ä¸ª Logger å¯¹è±¡ã€‚å…¶ä¸­ï¼Œå‚æ•° out è®¾ç½®æ—¥å¿—ä¿¡æ¯å†™å…¥çš„ç›®çš„åœ°ã€‚å‚æ•° prefix ä¼šæ·»åŠ åˆ°ç”Ÿæˆçš„æ¯ä¸€æ¡æ—¥å¿—å‰é¢ã€‚å‚æ•° flag å®šä¹‰æ—¥å¿—çš„å±æ€§ï¼ˆæ—¶é—´ã€æ–‡ä»¶ç­‰ç­‰ï¼‰ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><pre><code class="go">func main() {    logger := log.New(os.Stdout, &quot;&lt;New&gt;&quot;, log.Lshortfile|log.Ldate|log.Ltime)    logger.Println(&quot;è¿™æ˜¯è‡ªå®šä¹‰çš„loggerè®°å½•çš„æ—¥å¿—ã€‚&quot;)}</code></pre><p>å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘æ‰§è¡Œä¹‹åï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š</p><pre><code>&lt;New&gt;2017/06/19 14:06:51 main.go:34: è¿™æ˜¯è‡ªå®šä¹‰çš„loggerè®°å½•çš„æ—¥å¿—ã€‚</code></pre><h2 id="1-3-æ€»ç»“"><a href="#1-3-æ€»ç»“" class="headerlink" title="1.3 æ€»ç»“"></a>1.3 æ€»ç»“</h2><p>Go å†…ç½®çš„ log åº“åŠŸèƒ½æœ‰é™ï¼Œä¾‹å¦‚æ— æ³•æ»¡è¶³è®°å½•ä¸åŒçº§åˆ«æ—¥å¿—çš„æƒ…å†µï¼Œæˆ‘ä»¬åœ¨å®é™…çš„é¡¹ç›®ä¸­æ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ—¥å¿—åº“ï¼Œå¦‚ <a href="https://github.com/sirupsen/logrus" target="_blank" rel="noopener">logrus</a>ã€<a href="https://github.com/uber-go/zap" target="_blank" rel="noopener">zap</a> ç­‰ã€‚<br>â€‹</p><h1 id="2ã€ç¬¬ä¸‰æ–¹æ—¥å¿—åº“"><a href="#2ã€ç¬¬ä¸‰æ–¹æ—¥å¿—åº“" class="headerlink" title="2ã€ç¬¬ä¸‰æ–¹æ—¥å¿—åº“"></a>2ã€ç¬¬ä¸‰æ–¹æ—¥å¿—åº“</h1><h2 id="2-1-æ—¥å¿—é€‰å‹éœ€æ±‚æ•´ç†"><a href="#2-1-æ—¥å¿—é€‰å‹éœ€æ±‚æ•´ç†" class="headerlink" title="2.1 æ—¥å¿—é€‰å‹éœ€æ±‚æ•´ç†"></a>2.1 æ—¥å¿—é€‰å‹éœ€æ±‚æ•´ç†</h2><ol><li>æ—¥å¿—å†™å…¥æ€§èƒ½</li><li>æ—¥å¿—çº§åˆ«åˆ†ç¦»ï¼Œå¹¶ä¸”å¯åˆ†ç¦»æˆå¤šä¸ªæ—¥å¿—æ–‡ä»¶</li><li>å¯è¯»æ€§ä¸ç»“æ„åŒ–ï¼ŒJsonæ ¼å¼æˆ–æœ‰åˆ†éš”ç¬¦ï¼Œæ–¹ä¾¿åç»­çš„æ—¥å¿—é‡‡é›†ã€ç›‘æ§ç­‰</li><li>èƒ½å¤Ÿæ‰“å°åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚è°ƒç”¨æ–‡ä»¶ / å‡½æ•°åå’Œè¡Œå·ï¼Œæ—¥å¿—æ—¶é—´ç­‰</li><li>æ—¥å¿—ä¹¦å†™å‹å¥½ï¼Œæ”¯æŒé€šè¿‡contextè‡ªåŠ¨log traceç­‰</li><li>æ–‡ä»¶åˆ‡å‰²ï¼Œå¯æŒ‰å°æ—¶ã€å¤©è¿›è¡Œæ—¥å¿—æ‹†åˆ†ï¼Œæˆ–è€…æŒ‰æ–‡ä»¶å¤§å°</li><li>æ–‡ä»¶å®šæ—¶åˆ é™¤</li><li>å¼€æºæ€§ï¼Œä¸å…¶ä»–å¼€æºæ¡†æ¶æ”¯æŒè¾ƒå¥½</li><li>å¤šè¾“å‡º ï¼ åŒæ—¶æ”¯æŒæ ‡å‡†è¾“å‡ºï¼Œæ–‡ä»¶ç­‰</li></ol><h2 id="2-2-æ—¥å¿—æ¯”å¯¹"><a href="#2-2-æ—¥å¿—æ¯”å¯¹" class="headerlink" title="2.2 æ—¥å¿—æ¯”å¯¹"></a>2.2 æ—¥å¿—æ¯”å¯¹</h2><h3 id="2-2-1-åŠŸèƒ½æ¯”å¯¹"><a href="#2-2-1-åŠŸèƒ½æ¯”å¯¹" class="headerlink" title="2.2.1 åŠŸèƒ½æ¯”å¯¹"></a>2.2.1 åŠŸèƒ½æ¯”å¯¹</h3><blockquote><p>å‚è€ƒæ–‡æ¡£ï¼š</p><ul><li><a href="https://www.jianshu.com/p/38a67ab593ee" target="_blank" rel="noopener">https://www.jianshu.com/p/38a67ab593ee</a></li><li><a href="https://zhuanlan.zhihu.com/p/141321801" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/141321801</a></li><li>zerologï¼š<a href="https://zhuanlan.zhihu.com/p/136296821" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/136296821</a></li></ul></blockquote><p>æœçœ‹çš„è®¸å¤šæ—¥å¿—æ¡†æ¶ï¼Œæœ€åå‰©ä¸‹ä¸¤æ¬¾ç›®å‰æ˜æ˜¾æ€§èƒ½æ¯”è¾ƒå¥½çš„Uberå¼€æºçš„Zapå’ŒZeroLogï¼Œå‚è€ƒgithubä¸­å¼€æºé¡¹ç›®æ—¥å¿—å¼•ç”¨æƒ…å†µå’Œæ—¥å¿—å‘¨è¾¹æ¡†æ¶æ”¯æŒæœ€ç»ˆé€‰ç”¨Zapã€‚</p><table><thead><tr><th>éœ€æ±‚ç‚¹</th><th>go.uber.org/zap(å›½å†…ä¸€äº›å¼€æºé¡¹ç›®è§å¾—æ¯”è¾ƒå¤šã€æ€§èƒ½ä¹Ÿä¸é”™ã€æ¨è)</th><th>github.com/rs/zerolog</th></tr></thead><tbody><tr><td>æ—¥å¿—å†™å…¥æ€§èƒ½</td><td>è¾ƒé«˜</td><td>é«˜</td></tr><tr><td>æ—¥å¿—çº§åˆ«åˆ†ç¦»</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å¯è¯»æ€§ (Jsonæ ¼å¼æˆ–æœ‰åˆ†éš”ç¬¦ï¼Œæ–¹ä¾¿åç»­çš„æ—¥å¿—é‡‡é›†ã€ç›‘æ§ç­‰)</td><td>jsonæ ¼å¼</td><td>jsonæ ¼å¼</td></tr><tr><td>æ˜“ç”¨æ€§ï¼šæ¥å…¥æ–¹ä¾¿ï¼Œä¹¦å†™æ–¹ä¾¿ï¼ˆæ ¼å¼åŒ–ï¼‰ï¼Œå¯Hookæ³¨å…¥trace_idç­‰</td><td>è‡ªåŠ¨æ¥å…¥æ—¶é—´ã€ä»£ç ä¿¡æ¯ã€æ—¥å¿—çº§åˆ«ï¼Œæ”¯æŒHook</td><td>å¯æ”¯æŒæ¥å…¥æ—¶é—´ã€ä»£ç ä¿¡æ¯ã€æ—¥å¿—çº§åˆ«ç­‰ï¼Œæ”¯æŒHook</td></tr><tr><td>æ–‡ä»¶åˆ‡å‰² (å¯æŒ‰æ—¶é—´ã€æ–‡ä»¶å¤§å°æ—¥å¿—æ‹†åˆ†)</td><td>ä¸æ”¯æŒï¼Œå¯é€šè¿‡lumberjackå®ç°</td><td>æ”¯æŒ</td></tr><tr><td>å®šæ—¶åˆ é™¤</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å¤šè¾“å‡º ï¼ åŒæ—¶æ”¯æŒæ ‡å‡†è¾“å‡ºï¼Œæ–‡ä»¶ç­‰</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr></tbody></table><p></p><h3 id="2-2-3-æ€§èƒ½æ•°æ®æ¯”å¯¹"><a href="#2-2-3-æ€§èƒ½æ•°æ®æ¯”å¯¹" class="headerlink" title="2.2.3 æ€§èƒ½æ•°æ®æ¯”å¯¹"></a>2.2.3 æ€§èƒ½æ•°æ®æ¯”å¯¹</h3><p>æ ¹æ®Uber-go Zapçš„æ–‡æ¡£ï¼Œå®ƒçš„æ€§èƒ½æ¯”ç±»ä¼¼çš„ç»“æ„åŒ–æ—¥å¿—åŒ…æ›´å¥½â€”â€”ä¹Ÿæ¯”æ ‡å‡†åº“æ›´å¿«ã€‚ ä»¥ä¸‹æ˜¯Zapå‘å¸ƒçš„åŸºå‡†æµ‹è¯•ä¿¡æ¯<br>è®°å½•ä¸€æ¡æ¶ˆæ¯å’Œ10ä¸ªå­—æ®µ:<img alt="image.png" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1636515725486-2879df05-7f5f-4023-b2d3-891955d989ad.png" class="lazyload"><br>è®°å½•ä¸€ä¸ªé™æ€å­—ç¬¦ä¸²ï¼Œæ²¡æœ‰ä»»ä½•ä¸Šä¸‹æ–‡æˆ–printfé£æ ¼çš„æ¨¡æ¿ï¼š<br><img alt="image.png" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1636515725562-74541015-3c68-455f-a4ce-3ecee820248a.png" class="lazyload"><br>â€‹</p><p>ä¸‹ä¸€ç¯‡æˆ‘ä»¬ä¼šæ¥è®²è®²é«˜æ€§èƒ½æ—¥å¿—æ¡†æ¶Zapçš„ä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•æ»¡è¶³æˆ‘ä»¬å¯¹äºæ—¥å¿—æ¡†æ¶ä¸°å¯Œçš„ä½¿ç”¨éœ€æ±‚ï¼Œæˆ‘ä»¬ä¸‹æœŸè§ï¼ŒPeaceğŸ˜˜</p><blockquote><p>æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä¸ªåŠ±å¿—ç”¨æœ€ç®€å•çš„è¯­è¨€ï¼Œæè¿°æœ€å¤æ‚é—®é¢˜çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚<strong>æ±‚ç‚¹èµï¼Œæ±‚å…³æ³¨</strong>ï¼Œå¦‚æœä½ å¯¹æ­¤ç¯‡æ–‡ç« æœ‰ä»€ä¹ˆç–‘æƒ‘ï¼Œæ¬¢è¿åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ä¸­ç•™è¨€ï¼Œæˆ‘è¿˜å¯ä»¥ä¸ºä½ æä¾›ä»¥ä¸‹å¸®åŠ©ï¼š</p><ul><li>å¸®åŠ©å»ºç«‹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»</li><li>äº’è”ç½‘çœŸå®é«˜å¹¶å‘åœºæ™¯å®æˆ˜è®²è§£</li><li>ä¸å®šæœŸåˆ†äº«Golangã€Javaç›¸å…³ä¸šå†…çš„ç»å…¸åœºæ™¯å®è·µ</li></ul><p>æˆ‘çš„åšå®¢ï¼š<a href="https://besthpt.github.io/" target="_blank" rel="noopener">https://besthpt.github.io/</a><br>æˆ‘çš„å¾®ä¿¡ï¼šbestbear666<br>å¾®ä¿¡å…¬ä¼—å·ï¼š<br><img alt="image.png" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1633094381436-599e5e08-34bf-4d7a-88fb-e9a4b30ebea3.png" class="lazyload"></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¯ä»¶ç ”å‘è¿‡ç¨‹ä¸­çš„5ç§æœ€å¸¸è§çš„å›¾</title>
      <link href="/2021/11/08/9.%E5%90%8E%E7%AB%AF%E5%BF%83%E5%BE%97%E5%88%86%E4%BA%AB/%E8%BD%AF%E4%BB%B6%E7%A0%94%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%845%E7%A7%8D%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9B%BE/"/>
      <url>/2021/11/08/9.%E5%90%8E%E7%AB%AF%E5%BF%83%E5%BE%97%E5%88%86%E4%BA%AB/%E8%BD%AF%E4%BB%B6%E7%A0%94%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%845%E7%A7%8D%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€èƒŒæ™¯"><a href="#ä¸€ã€èƒŒæ™¯" class="headerlink" title="ä¸€ã€èƒŒæ™¯"></a>ä¸€ã€èƒŒæ™¯</h2><p>è½¯ä»¶ç ”å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸æœ‰å¦‚ä¸‹çš„å›°æƒ‘ï¼š</p><ol><li>æœ‰æ—¶æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªè¾ƒå¤§å‹çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œæˆ–è€…åšä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å°†è¿™ä¸ªç³»ç»Ÿçš„æ•´ä½“åŠŸèƒ½ã€é€»è¾‘ç»†èŠ‚ä¸€å±‚å±‚æè¿°æ¸…æ¥šå‘¢ï¼Ÿ</li><li>æˆ‘ä»¬æ¥æ‰‹äº†ä¸€ä¸ªå¤§å‹å¤æ‚çš„ç³»ç»Ÿï¼Œè¯¥å¦‚ä½•ä¸€ç‚¹ç‚¹ä»å®è§‚åˆ°å¾®è§‚çš„å»æ¢³ç†æ•´ä¸ªåŠŸèƒ½æµè½¬çš„è„‰ç»œå‘¢?</li></ol><p>é€šè¿‡ç®€å•ç»˜åˆ¶ç³»ç»Ÿçš„æ¶æ„å›¾ã€å„æ¨¡å—ä¹‹é—´çš„æ¥å£äº¤äº’å’Œæ—¶åºå›¾ç­‰ï¼Œæˆ‘å¯ä»¥æ›´åŠ ç›´è§‚åœ°ç†è§£æ•´ä¸ªç³»ç»Ÿçš„è¿ä½œæ¨¡å¼ï¼Œæ‰€è°“çš„ç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ã€‚</p><h2 id="äºŒã€ç³»ç»Ÿæ¶æ„å›¾"><a href="#äºŒã€ç³»ç»Ÿæ¶æ„å›¾" class="headerlink" title="äºŒã€ç³»ç»Ÿæ¶æ„å›¾"></a>äºŒã€ç³»ç»Ÿæ¶æ„å›¾</h2><p>ç³»ç»Ÿæ¶æ„å›¾å¾€å¾€ç”¨äºè½¯ä»¶ç ”å‘çš„æ€»ä½“è®¾è®¡é˜¶æ®µï¼Œé€šè¿‡ç®€å•åˆ†å±‚æ¥å±•ç¤ºä¸åŒå±‚æ¬¡çš„æ¨¡å—ï¼Œå†åŠ ä¸ŠåŸºç¡€æœåŠ¡ã€å…¬å…±æœåŠ¡å’Œç›‘æ§æœåŠ¡ç­‰ï¼Œå°±æ„æˆäº†ç³»ç»Ÿå±‚é¢çš„ä¸€ä¸ªå®è§‚çš„è½®å»“ã€‚æ— è®ºæ˜¯å¸¸è§çš„MVCæ¶æ„ã€è¿˜æ˜¯DDDæ¶æ„åœ¨æ•´ä½“ç³»ç»Ÿè®¾è®¡å±‚é¢éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œä¸€ä¸ªå®Œæ•´æ¸…æ™°çš„ç³»ç»Ÿæ¶æ„å›¾å¾€å¾€ä¼šæœ‰ä»¥ä¸‹ç”¨é€”ï¼š</p><ul><li>é˜æ˜äº†ç³»ç»Ÿçš„å„ç§ä¾èµ–ï¼ŒåŒ…æ‹¬åº•å±‚ä¸­é—´ä»¶ã€å¤–éƒ¨ç³»ç»Ÿã€ç›‘æ§ç³»ç»Ÿç­‰ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„å»ºç«‹æ•´ä¸ªç³»ç»Ÿçš„ç›‘æ§ä½“ç³»ï¼Œäº†è§£ç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆç‚¹ç­‰</li><li>åœ¨ä¸šåŠ¡å±‚é˜è¿°äº†ç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½æ¨¡å—ï¼Œå¯ä»¥å¥½ä¸”å¿«å¯¹å¤–ä»‹ç»æˆ‘ä»¬çš„ç³»ç»Ÿ</li><li>é˜è¿°äº†ç³»ç»Ÿçš„æ•´ä½“æŠ€æœ¯æ¶æ„ï¼Œæ˜¯å¾®æœåŠ¡åŒ–çš„ï¼Œè¿˜æ˜¯å•ä½“çš„ï¼›æœ‰æ²¡æœ‰ç½‘å…³å±‚ã€åŸºç¡€ç»„ä»¶å±‚ç­‰</li></ul><p>è¿™é‡Œæœ‰ä¸¤å¼ æŠ½è±¡çš„ç³»ç»Ÿæ¶æ„ä¾›å‚è€ƒï¼š<br><img alt="image1" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/image1.png" class="lazyload"></p><p><img alt="image2" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/image2.png" class="lazyload"></p><h2 id="ä¸‰ã€æ—¶åºå›¾"><a href="#ä¸‰ã€æ—¶åºå›¾" class="headerlink" title="ä¸‰ã€æ—¶åºå›¾"></a>ä¸‰ã€æ—¶åºå›¾</h2><p>æ—¶åºå›¾ä¸€èˆ¬ç”¨äºè½¯ä»¶ç ”å‘çš„è¯¦ç»†è®¾è®¡é˜¶æ®µï¼Œå¯ä»¥ç”¨æ¥æè¿°<strong>ç³»ç»Ÿé—´</strong>ã€<strong>å¾®æœåŠ¡é—´</strong>ã€æˆ–è€…æ˜¯<strong>åŠŸèƒ½æ¨¡å—é—´</strong>çš„äº¤äº’è¿‡ç¨‹ï¼Œå®ƒå±•ç¤ºäº†ç³»ç»Ÿçš„æ€»ä½“è°ƒç”¨é“¾è·¯ï¼Œå’Œæ•°æ®æµè½¬çš„è¿‡ç¨‹ã€‚åŸºäºæ—¶åºå›¾æˆ‘ä»¬å¯ä»¥åšä»¥ä¸‹äº‹æƒ…ï¼š</p><ul><li>ç­¾ç½²æœåŠ¡é—´çš„SLAï¼Œå¸®åŠ©æˆ‘ä»¬æ¨åŠ¨å¾®æœåŠ¡æ²»ç†</li><li>å®è§‚ä¸Šæ¸…æ™°çš„æè¿°äº†åŠŸèƒ½å®ç°çš„è¿‡ç¨‹ï¼ˆä¸šåŠ¡æµè½¬ã€æ•°æ®æµè½¬ï¼‰ï¼ŒååŠ©æˆ‘ä»¬åœ¨è®¾è®¡æ—¶æ€è€ƒï¼Œä»¥é˜²é—æ¼è®¾è®¡ç»†èŠ‚</li></ul><p><img alt="3" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/3.png" class="lazyload"></p><h2 id="å››ã€ç¨‹åºæµç¨‹å›¾"><a href="#å››ã€ç¨‹åºæµç¨‹å›¾" class="headerlink" title="å››ã€ç¨‹åºæµç¨‹å›¾"></a>å››ã€ç¨‹åºæµç¨‹å›¾</h2><p>è¯¦ç»†è®¾è®¡é˜¶æ®µï¼Œåœ¨ç³»ç»Ÿå†…éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦æ¸…æ™°çš„æè¿°ä¸šåŠ¡å®ç°çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬é¡ºåºé€»è¾‘ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯é€»è¾‘ç­‰ã€‚æ˜¯æˆ‘ä»¬åœ¨æŠ€æœ¯reviewé˜¶æ®µçš„é‡è¦å·¥å…·ï¼ŒåŸºæœ¬ç¨‹åºæµç¨‹å›¾è®¾è®¡å¥½ï¼Œä»£ç ä¸­çš„å¯èƒ½å¼‚å¸¸å’Œé£é™©ç‚¹ä¹Ÿå°±åˆ†æçš„å·®ä¸å¤šäº†ï¼ŒåŸºæœ¬å°±å¯ä»¥ç›´æ¥ç…§ç€æµç¨‹å›¾è¿›è¡Œç¼–ç äº†ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒæ³¨é‡ç³»ç»Ÿç¨³å®šæ€§çš„å›¢é˜Ÿï¼Œåœ¨æ­¤é˜¶æ®µèŠ±è´¹çš„æ—¶é—´ï¼Œæœ‰æ—¶è¦æ¯”ç¼–ç æ—¶é—´è¿˜é•¿ğŸ˜‚ </p><p><img alt="image3" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/image3.png" class="lazyload"></p><h2 id="äº”ã€çŠ¶æ€æµè½¬å›¾"><a href="#äº”ã€çŠ¶æ€æµè½¬å›¾" class="headerlink" title="äº”ã€çŠ¶æ€æµè½¬å›¾"></a>äº”ã€çŠ¶æ€æµè½¬å›¾</h2><p>æœ‰æ—¶é™¤äº†å…³ç³»ä¸šåŠ¡å¤„ç†é€»è¾‘ï¼Œè¿˜è¦å…³å¿ƒå¯¹è±¡çŠ¶æ€çš„æµè½¬ï¼Œè¿™é‡Œæˆªå–äº†ä¸€ä¸ªç”µå•†ç½‘ç«™åœ¨ä¸‹å•æ—¶çš„è®¢å•çŠ¶æ€æµè½¬çš„ç¤ºä¾‹ã€‚</p><p><img alt="43" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/43.png" class="lazyload"></p><h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>æœ¬æ–‡åˆ—ä¸¾äº†è½¯ä»¶å·¥ç¨‹è®¾è®¡é˜¶æ®µæœ€ä¸ºå¸¸è§çš„5ç§å›¾ï¼Œæ¸…æ™°çš„è½¯ä»¶å·¥ç¨‹çš„å›¾å¯ä»¥æ›´åŠ ç›´è§‚çš„è¡¨è¾¾å‡ºæˆ‘ä»¬çš„è®¾è®¡æ„æ„¿ï¼Œå»ºç«‹èµ·ä¸å…¶ä»–é¡¹ç›®å‚ä¸è€…æ²Ÿé€šçš„æ¡¥æ¢ï¼›è¿˜æœ‰åŠ©äºè®©æˆ‘ä»¬çš„è®¾è®¡æ€è€ƒæ›´åŠ ä¸¥å¯†ï¼›å¦å¤–è¿˜æœ‰åŠ©äºæ•´ä½“é¡¹ç›®æ–‡æ¡£çš„å»ºè®¾ï¼Œå¸®å¿™æ–°äººå¿«é€Ÿä¸Šæ‰‹é¡¹ç›®ã€‚<br>å…³äºè½¯ä»¶å·¥ç¨‹ä¸­å¸¸è§çš„5ä¸­å›¾å°±ä»‹ç»åˆ°è¿™é‡Œå•¦ï¼Œæˆ‘ä»¬ä¸‹æœŸè§ï¼ŒPeace ğŸ˜˜ </p><blockquote><p>æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä¸ªåŠ±å¿—ç”¨æœ€ç®€å•çš„è¯­è¨€ï¼Œæè¿°æœ€å¤æ‚é—®é¢˜çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚<strong>æ±‚ç‚¹èµï¼Œæ±‚å…³æ³¨</strong>ï¼Œå¦‚æœä½ å¯¹æ­¤ç¯‡æ–‡ç« æœ‰ä»€ä¹ˆç–‘æƒ‘ï¼Œæ¬¢è¿åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ä¸­ç•™è¨€ï¼Œæˆ‘è¿˜å¯ä»¥ä¸ºä½ æä¾›ä»¥ä¸‹å¸®åŠ©ï¼š</p><ul><li>å¸®åŠ©å»ºç«‹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»</li><li>äº’è”ç½‘çœŸå®é«˜å¹¶å‘åœºæ™¯å®æˆ˜è®²è§£</li><li>ä¸å®šæœŸåˆ†äº«Golangã€Javaç›¸å…³ä¸šå†…çš„ç»å…¸åœºæ™¯å®è·µ</li></ul></blockquote><p>æˆ‘çš„åšå®¢ï¼š<a href="https://besthpt.github.io/" target="_blank" rel="noopener">https://besthpt.github.io/</a></p><blockquote><p>å¾®ä¿¡å…¬ä¼—å·ï¼š<br><img alt="image" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/image.png" class="lazyload"></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯åˆ†äº«å¿ƒå¾— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯åˆ†äº«å¿ƒå¾— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€ä½³å®è·µä¹‹Golangé”™è¯¯å¤„ç†</title>
      <link href="/2021/11/05/10.Golang/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B9%8BGolang%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/"/>
      <url>/2021/11/05/10.Golang/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B9%8BGolang%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€åŸç”Ÿé”™è¯¯å¤„ç†"><a href="#1ã€åŸç”Ÿé”™è¯¯å¤„ç†" class="headerlink" title="1ã€åŸç”Ÿé”™è¯¯å¤„ç†"></a>1ã€åŸç”Ÿé”™è¯¯å¤„ç†</h1><p>Go è¯­è¨€é€šè¿‡å†…ç½®çš„é”™è¯¯æ¥å£æä¾›äº†éå¸¸ç®€å•çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚<br>errorç±»å‹æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œè¿™æ˜¯å®ƒçš„å®šä¹‰ï¼š<br>type error interface {<br>    Error() string<br>}<br>â€‹</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ç¼–ç ä¸­é€šè¿‡å®ç° error æ¥å£ç±»å‹æ¥ç”Ÿæˆé”™è¯¯ä¿¡æ¯ã€‚<br>å‡½æ•°é€šå¸¸åœ¨æœ€åçš„è¿”å›å€¼ä¸­è¿”å›é”™è¯¯ä¿¡æ¯ã€‚ä½¿ç”¨errors.New å¯è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼š</p><pre><code class="go">func Sqrt(f float64) (float64, error) {    if f &lt; 0 {        return 0, errors.New(&quot;math: square root of negative number&quot;)    }    // å®ç°}</code></pre><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨Sqrtçš„æ—¶å€™ä¼ é€’çš„ä¸€ä¸ªè´Ÿæ•°ï¼Œç„¶åå°±å¾—åˆ°äº†non-nilçš„errorå¯¹è±¡ï¼Œå°†æ­¤å¯¹è±¡ä¸nilæ¯”è¾ƒï¼Œç»“æœä¸ºtrueï¼Œæ‰€ä»¥fmt.Println(fmtåŒ…åœ¨å¤„ç†erroræ—¶ä¼šè°ƒç”¨Erroræ–¹æ³•)è¢«è°ƒç”¨ï¼Œä»¥è¾“å‡ºé”™è¯¯ï¼Œè¯·çœ‹ä¸‹é¢è°ƒç”¨çš„ç¤ºä¾‹ä»£ç ï¼š</p><pre><code class="go">result, err:= Sqrt(-1)if err != nil {   fmt.Println(err)}</code></pre><h1 id="2ã€å¼€æºerroråŒ…"><a href="#2ã€å¼€æºerroråŒ…" class="headerlink" title="2ã€å¼€æºerroråŒ…"></a>2ã€å¼€æºerroråŒ…</h1><p>github.com/pkg/errorsåŒ…åœ¨åŸç”ŸerroråŒ…åŸºç¡€ä¸Šå¢åŠ äº†ä»¥ä¸‹å¸¸ç”¨çš„åŠŸèƒ½ï¼š</p><ul><li>å¯ä»¥æ‰“å°errorçš„å †æ ˆä¿¡æ¯ï¼šæ‰“å°é”™è¯¯éœ€è¦%+væ‰èƒ½è¯¦ç»†è¾“å‡º</li><li>ä½¿ç”¨Wrapæˆ–Wrapfï¼Œåˆå§‹åŒ–ä¸€ä¸ªerror</li><li>ä½¿ç”¨errors.WithMessageå¯ä»¥åœ¨åŸæ¥çš„erroråŸºç¡€ä¸Šå†åŒ…è£…ä¸€å±‚ï¼ŒåŒ…å«åŸæœ‰errorä¿¡æ¯</li><li>errors.Isï¼Œç”¨äºåˆ¤æ–­errorç±»å‹ï¼Œå¯æ ¹æ®errorç±»å‹ä¸åŒåšä¸åŒå¤„ç†</li><li>errors.Asï¼Œç”¨äºè§£æerror</li></ul><p>å…·ä½“ä½¿ç”¨æ¡ˆä¾‹è§å…¨å±€é”™è¯¯å¤„ç†ä¸€èŠ‚ã€‚<br></p><h1 id="3ã€å·¥ç¨‹ä¸­é”™è¯¯å¤„ç†"><a href="#3ã€å·¥ç¨‹ä¸­é”™è¯¯å¤„ç†" class="headerlink" title="3ã€å·¥ç¨‹ä¸­é”™è¯¯å¤„ç†"></a>3ã€å·¥ç¨‹ä¸­é”™è¯¯å¤„ç†</h1><h2 id="3-1-éœ€æ±‚æ•´ç†"><a href="#3-1-éœ€æ±‚æ•´ç†" class="headerlink" title="3.1 éœ€æ±‚æ•´ç†"></a>3.1 éœ€æ±‚æ•´ç†</h2><ul><li>è‡ªå®šä¹‰errorä¿¡æ¯ï¼Œå¹¶è¿›è¡Œç¼–ç æ•´ç†<ul><li>controllerå±‚å¯ä»¥åˆ¤æ–­è‡ªå®šä¹‰errorç±»å‹ï¼Œæœ€ç»ˆåˆ¤æ–­æ˜¯æŒ‰infoå¤„ç†ï¼Œè¿˜æ˜¯æŒ‰errorå¤„ç†</li></ul></li><li>å¯ä»¥æ‰“å°erroråˆå§‹å‘ç”Ÿçš„ä½ç½®ï¼ˆè·å–errorçš„è°ƒç”¨æ ˆï¼‰</li><li>ç¡®è®¤å½“å‰ç³»ç»Ÿå®šä½ï¼š<ul><li>ç”¨æˆ·ï¼Œè·å–TagMessage</li><li>ä¸Šæ¸¸æœåŠ¡ï¼Œéœ€è¦é”™è¯¯ç æ˜ å°„</li><li>æ—¥å¿—ç›‘æ§ã€ç›‘æ§TagMessage</li></ul></li></ul><p>ä¸‹é¢åœ¨ä¸€ä¸ªå·¥ç¨‹åŒ–çš„é¡¹ç›®ä¸­åˆ©ç”¨<code>github.com/pkg/errors</code>åŒ…ï¼Œå®Œæ•´å®ç°ä¸€å¥—çš„é”™è¯¯å¤„ç†æœºåˆ¶</p><h2 id="3-2-æ–¹å¼ä¸€ï¼šMapä¿å­˜é”™è¯¯ç ä¸Messageçš„æ˜ å°„"><a href="#3-2-æ–¹å¼ä¸€ï¼šMapä¿å­˜é”™è¯¯ç ä¸Messageçš„æ˜ å°„" class="headerlink" title="3.2 æ–¹å¼ä¸€ï¼šMapä¿å­˜é”™è¯¯ç ä¸Messageçš„æ˜ å°„"></a>3.2 æ–¹å¼ä¸€ï¼šMapä¿å­˜é”™è¯¯ç ä¸Messageçš„æ˜ å°„</h2><h3 id="3-2-1-å®šä¹‰é”™è¯¯ä¿¡æ¯"><a href="#3-2-1-å®šä¹‰é”™è¯¯ä¿¡æ¯" class="headerlink" title="3.2.1 å®šä¹‰é”™è¯¯ä¿¡æ¯"></a>3.2.1 å®šä¹‰é”™è¯¯ä¿¡æ¯</h3><p>æ–°å»ºerror_handler.go</p><pre><code class="go">package error_handleimport (    &quot;github.com/pkg/errors&quot;)// 1ã€è‡ªå®šä¹‰errorç»“æ„ä½“ï¼Œå¹¶é‡å†™Error()æ–¹æ³•// é”™è¯¯æ—¶è¿”å›è‡ªå®šä¹‰ç»“æ„type CustomError struct {    Code       int    `json:&quot;code&quot;`    // ä¸šåŠ¡ç     TagMessage string `json:&quot;message&quot;` // æè¿°ä¿¡æ¯}func (e *CustomError) Error() string {    return e.TagMessage}// 2ã€å®šä¹‰errorCodeconst (    // æœåŠ¡çº§é”™è¯¯ç     ServerError        = 10101    TooManyRequests    = 10102    ParamBindError     = 10103    AuthorizationError = 10104    CallHTTPError      = 10105    ResubmitError      = 10106    ResubmitMsg        = 10107    HashIdsDecodeError = 10108    SignatureError     = 10109    // ä¸šåŠ¡æ¨¡å—çº§é”™è¯¯ç     // ç”¨æˆ·æ¨¡å—    IllegalUserName = 20101    UserCreateError = 20102    UserUpdateError = 20103    UserSearchError = 20104    // æˆæƒè°ƒç”¨æ–¹    AuthorizedCreateError    = 20201    AuthorizedListError      = 20202    AuthorizedDeleteError    = 20203    AuthorizedUpdateError    = 20204    AuthorizedDetailError    = 20205    AuthorizedCreateAPIError = 20206    AuthorizedListAPIError   = 20207    AuthorizedDeleteAPIError = 20208    // ç®¡ç†å‘˜    AdminCreateError             = 20301    AdminListError               = 20302    AdminDeleteError             = 20303    AdminUpdateError             = 20304    AdminResetPasswordError      = 20305    AdminLoginError              = 20306    AdminLogOutError             = 20307    AdminModifyPasswordError     = 20308    AdminModifyPersonalInfoError = 20309    // é…ç½®    ConfigEmailError        = 20401    ConfigSaveError         = 20402    ConfigRedisConnectError = 20403    ConfigMySQLConnectError = 20404    ConfigMySQLInstallError = 20405    ConfigGoVersionError    = 20406    // å®ç”¨å·¥å…·ç®±    SearchRedisError = 20501    ClearRedisError  = 20502    SearchRedisEmpty = 20503    SearchMySQLError = 20504    // èœå•æ     MenuCreateError = 20601    MenuUpdateError = 20602    MenuListError   = 20603    MenuDeleteError = 20604    MenuDetailError = 20605    // å€Ÿä¹¦    BookNotFoundError        = 20701    BookHasBeenBorrowedError = 20702)// 3ã€å®šä¹‰errorCodeå¯¹åº”çš„æ–‡æœ¬ä¿¡æ¯var codeTag = map[int]string{    ServerError:        &quot;Internal Server Error&quot;,    TooManyRequests:    &quot;Too Many Requests&quot;,    ParamBindError:     &quot;å‚æ•°ä¿¡æ¯æœ‰è¯¯&quot;,    AuthorizationError: &quot;ç­¾åä¿¡æ¯æœ‰è¯¯&quot;,    CallHTTPError:      &quot;è°ƒç”¨ç¬¬ä¸‰æ–¹ HTTP æ¥å£å¤±è´¥&quot;,    ResubmitError:      &quot;Resubmit Error&quot;,    ResubmitMsg:        &quot;è¯·å‹¿é‡å¤æäº¤&quot;,    HashIdsDecodeError: &quot;IDå‚æ•°æœ‰è¯¯&quot;,    SignatureError:     &quot;SignatureError&quot;,    IllegalUserName: &quot;éæ³•ç”¨æˆ·å&quot;,    UserCreateError: &quot;åˆ›å»ºç”¨æˆ·å¤±è´¥&quot;,    UserUpdateError: &quot;æ›´æ–°ç”¨æˆ·å¤±è´¥&quot;,    UserSearchError: &quot;æŸ¥è¯¢ç”¨æˆ·å¤±è´¥&quot;,    AuthorizedCreateError:    &quot;åˆ›å»ºè°ƒç”¨æ–¹å¤±è´¥&quot;,    AuthorizedListError:      &quot;è·å–è°ƒç”¨æ–¹åˆ—è¡¨é¡µå¤±è´¥&quot;,    AuthorizedDeleteError:    &quot;åˆ é™¤è°ƒç”¨æ–¹å¤±è´¥&quot;,    AuthorizedUpdateError:    &quot;æ›´æ–°è°ƒç”¨æ–¹å¤±è´¥&quot;,    AuthorizedDetailError:    &quot;è·å–è°ƒç”¨æ–¹è¯¦æƒ…å¤±è´¥&quot;,    AuthorizedCreateAPIError: &quot;åˆ›å»ºè°ƒç”¨æ–¹APIåœ°å€å¤±è´¥&quot;,    AuthorizedListAPIError:   &quot;è·å–è°ƒç”¨æ–¹APIåœ°å€åˆ—è¡¨å¤±è´¥&quot;,    AuthorizedDeleteAPIError: &quot;åˆ é™¤è°ƒç”¨æ–¹APIåœ°å€å¤±è´¥&quot;,    AdminCreateError:             &quot;åˆ›å»ºç®¡ç†å‘˜å¤±è´¥&quot;,    AdminListError:               &quot;è·å–ç®¡ç†å‘˜åˆ—è¡¨é¡µå¤±è´¥&quot;,    AdminDeleteError:             &quot;åˆ é™¤ç®¡ç†å‘˜å¤±è´¥&quot;,    AdminUpdateError:             &quot;æ›´æ–°ç®¡ç†å‘˜å¤±è´¥&quot;,    AdminResetPasswordError:      &quot;é‡ç½®å¯†ç å¤±è´¥&quot;,    AdminLoginError:              &quot;ç™»å½•å¤±è´¥&quot;,    AdminLogOutError:             &quot;é€€å‡ºå¤±è´¥&quot;,    AdminModifyPasswordError:     &quot;ä¿®æ”¹å¯†ç å¤±è´¥&quot;,    AdminModifyPersonalInfoError: &quot;ä¿®æ”¹ä¸ªäººä¿¡æ¯å¤±è´¥&quot;,    ConfigEmailError:        &quot;ä¿®æ”¹é‚®ç®±é…ç½®å¤±è´¥&quot;,    ConfigSaveError:         &quot;å†™å…¥é…ç½®æ–‡ä»¶å¤±è´¥&quot;,    ConfigRedisConnectError: &quot;Redisè¿æ¥å¤±è´¥&quot;,    ConfigMySQLConnectError: &quot;MySQLè¿æ¥å¤±è´¥&quot;,    ConfigMySQLInstallError: &quot;MySQLåˆå§‹åŒ–æ•°æ®å¤±è´¥&quot;,    ConfigGoVersionError:    &quot;GoVersionä¸æ»¡è¶³è¦æ±‚&quot;,    SearchRedisError: &quot;æŸ¥è¯¢RedisKeyå¤±è´¥&quot;,    ClearRedisError:  &quot;æ¸…ç©ºRedisKeyå¤±è´¥&quot;,    SearchRedisEmpty: &quot;æŸ¥è¯¢çš„RedisKeyä¸å­˜åœ¨&quot;,    SearchMySQLError: &quot;æŸ¥è¯¢mysqlå¤±è´¥&quot;,    MenuCreateError: &quot;åˆ›å»ºèœå•å¤±è´¥&quot;,    MenuUpdateError: &quot;æ›´æ–°èœå•å¤±è´¥&quot;,    MenuDeleteError: &quot;åˆ é™¤èœå•å¤±è´¥&quot;,    MenuListError:   &quot;è·å–èœå•åˆ—è¡¨é¡µå¤±è´¥&quot;,    MenuDetailError: &quot;è·å–èœå•è¯¦æƒ…å¤±è´¥&quot;,    BookNotFoundError:        &quot;ä¹¦æœªæ‰¾åˆ°&quot;,    BookHasBeenBorrowedError: &quot;ä¹¦å·²ç»è¢«å€Ÿèµ°äº†&quot;,}func Text(code int) string {    return codeTag[code]}// 4ã€æ–°å»ºè‡ªå®šä¹‰errorå®ä¾‹åŒ–func NewCustomError(code int) error {    // åˆæ¬¡è°ƒç”¨å¾—ç”¨Wrapæ–¹æ³•ï¼Œè¿›è¡Œå®ä¾‹åŒ–    return errors.Wrap(&amp;CustomError{        Code:       code,        TagMessage: codeTag[code],    }, &quot;&quot;)}</code></pre><h3 id="3-3-è‡ªå®šä¹‰Errorä½¿ç”¨"><a href="#3-3-è‡ªå®šä¹‰Errorä½¿ç”¨" class="headerlink" title="3.3 è‡ªå®šä¹‰Errorä½¿ç”¨"></a>3.3 è‡ªå®šä¹‰Errorä½¿ç”¨</h3><p>æ–°å»ºæµ‹è¯•æ–‡ä»¶ï¼šerror_handler_test.go</p><pre><code class="go">package error_handleimport (    &quot;fmt&quot;    &quot;github.com/pkg/errors&quot;    &quot;testing&quot;)func TestText(t *testing.T) {    books := []string{        &quot;Book1&quot;,        &quot;Book222222&quot;,        &quot;Book3333333333&quot;,    }    for _, bookName := range books {        err := searchBook(bookName)        // ç‰¹æ®Šä¸šåŠ¡åœºæ™¯ï¼šå¦‚æœå‘ç°ä¹¦è¢«å€Ÿèµ°äº†ï¼Œä¸‹æ¬¡å†æ¥å°±è¡Œäº†ï¼Œä¸éœ€è¦ä½œä¸ºé”™è¯¯å¤„ç†        if err != nil {            // æå–errorè¿™ä¸ªinterfaceåº•å±‚çš„é”™è¯¯ç ï¼Œä¸€èˆ¬åœ¨APIçš„è¿”å›å‰æ‰æå–            // As - è·å–é”™è¯¯çš„å…·ä½“å®ç°            var myError = new(CustomError)            // As - è§£æé”™è¯¯å†…å®¹            if errors.As(err, &amp;myError) {                fmt.Printf(&quot;ASä¸­çš„ä¿¡æ¯ï¼šå½“å‰ä¹¦ä¸º: %s ,error code is %d, message is %s\n&quot;, bookName, myError.Code, myError.TagMessage)            }            // ç‰¹æ®Šåœºæ™¯ï¼ŒæŒ‡å®šé”™è¯¯(ErrorBookHasBeenBorrowed)æ—¶ï¼Œæ‰“å°å³å¯ï¼Œä¸è¿”å›é”™è¯¯            // Is - åˆ¤æ–­é”™è¯¯æ˜¯å¦ä¸ºæŒ‡å®šç±»å‹            if errors.Is(err,  NewCustomError(BookHasBeenBorrowedError)) {                fmt.Printf(&quot;ISä¸­çš„ä¿¡æ¯ï¼š%s å·²ç»è¢«å€Ÿèµ°äº†, åªéœ€æŒ‰Infoå¤„ç†!\n&quot;, bookName)                err = nil            }else {                // å¦‚æœå·²æœ‰å †æ ˆä¿¡æ¯ï¼Œåº”è°ƒç”¨WithMessageæ–¹æ³•                newErr := errors.WithMessage(err, &quot;WithMessage err&quot;)                fmt.Printf(&quot;ISä¸­çš„ä¿¡æ¯ï¼š%s æœªæ‰¾åˆ°ï¼Œåº”è¯¥æŒ‰Errorå¤„ç†! ,newErr is %s\n&quot;, bookName , newErr)            }        }    }}func searchBook(bookName string) error {    // 1 å‘ç°å›¾ä¹¦é¦†ä¸å­˜åœ¨è¿™æœ¬ä¹¦ - è®¤ä¸ºæ˜¯é”™è¯¯ï¼Œéœ€è¦æ‰“å°è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯    if len(bookName) &gt; 10 {        return NewCustomError(BookHasBeenBorrowedError)    } else if len(bookName) &gt; 6 {        // 2 å‘ç°ä¹¦è¢«å€Ÿèµ°äº† - æ‰“å°ä¸€ä¸‹è¢«æ¥èµ°çš„æç¤ºå³å¯ï¼Œä¸è®¤ä¸ºæ˜¯é”™è¯¯        return NewCustomError(BookHasBeenBorrowedError)    }    // 3 æ‰¾åˆ°ä¹¦ - ä¸éœ€è¦ä»»ä½•å¤„ç†    return nil}</code></pre><h2 id="3-3-æ–¹å¼äºŒï¼šå€ŸåŠ©generateç®€åŒ–ä»£ç ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰"><a href="#3-3-æ–¹å¼äºŒï¼šå€ŸåŠ©generateç®€åŒ–ä»£ç ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰" class="headerlink" title="3.3 æ–¹å¼äºŒï¼šå€ŸåŠ©generateç®€åŒ–ä»£ç ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰"></a>3.3 æ–¹å¼äºŒï¼šå€ŸåŠ©generateç®€åŒ–ä»£ç ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰</h2><p>æ–¹å¼ä¸€ç»´æŠ¤é”™è¯¯ç ä¸é”™è¯¯ä¿¡æ¯çš„å…³ç³»è¾ƒä¸ºå¤æ‚ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©go generateæ¥è‡ªåŠ¨ç”Ÿæˆä»£ç ã€‚</p><h3 id="3-3-1-å®‰è£…stringer"><a href="#3-3-1-å®‰è£…stringer" class="headerlink" title="3.3.1 å®‰è£…stringer"></a>3.3.1 å®‰è£…stringer</h3><p>stringerä¸æ˜¯Goè‡ªå¸¦å·¥å…·ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ã€‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯</p><pre><code class="go">go get golang.org/x/tools/cmd/stringer</code></pre><h3 id="3-3-1-å®šä¹‰é”™è¯¯ä¿¡æ¯"><a href="#3-3-1-å®šä¹‰é”™è¯¯ä¿¡æ¯" class="headerlink" title="3.3.1 å®šä¹‰é”™è¯¯ä¿¡æ¯"></a>3.3.1 å®šä¹‰é”™è¯¯ä¿¡æ¯</h3><p>æ–°å»ºerror_handler.goã€‚åœ¨error_handlerä¸­ï¼Œå¢åŠ æ³¨é‡Š//go:generate stringer -type ErrCode -linecommentã€‚æ‰§è¡Œgo generateï¼Œä¼šç”Ÿæˆæ–°çš„æ–‡ä»¶<br><img alt="image" data-src="https://i.loli.net/2021/11/05/tCLWFMyIex5JNas.png" class="lazyload"></p><pre><code class="go">package error_handleimport (    &quot;github.com/pkg/errors&quot;)// 1ã€è‡ªå®šä¹‰errorç»“æ„ä½“ï¼Œå¹¶é‡å†™Error()æ–¹æ³•// é”™è¯¯æ—¶è¿”å›è‡ªå®šä¹‰ç»“æ„type CustomError struct {    Code    ErrCode `json:&quot;code&quot;`    // ä¸šåŠ¡ç     Message string  `json:&quot;message&quot;` // ä¸šåŠ¡ç }func (e *CustomError) Error() string {    return e.Code.String()}type ErrCode int64 //é”™è¯¯ç // 2ã€å®šä¹‰errorCode//go:generate stringer -type ErrCode -linecommentconst (    // æœåŠ¡çº§é”™è¯¯ç     ServerError        ErrCode = 10101 // Internal Server Error    TooManyRequests    ErrCode = 10102 // Too Many Requests    ParamBindError     ErrCode = 10103 // å‚æ•°ä¿¡æ¯æœ‰è¯¯    AuthorizationError ErrCode = 10104 // ç­¾åä¿¡æ¯æœ‰è¯¯    CallHTTPError      ErrCode = 10105 // è°ƒç”¨ç¬¬ä¸‰æ–¹HTTPæ¥å£å¤±è´¥    ResubmitError      ErrCode = 10106 // ResubmitError    ResubmitMsg        ErrCode = 10107 // è¯·å‹¿é‡å¤æäº¤    HashIdsDecodeError ErrCode = 10108 // IDå‚æ•°æœ‰è¯¯    SignatureError     ErrCode = 10109 // SignatureError    // ä¸šåŠ¡æ¨¡å—çº§é”™è¯¯ç     // ç”¨æˆ·æ¨¡å—    IllegalUserName ErrCode = 20101 // éæ³•ç”¨æˆ·å    UserCreateError ErrCode = 20102 // åˆ›å»ºç”¨æˆ·å¤±è´¥    UserUpdateError ErrCode = 20103 // æ›´æ–°ç”¨æˆ·å¤±è´¥    UserSearchError ErrCode = 20104 // æŸ¥è¯¢ç”¨æˆ·å¤±è´¥    // é…ç½®    ConfigEmailError        ErrCode = 20401 // ä¿®æ”¹é‚®ç®±é…ç½®å¤±è´¥    ConfigSaveError         ErrCode = 20402 // å†™å…¥é…ç½®æ–‡ä»¶å¤±è´¥    ConfigRedisConnectError ErrCode = 20403 // Redisè¿æ¥å¤±è´¥    ConfigMySQLConnectError ErrCode = 20404 // MySQLè¿æ¥å¤±è´¥    ConfigMySQLInstallError ErrCode = 20405 // MySQLåˆå§‹åŒ–æ•°æ®å¤±è´¥    ConfigGoVersionError    ErrCode = 20406 // GoVersionä¸æ»¡è¶³è¦æ±‚    // å®ç”¨å·¥å…·ç®±    SearchRedisError ErrCode = 20501 // æŸ¥è¯¢RedisKeyå¤±è´¥    ClearRedisError  ErrCode = 20502 // æ¸…ç©ºRedisKeyå¤±è´¥    SearchRedisEmpty ErrCode = 20503 // æŸ¥è¯¢çš„RedisKeyä¸å­˜åœ¨    SearchMySQLError ErrCode = 20504 // æŸ¥è¯¢mysqlå¤±è´¥    // èœå•æ     MenuCreateError ErrCode = 20601 // åˆ›å»ºèœå•å¤±è´¥    MenuUpdateError ErrCode = 20602 // æ›´æ–°èœå•å¤±è´¥    MenuListError   ErrCode = 20603 // åˆ é™¤èœå•å¤±è´¥    MenuDeleteError ErrCode = 20604 // è·å–èœå•åˆ—è¡¨é¡µå¤±è´¥    MenuDetailError ErrCode = 20605 // è·å–èœå•è¯¦æƒ…å¤±è´¥    // å€Ÿä¹¦    BookNotFoundError        ErrCode = 20701 // ä¹¦æœªæ‰¾åˆ°    BookHasBeenBorrowedError ErrCode = 20702 // ä¹¦å·²ç»è¢«å€Ÿèµ°äº†)// 4ã€æ–°å»ºè‡ªå®šä¹‰errorå®ä¾‹åŒ–func NewCustomError(code ErrCode) error {    // åˆæ¬¡è°ƒç”¨å¾—ç”¨Wrapæ–¹æ³•ï¼Œè¿›è¡Œå®ä¾‹åŒ–    return errors.Wrap(&amp;CustomError{        Code:    code,        Message: code.String(),    }, &quot;&quot;)}</code></pre><h3 id="3-3-2-è‡ªå®šä¹‰Errorä½¿ç”¨"><a href="#3-3-2-è‡ªå®šä¹‰Errorä½¿ç”¨" class="headerlink" title="3.3.2 è‡ªå®šä¹‰Errorä½¿ç”¨"></a>3.3.2 è‡ªå®šä¹‰Errorä½¿ç”¨</h3><p>æ–°å»ºæµ‹è¯•æ–‡ä»¶ï¼šerror_handler_test.go</p><pre><code class="go">package error_handleimport (    &quot;fmt&quot;    &quot;github.com/pkg/errors&quot;    &quot;testing&quot;)func TestText(t *testing.T) {    books := []string{        &quot;Book1&quot;,        &quot;Book222222&quot;,        &quot;Book3333333333&quot;,    }    for _, bookName := range books {        err := searchBook(bookName)        // ç‰¹æ®Šä¸šåŠ¡åœºæ™¯ï¼šå¦‚æœå‘ç°ä¹¦è¢«å€Ÿèµ°äº†ï¼Œä¸‹æ¬¡å†æ¥å°±è¡Œäº†ï¼Œä¸éœ€è¦ä½œä¸ºé”™è¯¯å¤„ç†        if err != nil {            // æå–errorè¿™ä¸ªinterfaceåº•å±‚çš„é”™è¯¯ç ï¼Œä¸€èˆ¬åœ¨APIçš„è¿”å›å‰æ‰æå–            // As - è·å–é”™è¯¯çš„å…·ä½“å®ç°            var customErr = new(CustomError)            // As - è§£æé”™è¯¯å†…å®¹            if errors.As(err, &amp;customErr) {                //fmt.Printf(&quot;ASä¸­çš„ä¿¡æ¯ï¼šå½“å‰ä¹¦ä¸º: %s ,error code is %d, message is %s\n&quot;, bookName, customErr.Code, customErr.Message)                if customErr.Code == BookHasBeenBorrowedError {                    fmt.Printf(&quot;ISä¸­çš„infoä¿¡æ¯ï¼š%s å·²ç»è¢«å€Ÿèµ°äº†, åªéœ€æŒ‰Infoå¤„ç†!\n&quot;, bookName)                } else {                    // å¦‚æœå·²æœ‰å †æ ˆä¿¡æ¯ï¼Œåº”è°ƒç”¨WithMessageæ–¹æ³•                    newErr := errors.WithMessage(err, &quot;WithMessage err1&quot;)                    // ä½¿ç”¨%+vå¯ä»¥æ‰“å°å®Œæ•´çš„å †æ ˆä¿¡æ¯                    fmt.Printf(&quot;ISä¸­çš„errorä¿¡æ¯ï¼š%s æœªæ‰¾åˆ°ï¼Œåº”è¯¥æŒ‰Errorå¤„ç†! ,newErr is: %+v\n&quot;, bookName, newErr)                }            }        }    }}func searchBook(bookName string) error {    // 1 å‘ç°å›¾ä¹¦é¦†ä¸å­˜åœ¨è¿™æœ¬ä¹¦ - è®¤ä¸ºæ˜¯é”™è¯¯ï¼Œéœ€è¦æ‰“å°è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯    if len(bookName) &gt; 10 {        return NewCustomError(BookNotFoundError)    } else if len(bookName) &gt; 6 {        // 2 å‘ç°ä¹¦è¢«å€Ÿèµ°äº† - æ‰“å°ä¸€ä¸‹è¢«æ¥èµ°çš„æç¤ºå³å¯ï¼Œä¸è®¤ä¸ºæ˜¯é”™è¯¯        return NewCustomError(BookHasBeenBorrowedError)    }    // 3 æ‰¾åˆ°ä¹¦ - ä¸éœ€è¦ä»»ä½•å¤„ç†    return nil}</code></pre><h2 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4 æ€»ç»“"></a>4 æ€»ç»“</h2><ol><li><code>CustomError</code> ä½œä¸ºå…¨å±€ <code>error</code> çš„åº•å±‚å®ç°ï¼Œä¿å­˜å…·ä½“çš„é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯ï¼›</li><li><code>CustomError</code>å‘ä¸Šè¿”å›é”™è¯¯æ—¶ï¼Œç¬¬ä¸€æ¬¡å…ˆç”¨<code>Wrap</code>åˆå§‹åŒ–å †æ ˆï¼Œåç»­ç”¨<code>WithMessage</code>å¢åŠ å †æ ˆä¿¡æ¯ï¼›</li><li>ä»<code>error</code>ä¸­è§£æå…·ä½“é”™è¯¯æ—¶ï¼Œç”¨<code>errors.As</code>æå–å‡º<code>CustomError</code>ï¼Œå…¶ä¸­çš„é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯å¯ä»¥ä¼ å…¥åˆ°å…·ä½“çš„APIæ¥å£ä¸­ï¼›</li><li>è¦åˆ¤æ–­<code>error</code>æ˜¯å¦ä¸ºæŒ‡å®šçš„é”™è¯¯æ—¶ï¼Œç”¨<code>errors.Is</code> + <code>Handler Error</code>çš„æ–¹æ³•ï¼Œå¤„ç†ä¸€äº›ç‰¹å®šæƒ…å†µä¸‹çš„é€»è¾‘ï¼›</li></ol><blockquote><p>Tipsï¼š<br>â€‹1.ä¸è¦ä¸€ç›´ç”¨errors.Wrapæ¥åå¤åŒ…è£…é”™è¯¯ï¼Œå †æ ˆä¿¡æ¯ä¼šçˆ†ç‚¸ï¼Œå…·ä½“æƒ…å†µå¯è‡ªè¡Œæµ‹è¯•äº†è§£</p><p>2.åˆ©ç”¨go generateå¯ä»¥å¤§é‡ç®€åŒ–åˆå§‹åŒ–Erroé‡å¤çš„å·¥ä½œ</p><p>3.<code>github.com/pkg/errors</code>å’Œæ ‡å‡†åº“çš„<code>error</code>å®Œå…¨å…¼å®¹ï¼Œå¯ä»¥å…ˆæ›¿æ¢ã€åç»­æ”¹é€ å†å²é—ç•™çš„ä»£ç </p><p>4.ä¸€å®šè¦æ³¨æ„æ‰“å°<code>error</code>çš„å †æ ˆéœ€è¦ç”¨<code>%+v</code>ï¼Œè€ŒåŸæ¥çš„<code>%v</code>ä¾æ—§ä¸ºæ™®é€šå­—ç¬¦ä¸²æ–¹æ³•ï¼›åŒæ—¶ä¹Ÿè¦æ³¨æ„æ—¥å¿—é‡‡é›†å·¥å…·æ˜¯å¦æ”¯æŒå¤šè¡ŒåŒ¹é…</p></blockquote><blockquote><p>æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä¸ªåŠ±å¿—ç”¨æœ€ç®€å•çš„è¯­è¨€ï¼Œæè¿°æœ€å¤æ‚é—®é¢˜çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚<strong>æ±‚ç‚¹èµï¼Œæ±‚å…³æ³¨</strong>ï¼Œå¦‚æœä½ å¯¹æ­¤ç¯‡æ–‡ç« æœ‰ä»€ä¹ˆç–‘æƒ‘ï¼Œæ¬¢è¿åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ä¸­ç•™è¨€ï¼Œæˆ‘è¿˜å¯ä»¥ä¸ºä½ æä¾›ä»¥ä¸‹å¸®åŠ©ï¼š</p><ul><li>å¸®åŠ©å»ºç«‹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»</li><li>äº’è”ç½‘çœŸå®é«˜å¹¶å‘åœºæ™¯å®æˆ˜è®²è§£</li><li>ä¸å®šæœŸåˆ†äº«Golangã€Javaç›¸å…³ä¸šå†…çš„ç»å…¸åœºæ™¯å®è·µ</li></ul></blockquote><p>æˆ‘çš„åšå®¢ï¼š<a href="https://besthpt.github.io/" target="_blank" rel="noopener">https://besthpt.github.io/</a></p><blockquote><p>å¾®ä¿¡å…¬ä¼—å·ï¼š<br><img alt="imagea" data-src="https://i.loli.net/2021/11/05/5E8xBC6ZaTwP2my.png" class="lazyload"></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šä¸€æ–‡æ•™ä¼šä½ å¦‚ä½•è¿›è¡ŒGolangæœåŠ¡ä¼˜åŒ–ã€‹</title>
      <link href="/2021/10/29/10.Golang/%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8Cgolang%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
      <url>/2021/10/29/10.Golang/%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8Cgolang%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h1><p>å—¨å–½ï¼Œå¤§å®¶å¥½å‘€ï¼æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä½æ¸¸èµ°äºå„äº’è”ç½‘å¤§å‚é—´çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚å¯¹äºCç«¯åœ¨çº¿ä¸šåŠ¡ï¼ŒæœåŠ¡çš„ç¨³å®šæ€§å’Œååé‡å¸¸å¸¸æ˜¯è¯„ä¼°ä¸€ä¸ªç³»ç»Ÿçš„é‡è¦æŒ‡æ ‡ï¼Œæ‰€ä»¥æœ¬æ–‡å°†ä»ä»¥ä¸‹4ç‚¹è¿›è¡Œå±•å¼€ï¼Œé€æ­¥è®²è§£golangä¸­å¦‚ä½•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚</p><ol><li>ä¸ºä»€ä¹ˆè¦åšæ€§èƒ½ä¼˜åŒ–</li><li>æ€§èƒ½ä¼˜åŒ–åŸºç¡€</li><li>ä¼˜åŒ–æ€è·¯</li><li>å¸¸è§çš„ä¼˜åŒ–åœºæ™¯</li></ol><h1 id="2ã€æ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ï¼ˆWhy-ï¼‰"><a href="#2ã€æ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ï¼ˆWhy-ï¼‰" class="headerlink" title="2ã€æ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ï¼ˆWhy?ï¼‰"></a>2ã€æ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ï¼ˆWhy?ï¼‰</h1><p>æˆ‘ä»¬å¸¸å¸¸åœ¨ä»¥ä¸‹æ—¶å€™è€ƒè™‘åˆ°æ€§èƒ½ä¼˜åŒ–ï¼š</p><ol><li>æ—¥å¸¸ä¼˜åŒ–ç³»ç»Ÿï¼š<ol><li>æ¥å£ç›¸åº”æ—¶é—´ä¼˜åŒ–ï¼Œä»¥æ»¡è¶³å¯¹ä¸Šæ¸¸çš„SLA</li><li>CPUä¼˜åŒ–ï¼Œä¿è¯åœ¨çº¿ä¸šåŠ¡cpu idlå¤„äºä¸€ä¸ªè¾ƒé«˜æ°´å¹³ï¼Œé™ä½ä¸šåŠ¡é‡çªå¢å¯¹ç³»ç»Ÿç¨³å®šæ€§å¸¦æ¥çš„å†²å‡»</li><li>å†…å­˜ä¼˜åŒ–ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼Œé‡Šæ”¾å¤šä½™çš„æœåŠ¡å™¨èµ„æº</li></ol></li><li>è§£å†³çº¿ä¸Šä¸šåŠ¡é—®é¢˜ï¼š<ol><li>æ¥å£ç›¸åº”è¶…æ—¶</li><li>CPUåˆ©ç”¨ç‡é£™å‡</li></ol></li></ol><h1 id="3ã€æ€§èƒ½ä¼˜åŒ–åŸºç¡€ï¼ˆWhat-ï¼‰"><a href="#3ã€æ€§èƒ½ä¼˜åŒ–åŸºç¡€ï¼ˆWhat-ï¼‰" class="headerlink" title="3ã€æ€§èƒ½ä¼˜åŒ–åŸºç¡€ï¼ˆWhat?ï¼‰"></a>3ã€æ€§èƒ½ä¼˜åŒ–åŸºç¡€ï¼ˆWhat?ï¼‰</h1><h2 id="3-1-æ€§èƒ½ä¼˜åŒ–æŒ‡æ ‡"><a href="#3-1-æ€§èƒ½ä¼˜åŒ–æŒ‡æ ‡" class="headerlink" title="3.1 æ€§èƒ½ä¼˜åŒ–æŒ‡æ ‡"></a>3.1 æ€§èƒ½ä¼˜åŒ–æŒ‡æ ‡</h2><p>åœ¨GolangæœåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä»ä»¥ä¸‹4ç‚¹è§¦å‘å»åšæœåŠ¡çš„ä¼˜åŒ–ï¼š</p><ul><li>CPU profileï¼šæŠ¥å‘Šç¨‹åºçš„ CPU ä½¿ç”¨æƒ…å†µï¼ŒæŒ‰ç…§ä¸€å®šé¢‘ç‡å»é‡‡é›†åº”ç”¨ç¨‹åºåœ¨ CPU å’Œå¯„å­˜å™¨ä¸Šé¢çš„æ•°æ®</li><li>Memory Profileï¼ˆHeap Profileï¼‰ï¼šæŠ¥å‘Šç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ</li><li>Block Profilingï¼šæŠ¥å‘Š goroutines ä¸åœ¨è¿è¡ŒçŠ¶æ€çš„æƒ…å†µï¼Œå¯ä»¥ç”¨æ¥åˆ†æå’ŒæŸ¥æ‰¾æ­»é”ç­‰æ€§èƒ½ç“¶é¢ˆ</li><li>Goroutine Profilingï¼šæŠ¥å‘Š goroutines çš„ä½¿ç”¨æƒ…å†µï¼Œæœ‰å“ªäº› goroutineï¼Œå®ƒä»¬çš„è°ƒç”¨å…³ç³»æ˜¯æ€æ ·çš„</li></ul><h1 id="4-æ€§èƒ½åˆ†æè¿‡ç¨‹ï¼ˆHow-ï¼‰"><a href="#4-æ€§èƒ½åˆ†æè¿‡ç¨‹ï¼ˆHow-ï¼‰" class="headerlink" title="4. æ€§èƒ½åˆ†æè¿‡ç¨‹ï¼ˆHow?ï¼‰"></a>4. æ€§èƒ½åˆ†æè¿‡ç¨‹ï¼ˆHow?ï¼‰</h1><h2 id="4-1-å¦‚ä½•è·å–æ€§èƒ½å¿«ç…§"><a href="#4-1-å¦‚ä½•è·å–æ€§èƒ½å¿«ç…§" class="headerlink" title="4.1 å¦‚ä½•è·å–æ€§èƒ½å¿«ç…§"></a>4.1 å¦‚ä½•è·å–æ€§èƒ½å¿«ç…§</h2><p>golangä¸­æœ‰ä¸¤ç§ç±»å‹çš„åº”ç”¨ï¼Œå·¥å…·æ€§åº”ç”¨å’ŒæœåŠ¡å‹åº”ç”¨ï¼Œå·¥å…·æ€§å‹åº”ç”¨çš„mainå‡½æ•°ä»…ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬æœ¬åœ°è·‘å•å…ƒæµ‹è¯•çš„æ€§èƒ½æµ‹è¯•å…¶å®åŸç†å°±æ˜¯åº”ç”¨çš„è¿™ç§ã€‚æœåŠ¡å‹åº”ç”¨ä¸ºé•¿æœŸå­˜æ´»çš„åç«¯åº”ç”¨ï¼Œä¾‹å¦‚RPCæœåŠ¡ï¼ŒHTTPæœåŠ¡ï¼Œæˆ‘ä»¬åç«¯ç³»ç»Ÿé€šå¸¸éƒ½æ˜¯æœåŠ¡å‹åº”ç”¨ã€‚</p><h3 id="4-1-1-å·¥å…·å‹åº”ç”¨è·å–CPUå¿«ç…§"><a href="#4-1-1-å·¥å…·å‹åº”ç”¨è·å–CPUå¿«ç…§" class="headerlink" title="4.1.1 å·¥å…·å‹åº”ç”¨è·å–CPUå¿«ç…§"></a>4.1.1 å·¥å…·å‹åº”ç”¨è·å–CPUå¿«ç…§</h3><p>æµ‹è¯•Demoå¦‚ä¸‹ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ªå¿«æ’çš„ä¾‹å­ï¼Œåº”ç”¨æ‰§è¡Œç»“æŸåï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œä¿å­˜äº†æˆ‘ä»¬çš„ CPU profiling æ•°æ®ã€‚å¾—åˆ°é‡‡æ ·æ•°æ®ä¹‹åï¼Œä½¿ç”¨go tool pprofå·¥å…·è¿›è¡Œ CPU æ€§èƒ½åˆ†æã€‚</p><pre><code class="go">package mainimport (    &quot;math/rand&quot;    &quot;os&quot;    &quot;runtime/pprof&quot;    &quot;time&quot;)func generate(n int) []int {    rand.Seed(time.Now().UnixNano())    nums := make([]int, 0)    for i := 0; i &lt; n; i++ {        nums = append(nums, rand.Int())    }    return nums}func bubbleSort(nums []int) {    for i := 0; i &lt; len(nums); i++ {        for j := 1; j &lt; len(nums)-i; j++ {            if nums[j] &lt; nums[j-1] {                nums[j], nums[j-1] = nums[j-1], nums[j]            }        }    }}func main() {    pprof.StartCPUProfile(os.Stdout)    defer pprof.StopCPUProfile()    n := 10    for i := 0; i &lt; 5; i++ {        nums := generate(n)        bubbleSort(nums)        n *= 10    }}</code></pre><p>è¿™é‡Œä½¿ç”¨çš„runtime/pprofè¿™ä¸ªåˆ†æå·¥å…·ï¼Œéœ€è¦æŒ‡å®šå¿«ç…§æ‰“å°çš„ä½ç½®ï¼Œè¿™é‡Œæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºäº†ã€‚å¯ä»¥ä¼šä¸ç¨‹åºä¸­çš„æ‰“å°å†²çªã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°å†™åˆ°æ–‡ä»¶ä¸­ï¼Œè¿™é‡Œå¯ä»¥ç”¨å¦ä¸€ä¸ªå¼€æºå·¥å…·æ›¿ä»£<code>github.com/pkg/profile</code>ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªæ—¥å¿—å¿«ç…§æ–‡ä»¶åˆ°ä¸´æ—¶ç›®å½•ã€‚</p><pre><code class="go">package mainimport (    &quot;math/rand&quot;    &quot;github.com/pkg/profile&quot;    &quot;time&quot;)func generate(n int) []int {    rand.Seed(time.Now().UnixNano())    nums := make([]int, 0)    for i := 0; i &lt; n; i++ {        nums = append(nums, rand.Int())    }    return nums}func bubbleSort(nums []int) {    for i := 0; i &lt; len(nums); i++ {        for j := 1; j &lt; len(nums)-i; j++ {            if nums[j] &lt; nums[j-1] {                nums[j], nums[j-1] = nums[j-1], nums[j]            }        }    }}func main() {    defer profile.Start(profile.MemProfile, profile.MemProfileRate(1)).Stop()    n := 10    for i := 0; i &lt; 5; i++ {        nums := generate(n)        bubbleSort(nums)        n *= 10    }}</code></pre><h3 id="4-1-1-æœåŠ¡å‹åº”ç”¨CPUåˆ†æ"><a href="#4-1-1-æœåŠ¡å‹åº”ç”¨CPUåˆ†æ" class="headerlink" title="4.1.1 æœåŠ¡å‹åº”ç”¨CPUåˆ†æ"></a>4.1.1 æœåŠ¡å‹åº”ç”¨CPUåˆ†æ</h3><p>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ˜¯ä¸€ç›´è¿è¡Œçš„ï¼Œæ¯”å¦‚ web åº”ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨net/http/pprofåº“ï¼Œå®ƒèƒ½å¤Ÿåœ¨æä¾› HTTP æœåŠ¡è¿›è¡Œåˆ†æã€‚è¿™æ ·ä½ çš„ HTTP æœåŠ¡éƒ½ä¼šå¤šå‡º/debug/pprof endpointï¼Œè®¿é—®å®ƒä¼šå¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹ï¼š</p><pre><code class="go">package mainimport (    &quot;net/http&quot;    _ &quot;net/http/pprof&quot;)func main() {    http.ListenAndServe(&quot;0.0.0.0:8000&quot;, nil)}</code></pre><p><img alt="image.png" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1635496049023-20047be6-c670-4d35-948a-d3037d4610a9.png" class="lazyload"></p><p>ç°åœ¨æ•°æ®å·²ç»å¯ä»¥é‡‡é›†äº†ï¼Œé‚£å¦‚ä½•è·å–å¿«ç…§å‘¢ï¼Ÿæˆ‘ä»¬ä¸Šä¸€æ­¥çš„æ“ä½œï¼Œåœ¨åå°èµ·äº†ä¸€ä¸ªhttp serveræœåŠ¡ï¼Œæˆ‘ä»¬ç›´æ¥ç‚¹å‡»uiä¸­çš„é“¾æ¥å°±å¯ä»¥æ‹¿åˆ°å†…å­˜å¿«ç…§äº†,ä¾‹å¦‚ç‚¹å‡»profileï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°ä¸€ä¸ª30sçš„CPUå¿«ç…§ï¼Œæ˜¯ä¸€ä¸ª*.pb.gzç±»å‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ç”¨äºæˆ‘ä»¬åé¢çš„åˆ†æã€‚</p><ul><li>/debug/pprof/profileï¼šè®¿é—®è¿™ä¸ªé“¾æ¥ä¼šè‡ªåŠ¨è¿›è¡Œ CPU profilingï¼ŒæŒç»­ 30sï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ä¾›ä¸‹è½½</li><li>/debug/pprof/heapï¼š Memory Profiling çš„è·¯å¾„ï¼Œè®¿é—®è¿™ä¸ªé“¾æ¥ä¼šå¾—åˆ°ä¸€ä¸ªå†…å­˜ Profiling ç»“æœçš„æ–‡ä»¶</li><li>/debug/pprof/blockï¼šblock Profiling çš„è·¯å¾„</li><li>/debug/pprof/goroutinesï¼šè¿è¡Œçš„ goroutines åˆ—è¡¨ï¼Œä»¥åŠè°ƒç”¨å…³ç³»</li></ul><h2 id="4-2-go-toolåˆ†ææ€§èƒ½å¿«ç…§"><a href="#4-2-go-toolåˆ†ææ€§èƒ½å¿«ç…§" class="headerlink" title="4.2 go toolåˆ†ææ€§èƒ½å¿«ç…§"></a>4.2 go toolåˆ†ææ€§èƒ½å¿«ç…§</h2><p>ä¸ç®¡æ˜¯å·¥å…·å‹åº”ç”¨è¿˜æ˜¯æœåŠ¡å‹åº”ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸åº”çš„ pprof åº“è·å–æ•°æ®ä¹‹åï¼Œä¸‹ä¸€æ­¥çš„éƒ½è¦å¯¹è¿™äº›<strong>æ•°æ®è¿›è¡Œåˆ†æ</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨go tool pprofå‘½ä»¤è¡Œå·¥å…·ã€‚<br>go tool pprofæœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ä¸º:</p><pre><code class="go">go tool pprof [binary] [source]</code></pre><p>å…¶ä¸­ï¼š</p><ul><li>binary æ˜¯åº”ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨æ¥è§£æå„ç§ç¬¦å·ï¼›ä¾‹å¦‚ï¼šgo tool pprof -http=:9999 /Users/xxxx/pprof/pprof.samples.cpu.001.pb.gz</li><li>source è¡¨ç¤º profile æ•°æ®çš„æ¥æºï¼Œå¯ä»¥æ˜¯æœ¬åœ°çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ http åœ°å€ã€‚æ­¤æ–¹å¼ä¼šåœ¨å‘½ä»¤çª—å£ä¸­æŒ‰ç…§äº¤äº’æ¨¡å¼ä¾‹å¦‚ï¼šgo tool pprof <a href="http://127.0.0.1:8000/debug/pprof/profile" target="_blank" rel="noopener">http://127.0.0.1:8000/debug/pprof/profile</a></li></ul><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> è·å–çš„ Profiling æ•°æ®æ˜¯åŠ¨æ€çš„ï¼Œè¦æƒ³è·å¾—æœ‰æ•ˆçš„æ•°æ®ï¼Œè¯·ä¿è¯åº”ç”¨å¤„äºè¾ƒå¤§çš„è´Ÿè½½ï¼ˆæ¯”å¦‚æ­£åœ¨ç”Ÿæˆä¸­è¿è¡Œçš„æœåŠ¡ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–å‹æµ‹å·¥å…·æ¨¡æ‹Ÿè®¿é—®å‹åŠ›ï¼‰ã€‚å¦åˆ™å¦‚æœåº”ç”¨å¤„äºç©ºé—²çŠ¶æ€ï¼Œå¾—åˆ°çš„ç»“æœå¯èƒ½æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚</p><p>å¯ä»¥å¢åŠ äº›å‚æ•°æ¥è·å–æ›´å¤šä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p><pre><code class="go"># æˆ‘ä»¬æƒ³è·å–70sçš„å†…å­˜å¿«ç…§ï¼Œå¯ä»¥å¢åŠ -secondså‚æ•°ï¼šgotool pprof  -seconds 70 http://127.0.0.1:8912/debug/pprof/profile# æŒ‡å®šhttpæ¥å£ï¼Œå¯ä»¥åœ¨uiä¸Šçœ‹åˆ°å†…å­˜å¿«ç…§ï¼Œå‚è§æœ¬æ–‡4.2.2gotool pprof  -http=0.0.0.0:8234 http://127.0.0.1:8912/debug/pprof/profile</code></pre><h3 id="4-2-1-ç›´è¿æœåŠ¡åˆ†æ"><a href="#4-2-1-ç›´è¿æœåŠ¡åˆ†æ" class="headerlink" title="4.2.1 ç›´è¿æœåŠ¡åˆ†æ"></a>4.2.1 ç›´è¿æœåŠ¡åˆ†æ</h3><p>go tool + çº¿ä¸ŠæœåŠ¡httpæ¥å£åœ°å€çš„æ–¹å¼ï¼š</p><pre><code class="go">go tool pprof http://127.0.0.1:8000/debug/pprof/profile</code></pre><p>æ‰§è¡Œä¸Šé¢çš„ä»£ç ä¼šè¿›å…¥äº¤äº’ç•Œé¢å¦‚ä¸‹ï¼š</p><pre><code class="go">runtime_pprof $ go tool pprof cpu.pprofType: cpuTime: Jun 28, 2019 at 11:28am (CST)Duration: 20.13s, Total samples = 1.91mins (568.60%)Entering interactive mode (type &quot;help&quot; for commands, &quot;o&quot; for options)(pprof)</code></pre><p>æˆ‘ä»¬å¯ä»¥åœ¨äº¤äº’ç•Œé¢è¾“å…¥<code>top3</code>æ¥æŸ¥çœ‹ç¨‹åºä¸­å ç”¨ CPU å‰ 3 ä½çš„å‡½æ•°ï¼š</p><pre><code class="go">(pprof) top3Showing nodes accounting for 100.37s, 87.68% of 114.47s totalDropped 17 nodes (cum &lt;= 0.57s)Showing top 3 nodes out of 4      flat  flat%   sum%        cum   cum%    42.52s 37.15% 37.15%     91.73s 80.13%  runtime.selectnbrecv    35.21s 30.76% 67.90%     39.49s 34.50%  runtime.chanrecv    22.64s 19.78% 87.68%    114.37s 99.91%  main.logicCode</code></pre><p>å…¶ä¸­ï¼š</p><ul><li>flatï¼šå½“å‰å‡½æ•°å ç”¨ CPU çš„è€—æ—¶</li><li>flatï¼š: å½“å‰å‡½æ•°å ç”¨ CPU çš„è€—æ—¶ç™¾åˆ†æ¯”</li><li>sun%ï¼šå‡½æ•°å ç”¨ CPU çš„è€—æ—¶ç´¯è®¡ç™¾åˆ†æ¯”</li><li>cumï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨ CPU çš„æ€»è€—æ—¶</li><li>cum%ï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨ CPU çš„æ€»è€—æ—¶ç™¾åˆ†æ¯”</li><li>æœ€åä¸€åˆ—ï¼šå‡½æ•°åç§°</li></ul><p>åœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†æè¿™äº”åˆ—å¾—å‡ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¿è¡Œæƒ…å†µï¼Œå¹¶å¯¹ç¨‹åºè¿›è¡Œä¼˜åŒ–ã€‚<br>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>list å‡½æ•°å</code>å‘½ä»¤æŸ¥çœ‹å…·ä½“çš„å‡½æ•°åˆ†æï¼Œä¾‹å¦‚æ‰§è¡Œ<code>list logicCode</code>æŸ¥çœ‹æˆ‘ä»¬ç¼–å†™çš„å‡½æ•°çš„è¯¦ç»†åˆ†æã€‚</p><pre><code class="go">(pprof) list logicCodeTotal: 1.91minsROUTINE ================ main.logicCode in .../runtime_pprof/main.go    22.64s   1.91mins (flat, cum) 99.91% of Total         .          .     12:func logicCode() {         .          .     13:   var c chan int         .          .     14:   for {         .          .     15:           select {         .          .     16:           case v := &lt;-c:    22.64s   1.91mins     17:                   fmt.Printf(&quot;recv from chan, value:%v\n&quot;, v)         .          .     18:           default:         .          .     19:         .          .     20:           }         .          .     21:   }         .          .     22:}</code></pre><p>é€šè¿‡åˆ†æå‘ç°å¤§éƒ¨åˆ† CPU èµ„æºè¢« 17 è¡Œå ç”¨ï¼Œæˆ‘ä»¬åˆ†æå‡º select è¯­å¥ä¸­çš„ default æ²¡æœ‰å†…å®¹ä¼šå¯¼è‡´ä¸Šé¢çš„<code>case v:=&lt;-c:</code>ä¸€ç›´æ‰§è¡Œã€‚æˆ‘ä»¬åœ¨ default åˆ†æ”¯æ·»åŠ ä¸€è¡Œ<code>time.Sleep(time.Second)</code>å³å¯ã€‚<br>â€‹</p><h3 id="4-2-2-å¿«ç…§æ–‡ä»¶-å›¾å½¢åŒ–å·¥å…·"><a href="#4-2-2-å¿«ç…§æ–‡ä»¶-å›¾å½¢åŒ–å·¥å…·" class="headerlink" title="4.2.2 å¿«ç…§æ–‡ä»¶+å›¾å½¢åŒ–å·¥å…·"></a>4.2.2 å¿«ç…§æ–‡ä»¶+å›¾å½¢åŒ–å·¥å…·</h3><p>è¿™ç§å¿«ç…§æ–‡ä»¶çš„æ–¹å¼å¥½å¤„æ˜¯æ›´åŠ ç›´è§‚ï¼Œå¯ä»¥é€šè¿‡å›¾å½¢åŒ–ç•Œé¢æ¥åˆ†æï¼š<br>æƒ³è¦æŸ¥çœ‹å›¾å½¢åŒ–çš„ç•Œé¢é¦–å…ˆéœ€è¦å®‰è£… <a href="https://graphviz.gitlab.io/" target="_blank" rel="noopener">graphviz</a> å›¾å½¢åŒ–å·¥å…·ã€‚Macï¼šbrew install graphviz<br>æ¥ä¸‹æ¥ï¼Œå¯ä»¥ç”¨ go tool pprof åˆ†æè¿™ä»½æ•°æ®</p><pre><code class="go">go tool pprof -http=:9999 cpu.pprof</code></pre><p>è®¿é—® localhost:9999ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·çš„é¡µé¢ï¼š<br><img alt data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/do1_xqSgVgkMuBtIeulm6fJu.png" class="lazyload"></p><p>å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©VIEWï¼Œç„¶åçœ‹ç«ç„°å›¾ï¼š<br><img alt data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/do1_wfg9QPIBkQtZYfFGNHYI.png" class="lazyload"><br>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±æˆåŠŸçš„è·å–äº†æ¯ä¸ªå‡½æ•°å ç”¨çš„CPUæ—¶é—´äº†ï¼Œä¸‹é¢å°±å¯ä»¥å¯¹å ç”¨è¾ƒé•¿çš„å‡½æ•°ï¼ˆå¹³é¡¶å±±éƒ¨åˆ†)è¿›è¡Œä¼˜åŒ–äº†ã€‚<br>â€‹</p><h1 id="5ã€å¸¸è§æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ"><a href="#5ã€å¸¸è§æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ" class="headerlink" title="5ã€å¸¸è§æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ"></a>5ã€å¸¸è§æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ</h1><h2 id="5-1-ä½¿ç”¨é«˜æ•ˆçš„æ€§èƒ½åŒ…"><a href="#5-1-ä½¿ç”¨é«˜æ•ˆçš„æ€§èƒ½åŒ…" class="headerlink" title="5.1 ä½¿ç”¨é«˜æ•ˆçš„æ€§èƒ½åŒ…"></a>5.1 ä½¿ç”¨é«˜æ•ˆçš„æ€§èƒ½åŒ…</h2><h3 id="5-1-1-Jsonè§£æ"><a href="#5-1-1-Jsonè§£æ" class="headerlink" title="5.1.1 Jsonè§£æ"></a>5.1.1 Jsonè§£æ</h3><p>æˆ‘ä»¬å°†Jsonæ•°æ®å­˜æ”¾åˆ°Redisæ—¶ï¼Œå–å‡ºæ—¶éœ€è¦å°†å…¶è§£æä¸ºStructï¼Œä½†goå®˜æ–¹è‡ªå¸¦çš„åº“æ€§èƒ½è¾ƒå·®ï¼Œæ‰€ä»¥å¸¸å¸¸å‡ºç°ç“¶é¢ˆï¼Œå¯é€‰æ‹©<a href="https://github.com/json-iterator" target="_blank" rel="noopener">github.com/json-iterator</a> æ›¿æ¢æ ‡å‡†åº“çš„ encoding/jsonï¼ˆè¯¥åº“ä¸»è¦çš„ä¼˜åŒ–æ‰‹æ®µè¯¦è§ï¼š<a href="http://jsoniter.com/benchmark.html#optimization-usedï¼‰ã€‚" target="_blank" rel="noopener">http://jsoniter.com/benchmark.html#optimization-usedï¼‰ã€‚</a> <a href="https://github.com/json-iterator" target="_blank" rel="noopener">json-iterator</a> å®£ä¼ çš„æ€§èƒ½å¦‚ä¸‹å›¾ï¼š<br><img alt data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/do1_v7N9CCRnXegVFeqemj53.png" class="lazyload"><br>â€‹</p><h3 id="5-1-2-æ·±æ‹·è´"><a href="#5-1-2-æ·±æ‹·è´" class="headerlink" title="5.1.2 æ·±æ‹·è´"></a>5.1.2 æ·±æ‹·è´</h3><p>è¿˜æœ‰æ—¶æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨åˆ°æ·±æ‹·è´çš„åœºæ™¯ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼Œæ·±æ‹·è´æ€§èƒ½å¯¹æ¯”ï¼š<a href="https://www.yuque.com/jinsesihuanian/gpwou5/xg20gn" target="_blank" rel="noopener">https://www.yuque.com/jinsesihuanian/gpwou5/xg20gn</a>ã€‚<br>â€‹</p><h2 id="5-2-ç©ºé—´æ¢æ—¶é—´"><a href="#5-2-ç©ºé—´æ¢æ—¶é—´" class="headerlink" title="5.2 ç©ºé—´æ¢æ—¶é—´"></a>5.2 ç©ºé—´æ¢æ—¶é—´</h2><ol><li>å¯¹äºå¸¸è§çš„Jsonè§£æé—®é¢˜ï¼ŒRediså¤§keyé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¤šçº§ç¼“å­˜ï¼Œå°†Redisä¸­çš„å¤§keyæ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œè¿™é‡Œåˆ«å¿˜äº†è€ƒè™‘å¸¦æ¥çš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚</li><li>å¯¹äºä¸€äº›mapï¼Œsliceï¼Œå°½é‡åœ¨åˆå§‹åŒ–æ—¶æŒ‡å®šå¤§å°ï¼Œå‡å°‘å†…å­˜çš„é‡æ–°åˆ†é…</li></ol><h2 id="5-3-å­—ç¬¦ä¸²æ‹¼æ¥"><a href="#5-3-å­—ç¬¦ä¸²æ‹¼æ¥" class="headerlink" title="5.3 å­—ç¬¦ä¸²æ‹¼æ¥"></a>5.3 å­—ç¬¦ä¸²æ‹¼æ¥</h2><p>å­—ç¬¦ä¸²çš„æ‹¼æ¥ä¼˜å…ˆè€ƒè™‘bytes.Bufferã€‚ç”±äºstringç±»å‹æ˜¯ä¸€ä¸ªä¸å¯å˜ç±»å‹ï¼Œä½†æ‹¼æ¥ä¼šåˆ›å»ºæ–°çš„stringã€‚GOä¸­å­—ç¬¦ä¸²æ‹¼æ¥å¸¸è§æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼Œå¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„æœåŠ¡å°½é‡ä½¿ç”¨bytes.Bufferè¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥</p><ul><li>string + æ“ä½œ ï¼šå¯¼è‡´å¤šæ¬¡å¯¹è±¡çš„åˆ†é…ä¸å€¼æ‹·è´</li><li>fmt.Sprintf ï¼šä¼šåŠ¨æ€è§£æå‚æ•°ï¼Œæ•ˆç‡å¥½ä¸å“ªå»</li><li>strings.Join ï¼šå†…éƒ¨æ˜¯[]byteçš„append</li><li>bytes.Buffer ï¼šå¯ä»¥é¢„å…ˆåˆ†é…å¤§å°ï¼Œå‡å°‘å¯¹è±¡åˆ†é…ä¸æ‹·è´</li></ul><p><img alt="image.png" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1635499076665-94d9556c-ca7c-40b2-ac7a-d3a3d0f874b1.png" class="lazyload"><br><strong>ä½¿ç”¨strconvåŒ…æ›¿ä»£fmt.Sprintfçš„æ ¼å¼åŒ–æ–¹å¼ï¼Œæ€§èƒ½æ¯”å¯¹è§ï¼š</strong><a href="https://www.cnblogs.com/yumuxu/p/4077234.html" target="_blank" rel="noopener">https://www.cnblogs.com/yumuxu/p/4077234.html</a><br>â€‹</p><h2 id="5-4-å¼‚æ­¥å¤„ç†"><a href="#5-4-å¼‚æ­¥å¤„ç†" class="headerlink" title="5.4 å¼‚æ­¥å¤„ç†"></a>5.4 å¼‚æ­¥å¤„ç†</h2><p>æ—¢ç„¶é€‰ç”¨äº†Golangï¼Œè‡ªç„¶è¦ç”¨åˆ°å®ƒç®€å•æ˜“ç”¨çš„å¹¶å‘æœºåˆ¶å•¦ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›ä¸å½±å“ä¸»æµç¨‹çš„æ“ä½œå®Œå…¨å¯ä»¥å¼‚æ­¥åŒ–ï¼Œä¾‹å¦‚å‘é€é‚®ä»¶ã€å†™æ—¥å¿—ç­‰ã€‚å¯ä»¥æŠŠä¸€äº›ä¸šåŠ¡åœºæ™¯å¹¶è¡Œå¤„ç†ï¼Œä¾‹å¦‚ä½ è¦ä¸€æ¬¡æ€§è¯»å–å¤šä¸ªæ–‡ä»¶ã€‚<br>â€‹</p><h1 id="6ã€æ€»ç»“"><a href="#6ã€æ€»ç»“" class="headerlink" title="6ã€æ€»ç»“"></a>6ã€æ€»ç»“</h1><p>ä»£ç å±‚é¢çš„ä¼˜åŒ–ï¼Œæ˜¯ us çº§åˆ«çš„ï¼Œè€Œé’ˆå¯¹ä¸šåŠ¡å¯¹å­˜å‚¨è¿›è¡Œä¼˜åŒ–ï¼Œå¯ä»¥åšåˆ° ms çº§åˆ«çš„ï¼Œæ‰€ä»¥ä¼˜åŒ–è¶Šé è¿‘åº”ç”¨å±‚æ•ˆæœè¶Šå¥½ã€‚å¯¹äºä»£ç å±‚é¢ï¼Œä¼˜åŒ–çš„æ­¥éª¤æ˜¯ï¼š</p><ol><li>åˆ©ç”¨å‹æµ‹å·¥å…·æ¨¡æ‹Ÿåœºæ™¯æ‰€éœ€çš„çœŸå®æµé‡ã€‚å‹æµ‹å·¥å…·æ¨èä½¿ç”¨ <a href="https://github.com/wg/wrk" target="_blank" rel="noopener">https://github.com/wg/wrk</a> æˆ– <a href="https://github.com/adjust/go-wrk" target="_blank" rel="noopener">https://github.com/adjust/go-wrk</a></li><li>pprof ç­‰å·¥å…·æŸ¥çœ‹æœåŠ¡çš„ CPUã€MEM è€—æ—¶</li><li>é”å®šå¹³é¡¶å±±é€»è¾‘ï¼Œçœ‹ä¼˜åŒ–å¯èƒ½æ€§ï¼šå¼‚æ­¥å¤„ç†ï¼Œç©ºé—´æ¢æ—¶é—´ï¼Œä½¿ç”¨é«˜æ€§èƒ½åŒ… ç­‰</li><li>å±€éƒ¨ä¼˜åŒ–å®Œå†™ benchmark å·¥å…·æŸ¥çœ‹ä¼˜åŒ–æ•ˆæœ</li><li>æ•´ä½“ä¼˜åŒ–å®Œå›åˆ°æ­¥éª¤ä¸€ï¼Œé‡æ–°è¿›è¡Œ å‹æµ‹+pprof çœ‹æ•ˆæœï¼Œçœ‹è€—æ—¶èƒ½å¦æ»¡è¶³è¦æ±‚ï¼Œå¦‚æœæ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œé‚£å°±æ¢å­˜å‚¨å§~ğŸ˜­</li></ol><p>â€‹    åç»­æˆ‘ä¼šç»™å¤§å®¶å‡ºä¸€ç¯‡å…³äºGolangæœåŠ¡çš„ä»£ç å¼€å‘å»ºè®®ï¼Œæˆ‘ä»¬ä¸‹æœŸè§ï¼ŒPeaceğŸ˜˜</p><blockquote><p>æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä¸ªåŠ±å¿—ç”¨æœ€ç®€å•çš„è¯­è¨€ï¼Œæè¿°æœ€å¤æ‚é—®é¢˜çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚<strong>æ±‚ç‚¹èµï¼Œæ±‚å…³æ³¨</strong>ï¼Œå¦‚æœä½ å¯¹æ­¤ç¯‡æ–‡ç« æœ‰ä»€ä¹ˆç–‘æƒ‘ï¼Œæ¬¢è¿åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ä¸­ç•™è¨€ï¼Œæˆ‘è¿˜å¯ä»¥ä¸ºä½ æä¾›ä»¥ä¸‹å¸®åŠ©ï¼š</p><ul><li>å¸®åŠ©å»ºç«‹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»</li><li>äº’è”ç½‘çœŸå®é«˜å¹¶å‘åœºæ™¯å®æˆ˜è®²è§£</li><li>ä¸å®šæœŸåˆ†äº«Golangã€Javaç›¸å…³ä¸šå†…çš„ç»å…¸åœºæ™¯å®è·µ<br>æˆ‘çš„åšå®¢ï¼š<a href="https://besthpt.github.io/" target="_blank" rel="noopener">https://besthpt.github.io/</a><br>å¾®ä¿¡å…¬ä¼—å·ï¼šâ€ç®€å‡¡ä¸¶â€</li></ul></blockquote><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1633094381436-599e5e08-34bf-4d7a-88fb-e9a4b30ebea3.png" class="lazyload"></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šåç«¯ä»å…¥é—¨åˆ°ç†Ÿæ‚‰-æ­£å¼ç¯‡ã€‹</title>
      <link href="/2021/10/23/9.%E5%90%8E%E7%AB%AF%E5%BF%83%E5%BE%97%E5%88%86%E4%BA%AB/%E3%80%8A%E5%90%8E%E7%AB%AF%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%86%9F%E6%82%89-%E6%AD%A3%E5%BC%8F%E7%AF%87%E3%80%8B/"/>
      <url>/2021/10/23/9.%E5%90%8E%E7%AB%AF%E5%BF%83%E5%BE%97%E5%88%86%E4%BA%AB/%E3%80%8A%E5%90%8E%E7%AB%AF%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%86%9F%E6%82%89-%E6%AD%A3%E5%BC%8F%E7%AF%87%E3%80%8B/</url>
      
        <content type="html"><![CDATA[<p>å—¨å–½ï¼Œå¤§å®¶å¥½å‘€ï¼æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä½æ¸¸èµ°äºå„äº’è”ç½‘å¤§å‚é—´çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚ä»æœ¬ç¯‡å¼€å§‹ï¼Œæˆ‘å¼€å§‹æŒ‰ç…§ä¼ä¸šå¯¹äºåç«¯å¼€å‘è€…çš„éœ€æ±‚å±‚çº§ï¼Œå°†æˆé•¿é˜¶æ®µæ‹†åˆ†ä¸ºå…¥é—¨ã€åˆçº§ã€ä¸­çº§ã€é«˜çº§ã€å²è¯—çº§ï¼Œé€æ­¥æ·±å…¥çš„ä¸ºå¤§å®¶ä»‹ç»åç«¯çš„å­¦ä¹ å†…å®¹ï¼Œä¸‹é¢å¼€å§‹æ­£é¢˜ã€‚</p><h2 id="ä¸€ã€å‰æœŸå‡†å¤‡"><a href="#ä¸€ã€å‰æœŸå‡†å¤‡" class="headerlink" title="ä¸€ã€å‰æœŸå‡†å¤‡"></a>ä¸€ã€å‰æœŸå‡†å¤‡</h2><p>é¦–å…ˆè¯´å‰æœŸå‡†å¤‡ï¼Œæ‰¿æ¥åºè¨€ä¸­çš„è§‚ç‚¹ï¼Œä¸ºäº†è®©æ¯ä¸€è½®çš„çŸ¥è¯†å­¦ä¹ æ›´åŠ æ‰å®ï¼Œä¹Ÿä¸ºäº†å­¦ä¹ çš„ç»“æœã€Demoæ²‰æ·€ä¸‹æ¥ï¼Œç”¨äºä»¥åçš„å¤ä¹ ã€å›æº¯ï¼Œæˆ‘ä»¬è¦å¼€å§‹åšä»¥ä¸‹äº‹æƒ…ï¼š</p><ul><li><p>é€‰æ‹©è‡ªå·±çš„äº‘ç¬”è®°ï¼Œä¸ªäººå»ºè®®ç”¨è¯­é›€ï¼Œä¸Šä¸€ç¯‡åšè¿‡åˆ†æã€‚ç„¶åå‚è€ƒç®€å‡¡ä¸€æ ·å»ºç«‹è‡ªå·±åç«¯çš„ä½“ç³»æ¡†æ¶ï¼Œæœªæ¥é€æ­¥å¾€é‡Œé¢å¢æ·»å†…å®¹</p></li><li><p>å‡†å¤‡å¥½é›†æˆå¼€å‘ç¯å¢ƒï¼Œå»ºè®®ç›´æ¥ç”¨jetbrainsï¼ŒJavaé€‰ç”¨ideaï¼ŒGoé€‰ç”¨Golandï¼Œ<a href="https://www.jetbrains.com/" target="_blank" rel="noopener">https://www.jetbrains.com/</a></p></li><li><p>æˆ‘ä¼šç»™å¤§å®¶æä¾›çš„Excelå­¦ä¹ è·¯çº¿ï¼Œå¹¶æ•´ç†æˆWBSçš„æ ¼å¼ï¼Œæ”¾åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·â€ç®€å‡¡ä¸¶â€ä¸­ä¾›å¤§å®¶ä¸‹è½½ï¼Œå…¬ä¼—å·å›å¤â€œå­¦ä¹ è·¯çº¿â€å³å¯è·å–ã€‚å¤§å®¶å¯ä»¥æŒ‰ç…§è‡ªå·±çš„æƒ…å†µå®Œå–„è®¡åˆ’ï¼Œç„¶åæ¯å¤©è¿›è¡Œæ‰“å¡ï¼Œç”¨äºç›‘ç£å­¦ä¹ è¿›åº¦ï¼Œæ¿€åŠ±è‡ªå·±ä¸æ–­å®Œå–„è‡ªå·±çš„çŸ¥è¯†ä½“ç³»ã€‚åé¢æˆ‘ä¼šå®šæœŸå¯¹è·¯çº¿å›¾è¿›è¡Œå®Œå–„ï¼Œè¡¥å……å†…å®¹ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œç¬¬ä¸€æ—¶é—´è·å¾—æ›´æ–°é€šçŸ¥ã€‚</p></li><li><p>å­¦ä¹ æ€è·¯ï¼š</p><ul><li>å…¥é—¨é˜¶æ®µå»ºè®®ç”¨è§†é¢‘+æ–‡æ¡£çš„æ–¹å¼å­¦ä¹ ï¼Œè§†é¢‘å¯ä»¥å¸®åŠ©æˆ‘ä»¬å°‘èµ°ä¸€äº›å¼¯è·¯ï¼Œå°½å¿«å»ºç«‹è®¤çŸ¥ã€‚æ–‡æ¡£å¯ä»¥å¸®åŠ©å½¢æˆå®Œæ•´çš„çŸ¥è¯†ä½“ç³»ï¼Œå¹¶å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ•´ç†ç¬”è®°ã€‚é«˜çº§é˜¶æ®µé€šè¿‡æ–‡æ¡£å­¦ä¹ å¾€å¾€æ•ˆç‡ä¼šæ›´é«˜ï¼Œæ¥æ”¶çš„çŸ¥è¯†ä¹Ÿæ›´åŠ å‡†ç¡®ï¼Œä¸”æˆä½“ç³»ã€‚</li><li>åˆçº§é˜¶æ®µè¦å¤šæ•²ä»£ç ï¼Œæ‰‹æ•²ä»£ç æ—¶æˆ‘ä»¬æ‰ä¼šå‘ç°å¯¹ä¸€äº›çŸ¥è¯†ç‚¹å¹¶æœªç†è§£é€å½»ï¼Œå¯¹æ‰€å­¦çš„çŸ¥è¯†ä¸€å®šè¦åšæ‰å®ã€‚é«˜çº§é˜¶æ®µè¦å¤šè¯»ä¼˜ç§€çš„å¼€æºä»£ç ï¼Œä»ä¸­å­¦ä¹ å€Ÿé‰´å¥½çš„ä»£ç è®¾è®¡ï¼Œå»ç²—å–ç²¾ï¼Œæœ€ç»ˆå½¢æˆè‡ªå·±çš„ä»£ç é£æ ¼ã€‚</li></ul></li></ul><h2 id="äºŒã€å…¥é—¨é˜¶æ®µï¼šæŒæ¡ä¸€é—¨è¯­è¨€"><a href="#äºŒã€å…¥é—¨é˜¶æ®µï¼šæŒæ¡ä¸€é—¨è¯­è¨€" class="headerlink" title="äºŒã€å…¥é—¨é˜¶æ®µï¼šæŒæ¡ä¸€é—¨è¯­è¨€"></a>äºŒã€å…¥é—¨é˜¶æ®µï¼šæŒæ¡ä¸€é—¨è¯­è¨€</h2><h4 id="2-1-ç¼–ç¨‹è¯­è¨€"><a href="#2-1-ç¼–ç¨‹è¯­è¨€" class="headerlink" title="2.1 ç¼–ç¨‹è¯­è¨€"></a>2.1 ç¼–ç¨‹è¯­è¨€</h4><p>å…¶å®åšè½¯ä»¶å¼€å‘æœ‰æ—¶å€™å°±å’Œå†™ä¸€ç¯‡è¯´æ˜æ–‡ä¸€æ ·ï¼Œå°†ä¸€ä»¶ä¸šåŠ¡éœ€æ±‚æè¿°æ¸…æ¥šï¼Œç¨‹åºå°±å¯ä»¥æŒ‰ç…§é¢„æƒ³çš„è¿è¡Œèµ·æ¥äº†ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆè¦æŒæ¡ä¸€é—¨è¯­è¨€ï¼Œç”¨äºå’Œè®¡ç®—æœºæ‰“äº¤é“ï¼Œå‘Šè¯‰å®ƒæˆ‘ä»¬è¦åšäº›ä»€ä¹ˆã€‚</p><p>ä¸ºäº†å’Œæ“ä½œç³»ç»Ÿæ‰“äº¤é“ï¼Œæˆ‘ä»¬å…ˆè¦å­¦ä¹ Javaã€Golangã€Pythonã€C++ç­‰åç«¯è¯­è¨€ã€‚è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ç¼–ç¨‹è¯­è¨€çš„é€‰æ‹©ï¼Œç°åœ¨çš„ä¸­ã€å°å‹å…¬å¸å¤šä»¥Javaä¸ºä¸»ï¼Œå› ä¸ºJavaçš„ç”Ÿæ€æ›´å®Œå–„ï¼Œè¯´ç™½äº†å°±æ˜¯åº”ç”¨æ¡†æ¶æ›´ä¸°å¯Œï¼Œå¼€ç®±å³ç”¨ï¼Œå„ç§ä¸šåŠ¡éœ€æ±‚åœºæ™¯éƒ½æœ‰æ¯”è¾ƒæˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œç¤¾åŒºä¹Ÿæ¯”è¾ƒæ´»è·ƒï¼Œç”šè‡³åˆ°äº†å†…å·çš„çŠ¶æ€ğŸ¶ã€‚ç„¶åå°±æ˜¯Golangï¼Œç›®å‰ç”Ÿæ€è¿˜ä¸å¤Ÿå®Œå–„ï¼Œå¼€æºé¡¹ç›®ä¸å¤Ÿä¸°å¯Œï¼Œä½†è§£å†³å¤§å¤šæ•°çš„éœ€æ±‚è¿˜æ˜¯æ²¡é—®é¢˜çš„ã€‚ç°åœ¨å¤§å‚éƒ½åœ¨æ‹¥æŠ±äº‘åŸç”Ÿï¼Œè€Œä¸”å¤§å‚è‡ªå·±ä¹Ÿæœ‰ä¸€å®šçš„è‡ªç ”èƒ½åŠ›ï¼Œæ‰€ä»¥æœ‰äº›è½¬å‘äº†Golangã€‚å¦å¤–ï¼ŒGolangè¯­æ³•ç›¸å¯¹Javaè¾ƒä¸ºç®€å•ï¼Œå­¦ä¹ æˆæœ¬è¾ƒä½ï¼Œå¹¶ä¸”å¤©ç„¶æ”¯æŒå¹¶å‘ç¼–ç¨‹ã€‚æœ€åè¯´ä¸‹Pythonï¼Œç°åœ¨æ¯”è¾ƒå¸¸è§çš„åº”ç”¨é¢†åŸŸæ˜¯æœºå™¨å­¦ä¹ ã€æ•°æ®åˆ†æç­‰ï¼Œä½†ä½œä¸ºåç«¯è¯­è¨€åœ¨æ€§èƒ½æ–¹é¢æ— ä¼˜åŠ¿ï¼Œè€Œä¸”æ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œä¸åˆ©äºå»ºç«‹è‡ªå·±çš„ä»£ç è§„èŒƒï¼Œä¸å¤ªå»ºè®®æ–°æ‰‹å°†å…¶ä½œä¸ºä¸»è¦çš„åç«¯è¯­è¨€æ¥ç”¨ã€‚</p><p>è¨€å½’æ­£ä¼ ï¼Œä¸‹é¢åˆ†åˆ«åˆ—ä¸¾äº†Javaã€Golangçš„è¯­è¨€å…¥é—¨å†…å®¹ï¼š</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634560652542-1234e1ce-0735-413a-b4c0-bf9bbb75f53c.png" class="lazyload"></p><h4 id="2-2-æ•°æ®åº“"><a href="#2-2-æ•°æ®åº“" class="headerlink" title="2.2 æ•°æ®åº“"></a>2.2 æ•°æ®åº“</h4><p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦å°†æ•°æ®å­˜å‚¨èµ·æ¥ï¼Œå°±è¦ç”¨åˆ°æ•°æ®åº“ï¼Œä¸ºäº†ä¸æ•°æ®åº“æ‰“äº¤é“ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¹ ï¼š</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634560723990-c14255a8-f1ba-4aac-ae4b-1874a5975d59.png" class="lazyload"></p><h4 id="2-3-å‰ç«¯"><a href="#2-3-å‰ç«¯" class="headerlink" title="2.3 å‰ç«¯"></a>2.3 å‰ç«¯</h4><p>ä¸ºäº†åç»­ä¸å‰ç«¯é¡µé¢æ‰“äº¤é“ï¼Œæˆ‘ä»¬éœ€è¦å¼€å§‹æŒæ¡å‰ç«¯åŸºç¡€ï¼š</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634560967073-f499e7f8-f700-4fa2-97dd-8a1bf353ac0b.png" class="lazyload"></p><h4 id="2-4-ç ”å‘å·¥å…·"><a href="#2-4-ç ”å‘å·¥å…·" class="headerlink" title="2.4 ç ”å‘å·¥å…·"></a>2.4 ç ”å‘å·¥å…·</h4><p>ä¸ºäº†æ›´é«˜æ•ˆçš„å¼€å‘ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé›†æˆå¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œä¸ºå¤§å®¶æ¨èideaå…¨å®¶æ¡¶ï¼Œgolangç”¨golandï¼š</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634560801680-28cb1e1c-dd39-4a10-bd1e-04ad7f14034f.png" class="lazyload"></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±ç®—å®Œæˆçš„å¸¸ç”¨è¯­è¨€çš„å…¥é—¨ï¼Œä½†è¿™è¿˜ä¸è¶³ä»¥è®©æˆ‘ä»¬å¼€å‘å‡ºä¸€ä¸ªWebé¡¹ç›®ï¼Œæˆ‘ä»¬æ¥ç»§ç»­çœ‹ä¸‹ä¸€èŠ‚ã€‚</p><h2 id="ä¸‰ã€åˆçº§é˜¶æ®µï¼šWebå¼€å‘åˆçª¥"><a href="#ä¸‰ã€åˆçº§é˜¶æ®µï¼šWebå¼€å‘åˆçª¥" class="headerlink" title="ä¸‰ã€åˆçº§é˜¶æ®µï¼šWebå¼€å‘åˆçª¥"></a>ä¸‰ã€åˆçº§é˜¶æ®µï¼šWebå¼€å‘åˆçª¥</h2><h4 id="3-1-ç½‘ç»œã€è®¡ç®—æœºç³»ç»ŸåŸºç¡€"><a href="#3-1-ç½‘ç»œã€è®¡ç®—æœºç³»ç»ŸåŸºç¡€" class="headerlink" title="3.1 ç½‘ç»œã€è®¡ç®—æœºç³»ç»ŸåŸºç¡€"></a>3.1 ç½‘ç»œã€è®¡ç®—æœºç³»ç»ŸåŸºç¡€</h4><p>æ—¢ç„¶è¦å¼€å‘ä¸€ä¸ªwebåº”ç”¨ï¼Œæˆ‘ä»¬å°±é¦–å…ˆéœ€è¦æŒæ¡ä¸€äº›ç½‘ç»œåŸºç¡€çŸ¥è¯†ï¼Œä»¥ä¾¿äºäº†è§£æ•°æ®æ˜¯å¦‚ä½•åœ¨ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“çš„ã€‚ä¼ä¸šçº§çš„é¡¹ç›®åŸºæœ¬éƒ½æ˜¯éƒ¨ç½²åœ¨LinuxæœåŠ¡å™¨ä¸Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¼€å§‹å­¦ä¹ linuxçŸ¥è¯†å’Œshellå‘½ä»¤ã€‚<a href="https://doc.code-nav.cn/roadmap/java" target="_blank" rel="noopener"></a><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634561389685-a919b1b1-da38-4907-a6e2-5b2c1313555a.png" class="lazyload"><a href="https://doc.code-nav.cn/roadmap/java" target="_blank" rel="noopener"></a>    </p><h4 id="3-2-Webå…¥é—¨"><a href="#3-2-Webå…¥é—¨" class="headerlink" title="3.2 Webå…¥é—¨"></a>3.2 Webå…¥é—¨</h4><p>æˆ‘ä»¬é€‰æ‹©çš„åç«¯è¯­è¨€éƒ½æœ‰æˆç†Ÿçš„Webæ¡†æ¶ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸å‰ç«¯é¡µé¢ï¼Œä¸æ•°æ®åº“æ‰“äº¤é“ã€‚å¯¹äºJavaæˆ‘ä»¬è¦å¼€å§‹å­¦ä¹ JavaWebåŸºç¡€ï¼Œå­¦ä¹ Springå…¨å®¶æ¡¶ã€‚å¯¹äºGolangï¼Œç°åœ¨æ¯”è¾ƒä¸»æµçš„Webæ¡†æ¶æ˜¯beegoæˆ–è€…æ˜¯ginã€‚æ­¤å¤–ï¼Œå¼€å‘è€…ä»¬ä¼šæŠŠæŸäº›é€šç”¨åŠŸèƒ½ï¼Œå¼€å‘æˆç»„ä»¶ï¼Œé€šè¿‡SDKåŒ…çš„æ–¹å¼å¼€æºå‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å­¦ä¹ åŒ…ç®¡ç†å·¥å…·ï¼Œä»¥ä¾¿å¼•ç”¨è‡ªå·±æˆ–ä»–äººçš„ä»£ç ã€‚Javaä¸­å¸¸ç”¨çš„æ˜¯Mavenå’ŒGradleï¼ŒGolangä¸­å®˜æ–¹æä¾›äº†go moduleã€‚</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634562391132-72dd9139-5f11-49c2-9bf3-a98b58bea34e.png" class="lazyload"></p><h4 id="3-3-å‰ç«¯æ¡†æ¶"><a href="#3-3-å‰ç«¯æ¡†æ¶" class="headerlink" title="3.3 å‰ç«¯æ¡†æ¶"></a>3.3 å‰ç«¯æ¡†æ¶</h4><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å¼€å§‹å­¦ä¹ ä¸€äº›å‰ç«¯æ¡†æ¶ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½ï¼Œæ›´å¿«é€Ÿå¼€å‘å‰ç«¯é¡µé¢ã€‚è¿™é‡Œåªå†™äº†JQueryï¼Œå› ä¸ºä¸Šæ‰‹æ¯”è¾ƒå®¹æ˜“ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å­¦ä¹ ä¸‹VUEï¼Œæœ¬ç¯‡æˆ‘å°†å…¶æ”¾åˆ°äº†ä¸­çº§é˜¶æ®µé‡Œäº†ã€‚</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634562865609-10c2a402-0867-4eca-b27a-365c718ade12.png" class="lazyload"></p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634564795517-a603458e-f846-4de0-b3ea-f5ad5f4bcc34.png" class="lazyload"></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å‘ä¸€ä¸ªå°å‹å•ä½“Webåº”ç”¨äº†ã€‚ä¸­çº§é˜¶æ®µé‡Œæˆ‘ä»¬ä¼šå¼€å§‹åˆ©ç”¨å„ç§å¼€æºæ¡†æ¶ååŠ©æˆ‘ä»¬å®ç°å¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ï¼Œç„¶åå­¦ä¹ å¦‚ä½•æ¥å…¥å¾®æœåŠ¡ï¼Œå°†å¤§å‹åº”ç”¨æ‹†åˆ†ä¸ºä¸€ä¸ªä¸ªå•ä½“æœåŠ¡ï¼Œä»¥ä¾¿åœ¨ä¼ä¸šçº§å¼€å‘ä¸­æ›´åŠ å¿«é€Ÿçš„è¿­ä»£éœ€æ±‚ã€‚å­¦ä¹ ä»£ç ç®¡ç†ï¼Œå¹¶å…³æ³¨è‡ªå·±çš„ä»£ç è§„èŒƒã€‚</p><h2 id="å››ã€ä¸­çº§é˜¶æ®µï¼šåº”å¯¹å¤æ‚å¤šå˜çš„ä¸šåŠ¡éœ€æ±‚"><a href="#å››ã€ä¸­çº§é˜¶æ®µï¼šåº”å¯¹å¤æ‚å¤šå˜çš„ä¸šåŠ¡éœ€æ±‚" class="headerlink" title="å››ã€ä¸­çº§é˜¶æ®µï¼šåº”å¯¹å¤æ‚å¤šå˜çš„ä¸šåŠ¡éœ€æ±‚"></a>å››ã€ä¸­çº§é˜¶æ®µï¼šåº”å¯¹å¤æ‚å¤šå˜çš„ä¸šåŠ¡éœ€æ±‚</h2><p>ä¸­çº§é˜¶æ®µæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æˆä¸ºä¸€ä¸ªåˆæ ¼çš„CRUD Boyï¼Œé‚£æˆ‘ä»¬è¦åšå“ªäº›äº‹æƒ…å‘¢ï¼Ÿ</p><h4 id="4-1-å·©å›ºåŸºç¡€"><a href="#4-1-å·©å›ºåŸºç¡€" class="headerlink" title="4.1 å·©å›ºåŸºç¡€"></a>4.1 å·©å›ºåŸºç¡€</h4><p>è¿›å…¥ä¸­çº§é˜¶æ®µï¼Œå»ºè®®å¤§å®¶é¦–å…ˆè¦åšä¸€éåŸºç¡€çš„å·©å›ºï¼Œè¦å°†æˆ‘ä»¬åœ¨å…¥é—¨å’Œåˆçº§é˜¶æ®µæ²‰æ·€çš„çŸ¥è¯†çœŸæ­£æˆä¸ºæˆ‘ä»¬è‡ªå·±çš„ã€‚é‚£è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œé€šè¿‡é˜…è¯»ä¸šç•Œä¼˜ç§€ä¹¦ç±ï¼Œå®˜æ–¹æ–‡æ¡£ï¼Œå†æ¬¡æ¯”å¯¹æˆ‘ä»¬çš„ç¬”è®°ï¼Œå¹¶å¯¹å…¶è¿›è¡Œæ€»ç»“å’Œå®Œå–„ã€‚è¿™æ—¶æˆ‘ä»¬å¯¹å‰é¢çŸ¥è¯†çš„ç†è§£ä¼šæ›´åŠ æ·±å…¥ï¼Œç”šè‡³ä¸Šå‡ä¸€ä¸ªå±‚æ¬¡ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å†å­¦ä¹ ä¸€ä¸‹Nginxã€Nettyç½‘ç»œæ¡†æ¶ï¼ŒåŠ æ·±æˆ‘ä»¬å¯¹ç½‘ç»œé€šä¿¡çš„ç†è§£ã€‚Javaçš„è¯è¿˜å¯ä»¥å­¦ä¹ ä¸€ä¸‹Java8ã€‚</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634891238845-379a8e34-c323-45c2-ad9f-a3ad8f95d2ae.png" class="lazyload"></p><p>æˆ‘ä»¬è¿˜éœ€è¦å­¦ä¹ ä¸€äº›å¹¶å‘ç¼–ç¨‹çš„çŸ¥è¯†ï¼Œæ¥æå‡æˆ‘ä»¬ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</p><ul><li>Java</li></ul><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634891407507-694d7ea5-8e80-4194-a3ac-4da95041da4a.png" class="lazyload"></p><ul><li>Golang</li></ul><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634891546918-ea64e7e0-3831-4aa5-96fd-8dbc49acd9b7.png" class="lazyload"></p><p>è¿›ä¸€æ­¥å­¦ä¹ ä¸€äº›ç¼–ç¨‹è¯­è¨€æ˜¯å¦‚ä½•ä¸è®¡ç®—æœºç³»ç»Ÿæ‰“äº¤é“çš„ï¼Œä»¥ä¾¿äºæˆ‘ä»¬ç†è§£ç¨‹åºçš„è¿è¡Œæœºåˆ¶ï¼Œä¹Ÿä¸ºä»¥ååšæ€§èƒ½è°ƒä¼˜æ‰“ä¸‹åŸºç¡€</p><ul><li>Java</li></ul><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634891786044-e68c5d69-0a7e-400c-90fb-6173fbb0ed17.png" class="lazyload"></p><ul><li>Golangï¼šGPMã€pprof</li></ul><h4 id="4-2-æå‡ä»£ç è´¨é‡"><a href="#4-2-æå‡ä»£ç è´¨é‡" class="headerlink" title="4.2 æå‡ä»£ç è´¨é‡"></a>4.2 æå‡ä»£ç è´¨é‡</h4><p>ä¸ºäº†é¿å…æµæ°´è´¦å½¢å¼çš„ä»£ç ï¼Œæˆ‘ä»¬è¦å¼€å§‹å­¦ä¹ è®¾è®¡æ¨¡å¼å’Œä»£ç è§„èŒƒã€‚è®©è‡ªå·±çš„ä»£ç å˜å¾—ä¼˜é›…èµ·æ¥ã€‚å­¦ä¹ ä¸‹Mysqlçš„åº•å±‚çŸ¥è¯†å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œè®©æˆ‘ä»¬çš„sqlä¹Ÿå˜å¾—é«˜æ•ˆèµ·æ¥ã€‚å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦å¼€å§‹å­¦ä¹ æ•°æ®ç»“æ„çš„çŸ¥è¯†ï¼Œå¼€å§‹åˆ·åˆ·ç®—æ³•é¢˜äº†ã€‚</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634649226591-b12aff8f-1b3b-491e-968c-f25fe4102b15.png" class="lazyload"></p><ul><li>Java</li></ul><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634891296718-5ca71b3d-cac6-483b-8587-6b5d4a3d594d.png" class="lazyload"></p><ul><li>Golang</li></ul><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634891893990-bf233198-7c2f-4f36-bb20-cb24e0505af5.png" class="lazyload"></p><ul><li>Mysql</li></ul><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634892226663-d8387f87-8954-4f37-aaed-05b6ac2b0274.png" class="lazyload"></p><ul><li>ç®—æ³•ä¸æ•°æ®ç»“æ„</li></ul><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634911523124-46c97237-6fc4-4bd5-b7cc-862697dde45c.png" class="lazyload"></p><h4 id="4-3-å­¦ä¹ åº”ç”¨æ¡†æ¶"><a href="#4-3-å­¦ä¹ åº”ç”¨æ¡†æ¶" class="headerlink" title="4.3 å­¦ä¹ åº”ç”¨æ¡†æ¶"></a>4.3 å­¦ä¹ åº”ç”¨æ¡†æ¶</h4><p>ä¸ºäº†è§£å†³å¤§å‹åº”ç”¨å¼€å‘ä¸­çš„ç§ç§éœ€æ±‚ï¼Œæ¯ç§é€šç”¨çš„ä¸šåŠ¡åœºæ™¯éƒ½æœ‰å†™å¼€æºæ¡†æ¶å’Œä¸­é—´ä»¶æ¥æ”¯æŒæˆ‘ä»¬æ–¹ä¾¿å¿«æ·çš„è§£å†³éœ€æ±‚ã€‚</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634892090401-dda5a4ba-ec29-4192-8c09-8af8a02fe2c5.png" class="lazyload"></p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634892259615-28822cce-0350-4f96-8b62-2b4144b6057b.png" class="lazyload"></p><p>å¯¹äºå‰ç«¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å­¦ä¹ ä¸‹vueã€Node.jsã€npmï¼ŒååŠ©æˆ‘ä»¬æ›´å¥½ã€æ›´æ–¹ä¾¿çš„å¼€å‘å‰ç«¯é¡¹ç›®</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634892358451-fb8b535d-6a9e-43f2-95ce-cae6522baa9d.png" class="lazyload"></p><h4 id="4-4-ä»£ç ç®¡ç†"><a href="#4-4-ä»£ç ç®¡ç†" class="headerlink" title="4.4 ä»£ç ç®¡ç†"></a>4.4 ä»£ç ç®¡ç†</h4><p>æˆ‘ä»¬åœ¨è¿™ä¸ªé˜¶æ®µæ¯å¤©å¯èƒ½éƒ½ä¼šå†™å¾ˆå¤šçš„ä»£ç äº†ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¹ ä¸‹ä»£ç ç®¡ç†å·¥å…·ï¼Œå°†æˆ‘ä»¬çš„é¡¹ç›®ç®¡ç†èµ·æ¥ã€‚</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634892475409-688ccd89-5c74-435d-b2c1-d0ae6c074706.png" class="lazyload"></p><h4 id="4-5-åˆ†å¸ƒå¼ç³»ç»Ÿ"><a href="#4-5-åˆ†å¸ƒå¼ç³»ç»Ÿ" class="headerlink" title="4.5 åˆ†å¸ƒå¼ç³»ç»Ÿ"></a>4.5 åˆ†å¸ƒå¼ç³»ç»Ÿ</h4><p>çœŸæ­£çš„ä¼ä¸šçº§å¤§å‹é¡¹ç›®å¾€å¾€éƒ½æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¼€å§‹å­¦ä¹ å„ç§åˆ†å¸ƒå¼åœºæ™¯è§£å†³æ–¹æ¡ˆå¯¹åº”æ¡†æ¶çš„ä½¿ç”¨ã€‚å¦å¤–ï¼Œä¼ä¸šä¸ºäº†æ›´å¿«çš„è¿­ä»£ã€æ›´å¥½çš„ç»„ç»‡å¤§å‹åº”ç”¨åˆ†åˆ†å‘å¾®æœåŠ¡è¿›è¡Œè½¬å‹ï¼ŒæŠŠå•ä½“é¡¹ç›®æ‹†åˆ†æˆäº†ä¸€ä¸ªä¸ªå¾®æœåŠ¡ã€‚æ‰€ä»¥è¿™é‡Œä¹Ÿå˜æˆçš„å¾ˆå¤šä¼ä¸šå¯¹äºåç«¯å¼€å‘è€…çš„å¿…å¤‡éœ€æ±‚ä¹‹ä¸€äº†ã€‚</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634892746944-888f115b-42aa-4005-b2f5-062d004d0de1.png" class="lazyload"></p><p>å­¦ä¹ å®Œç¬¬å››ç« èŠ‚ï¼Œæ­å–œä½ å˜æˆäº†ä¸€ä¸ªåˆæ ¼çš„CRUD boyäº†ã€‚</p><h2 id="äº”ã€é«˜çº§é˜¶æ®µï¼šé¢å‘è–ªèµ„ç¼–ç¨‹"><a href="#äº”ã€é«˜çº§é˜¶æ®µï¼šé¢å‘è–ªèµ„ç¼–ç¨‹" class="headerlink" title="äº”ã€é«˜çº§é˜¶æ®µï¼šé¢å‘è–ªèµ„ç¼–ç¨‹"></a>äº”ã€é«˜çº§é˜¶æ®µï¼šé¢å‘è–ªèµ„ç¼–ç¨‹</h2><p>ä¸ºäº†â€è–ªèµ„æå‡â€ï¼Œå’³å’³ï¼Œä¸ï¼Œæ˜¯ä¸ºäº†æŠ€æœ¯çš„è¿›é˜¶ã€‚æˆ‘ä»¬éœ€è¦äº†è§£æˆ‘ä»¬åº”ç”¨çš„æ¡†æ¶çš„è®¾è®¡åŸç†ï¼Œå®ç°ç»†èŠ‚ï¼Œå¸¸è§é—®é¢˜ï¼ŒæŠ€æœ¯é€‰å‹ç­‰ç­‰ï¼Œå¼€å§‹å‘é«˜çº§ç ”å‘å·¥ç¨‹å¸ˆè¿›é˜¶ã€‚å¦å¤–ï¼Œè¿˜éœ€è¦å¤šå¤šé˜…è¯»å¼€æºé¡¹ç›®ï¼Œäº†è§£å…¶é¡¹ç›®ç»“æ„ï¼Œå®ç°ç»†èŠ‚ç­‰ï¼Œä¿—è¯è¯´â€œå®ƒå±±ä¹‹çŸ³å¯ä»¥æ”»ç‰â€ã€‚</p><h4 id="5-1-æ¡†æ¶è¿›é˜¶"><a href="#5-1-æ¡†æ¶è¿›é˜¶" class="headerlink" title="5.1 æ¡†æ¶è¿›é˜¶"></a>5.1 æ¡†æ¶è¿›é˜¶</h4><p>è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬è¦åšçš„æœ‰ï¼š</p><ul><li>æ‹“å±•çŸ¥è¯†çš„å¹¿åº¦ï¼Œå­¦ä¹ æŒæ¡æ›´å¤šéœ€æ±‚åœºæ™¯çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ•°æ®åº“çš„è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ï¼Œå¦‚ä½•è§£å†³æ¥å£çš„å¹‚ç­‰æ€§é—®é¢˜ç­‰ã€‚</li><li>æ‹“å±•çŸ¥è¯†çš„æ·±åº¦ï¼Œäº†è§£æ¡†æ¶åŸç†ã€å®ç°ç»†èŠ‚ã€æŠ€æœ¯é€‰å‹ã€å¸¸è§çš„ç”Ÿäº§é—®é¢˜ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ä½¿ç”¨æ¡†æ¶æ¥è§£å†³éœ€æ±‚ï¼Œä¹Ÿè®©æˆ‘ä»¬çš„ç³»ç»Ÿè¿è¡Œçš„æ›´åŠ ç¨³å®šã€‚ä¼ä¸šä¸­ï¼Œå°¤å…¶æ˜¯åœ¨çº¿ä¸šåŠ¡ç³»ç»Ÿï¼Œéƒ½éå¸¸é‡è§†ç³»ç»Ÿç¨³å®šæ€§ï¼Œå¦‚æœæˆ‘ä»¬å¹³æ—¶ä¸æ³¨é‡ç›¸å…³åº•å±‚çŸ¥è¯†çš„ç§¯ç´¯ï¼Œå¯¹äºä¸­é—´ä»¶çš„åº”ç”¨æµ®äºè¡¨é¢ï¼Œå¾ˆå¯èƒ½å°±æå‡ºä¸ªBUGï¼Œå¹¶ä¸”å‡ºç°é—®é¢˜æ—¶è¿˜æ— ä»ç€æ‰‹ã€‚æˆ–æ˜¯ï¼Œæˆ‘ä»¬æƒ³å»åšåŸºç¡€æ¶æ„ç›¸å…³çš„å¼€å‘ï¼Œæ›´åŠ éœ€è¦ç§¯ç´¯åº•å±‚çŸ¥è¯†äº†ã€‚</li></ul><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634911306670-c76c4256-eec6-4d29-986c-2e1668ff7748.png" class="lazyload"></p><h4 id="5-2-é¡¹ç›®å®æˆ˜"><a href="#5-2-é¡¹ç›®å®æˆ˜" class="headerlink" title="5.2 é¡¹ç›®å®æˆ˜"></a>5.2 é¡¹ç›®å®æˆ˜</h4><p>è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬è¦å¼€å§‹ç§¯ç´¯å®æˆ˜ç»éªŒï¼Œå¦‚æœè¿˜åœ¨å­¦ä¹ é˜¶æ®µï¼Œå°±å¤šçœ‹çœ‹å¼€æºçš„æ¡†æ¶æºç ã€‚å¦‚æœæˆ‘ä»¬å·²ç»å·¥ä½œï¼Œé‚£å°±è¦æ³¨é‡å·¥ä½œä¸­çš„æ€»ç»“ã€‚è¡ŒåŠ¨ä¸­æ€è€ƒï¼Œå°±æ˜¯å§‹ç»ˆä¿æŒå¥½å¥‡ï¼Œä¸æ–­ä»å·¥ä½œä¸­å‘ç°é—®é¢˜ï¼Œä¸æ–­å¸¦ç€é—®é¢˜å›åˆ°å·¥ä½œä¸­å»ï¼›ä¸æ–­æ€è€ƒï¼Œä¸æ–­åœ¨å·¥ä½œä¸­éªŒè¯æ€è€ƒï¼›ä¸æ–­ä»å·¥ä½œä¸­æ€»ç»“æŠ½è±¡ï¼Œä¸æ–­å¯¹å·¥ä½œè¿›è¡Œå¤ç›˜ï¼ŒæŒç»­ä¸æ–­æŠŠå·¥ä½œå†…å®¹å’Œå…¨é¢†åŸŸçš„çŸ¥è¯†äº¤å‰éªŒè¯ï¼Œåå¤å®è·µã€‚</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634910650780-30338969-3582-42fa-9316-ffe9c520c48c.png" class="lazyload"></p><h2 id="å…­ã€å²è¯—çº§é˜¶æ®µï¼šæŒç»­ç²¾è¿›"><a href="#å…­ã€å²è¯—çº§é˜¶æ®µï¼šæŒç»­ç²¾è¿›" class="headerlink" title="å…­ã€å²è¯—çº§é˜¶æ®µï¼šæŒç»­ç²¾è¿›"></a>å…­ã€å²è¯—çº§é˜¶æ®µï¼šæŒç»­ç²¾è¿›</h2><p>å¦‚æœæŠŠå‰é¢5æ­¥éƒ½åšåˆ°ä¼˜ç§€ï¼ŒåŸºæœ¬ä½ å·²ç»å¯ä»¥å¯¹é½é«˜çº§ç ”å‘å·¥ç¨‹å¸ˆäº†ï¼Œå¦‚æœä½ é¡¹ç›®ç»éªŒå¾ˆå¥½ï¼Œè¿˜å¯èƒ½ä¼šæ›´é«˜ã€‚é‚£æˆ‘ä»¬è¿˜å¯ä»¥åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p><h4 id="6-1-æŒç»­ç²¾è¿›"><a href="#6-1-æŒç»­ç²¾è¿›" class="headerlink" title="6.1 æŒç»­ç²¾è¿›"></a>6.1 æŒç»­ç²¾è¿›</h4><p>è¿™ä¸ªé˜¶æ®µå…¶å®å°±æ˜¯ç¬¬5æ­¥çš„è¿›ä¸€æ­¥é€’è¿›ï¼Œç»§ç»­æ‹“å±•çŸ¥è¯†çš„æ·±åº¦å’Œå¹¿åº¦ï¼Œä¾‹å¦‚è¿›è¡Œæºç é˜…è¯»ï¼Œä¾‹å¦‚å­¦ä¸€äº›æœºå™¨å­¦ä¹ ã€å¤§æ•°æ®ç›¸å…³çš„çŸ¥è¯†ã€‚ä½†æœ‰æˆ‘ä»¬è¦è®°ä½æŠ€æœ¯æ°¸è¿œæ˜¯æœåŠ¡äºä¸šåŠ¡çš„ï¼Œæˆ‘ä»¬å°½é‡ä¸è¦è„±ç¦»ä¸šåŠ¡ç›²ç›®å»æ‹“å±•å¹¿åº¦ï¼Œè€Œæ˜¯æ³¨é‡åŸæœ‰ä¸šåŠ¡è¿›è¡Œæ·±åº¦çš„é’»ç ”ï¼Œç”šè‡³å¯ä»¥å°è¯•ä¾æ®äºæŠ€æœ¯ï¼Œåˆ›é€ å‡ºæ–°çš„äº§å“éœ€æ±‚ï¼Œæ¥è®©äº§å“å˜çš„æ›´å¥½ï¼Œæˆ–æ˜¯æå‡äº§ç ”æ•ˆç‡ç­‰ã€‚</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634912035666-89bb3a1a-f13d-4862-91bf-728abd5cdb90.png" class="lazyload"></p><h4 id="6-2-ç³»ç»Ÿè®¾è®¡"><a href="#6-2-ç³»ç»Ÿè®¾è®¡" class="headerlink" title="6.2 ç³»ç»Ÿè®¾è®¡"></a>6.2 ç³»ç»Ÿè®¾è®¡</h4><p>ä½œä¸ºæŠ€æœ¯äººï¼Œæˆ‘ä»¬ç»™è‡ªå·±å®šçš„èŒä¸šç›®æ ‡å¯èƒ½æ˜¯ä¸€ä¸ªæŠ€æœ¯ä¸“å®¶ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæ¶æ„å¸ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŠ€æœ¯å’Œç®¡ç†å…¼å…·çš„æŠ€æœ¯ç»ç†ã€‚ä½†æ˜¯æ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¸€å®šçš„ç³»ç»Ÿè®¾è®¡èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¼€å§‹ç§¯ç´¯è¡Œä¸šèƒŒæ™¯çŸ¥è¯†ï¼Œä¾‹å¦‚ï¼Œå¦‚æœè®¾è®¡ä¸€ä¸ªç”µå•†ç³»ç»Ÿï¼Œå¦‚ä½•è®¾è®¡ä¸€ä¸ªæœºå™¨å­¦ä¹ å¹³å°ï¼Œå¦‚ä½•è®¾è®¡ä¸€ä¸ªä¾›åº”é“¾ç³»ç»Ÿç­‰ç­‰ï¼Œå½“ç„¶è¦æ ¹æ®ä½ çš„å·¥ä½œèƒŒæ™¯è€Œå®šã€‚</p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1634912201169-513eb1a8-69cf-4f6b-b4fb-fa9797fa152e.png" class="lazyload"></p><h4 id="6-3-ç”±æœ¯åˆ°é“"><a href="#6-3-ç”±æœ¯åˆ°é“" class="headerlink" title="6.3 ç”±æœ¯åˆ°é“"></a>6.3 ç”±æœ¯åˆ°é“</h4><p>æˆ‘ä»¬éƒ¨é—¨åœ¨æ¯ä¸€è½®é¢è¯•æ±‚èŒè€…çš„æ—¶å€™ï¼Œé™¤äº†çœ‹æ±‚èŒè€…çš„æŠ€æœ¯èƒ½åŠ›å¦‚ä½•ï¼Œè¿˜ä¼šè§‚å¯Ÿä»–æ˜¯å¦åœ¨å·¥ä½œä¸­å‹¤äºæ€è€ƒã€å–„äºæ€»ç»“ï¼Œç”šè‡³èƒ½å¦æ²‰æ·€å‡ºæ–¹æ³•è®ºæ¥ï¼›æ˜¯å¦å…·æœ‰è‡ªå·±æ€ç»´ä½“ç³»ï¼Œæœ‰ç»“æ„åŒ–æ€ç»´èƒ½åŠ›ï¼›æ˜¯å¦å…·æœ‰è‰¯å¥½çš„æ²Ÿé€šåŠ›ã€å…±æƒ…åŠ›ã€è¡¨è¾¾åŠ›ç­‰ç­‰ã€‚å…¶å®ï¼Œè¿™äº›å¾€å¾€æ˜¯æˆ‘ä»¬å®¹æ˜“å¿½ç•¥çš„ã€‚å¦‚æœæˆ‘ä»¬æœªæ¥æƒ³èµ°çš„æ›´è¿œï¼Œè¿™äº›å¾€å¾€æ˜¯å¿…è¦çš„ï¼Œç”šè‡³æ˜¯é¦–è¦çš„ã€‚åé¢æˆ‘ä¹Ÿä¼šå†™ä¸€äº›ç›¸å…³çš„æ–‡ç« ï¼Œä¸å¤§å®¶å…±å‹‰ã€‚</p><h2 id="ä¸ƒã€å†™åœ¨æœ€å"><a href="#ä¸ƒã€å†™åœ¨æœ€å" class="headerlink" title="ä¸ƒã€å†™åœ¨æœ€å"></a>ä¸ƒã€å†™åœ¨æœ€å</h2><p>å†™äº†è¿™ä¹ˆå¤šç»ˆäºç®—æ˜¯å®Œç»“æ•£èŠ±äº†ï¼Œç¥å¤§å®¶æ—©æ—¥æ‰¾åˆ°è‡ªå·±å¿ƒä»ªçš„å·¥ä½œï¼Œæˆ‘ä»¬ä¸‹æœŸè§ï¼ŒPeaceğŸ˜˜</p><p>æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä¸ªåŠ±å¿—ç”¨æœ€ç®€å•çš„è¯­è¨€ï¼Œæè¿°æœ€å¤æ‚é—®é¢˜çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚<strong>æ±‚ç‚¹èµï¼Œæ±‚å…³æ³¨</strong>ï¼Œå¦‚æœä½ å¯¹æ­¤ç¯‡æ–‡ç« æœ‰ä»€ä¹ˆç–‘æƒ‘ï¼Œæ¬¢è¿åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ä¸­ç•™è¨€ï¼Œæˆ‘è¿˜å¯ä»¥ä¸ºä½ æä¾›ä»¥ä¸‹å¸®åŠ©ï¼š</p><blockquote><p>æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä¸ªåŠ±å¿—ç”¨æœ€ç®€å•çš„è¯­è¨€ï¼Œæè¿°æœ€å¤æ‚é—®é¢˜çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚<strong>æ±‚ç‚¹èµï¼Œæ±‚å…³æ³¨</strong>ï¼Œå¦‚æœä½ å¯¹æ­¤ç¯‡æ–‡ç« æœ‰ä»€ä¹ˆç–‘æƒ‘ï¼Œæ¬¢è¿åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ä¸­ç•™è¨€ï¼Œæˆ‘è¿˜å¯ä»¥ä¸ºä½ æä¾›ä»¥ä¸‹å¸®åŠ©ï¼š</p><ul><li>å¸®åŠ©å»ºç«‹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»</li><li>äº’è”ç½‘çœŸå®é«˜å¹¶å‘åœºæ™¯å®æˆ˜è®²è§£</li><li>ä¸å®šæœŸåˆ†äº«Golangã€Javaç›¸å…³ä¸šå†…çš„ç»å…¸åœºæ™¯å®è·µ</li></ul><p>æˆ‘çš„åšå®¢ï¼š<a href="https://besthpt.github.io/" target="_blank" rel="noopener">https://besthpt.github.io/</a><br>å¾®ä¿¡å…¬ä¼—å·ï¼š<br><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1633094381436-599e5e08-34bf-4d7a-88fb-e9a4b30ebea3.png" class="lazyload"></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯åˆ†äº«å¿ƒå¾— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯åˆ†äº«å¿ƒå¾— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šåç«¯ä»å…¥é—¨åˆ°ç†Ÿæ‚‰-åºè¨€ã€‹</title>
      <link href="/2021/10/11/9.%E5%90%8E%E7%AB%AF%E5%BF%83%E5%BE%97%E5%88%86%E4%BA%AB/%E3%80%8A%E5%90%8E%E7%AB%AF%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%86%9F%E6%82%89-%E5%BA%8F%E8%A8%80%E3%80%8B/"/>
      <url>/2021/10/11/9.%E5%90%8E%E7%AB%AF%E5%BF%83%E5%BE%97%E5%88%86%E4%BA%AB/%E3%80%8A%E5%90%8E%E7%AB%AF%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%86%9F%E6%82%89-%E5%BA%8F%E8%A8%80%E3%80%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€å†™åœ¨å‰é¢çš„è¯"><a href="#ä¸€ã€å†™åœ¨å‰é¢çš„è¯" class="headerlink" title="ä¸€ã€å†™åœ¨å‰é¢çš„è¯"></a>ä¸€ã€å†™åœ¨å‰é¢çš„è¯</h1><p>å—¨å–½ï¼Œå¤§å®¶å¥½å‘€ï¼æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä½æ¸¸èµ°äºå„äº’è”ç½‘å¤§å‚é—´çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚<br>è¿™æ˜¯æˆ‘åˆå†™åšå®¢çš„ç¬¬ä¸€ä¸ªç³»åˆ—ï¼Œåšä¸ºæ›¾ç»ç¼–ç¨‹å°ç™½æˆ‘ï¼Œä¹Ÿç»å†äº†é•¿æœŸçš„å›°æƒ‘è¿·æƒ˜ï¼Œæƒ³å­¦ç‚¹ä»€ä¹ˆåšç‚¹ä»€ä¹ˆï¼Œä½†åˆæ— ä»ä¸‹æ‰‹ğŸ˜‚ ã€‚æ‰€ä»¥æƒ³åœ¨æ­¤åˆ†äº«ä¸‹è¿™ä¸€è·¯èµ°æ¥çš„æˆé•¿ä¹‹è·¯ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°æ­£åœ¨è§‚çœ‹æ–‡ç« çš„ä½ ã€‚ä¸ºäº†è®©æˆé•¿å˜å¾—æ›´åŠ å¯ä»¥æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä¸æƒ³ç›´æ¥æ‰”ä¸€ç¯‡ä»€ä¹ˆåç«¯æˆç¥ä¹‹è·¯çš„è·¯çº¿å›¾xmindå‡ºæ¥ï¼Œè€Œæ˜¯é€šè¿‡æˆé•¿çš„ç¬¬ä¸€äººç§°è§†è§’å»ä¸€æ­¥æ­¥å®Œæˆè¿™ä¸ªç³»åˆ—ã€‚<br>é¦–å…ˆä»‹ç»å…ˆè¿™ä¸ªç³»åˆ—çš„æ ‡é¢˜ï¼Œåç«¯ä»å…¥é—¨åˆ°ç†Ÿæ‚‰ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ç†Ÿæ‚‰å‘¢ï¼Ÿå› ä¸ºç¨‹åºå‘˜è¦å­¦ä¼šçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä½è°ƒğŸ¶ ï¼Œä¼—æ‰€å‘¨çŸ¥è¦æ˜¯åœ¨ç®€å†é‡Œé¢å†™ä¸Šç²¾é€šæŸæŸï¼Œä½ ä¼šè¢«é¢è¯•å®˜é—®çš„ä½“æ— å®Œè‚¤ï¼Œå“ˆå“ˆã€‚é‚£åˆæ˜¯ä¸ºä»€ä¹ˆç”¨äº†åç«¯ï¼Œè€Œæ²¡æœ‰å†™å…·ä½“çš„è¯­è¨€å‘¢ï¼Ÿå› ä¸ºæˆ‘æ›¾ç»æ˜¯Javaerï¼Œç°åœ¨æ˜¯ä¸€ä¸ªGopherï¼Œæˆ‘æœŸå¾…ä»ä¸€ä¸ªæ›´é€šç”¨çš„è§†è§’æ¥çœ‹å¾…åç«¯å¼€å‘çš„çŸ¥è¯†ä½“ç³»ã€‚è¨€å½’æ­£ä¼ ï¼Œä¿—è¯è¯´ç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ï¼Œæ‰€ä»¥è¿™ç¯‡åºè¨€æˆ‘ä¸ä¼šè®²å…¥é—¨ç¬¬ä¸€æ­¥è¯¥æ€ä¹ˆåšï¼Œè€Œæ˜¯æ‰“ç®—ä»ä»¥ä¸‹ä¸‰æ–¹é¢æ¥è¿›è¡Œï¼Œå› ä¸ºæŒæ¡äº†è¿™äº›æ‰ä¼šè®©åé¢çš„è·¯èµ°çš„åšå®ã€ç¨³å›ºï¼Œè¿™ä¹Ÿæ˜¯ä½ æœªæ¥æˆé•¿ä¸ºæŠ€æœ¯å¤§ç‰›çš„çœŸæ­£æ ¸å¿ƒï¼š</p><ol><li>å…‹æœå­¦ä¹ è¿‡ç¨‹ä¸­çš„é•¿æœŸæ€§è¿·æƒ˜ï¼Œå’Œé—´æ­‡æ€§æ‡’æƒ°</li><li>å¼€å§‹å»ºç«‹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»</li><li>åˆç†åˆ©ç”¨è‡ªå·±çš„æ—¶é—´<h1 id="äºŒã€å¦‚ä½•æˆé•¿ä¸ºä¸€ä½æŠ€æœ¯å¤§ç‰›"><a href="#äºŒã€å¦‚ä½•æˆé•¿ä¸ºä¸€ä½æŠ€æœ¯å¤§ç‰›" class="headerlink" title="äºŒã€å¦‚ä½•æˆé•¿ä¸ºä¸€ä½æŠ€æœ¯å¤§ç‰›"></a>äºŒã€å¦‚ä½•æˆé•¿ä¸ºä¸€ä½æŠ€æœ¯å¤§ç‰›</h1><h2 id="2-1-å’¬å®šé’å±±ä¸æ”¾æ¾ï¼Œç«‹æ ¹åŸåœ¨ç ´å²©ä¸­"><a href="#2-1-å’¬å®šé’å±±ä¸æ”¾æ¾ï¼Œç«‹æ ¹åŸåœ¨ç ´å²©ä¸­" class="headerlink" title="2.1 å’¬å®šé’å±±ä¸æ”¾æ¾ï¼Œç«‹æ ¹åŸåœ¨ç ´å²©ä¸­"></a>2.1 å’¬å®šé’å±±ä¸æ”¾æ¾ï¼Œç«‹æ ¹åŸåœ¨ç ´å²©ä¸­</h2>é¦–å…ˆç¬¬ä¸€ç‚¹ï¼Œä½œä¸ºä¸€ä¸ªæŠ€æœ¯äººæˆ‘ä»¬å¯èƒ½ä¼šå¸¸å¸¸ä¼šå¤„äºä¸€ç§çŸ¥è¯†ç„¦è™‘çš„çŠ¶æ€ï¼Œæ¯”å¦‚ä½ æƒ³è¦å­¦ä¹ ï¼Œæƒ³è¦è¿›æ­¥ï¼Œä½†ä¸çŸ¥é“ä»Šå¤©è¯¥åšäº›ä»€ä¹ˆï¼Œæ˜å¤©è¦åšäº›ä»€ä¹ˆï¼Œè¿™ä¸ªæœˆè¦åšäº›ä»€ä¹ˆã€‚åˆæ¯”å¦‚ä½ æ˜æ˜ä¼¼ä¹å¾ˆæƒ³è¾¾æˆä¸€ä»¶äº‹ï¼Œä½†å¸¸å¸¸è¿˜æ²¡èµ·æ­¥å°±è¢«åˆ«çš„äº‹æƒ…å¸å¼•è¿‡å»äº†ï¼Œæ‰“äº†åŠå¤©æ¸¸æˆï¼Œåˆ·äº†åŠå¤©æŠ–éŸ³ï¼Œä¸€å¤©å°±è¿‡å»äº†ã€‚åˆ«æ‹…å¿ƒï¼Œé¦–å…ˆæœ‰æ‰€ç„¦è™‘è¿™æ˜¯ä»¶å¥½äº‹ï¼Œè¯æ˜äº†ä½ å¯¹æœªæ¥æœ‰æ‰€æœŸå¾…ï¼Œä½ æ‰€æ¬ ç¼ºçš„å°±æ˜¯ä¸€æ¡èƒ½é€šå‘ä½ æœªæ¥çš„åˆ‡å®å¯è¡Œçš„é“è·¯å’Œä¸€ç§åé¦ˆæ¿€åŠ±æœºåˆ¶ï¼Œä¿ƒä½¿ä½ ä¹æ­¤ä¸ç–²çš„å»è¾¾æˆä½ çš„æ„¿æœ›ã€‚é‚£æˆ‘ä»¬è¯¥å¦‚ä½•åšå‘¢ï¼Ÿè¿™é‡Œæˆ‘æƒ³æå››ä¸ªå…³é”®è¯ï¼šç›®æ ‡ã€è®¡åˆ’ã€æ‰§è¡ŒåŠ›ã€æ­£åé¦ˆã€‚<h3 id="2-1-1-ç›®æ ‡"><a href="#2-1-1-ç›®æ ‡" class="headerlink" title="2.1.1 ç›®æ ‡"></a>2.1.1 ç›®æ ‡</h3>é¦–å…ˆè¯´ç›®æ ‡ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä½ çš„ç›®æ ‡æ˜¯ï¼Œæˆ‘æƒ³å­¦ä¼šJavaï¼Œæˆ‘æƒ³å­¦ä¼šGolangã€‚å…¶å®è¿™ä¸ç®—æ˜¯ç›®æ ‡ï¼Œæˆ‘è®¤ä¸ºç›®æ ‡ä¸­å¿…é¡»è¦åŒ…å«ä¸€äº›å…³é”®è¦ç´ ï¼Œæ—¶é—´ã€åœ°ç‚¹ã€ç¨‹åº¦ã€‚<br>è¿˜æ˜¯å·²å­¦ä¹ Javaä¸ºä¾‹ï¼Œä½ å¯ä»¥ç»™è‡ªå·±è®¾ç½®ä¸€ä¸ªçŸ­æœŸç›®æ ‡ï¼Œæˆ‘æƒ³åœ¨å­¦æ ¡å›¾ä¹¦é¦†é‡Œ7å¤©å†…å­¦ä¹ å®ŒJavaåŸºç¡€ï¼Œæˆ‘æƒ³åœ¨1ä¸ªæœˆå†…å­¦ä¼šJavaWebåŸºç¡€ï¼Œå¹¶ä¸”èƒ½è·Ÿç€åšä¸€ä¸ªå°å‹é¡¹ç›®ï¼Œè¿™æ ·ä½ ä¼šç»™è‡ªå·±é”å®šä¸€ä¸ªåœºæ™¯ï¼Œä½ æ¯å¤©çå¼€çœ¼å°±çŸ¥é“äº†ï¼Œæˆ‘ä»Šå¤©è¦å»å›¾ä¹¦é¦†ï¼Œä¸ºäº†è¾¾æˆæˆ‘è¦åœ¨7å¤©å†…å­¦ä¹ å®ŒJavaè¯­è¨€åŸºç¡€çš„ç›®æ ‡ã€‚è¿™é‡Œè¿˜è¦æ³¨æ„çš„æ˜¯é•¿æœŸç›®æ ‡æ˜¯ç”±ä¸€ä¸ªä¸ªçŸ­æœŸç›®æ ‡æ„å»ºæˆçš„ï¼Œæˆ‘ä»¬å¦‚æœå®šçš„ç›®æ ‡å¤ªå¤§å°±å¾ˆéš¾è·Ÿè¸ªæ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¹ äº’è”ç½‘çš„ç®¡ç†ç†å¿µæ¥ç®¡ç†è‡ªå·±ï¼Œâ€å°æ­¥å¿«èµ°â€ï¼Œå°†ä¸€ä¸ªå¤§çš„ç›®æ ‡è¿›è¡Œé€çº§æ‹†è§£ï¼Œå˜ä¸ºçŸ­å‘¨æœŸçš„ç›®æ ‡ï¼Œä¸€èˆ¬ç›®æ ‡æ—¶é—´ä¸è¦è¶…è¿‡ä¸€ä¸ªæœˆã€‚æœ‰äººå¯èƒ½è§‰å¾—7å¤©å­¦ä¼šJavaåŸºç¡€æ˜¯ä¸æ˜¯æœ‰ç‚¹æ¿€è¿›å‘¢ï¼Ÿå…¶å®å¹¶ä¸æ˜¯ï¼Œæˆ‘ä»¬è¦ç›¸ä¿¡è‡ªå·±çš„æ½œåŠ›ï¼Œä¸€ä¸ªç¨é«˜ä¸€ç‚¹çš„ç›®æ ‡æ‰èƒ½æ¿€å‘æˆ‘ä»¬ä¸æ–­ä¸ºè¾¾æˆç›®æ ‡çš„æ„¿æœ›ï¼Œå¹¶ä¸”åœ¨ç›®æ ‡è¾¾æˆæ”¶è·æ›´å¼ºçƒˆçš„æ­£åé¦ˆã€‚ç„¶åæ¥è¯´ä»€ä¹ˆæ˜¯â€œç¨‹åº¦â€ï¼Œè¿™é‡Œè®²çš„å­¦ä¹ å®ŒJavaåŸºç¡€ï¼Œå­¦ä¹ å®ŒJavaWebï¼Œä¼šåšä¸€ä¸ªå°å‹Webé¡¹ç›®ï¼Œéƒ½ç®—æ˜¯ä¸€ç§ç¨‹åº¦ã€‚è¿™ç§ç¨‹åº¦ä¼šè®©æˆ‘ä»¬çš„ç›®æ ‡æ›´åŠ æ¸…æ™°ï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œæ—¶ä¼šçŸ¥é“ï¼Œå¦‚æœæˆ‘åšæŒå®Œæˆï¼Œå°±ä¼šæœ‰ä¸€ä¸ªæ€æ ·çš„æ”¶è·ï¼Œé‚£ä¹ˆåšèµ·æ¥ä¹Ÿèƒ½æ›´æœ‰åŠ¨åŠ›äº†ã€‚æ­¤å¤–ä¸€ä¸ªå¸¦æœ‰ç¨‹åº¦çš„æ¸…æ™°çš„ç›®æ ‡ï¼Œæ‰èƒ½ä¸ºæˆ‘ä»¬çš„ä¸‹ä¸€æ­¥â€œè®¡åˆ’â€ï¼Œåšä¸€ä¸ªå¾ˆå¥½çš„é“ºå«ã€‚<h3 id="2-1-2-è®¡åˆ’-amp-æ­£åé¦ˆ"><a href="#2-1-2-è®¡åˆ’-amp-æ­£åé¦ˆ" class="headerlink" title="2.1.2 è®¡åˆ’&amp;æ­£åé¦ˆ"></a>2.1.2 è®¡åˆ’&amp;æ­£åé¦ˆ</h3>ä¸ºäº†è¾¾æˆæˆ‘ä»¬çš„ç›®æ ‡ï¼Œæˆ‘ä»¬éœ€è¦è¯¦ç»†çš„åˆ—ä¸€ä»½è®¡åˆ’ï¼Œè¿™é‡Œæœ‰å‡ ç‚¹è¦æ³¨æ„ã€‚<br>ä¸€æ˜¯ï¼Œè®¡åˆ’ä¸€å®šè¦ç»†è‡´ï¼Œæ‹†åˆ†åˆ°åˆ‡å®å¯æ‰§è¡Œçš„æ“ä½œå•ä½ï¼Œæ¯ä¸ªæ“ä½œå•ä½æ‰§è¡Œæ—¶é—´ä¸è¦è¶…è¿‡3å¤©ï¼Œæ¯”å¦‚ä½ çš„è®¡åˆ’é¡¹æ˜¯å­¦ä¼šJavaåŸºç¡€ï¼Œè¿™ä¸ªæ˜¯ä¸å¯æ“ä½œçš„ï¼Œå› ä¸ºJavaåŸºç¡€è¿˜åŒ…å«å¾ˆå¤šï¼Œæœ€ç»ˆä½ çš„è¿™ä¸ªè®¡åˆ’é¡¹å°±ä¼šå˜å¾—ä¸å¯ç›‘æ§ã€‚è€Œä½ æŠŠè®¡åˆ’é¡¹åˆ—ä¸ºå­¦ä¹ Javaä¸­çš„å˜é‡å’Œè¿ç®—ç¬¦ï¼Œè¿™æ ·ä½ å°±å¯ä»¥æ¯å¤©å¯¹ä½ çš„è®¡åˆ’é¡¹è¿›è¡Œæ‰“å¡äº†ï¼Œä½ ä¹Ÿèƒ½ä¸æ–­çš„æ”¶è·åˆ°æ­£åé¦ˆï¼Œæ„Ÿè§‰å¾—åˆ°è‡ªå·±åœ¨ä¸æ–­æ‰“æ€ªå‡çº§ã€‚<br>äºŒæ˜¯ï¼Œè®¡åˆ’è¦æœ‰æ—¶é—´å’Œå®Œæˆåº¦çš„è¯´æ˜ï¼Œè¿™é‡Œæˆ‘ç»™å¤§å®¶æ¨èä¸€ä¸ªæœ€ç®€å•çš„ç®¡ç†å·¥å…·ï¼Œç”¨excelå†™ä¸€ä¸ªWBSï¼ˆæƒ³è¦è·å–wbsæ¨¡æ¿å¯ä»¥å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·â€œç®€å‡¡ä¸¶â€ï¼Œåå°å›å¤wbsï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸æ–­çš„è·Ÿè¸ªæˆ‘ä»¬çš„ç›®æ ‡è¾¾æˆç¨‹åº¦å•¦ã€‚</li></ol><p><img alt="image" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/image.png" class="lazyload"><br>ä¸‰æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä¸€æ®µæ—¶æœŸè¿˜æœ‰å…¶ä»–æƒ³è¦è¾¾æˆçš„ç›®æ ‡ï¼Œæ¯”å¦‚æƒ³å­¦ä¹ ç†è´¢ã€å­¦ä¹ ä¸€é¡¹ä¹å™¨ï¼Œè¿™é‡Œå»ºè®®ä¸»è¦ä¸å®œå¤ªå¤šï¼Œä¸ªäººå»ºè®®ä¸è¦è¶…è¿‡3ä¸ªã€‚å¦åˆ™å®¹æ˜“æŠŠè‡ªå·±çš„ç”Ÿæ´»æçš„æ··ä¹±ï¼Œæœ€ç»ˆå“ªä¸ªç›®æ ‡éƒ½æ²¡æœ‰è¾¾æˆã€‚æˆ‘ä»¬çŸ¥é“å¤šçº¿ç¨‹çš„ç¨‹åºï¼Œå¦‚æœCPUæ˜¯å•æ ¸çš„ï¼Œå¾€å¾€è¿˜ä¸å¦‚å•çº¿ç¨‹é¡ºåºå¤„ç†ï¼Œå› ä¸ºç¨‹åºä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ä¼šæ¶ˆè€—æ— è°“èµ„æºã€‚æˆ‘ä»¬è¦æŠ“ä½ä¸»è¦çŸ›ç›¾ï¼Œä¿æŒå¯¹ä¸»è¦ç›®æ ‡çš„ä¸“æ³¨åº¦ï¼Œæ‰èƒ½è®©æ—¶é—´æ›´åŠ é«˜æ•ˆã€‚</p><h3 id="2-1-3-æ‰§è¡ŒåŠ›"><a href="#2-1-3-æ‰§è¡ŒåŠ›" class="headerlink" title="2.1.3 æ‰§è¡ŒåŠ›"></a>2.1.3 æ‰§è¡ŒåŠ›</h3><p>æˆ‘å¾ˆå–œæ¬¢ä¸€å¥ç®€å•ä¸”å®ç”¨çš„è¯ï¼Œå¹²å°±å®Œäº†ã€‚å½“æˆ‘ä»¬é‡åˆ°å›°éš¾ï¼Œå»æŸ¥èµ„æ–™ï¼Œå»å’Œäººäº¤æµï¼Œæ€»ä¹‹å¹²å°±å®Œäº†ã€‚å½“æˆ‘é‡åˆ°æ‡ˆæ€ ï¼Œè¿˜åœ¨ç»™è‡ªå·±çš„å¯åŠ¨å­¦ä¹ ï¼Œåˆ›é€ ç†ç”±ï¼Œåˆ›é€ ç©ºé—´ï¼Œå¹²å°±å®Œäº†ã€‚åœ¨ç¨‹åºå‘˜è¿™ä¸ªè¡Œä¸šä»˜å‡ºå’Œæ”¶è·æˆæ­£æ¯”çš„ï¼Œæƒ³è¦é«˜è–ªï¼Œå¥½çš„å¾…é‡å°±è¦ä¸æ–­ä»˜å‡ºï¼Œä¿æŒå­¦ä¹ ã€‚å¦‚æœé€‰æ‹©èººå°¸ï¼Œå°±æ˜¯ä¼šåœ¨å¹´é¾„è¾ƒå¤§çš„æ—¶å€™ï¼Œé¢ä¸´æ·˜æ±°ã€‚åƒç®¡ç†ä¸€ä¸ªé¡¹ç›®ä¸€æ ·ï¼Œå¼€å§‹å¯¹è‡ªå·±çš„å­¦ä¹ ã€å·¥ä½œï¼Œä¹ƒè‡³äººç”Ÿè¿›è¡Œä¸€ä¸ªè§„åˆ’å’Œç®¡ç†å§ï¼Œä½ çš„äººç”Ÿä¸€å®šä¼šé€æ¸å˜çš„æ¸…æ™°ã€ç¿çƒ‚èµ·æ¥ã€‚</p><h3 id="2-1-4-æ€»ç»“"><a href="#2-1-4-æ€»ç»“" class="headerlink" title="2.1.4 æ€»ç»“"></a>2.1.4 æ€»ç»“</h3><p>è®²åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§ç›®æ ‡-&gt;è®¡åˆ’-&gt;æ‰§è¡Œ-&gt;æ­£åé¦ˆ-&gt;ä¸‹ä¸€é˜¶æ®µç›®æ ‡ï¼Œè¿™æ ·å¾ªç¯é€’è¿›çš„æ–¹å¼çœ‹åˆ°æˆ‘ä»¬æˆé•¿çš„è¿›åº¦æ¡åœ¨ç›´çº¿å‘å‰äº†ã€‚</p><h2 id="2-2-å­¦è€Œä¸æ€åˆ™ç½”ï¼Œæ€è€Œä¸å­¦åˆ™æ®†"><a href="#2-2-å­¦è€Œä¸æ€åˆ™ç½”ï¼Œæ€è€Œä¸å­¦åˆ™æ®†" class="headerlink" title="2.2 å­¦è€Œä¸æ€åˆ™ç½”ï¼Œæ€è€Œä¸å­¦åˆ™æ®†"></a>2.2 å­¦è€Œä¸æ€åˆ™ç½”ï¼Œæ€è€Œä¸å­¦åˆ™æ®†</h2><p>æˆ‘ä»¬åœ¨å­¦ä¹ çš„è¿‡ç¨‹å¸¸å¸¸ä¼šé‡åˆ°å­¦åˆ°åé¢ï¼Œå‰é¢çš„çŸ¥è¯†å°±å¿˜äº†ï¼Œç”šè‡³æƒ³æŸ¥ä¹Ÿæ— ä»æŸ¥èµ·ï¼Œåªèƒ½å†å­¦ä¸€éã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰è®°å½•ï¼ŒçŸ¥è¯†åœ¨è„‘å­é‡Œéƒ½æ˜¯ä¸€ä¸ªä¸ªç¢ç‰‡ï¼Œå½¼æ­¤ä¹‹é—´æ²¡å‘ç”Ÿä¸Šä¸‹æ–‡è”ç³»ã€‚é‚£æˆ‘ä»¬è¯¥å¦‚ä½•åšå‘¢ï¼Ÿ<br>ä¸€å¥è¯ï¼Œå¼€å§‹è®°ç¬”è®°ï¼Œå¹¶é€æ­¥å»ºç«‹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»ï¼Œç„¶åå¯¹è‡ªå·±çš„ä½“ç³»è¿›è¡Œå®Œå–„å’Œå®šæœŸé‡æ„ã€‚åœ¨ã€Šé‡‘å­—å¡”æ€ç»´ã€‹ä¸€ä¹¦ä¸­è¯´ï¼Œäººåœ¨ä¸€å°æ®µæ—¶é—´ï¼Œæœ€å¤šè®°ä½7ä»¶äº‹ï¼Œå†å¤šå‡ºæ¥å°±ä¼šå°†å‰é¢çš„æ·¡å¿˜ã€‚é‚£æˆ‘ä»¬è¯¥å¦‚ä½•è®©ç¹æ‚çš„çŸ¥è¯†åœ¨è„‘ä¸­è®°å¿†çš„æ›´åŠ ç‰¢å›ºå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¯¹çŸ¥è¯†è¿›è¡Œåˆ†å±‚ã€‚ä¾‹å¦‚ï¼Œä½ è¦å»èœå¸‚åœºä¹°èœï¼Œè¦ä¹°è‘¡è„ã€é»„ç“œã€è‹¹æœã€èŒ„å­ï¼Œå¦‚æœä½ åªé›¶æ•£çš„è®°ä½å‡ æ ·ç‰©å“ï¼Œåˆ°èœå¸‚åœºä½ å°±æœ‰å¯èƒ½å¿˜è®°äº†ä¸€ä¸¤æ ·ã€‚ä½†ä½ å¦‚æœå¯¹ä»–ä»¬è¿›è¡Œåˆ†ç±»ï¼Œåˆ†ä¸ºè”¬èœå’Œæ°´æœï¼Œè”¬èœæœ‰é»„ç“œå’ŒèŒ„å­ï¼Œæ°´æœæœ‰è‘¡è„å’Œè‹¹æœï¼Œè¿™æ ·çš„è¯ï¼Œä½ å°±å˜å¾—ä¸å®¹æ˜“å¿˜è®°ã€‚å†è¿›ä¸€æ­¥ï¼Œä½ å¦‚æœæœ‰æ„è¯†çŸ¥é“ä¸€å…±è¦ä¹°å››ä»¶ç‰©å“ï¼Œè”¬èœä¸¤ä»¶ï¼Œæ°´æœä¸¤ä»¶ï¼Œæœ€ç»ˆä¹°å®Œæ—¶ï¼Œè¿›è¡Œä¸€ä¸ªcheckï¼Œçœ‹çœ‹æ˜¯å¦ä¹°äº†å››ä»¶ç‰©å“ï¼Œè¿™æ ·ä½ æœ€ç»ˆå°±ä¸€å®šä¸ä¼šæ¼ä¹°äº†ã€‚è¿™å°±æ˜¯å…¸å‹çš„çš„ç»“æ„åŒ–æ€ç»´çš„å®é™…åº”ç”¨ã€‚å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬åŠ æ·±è®°å¿†ï¼Œå»ºç«‹çŸ¥è¯†ä¹‹é—´çš„è”ç³»ï¼Œç”šè‡³æ¿€å‘æˆ‘ä»¬çš„åˆ›é€ æ€§æ€ç»´ã€‚æ‰€ä»¥ç°åœ¨ä½ å·²ç»è®¤è¯†åˆ°å»ºç«‹çŸ¥è¯†ä½“ç³»çš„é‡è¦æ€§äº†å§ã€‚</p><h3 id="2-2-1-å¦‚ä½•å»ºç«‹çŸ¥è¯†ä½“ç³»"><a href="#2-2-1-å¦‚ä½•å»ºç«‹çŸ¥è¯†ä½“ç³»" class="headerlink" title="2.2.1 å¦‚ä½•å»ºç«‹çŸ¥è¯†ä½“ç³»"></a>2.2.1 å¦‚ä½•å»ºç«‹çŸ¥è¯†ä½“ç³»</h3><p>ä¸‹é¢æˆ‘ä»¬æ¥è¯´å¦‚ä½•å»å»ºç«‹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»ã€‚æˆ‘æ›¾ç»å­¦ä¹ å’Œå®é™…åº”ç”¨è¿‡å¤šé—¨å¼€å‘è¯­è¨€ï¼Œæ¯”å¦‚Javaå’ŒGolangï¼ŒPythonç­‰ï¼Œæˆ‘å‘ç°äº†åœ¨å„è¯­è¨€ä¹‹é—´ï¼Œå…¶å®æ˜¯æœ‰ç›¸åŒçš„å­¦ä¹ çš„é€»è¾‘é¡ºåºçš„ã€‚<br>æˆ‘ä»¬å­¦ä¹ ä¸€é—¨è¯­è¨€ï¼Œé¦–å…ˆè‚¯å®šè¦å­¦ä¹ è¯­è¨€åŸºç¡€ï¼ŒåŒ…å«åŸºç¡€è¯­æ³•å’Œè¯­è¨€ç‰¹æ€§ç­‰ã€‚ç„¶åå°±æ˜¯ä¸ºäº†å®ç°ä¸€ä¸ªåç«¯ä¸šåŠ¡éœ€æ±‚æˆ‘ä»¬è¦å­¦ä¹ Webæ¡†æ¶ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬æ–¹ä¾¿å¿«æ·çš„å’Œç½‘ç»œä¸æ•°æ®åº“æ‰“äº¤é“ï¼Œä»¥ä¾¿æˆ‘ä»¬å¿«é€Ÿå®ç°ä¸€ä¸ªå•ä½“é¡¹ç›®ã€‚ä¾‹å¦‚ï¼Œæ­¤æ—¶Javaä¸­è¦å¼€å§‹å­¦ä¹ Springã€SpringMVCï¼Œç„¶åå­¦ä¹ åœ¨SpringMVCåŸºç¡€ä¸Šè¿›ä¸€æ­¥å°è£…çš„SpringBootï¼Œå¯¹äºGolangæˆ‘ä»¬å¯èƒ½ä¼šå­¦ä¹ beegoã€å­¦ä¹ Ginã€‚å†æ¥ä¸‹æ¥å°±æ˜¯å¯¹äºä¸€äº›å¤æ‚çš„å¤§å‹ç³»ç»Ÿéœ€è¦ä¸ºäº†ä¸šåŠ¡çš„å¿«é€Ÿè¿­ä»£å’ŒåŸºç¡€å±‚çš„å¤ç”¨ï¼Œéœ€è¦æŠŠå•ä½“é¡¹ç›®æ‹†åˆ†ä¸ºå¾®æœåŠ¡ã€‚æ­¤æ—¶æˆ‘ä»¬è¦å¼€å§‹å­¦ä¹ å¾®æœåŠ¡æ¡†æ¶ï¼Œä¾‹å¦‚ï¼ŒJavaè¦å­¦Dubboã€å­¦SpringCloudï¼ŒGolangä¸­è¦å­¦ä¹ gRpcã€Microç­‰ã€‚å½“ç„¶æœ‰æ—¶æˆ‘ä»¬è¿˜éœ€è¦è§£å†³æŸç§ä¸šåŠ¡åœºæ™¯ï¼Œå°±éœ€è¦ä¸€äº›è¯­è¨€æ¡†æ¶æˆ–è€…ä¸­é—´ä»¶ï¼Œè¾…åŠ©æˆ‘ä»¬é«˜æ•ˆè§£å†³åº”ç”¨éœ€æ±‚ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦å­˜å‚¨é¡µé¢ä¸­çš„å›¾ç‰‡ï¼Œä¼šç”¨åˆ°å¯¹è±¡å­˜å‚¨OSSï¼›å†æ¯”å¦‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸­å¿ƒç¼“å­˜ï¼Œæ¥å‡è½»æ•°æ®åº“å‹åŠ›ï¼ŒåŠ é€Ÿæˆ‘ä»¬çš„æŸ¥è¯¢è¯·æ±‚ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°MemCacheã€Redisç­‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸šåŠ¡æµé‡è¿›è¡Œå¼‚æ­¥ã€æ¶ˆå³°æˆ‘ä»¬éœ€è¦ç”¨åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚è¿™äº›éœ€æ±‚åœºæ™¯æ¯ç§è¯­è¨€éƒ½ä¼šæœ‰ç›¸å…³çš„SDKæ¥ä¾›æˆ‘ä»¬æ“ä½œä½¿ç”¨è¿™äº›ä¸­é—´ä»¶æ¥è§£å†³é—®é¢˜ã€‚å½“ç„¶è¿™é‡Œåªæ˜¯åˆ—ä¸¾äº†åç«¯ä½“ç³»çš„ä¸€å°éƒ¨åˆ†ï¼Œåé¢å‡ æœŸæˆ‘ä¼šæŒ‰ç…§æŠ€æœ¯å±‚çº§çš„æ·±åº¦ä¸å¹¿åº¦é€æ­¥é€’è¿›ï¼Œé€æ­¥æ­å¼€åç«¯ä½“ç³»çš„ç¥ç§˜é¢çº±ï¼Œå¹¶ä¸ºå¤§å®¶æ•´ç†å‡ºé€‚åˆä¸åŒæˆé•¿é˜¶æ®µçš„å­¦ä¹ è·¯çº¿ã€‚<br>è¨€å½’æ­£ä¼ ï¼Œä½ ä¼šä»æˆ‘ä¸Šé¢çš„è¡¨è¿°ä¸­å‘ç°å»ºç«‹çŸ¥è¯†ä½“ç³»çš„ä¸¤ä¸ªè¦ç´ ï¼Œç¬¬ä¸€ï¼Œæ˜¯å¯¹çŸ¥è¯†è¿›è¡Œåˆ†å±‚ï¼Œåœ¨æ¯ä¸ªæˆé•¿é˜¶æ®µï¼Œæ ¹æ®è‡ªå·±çš„æƒ…å†µï¼Œå°†æ‰€å­¦çŸ¥è¯†æ·±å…¥åˆ°ä¸€å®šç¨‹åº¦ã€‚ä¾‹å¦‚ï¼Œä½ æ˜¯ä¸€ä¸ªåˆšå…¥é—¨çš„å°ç™½ï¼Œåœ¨ç¬¬ä¸€è½®å­¦ä¹ æ—¶ï¼Œå°±è¦å»æŒæ¡JVMè°ƒä¼˜ï¼ŒæŒæ¡å„ç§è®¾è®¡æ¨¡å¼ï¼Œè¿™æ˜¯ä¸å¿…è¦çš„ï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µä½ åº”è¯¥ç°å·²ç‹¬ç«‹å¼€å‘ä¸€ä¸ªé¡¹ç›®ä¸ºå‰æï¼Œå»è¿›è¡Œåˆçº§é˜¶æ®µçš„å­¦ä¹ ã€‚å½“ä½ å¯ä»¥è¾ƒä¸ºç†Ÿç»ƒçš„å†™å‡ºä¸€ä¸ªåº”ç”¨äº†ï¼Œå†å»å­¦ä¹ è®¾è®¡æ¨¡å¼ï¼Œé˜…è¯»å¼€æºä»£ç å­¦ä¹ äººå®¶çš„é¡¹ç›®æ„å»ºï¼Œæ‰æ˜¯æ­£ç¡®çš„è·¯çº¿ã€‚â€å°æ­¥å¿«èµ°â€ï¼Œå¯ä»¥å¸®åŠ©ä¸€ä¸ªä¼ä¸šæˆ–ä¸ªäººæ„å»ºä¸€æ¡å¿«é€Ÿæˆé•¿çš„é«˜é€Ÿè½¨é“ã€‚ç¬¬äºŒï¼Œæ˜¯ä¸æ–­æ‘„å–ä¼˜ç§€çš„å¼€æºæ–‡ç« æˆ–é¡¹ç›®ï¼Œæ¥å®Œå–„ä½ çŸ¥è¯†çš„ä½“ç³»ï¼Œå¹¶å®šæœŸå¯¹ä½ çš„çŸ¥è¯†ä½“ç³»reviewã€‚<br>æ­¤å¤–ï¼Œå·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå¥½çš„ç¬”è®°åº”ç”¨ååŠ©æˆ‘ä»¬æ„å»ºçŸ¥è¯†ä½“ç³»ã€‚è¿™é‡Œæ˜¯æˆ‘å½“æ—¶é€‰å–ç¬”è®°è½¯ä»¶çš„éœ€æ±‚(ä¼˜å…ˆçº§é€’å‡)ï¼š</p><ol><li>æ”¯æŒå…¨å±€å…³é”®è¯æœç´¢ï¼Œåªæœ‰è¿™æ ·ç¬”è®°æœ¬æ‰èƒ½æˆä¸ºæˆ‘ä»¬çš„ç¬¬äºŒä¸ªå¤§è„‘ï¼Œéšæ—¶å¯ä»¥è·å–æƒ³è¦çš„èµ„æº</li><li>é¡µé¢æ”¯æŒç›®å½•å¤§çº²ï¼Œå»ºç«‹ä¸€ç¯‡æ–‡ç« ä¸­çš„çŸ¥è¯†å±‚çº§</li><li>ç®€æ´ã€æ¸…æ™°ã€èµå¿ƒæ‚¦ç›®çš„ç¼–è¾‘é¡µé¢ï¼Œå¹¶ä¸”æ”¯æŒMarkdown</li><li>æ”¯æŒäº‘åŒæ­¥ï¼Œæ”¯æŒå¤šç«¯åŒæ­¥ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œè¿˜å¯ä»¥æ²¡äº‹æ—¶éšæ—¶æ‹¿æ¥å›é¡¾ä¸‹ä»¥å‰çš„çŸ¥è¯†</li><li>æœ‰å®¢æœï¼Œèƒ½è†å¬åˆ°ç”¨æˆ·æ„æ„¿ï¼Œå¹¶å¯¹äº§å“è¿›è¡Œæ›´æ–°ï¼ˆè¿™é‡Œåæ§½ä¸‹oneNote,æ„Ÿè§‰å¾®è½¯åšçš„äº§å“çœŸçš„ä¸å¤Ÿç”¨å¿ƒï¼‰</li><li>å¯ä»¥åšçŸ¥è¯†å…±äº«ï¼Œä½œä¸ºåšå®¢å¯¹å¤–è¾“å‡º</li></ol><p>ç»¼åˆä»¥ä¸Šå‡ ç‚¹ï¼Œæˆ‘åœ¨è¯¸å¤šç¬”è®°è½¯ä»¶ä¸­é€‰å‡ºäº†è¯­é›€ï¼Œæˆ–è€…ç›´æ¥ç”¨typoraå†™Markdownä¹Ÿæ˜¯ä¸é”™çš„ï¼Œä½†ç”±äºè‡ªå·±å†™çš„Markdownå›¾ç‰‡éœ€è¦æ‰¾å›¾åºŠä¿å­˜ï¼Œè¿˜å®¹æ˜“å¤±æ•ˆï¼Œæˆ‘ä¸ªäººæœ€ç»ˆé€‰æ‹©çš„è¯­é›€ã€‚è¿™é‡Œåªæƒ³è¯´è¯­é›€yydsã€‚è¿™é‡Œæœ‰ä¸ªå°æ’æ›²ï¼Œå½“æ—¶ç”±äºå…¬å¸ç½‘ç»œéš”ç¦»åŸå› è¯­é›€çªç„¶ä¸èƒ½ç”¨äº†ï¼Œè”ç³»äº†å®˜æ–¹åç«¯å°å“¥ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œå½“å¤©å°±å¸®åŠ©äº†æˆ‘è§£å†³äº†é—®é¢˜ï¼Œè¿™é‡Œç»™ä¸€ä¸ªèµğŸ‘ğŸ»</p><h2 id="2-3-å…‰æ™¯ä¸å¾…äººï¼Œé¡»åŸå‘æˆä¸"><a href="#2-3-å…‰æ™¯ä¸å¾…äººï¼Œé¡»åŸå‘æˆä¸" class="headerlink" title="2.3 å…‰æ™¯ä¸å¾…äººï¼Œé¡»åŸå‘æˆä¸"></a>2.3 å…‰æ™¯ä¸å¾…äººï¼Œé¡»åŸå‘æˆä¸</h2><p>ä¸Šé¢è¯´å®Œäº†æ–¹æ³•çš„é—®é¢˜ï¼Œä¸‹é¢å†è¯´ä¸‹å¿ƒæ€é—®é¢˜å§ï¼Œä¸å›å…±å‹‰ã€‚è¿™é‡Œç¬¬ä¸€ä¸ªè¦è¯´çš„å°±æ˜¯ç¨‹åºå‘˜çš„35å²é—®é¢˜ï¼Œå…¶å®æ˜¯å®é™…å­˜åœ¨çš„ï¼ŒåŸå› æˆ‘è§‰å¾—å¤§è‡´æ˜¯è¿™æ ·ï¼Œè¿™ä¸ªè¡Œä¸šç›®å‰æ¯”è¾ƒç«çƒ­ï¼Œç«äº‰æ¿€çƒˆï¼Œæ‰€ä»¥ä¼šæœ‰æºæºä¸æ–­çš„æ–°äººæ¶Œå…¥è¿›æ¥ï¼Œé‚£ä¼ä¸šæ–¹è‡ªç„¶æœ‰äº†æ›´å¤šçš„é€‰æ‹©ï¼Œæ‰€ä»¥è‡ªç„¶ä¼šè§‰å¾—åŒç­‰æ°´å¹³ä¸‹ï¼Œä¸€ä½å·¥ä½œå¹´é™è¾ƒçŸ­çš„äººæ¯”å¦å¤–ä¸€ä½æ›´åŠ æœ‰æ½œåŠ›ï¼Œæ›´åŠ çƒ­çˆ±å­¦ä¹ ã€‚æ‰€ä»¥ç”¨æ›´å°‘çš„é’±ï¼Œæ‹›è˜ä¸€ä½æŠ€æœ¯ä¼˜ç§€ï¼Œå¯å¡‘æ€§å¼ºï¼Œå­¦ä¹ èƒ½åŠ›å¼ºã€æ½œåŠ›æ·±çš„é’å¹´äººè‡ªç„¶æˆäº†è‡ªç„¶è€Œç„¶çš„äº‹æƒ…ã€‚<br>é‚£å¯¹äºå·²ç»è¿›å…¥è¿™ä¸ªè¡Œä¸šè¯¥å¦‚ä½•è‡ªå¤„å‘¢ï¼Ÿå…¶å®æ²¡åˆ«çš„åŠæ³•ï¼Œåªèƒ½è‡ªå·±å·è‡ªå·±äº†ğŸ˜­ï¼Œæˆ‘ä»¬è‡³å°‘è¦è®©è‡ªå·±çš„å·¥ä½œå¹´é™è‡³å°‘èƒ½åŒ¹é…ä¸ŠåŒç­‰æ°´å¹³çš„è¦æ±‚ï¼Œè€Œä¸”è¶Šæ—©è¾¾åˆ°ç›®æ ‡æ°´å¹³ï¼Œé‚£æˆ‘ä»¬æœªæ¥çš„æº¢ä»·ç©ºé—´å°±è¶Šå¤§ï¼Œå› ä¸ºè¿™ä½“ç°ç€ä½ æœªæ¥çš„æ½œåŠ›ï¼Œè¿™ä¹Ÿæ˜¯ä¼ä¸šé€‰æ‹©æŠ€æœ¯äººæ‰çš„ä¸€ä¸ªé‡è¦ç›®æ ‡ã€‚<br>æ‰€ä»¥å¿«é€Ÿæˆé•¿ï¼Œæˆä¸ºäº†ITäººçš„åˆšéœ€ï¼Œæ‰€ä»¥è¿˜åœ¨æ‡’æƒ°è¸Ÿè¹°ä¸å‰çš„ä½ ï¼Œåˆ«çŠ¹è±«äº†ï¼Œå°±æ˜¯å¹²ï¼<br>å¦å¤–ï¼Œè¿™é‡Œè¿˜æƒ³è¯´ä¸€ç‚¹ï¼Œå°±æ˜¯é¿å…å‡å¿™ï¼Œèšç„¦æˆé•¿ã€‚å¯¹äºå·²ç»æ­¥å…¥èŒåœºçš„åŒå­¦ç»å¸¸ä¼šè¢«ç¹æ‚çš„äº‹æƒ…æ‰€å¹²æ‰°ï¼Œä¼¼ä¹å¾ˆå¿™çš„æ ·å­ï¼Œä½†å½“ä½ æƒ³è¦è·³æ§½æ—¶å´å‘ç°è‡ªå·±å¥½åƒåˆä»€ä¹ˆéƒ½ä¸ä¼šäº†ï¼Œæ‰€ä»¥æ‹¼å‘½çš„åˆ·å…«è‚¡æ–‡ã€‚æ°å¥½æœ€è¿‘éƒ¨é—¨åœ¨æ‰©æ‹›ï¼Œæˆ‘ä¹Ÿé¢è¯•äº†å¾ˆå¤šç±»ä¼¼çš„äººï¼Œé¢è¯•è€…æ˜¯åˆ·çš„å…«è‚¡æ–‡ï¼Œè¿˜æ˜¯æœ‰çœŸæ­£çš„å®æˆ˜ç»éªŒä¸€æ·±é—®å°±çœ‹å‡ºæ¥äº†ã€‚å…¶å®å¯¹äºé¢è¯•å®˜æ¥è¯´åˆ·å…«è‚¡æ–‡å¹¶ä¸ä¼šå¼•èµ·å¤šå°‘åæ„Ÿï¼Œå®¹æ˜“è®©é¢è¯•å®˜å¼•èµ·åæ„Ÿçš„æ˜¯é¢è¯•è€…è¡¨ç°å‡ºçš„å¯¹äºå·¥ä½œå’Œå­¦ä¹ ç¼ºä¹æ€è€ƒçš„æ„è¯†ï¼Œæ­¤æ—¶å¾€å¾€ä¼šè¢«è¯„ä»·ä¸ºç¼ºå°‘æ½œåŠ›ã€‚â€œæ½œåŠ›â€è¿™ä¸ªè¯å¾ˆç¥å¥‡ï¼Œå°±è·Ÿç›¸äº²æ—¶å€™çš„â€œæ„Ÿè§‰â€ä¸€è¯ä¼¼çš„ï¼Œä¸€æ—¦è¢«è¯„ä»·ä¸ºæ²¡â€œæ½œåŠ›â€ï¼Œé‚£æ‹¿åˆ°offerçš„å¸Œæœ›ä¹Ÿå°±æ¸ºèŒ«äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨å·¥ä½œä¸­ä¸€å®šè¦å‹¤äºæ€è€ƒã€å–„äºæ€»ç»“ã€æŠŠä¸€äº›é€šç”¨çš„äº‹æƒ…å½¢æˆâ€œæ–¹æ³•è®ºâ€ï¼Œæ‰èƒ½æˆä¸ºé¢è¯•å®˜å’Œè€æ¿çœ¼é‡Œä¸€ä¸ªæœ‰â€œæ½œåŠ›â€çš„developerï¼Œæ‰èƒ½è®©è‡ªå·±åœ¨ç¹æ‚çš„å·¥ä½œä¸­æ”¶è·æˆé•¿ã€‚</p><h2 id="2-4-æ€»ç»“"><a href="#2-4-æ€»ç»“" class="headerlink" title="2.4 æ€»ç»“"></a>2.4 æ€»ç»“</h2><p>å•°å•°å—¦å—¦çš„è¯´äº†å¥½å¤šï¼Œå¸Œæœ›èƒ½ç»™æ¸´æœ›æˆé•¿çš„ä½ ä¸€äº›å¯è¿ªã€‚ä»ä¸‹ä¸€ç¯‡å¼€å§‹ï¼Œæˆ‘ä»¬å°†æ­£å¼è¿›å…¥ã€Šåç«¯ä»å…¥é—¨åˆ°ç†Ÿæ‚‰ä¹‹è·¯-å…¥é—¨ç¯‡ã€‹ï¼Œä¸€èµ·æ¢ç´¢å¦‚ä½•ä»ä¸€ä¸ªç¼–ç¨‹å°ç™½æˆé•¿ä¸ºä¸€ä¸ªåˆçº§å¼€å‘å·¥ç¨‹å¸ˆï¼Œæˆ‘ä»¬ä¸‹æœŸè§ï¼ŒPeaceğŸ˜˜</p><blockquote><p>æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä¸ªåŠ±å¿—ç”¨æœ€ç®€å•çš„è¯­è¨€ï¼Œæè¿°æœ€å¤æ‚é—®é¢˜çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚<strong>æ±‚ç‚¹èµï¼Œæ±‚å…³æ³¨</strong>ï¼Œå¦‚æœä½ å¯¹æ­¤ç¯‡æ–‡ç« æœ‰ä»€ä¹ˆç–‘æƒ‘ï¼Œæ¬¢è¿åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ä¸­ç•™è¨€ï¼Œæˆ‘è¿˜å¯ä»¥ä¸ºä½ æä¾›ä»¥ä¸‹å¸®åŠ©ï¼š</p><ul><li>å¸®åŠ©å»ºç«‹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»</li><li>äº’è”ç½‘çœŸå®é«˜å¹¶å‘åœºæ™¯å®æˆ˜è®²è§£</li><li>ä¸å®šæœŸåˆ†äº«Golangã€Javaç›¸å…³ä¸šå†…çš„ç»å…¸åœºæ™¯å®è·µ</li></ul></blockquote><p>æˆ‘çš„åšå®¢ï¼š<a href="https://besthpt.github.io/" target="_blank" rel="noopener">https://besthpt.github.io/</a></p><blockquote><p>å¾®ä¿¡å…¬ä¼—å·ï¼š<br><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1633094381436-599e5e08-34bf-4d7a-88fb-e9a4b30ebea3.png" class="lazyload"></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯åˆ†äº«å¿ƒå¾— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯åˆ†äº«å¿ƒå¾— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</title>
      <link href="/2021/10/01/3.%20redis/redis%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98/"/>
      <url>/2021/10/01/3.%20redis/redis%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå½“åˆ é™¤å®Œç¼“å­˜çš„æ—¶å€™ï¼Œè¿™æ—¶å»æ›´æ–°æ•°æ®åº“ï¼Œä½†è¿˜æ²¡æœ‰æ›´æ–°å®Œï¼Œå¦å¤–ä¸€ä¸ªè¯·æ±‚æ¥æŸ¥è¯¢æ•°æ®ï¼Œå‘ç°ç¼“å­˜é‡Œæ²¡æœ‰ï¼Œå°±å»æ•°æ®åº“é‡ŒæŸ¥ï¼Œä»¥å•†å“åº“å­˜ä¸ºä¾‹ï¼Œå¦‚æœæ•°æ®åº“ä¸­äº§å“çš„åº“å­˜æ˜¯100ï¼Œé‚£ä¹ˆæŸ¥è¯¢åˆ°çš„åº“å­˜æ˜¯100ï¼Œç„¶åæ’å…¥ç¼“å­˜ï¼Œæ’å…¥å®Œç¼“å­˜åï¼ŒåŸæ¥é‚£ä¸ªæ›´æ–°æ•°æ®åº“çš„çº¿ç¨‹æŠŠæ•°æ®åº“æ›´æ–°ä¸ºäº†99ï¼Œå¯¼è‡´æ•°æ®åº“ä¸ç¼“å­˜ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µå¦‚ä½•è§£å†³æ¯”è¾ƒå¥½å‘¢ï¼Ÿ     æœ¬æ–‡ä»ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†è¿›è¡Œæµ…è°ˆï¼Œ1ã€è®²è§£ç¼“å­˜æ›´æ–°ç­–ç•¥2ã€å¯¹æ¯ç§ç­–ç•¥è¿›è¡Œç¼ºç‚¹åˆ†æ3ã€é’ˆå¯¹ç¼ºç‚¹ç»™å‡ºæ”¹è¿›æ–¹æ¡ˆ     å¯¹äºç¼“å­˜å’Œæ•°æ®åº“çš„æ“ä½œï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ã€‚ </p><h1 id="å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“"><a href="#å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“" class="headerlink" title="å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“"></a>å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</h1><p>â€‹    å…ˆåˆ é™¤ç¼“å­˜ï¼Œæ•°æ®åº“è¿˜æ²¡æœ‰æ›´æ–°æˆåŠŸï¼Œæ­¤æ—¶å¦‚æœè¯»å–ç¼“å­˜ï¼Œç¼“å­˜ä¸å­˜åœ¨ï¼Œå»æ•°æ®åº“ä¸­è¯»å–åˆ°çš„æ˜¯æ—§å€¼ï¼Œç¼“å­˜ä¸ä¸€è‡´å‘ç”Ÿã€‚ </p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/333.png" class="lazyload"></p><p>â€‹    è¯¥æ–¹æ¡ˆçœ‹ä¼¼æ²¡æ¯›ç—…ã€‚ä½¿ç”¨å…ˆæ“ä½œç¼“å­˜ï¼ˆ<strong>delete</strong>ï¼‰ï¼Œå†æ“ä½œæ•°æ®åº“ã€‚å‡å¦‚åˆ é™¤ç¼“å­˜æˆåŠŸï¼Œæ›´æ–°æ•°æ®åº“å¤±è´¥äº†ã€‚ç¼“å­˜é‡Œæ²¡æœ‰æ•°æ®ï¼Œæ•°æ®åº“é‡Œæ˜¯ä¹‹å‰çš„æ•°æ®ï¼Œæ•°æ®æ²¡æœ‰ä¸ä¸€è‡´ï¼Œå¯¹ä¸šåŠ¡æ— å½±å“ã€‚åªæ˜¯ä¸‹ä¸€æ¬¡è¯»å–ï¼Œä¼šå¤šä¸€æ¬¡<strong>cache</strong> missã€‚     </p><p>ä½†æ˜¯å¦‚æœæ”¾åœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªå†™è¯·æ±‚è¿‡æ¥ï¼Œåˆ é™¤äº†ç¼“å­˜ï¼Œå‡†å¤‡æ›´æ–°æ•°æ®åº“ï¼ˆè¿˜æ²¡æ›´æ–°å®Œæˆï¼‰ã€‚ç„¶åä¸€ä¸ªè¯»è¯·æ±‚è¿‡æ¥ï¼Œç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“è¯»å–æ—§æ•°æ®ï¼Œå†æ¬¡æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œè¿™æ—¶å€™ï¼Œæ•°æ®åº“æ›´æ–°å®Œæˆäº†ã€‚æ­¤æ—¶çš„æƒ…å†µæ˜¯ï¼Œç¼“å­˜ä¸­æ˜¯æ—§æ•°æ®ï¼Œæ•°æ®åº“é‡Œé¢æ˜¯æ–°æ•°æ®ï¼Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ä¾¿ä¼šå‡¸æ˜¾å‡ºæ¥ã€‚ </p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1627453992836-84c10e1c-ee81-4d6f-a0ea-c6c2d403ef29.png" class="lazyload"></p><p>å¯¹äºè¯¥åœºæ™¯ä¸‹çš„é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥è¿›è¡Œè§£å†³ã€‚     </p><p>å»¶æ—¶åŒåˆ çš„æ–¹æ¡ˆçš„æ€è·¯æ˜¯ï¼Œä¸ºäº†é¿å…æ›´æ–°æ•°æ®åº“çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä»ç¼“å­˜ä¸­è¯»å–ä¸åˆ°æ•°æ®ï¼Œå°±åœ¨æ›´æ–°å®Œæ•°æ®åº“ä¹‹åï¼Œå†<strong>sleep</strong>ä¸€æ®µæ—¶é—´ï¼Œç„¶åå†æ¬¡åˆ é™¤ç¼“å­˜ã€‚<strong>sleep</strong>çš„æ—¶é—´è¦å¯¹ä¸šåŠ¡è¯»å†™ç¼“å­˜çš„æ—¶é—´åšå‡ºè¯„ä¼°ï¼Œ<strong>sleep</strong>æ—¶é—´å¤§äºè¯»å†™ç¼“å­˜çš„æ—¶é—´å³å¯ã€‚     </p><p>æµç¨‹å¦‚ä¸‹ï¼š     </p><p>çº¿ç¨‹1åˆ é™¤ç¼“å­˜ï¼Œç„¶åå»æ›´æ–°æ•°æ®åº“     </p><p>çº¿ç¨‹2æ¥è¯»ç¼“å­˜ï¼Œå‘ç°ç¼“å­˜å·²ç»è¢«åˆ é™¤ï¼Œæ‰€ä»¥ç›´æ¥ä»æ•°æ®åº“ä¸­è¯»å–ï¼Œè¿™æ—¶å€™ç”±äºçº¿ç¨‹1è¿˜æ²¡æœ‰æ›´æ–°å®Œæˆï¼Œæ‰€ä»¥è¯»åˆ°çš„æ˜¯æ—§å€¼ï¼Œç„¶åæŠŠæ—§å€¼å†™å…¥ç¼“å­˜     </p><p>çº¿ç¨‹1ï¼Œæ ¹æ®ä¼°ç®—çš„æ—¶é—´ï¼Œ<strong>sleep</strong>ï¼Œç”±äº<strong>sleep</strong>çš„æ—¶é—´å¤§äºçº¿ç¨‹2è¯»æ•°æ®+å†™ç¼“å­˜çš„æ—¶é—´ï¼Œæ‰€ä»¥ç¼“å­˜è¢«å†æ¬¡åˆ é™¤     </p><p>å¦‚æœè¿˜æœ‰å…¶ä»–çº¿ç¨‹æ¥è¯»å–ç¼“å­˜çš„è¯ï¼Œå°±ä¼šå†æ¬¡ä»æ•°æ®åº“ä¸­è¯»å–åˆ°æœ€æ–°å€¼ã€‚ </p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1627453993480-59f1ec90-2031-4be0-b6e0-eb2a02ac2cdc.png" class="lazyload"></p><h1 id="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜"><a href="#å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜" class="headerlink" title="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜"></a>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</h1><p>æ—¢ç„¶ä¸Šè¿°å…ˆåˆ ç¼“å­˜ä¸è¡Œï¼Œé‚£å¦‚æœåè¿‡æ¥æ“ä½œï¼Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜å‘¢ï¼Ÿ</p><p>è¿™ä¸ªå°±æ›´æ˜æ˜¾çš„é—®é¢˜äº†ï¼Œæ›´æ–°æ•°æ®åº“æˆåŠŸï¼Œå¦‚æœåˆ é™¤ç¼“å­˜å¤±è´¥æˆ–è€…è¿˜æ²¡æœ‰æ¥å¾—åŠåˆ é™¤ï¼Œé‚£ä¹ˆï¼Œå…¶ä»–çº¿ç¨‹ä»ç¼“å­˜ä¸­è¯»å–åˆ°çš„å°±æ˜¯æ—§å€¼ï¼Œè¿˜æ˜¯ä¼šå‘ç”Ÿä¸ä¸€è‡´ã€‚ </p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1627453992612-d70f275f-a1c0-4adc-9563-ab5908b46da6.png" class="lazyload"></p><p>â€‹    é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ     </p><p>åŸºäº<strong>binlog</strong>æ—¥å¿—å’Œæ¶ˆæ¯é˜Ÿåˆ—ï¼š     </p><ol><li><p>åº”ç”¨ç›´æ¥å†™æ•°æ®åˆ°æ•°æ®åº“ä¸­ã€‚     </p></li><li><p>æ•°æ®åº“æ›´æ–°<strong>binlog</strong>æ—¥å¿—ã€‚    </p></li><li><p>åˆ©ç”¨<strong>Canal</strong>ä¸­é—´ä»¶è¯»å–<strong>binlog</strong>æ—¥å¿—ã€‚     </p></li><li><p>Canalå€ŸåŠ©äºé™æµç»„ä»¶æŒ‰é¢‘ç‡å°†æ•°æ®å‘åˆ°<strong>MQ</strong>ä¸­ã€‚     </p></li><li><p>åº”ç”¨ç›‘æ§<strong>MQ</strong>é€šé“ï¼Œå°†<strong>MQ</strong>çš„æ•°æ®æ›´æ–°åˆ°<strong>Redis</strong>ç¼“å­˜ä¸­ã€‚     </p></li></ol><p>å¯ä»¥çœ‹åˆ°è¿™ç§æ–¹æ¡ˆå¯¹å¼€å‘æ¥è¯´æ¯”è¾ƒè½»é‡ï¼Œä¸ç”¨å¤ªå…³å¿ƒç¼“å­˜å±‚é¢ï¼Œè€Œä¸”è¿™ä¸ªæ–¹æ¡ˆè™½ç„¶æ¯”è¾ƒé‡ï¼Œä½†æ˜¯å´å®¹æ˜“å½¢æˆç»Ÿä¸€çš„è§£å†³æ–¹æ¡ˆã€‚ </p><p><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1627453993383-37b6a854-6cad-4933-9ed5-7bc7c23528f1.png" class="lazyload"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>â€‹    é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ˜ç¡®ä¸€ç‚¹ï¼Œç¼“å­˜ä¸æ˜¯æ›´æ–°ï¼Œè€Œåº”è¯¥æ˜¯åˆ é™¤ã€‚     </p><p>â€‹    åˆ é™¤ç¼“å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼š     </p><ul><li><p>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å»¶è¿ŸåŒåˆ ã€‚     </p></li><li><p>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€‚è§£å†³æ–¹æ¡ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—æˆ–è€…å…¶ä»–binlogåŒæ­¥ï¼Œå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¼šå¸¦æ¥æ›´å¤šçš„é—®é¢˜ï¼Œå¹¶ä¸æ¨èç›´æ¥ä½¿ç”¨ã€‚     </p><p>ä¸ºä»€ä¹ˆæ˜¯åˆ é™¤è€Œä¸æ˜¯æ›´æ–°å‘¢ï¼Ÿ     </p></li></ul><p>â€‹    æˆ‘ä»¬ä»¥å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜æ¥ä¸¾ä¾‹ã€‚     </p><p>â€‹    å¦‚æœæ˜¯æ›´æ–°çš„è¯ï¼Œé‚£å°±æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ã€‚    </p><p>â€‹    ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæ•°æ®åº“1å°æ—¶å†…æ›´æ–°äº†1000æ¬¡ï¼Œé‚£ä¹ˆç¼“å­˜ä¹Ÿè¦æ›´æ–°1000æ¬¡ï¼Œä½†æ˜¯è¿™ä¸ªç¼“å­˜å¯èƒ½åœ¨1å°æ—¶å†…åªè¢«è¯»å–äº†1æ¬¡ï¼Œé‚£ä¹ˆè¿™1000æ¬¡çš„æ›´æ–°æœ‰å¿…è¦å—ï¼Ÿ     </p><p>åè¿‡æ¥ï¼Œå¦‚æœæ˜¯åˆ é™¤çš„è¯ï¼Œå°±ç®—æ•°æ®åº“æ›´æ–°äº†1000æ¬¡ï¼Œé‚£ä¹ˆä¹Ÿåªæ˜¯åšäº†1æ¬¡ç¼“å­˜åˆ é™¤ï¼Œåªæœ‰å½“ç¼“å­˜çœŸæ­£è¢«è¯»å–çš„æ—¶å€™æ‰å»æ•°æ®åº“åŠ è½½ã€‚     </p><p>â€‹    é’ˆå¯¹ç¼“å­˜ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜çš„åœºæ™¯ï¼Œé‚£ä¹ˆåªé€šè¿‡è®¾ç½®è¶…æ—¶æ—¶é—´å°±å¯ä»¥äº†ã€‚å…¶å®ï¼Œå¦‚æœä¸æ˜¯å¾ˆé«˜çš„å¹¶å‘ï¼Œæ— è®ºä½ é€‰æ‹©å…ˆåˆ ç¼“å­˜è¿˜æ˜¯ååˆ ç¼“å­˜çš„æ–¹å¼ï¼Œéƒ½å‡ ä¹å¾ˆå°‘èƒ½äº§ç”Ÿè¿™ç§é—®é¢˜ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘ä¸‹ï¼Œä½ åº”è¯¥çŸ¥é“æ€ä¹ˆè§£å†³é—®é¢˜ã€‚     </p><p>â€‹    æœ€åï¼Œä¸ªäººè®¤ä¸ºå“ˆï¼Œæ²¡æœ‰åå…¨åç¾çš„è§£å†³æ–¹æ¡ˆï¼Œæ€»æ˜¯éœ€è¦ç‰ºç‰²ä¸€ç‚¹ä¸œè¥¿æ»´ã€‚</p><blockquote><p>æˆ‘æ˜¯ç®€å‡¡ï¼Œä¸€ä¸ªåŠ±å¿—ç”¨æœ€ç®€å•çš„è¯­è¨€ï¼Œæè¿°æœ€å¤æ‚é—®é¢˜çš„æ–°æ—¶ä»£å†œæ°‘å·¥ã€‚<strong>æ±‚ç‚¹èµï¼Œæ±‚å…³æ³¨</strong>ï¼Œæˆ‘ä¼šä¸ºä½ æä¾›ä»¥ä¸‹å¸®åŠ©ï¼š</p><ul><li>å¸®åŠ©ä½ å»ºç«‹è‡ªå·±çš„åç«¯çŸ¥è¯†ä½“ç³»</li><li>äº’è”ç½‘çœŸå®é«˜å¹¶å‘åœºæ™¯å®æˆ˜è®²è§£</li><li>ä¸å®šæœŸåˆ†äº«Golangã€Javaç›¸å…³ä¸šå†…çš„ç»å…¸åœºæ™¯å®è·µ</li></ul><p>æˆ‘çš„åšå®¢ï¼š<a href="https://besthpt.github.io/" target="_blank" rel="noopener">https://besthpt.github.io/</a><br>å¾®ä¿¡å…¬ä¼—å·ï¼š<br><img alt="img" data-src="https://codebear-images.oss-cn-beijing.aliyuncs.com/1633094381436-599e5e08-34bf-4d7a-88fb-e9a4b30ebea3.png" class="lazyload"></p></blockquote><script src="https://readmore.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>    const btw = new BTWPlugin();    btw.init({        id: 'post-content',        blogId: '24566-1633176031733-929',        name: 'ç®€å‡¡ä¸¶',        qrcode: 'https://codebear-images.oss-cn-beijing.aliyuncs.com/getqrcode.jpeg',        keyword: '666',    });</script>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é«˜å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿ä¸ŠæœåŠ¡çš„FGCé—®é¢˜æ’æŸ¥</title>
      <link href="/2020/07/15/6.%20JVM/FGC%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"/>
      <url>/2020/07/15/6.%20JVM/FGC%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<h2 id><a href="#" class="headerlink" title></a></h2><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å°†ä»¥ä¸€ä¸ªFGCé¢‘ç¹çš„çº¿ä¸Šæ¡ˆä¾‹ä½œä¸ºå¼•å­ï¼Œè¯¦ç»†ä»‹ç»ä¸‹GCçš„æ’æŸ¥è¿‡ç¨‹ï¼Œå¦å¤–ä¼šç»“åˆGCçš„è¿è¡ŒåŸç†ç»™å‡ºä¸€ä»½å®è·µæŒ‡å—ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚å†…å®¹åˆ†æˆä»¥ä¸‹3ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>ä»ä¸€æ¬¡FGCé¢‘ç¹çš„çº¿ä¸Šæ¡ˆä¾‹è¯´èµ·</li><li>GCçš„è¿è¡ŒåŸç†ä»‹ç»</li><li>æ’æŸ¥FGCé—®é¢˜çš„å®è·µæŒ‡å—</li></ul><h2 id="ä»ä¸€æ¬¡FGCé¢‘ç¹çš„çº¿ä¸Šæ¡ˆä¾‹è¯´èµ·"><a href="#ä»ä¸€æ¬¡FGCé¢‘ç¹çš„çº¿ä¸Šæ¡ˆä¾‹è¯´èµ·" class="headerlink" title="ä»ä¸€æ¬¡FGCé¢‘ç¹çš„çº¿ä¸Šæ¡ˆä¾‹è¯´èµ·"></a>ä»ä¸€æ¬¡FGCé¢‘ç¹çš„çº¿ä¸Šæ¡ˆä¾‹è¯´èµ·</h2><p>å»å¹´10æœˆä»½ï¼Œæˆ‘ä»¬çš„å¹¿å‘Šå¬å›ç³»ç»Ÿåœ¨ç¨‹åºä¸Šçº¿åæ”¶åˆ°äº†FGCé¢‘ç¹çš„ç³»ç»Ÿå‘Šè­¦ï¼Œé€šè¿‡ä¸‹é¢çš„ç›‘æ§å›¾å¯ä»¥çœ‹åˆ°ï¼šå¹³å‡æ¯35åˆ†é’Ÿå°±è¿›è¡Œäº†ä¸€æ¬¡FGCã€‚è€Œç¨‹åºä¸Šçº¿å‰ï¼Œæˆ‘ä»¬çš„FGCé¢‘æ¬¡å¤§æ¦‚æ˜¯2å¤©ä¸€æ¬¡ã€‚ä¸‹é¢ï¼Œè¯¦ç»†ä»‹ç»ä¸‹è¯¥é—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹ã€‚</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/AaabKZjib2kbo3d18WZsey7GqTSBxR7OfI15BdBhQPy2Q7Zd0k1S5drjWQFk59fte4mMyRXaHOIPnOZwYyfb8cQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h3 id="æ£€æŸ¥JVMé…ç½®"><a href="#æ£€æŸ¥JVMé…ç½®" class="headerlink" title="æ£€æŸ¥JVMé…ç½®"></a>æ£€æŸ¥JVMé…ç½®</h3><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹JVMçš„å¯åŠ¨å‚æ•°ï¼š</p><p>ps aux | grep â€œapplicationName=adsearchâ€</p><blockquote><p>-Xms4g -Xmx4g -Xmn2g -Xss1024K </p><p>-XX:ParallelGCThreads=5 </p><p>-XX:+UseConcMarkSweepGC </p><p>-XX:+UseParNewGC </p><p>-XX:+UseCMSCompactAtFullCollection </p><p>-XX:CMSInitiatingOccupancyFraction=80</p></blockquote><p>å¯ä»¥çœ‹åˆ°å †å†…å­˜ä¸º4Gï¼Œæ–°ç”Ÿä»£ä¸º2Gï¼Œè€å¹´ä»£ä¹Ÿä¸º2Gï¼Œæ–°ç”Ÿä»£é‡‡ç”¨ParNewæ”¶é›†å™¨ï¼Œè€å¹´ä»£é‡‡ç”¨å¹¶å‘æ ‡è®°æ¸…é™¤çš„CMSæ”¶é›†å™¨ï¼Œå½“è€å¹´ä»£çš„å†…å­˜å ç”¨ç‡è¾¾åˆ°80%æ—¶ä¼šè¿›è¡ŒFGCã€‚</p><p>è¿›ä¸€æ­¥é€šè¿‡ jmap -heap 7276 | head -n20 å¯ä»¥å¾—çŸ¥æ–°ç”Ÿä»£çš„EdenåŒºä¸º1.6Gï¼ŒS0å’ŒS1åŒºå‡ä¸º0.2Gã€‚</p><h3 id="è§‚å¯Ÿè€å¹´ä»£çš„å†…å­˜å˜åŒ–"><a href="#è§‚å¯Ÿè€å¹´ä»£çš„å†…å­˜å˜åŒ–" class="headerlink" title="è§‚å¯Ÿè€å¹´ä»£çš„å†…å­˜å˜åŒ–"></a>è§‚å¯Ÿè€å¹´ä»£çš„å†…å­˜å˜åŒ–</h3><p>é€šè¿‡è§‚å¯Ÿè€å¹´ä»£çš„ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°ï¼šæ¯æ¬¡FGCåï¼Œå†…å­˜éƒ½èƒ½å›åˆ°500Må·¦å³ï¼Œå› æ­¤æˆ‘ä»¬æ’é™¤äº†å†…å­˜æ³„æ¼çš„æƒ…å†µã€‚</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><h3 id="é€šè¿‡jmapå‘½ä»¤æŸ¥çœ‹å †å†…å­˜ä¸­çš„å¯¹è±¡"><a href="#é€šè¿‡jmapå‘½ä»¤æŸ¥çœ‹å †å†…å­˜ä¸­çš„å¯¹è±¡" class="headerlink" title="é€šè¿‡jmapå‘½ä»¤æŸ¥çœ‹å †å†…å­˜ä¸­çš„å¯¹è±¡"></a>é€šè¿‡jmapå‘½ä»¤æŸ¥çœ‹å †å†…å­˜ä¸­çš„å¯¹è±¡</h3><p>é€šè¿‡å‘½ä»¤ jmap -histo 7276 | head -n20</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>ä¸Šå›¾ä¸­ï¼ŒæŒ‰ç…§å¯¹è±¡æ‰€å å†…å­˜å¤§å°æ’åºï¼Œæ˜¾ç¤ºäº†å­˜æ´»å¯¹è±¡çš„å®ä¾‹æ•°ã€æ‰€å å†…å­˜ã€ç±»åã€‚å¯ä»¥çœ‹åˆ°æ’åç¬¬ä¸€çš„æ˜¯ï¼šint[]ï¼Œè€Œä¸”æ‰€å å†…å­˜å¤§å°è¿œè¿œè¶…è¿‡å…¶ä»–å­˜æ´»å¯¹è±¡ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å°†æ€€ç–‘ç›®æ ‡é”å®šåœ¨äº† int[] .</p><h3 id="è¿›ä¸€æ­¥dumpå †å†…å­˜æ–‡ä»¶è¿›è¡Œåˆ†æ"><a href="#è¿›ä¸€æ­¥dumpå †å†…å­˜æ–‡ä»¶è¿›è¡Œåˆ†æ" class="headerlink" title="è¿›ä¸€æ­¥dumpå †å†…å­˜æ–‡ä»¶è¿›è¡Œåˆ†æ"></a>è¿›ä¸€æ­¥dumpå †å†…å­˜æ–‡ä»¶è¿›è¡Œåˆ†æ</h3><p>é”å®š int[] åï¼Œæˆ‘ä»¬æ‰“ç®—dumpå †å†…å­˜æ–‡ä»¶ï¼Œé€šè¿‡å¯è§†åŒ–å·¥å…·è¿›ä¸€æ­¥è·Ÿè¸ªå¯¹è±¡çš„æ¥æºã€‚è€ƒè™‘å †è½¬å‚¨è¿‡ç¨‹ä¸­ä¼šæš‚åœç¨‹åºï¼Œå› æ­¤æˆ‘ä»¬å…ˆä»æœåŠ¡ç®¡ç†å¹³å°æ‘˜æ‰äº†æ­¤èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡ä»¥ä¸‹å‘½ä»¤dumpå †å†…å­˜ï¼š</p><p>jmap -dump:format=b,file=heap 7276</p><p>é€šè¿‡JVisualVMå·¥å…·å¯¼å…¥dumpå‡ºæ¥çš„å †å†…å­˜æ–‡ä»¶ï¼ŒåŒæ ·å¯ä»¥çœ‹åˆ°å„ä¸ªå¯¹è±¡æ‰€å ç©ºé—´ï¼Œå…¶ä¸­int[]å åˆ°äº†50%ä»¥ä¸Šçš„å†…å­˜ï¼Œè¿›ä¸€æ­¥å¾€ä¸‹ä¾¿å¯ä»¥æ‰¾åˆ° int[] æ‰€å±çš„ä¸šåŠ¡å¯¹è±¡ï¼Œå‘ç°å®ƒæ¥è‡ªäºæ¶æ„å›¢é˜Ÿæä¾›çš„codisåŸºç¡€ç»„ä»¶ã€‚</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><h3 id="é€šè¿‡ä»£ç åˆ†æå¯ç–‘å¯¹è±¡"><a href="#é€šè¿‡ä»£ç åˆ†æå¯ç–‘å¯¹è±¡" class="headerlink" title="é€šè¿‡ä»£ç åˆ†æå¯ç–‘å¯¹è±¡"></a>é€šè¿‡ä»£ç åˆ†æå¯ç–‘å¯¹è±¡</h3><p>é€šè¿‡ä»£ç åˆ†æï¼ŒcodisåŸºç¡€ç»„ä»¶æ¯åˆ†é’Ÿä¼šç”Ÿæˆçº¦40Må¤§å°çš„intæ•°ç»„ï¼Œç”¨äºç»Ÿè®¡TP99 å’Œ TP90ï¼Œæ•°ç»„çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€åˆ†é’Ÿã€‚è€Œæ ¹æ®ç¬¬2æ­¥è§‚å¯Ÿè€å¹´ä»£çš„å†…å­˜å˜åŒ–æ—¶ï¼Œå‘ç°è€å¹´ä»£çš„å†…å­˜åŸºæœ¬ä¸Šä¹Ÿæ˜¯æ¯åˆ†é’Ÿå¢åŠ 40å¤šMï¼Œå› æ­¤æ¨æ–­ï¼šè¿™40Mçš„intæ•°ç»„åº”è¯¥æ˜¯ä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ã€‚</p><p>æˆ‘ä»¬è¿›ä¸€æ­¥æŸ¥çœ‹äº†YGCçš„é¢‘æ¬¡ç›‘æ§ï¼Œé€šè¿‡ä¸‹å›¾å¯ä»¥çœ‹åˆ°å¤§æ¦‚1åˆ†é’Ÿæœ‰8æ¬¡å·¦å³çš„YGCï¼Œè¿™æ ·åŸºæœ¬éªŒè¯äº†æˆ‘ä»¬çš„æ¨æ–­ï¼šå› ä¸ºCMSæ”¶é›†å™¨é»˜è®¤çš„åˆ†ä»£å¹´é¾„æ˜¯6æ¬¡ï¼Œå³YGC 6æ¬¡åè¿˜å­˜æ´»çš„å¯¹è±¡å°±ä¼šæ™‹å‡åˆ°è€å¹´ä»£ï¼Œè€Œcodisç»„ä»¶ä¸­çš„å¤§æ•°ç»„ç”Ÿå‘½å‘¨æœŸæ˜¯1åˆ†é’Ÿï¼Œåˆšå¥½æ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>è‡³æ­¤ï¼Œæ•´ä¸ªæ’æŸ¥è¿‡ç¨‹åŸºæœ¬ç»“æŸäº†ï¼Œé‚£ä¸ºä»€ä¹ˆç¨‹åºä¸Šçº¿å‰æ²¡å‡ºç°æ­¤é—®é¢˜å‘¢ï¼Ÿé€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼šç¨‹åºä¸Šçº¿å‰YGCçš„é¢‘æ¬¡åœ¨5æ¬¡å·¦å³ï¼Œæ­¤æ¬¡ä¸Šçº¿åYGCé¢‘æ¬¡å˜æˆäº†8æ¬¡å·¦å³ï¼Œä»è€Œå¼•å‘äº†æ­¤é—®é¢˜ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ä¸ºäº†å¿«é€Ÿè§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬å°†CMSæ”¶é›†å™¨çš„åˆ†ä»£å¹´é¾„æ”¹æˆäº†15æ¬¡ï¼Œæ”¹å®ŒåFGCé¢‘æ¬¡æ¢å¤åˆ°äº†2å¤©ä¸€æ¬¡ï¼Œåç»­å¦‚æœYGCçš„é¢‘æ¬¡è¶…è¿‡æ¯åˆ†é’Ÿ15æ¬¡è¿˜ä¼šå†æ¬¡è§¦å‘æ­¤é—®é¢˜ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬æœ€æ ¹æœ¬çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šä¼˜åŒ–ç¨‹åºä»¥é™ä½YGCçš„é¢‘ç‡ï¼ŒåŒæ—¶ç¼©çŸ­codisç»„ä»¶ä¸­intæ•°ç»„çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™é‡Œå°±ä¸åšå±•å¼€äº†ã€‚</p><h2 id="GCçš„è¿è¡ŒåŸç†ä»‹ç»"><a href="#GCçš„è¿è¡ŒåŸç†ä»‹ç»" class="headerlink" title="GCçš„è¿è¡ŒåŸç†ä»‹ç»"></a>GCçš„è¿è¡ŒåŸç†ä»‹ç»</h2><p>ä¸Šé¢æ•´ä¸ªæ¡ˆä¾‹çš„åˆ†æè¿‡ç¨‹ä¸­ï¼Œå…¶å®æ¶‰åŠåˆ°å¾ˆå¤šGCçš„åŸç†çŸ¥è¯†ï¼Œå¦‚æœä¸æ‡‚å¾—è¿™äº›åŸç†å°±ç€æ‰‹å¤„ç†ï¼Œå…¶å®æ•´ä¸ªæ’æŸ¥è¿‡ç¨‹æ˜¯å¾ˆæŠ“ççš„ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘é€‰æ‹©å‡ ä¸ªæœ€æ ¸å¿ƒçš„çŸ¥è¯†ç‚¹ï¼Œå±•å¼€ä»‹ç»ä¸‹GCçš„è¿è¡ŒåŸç†ï¼Œæœ€åå†ç»™å‡ºä¸€ä»½å®è·µæŒ‡å—ã€‚</p><h3 id="å †å†…å­˜ç»“æ„"><a href="#å †å†…å­˜ç»“æ„" class="headerlink" title="å †å†…å­˜ç»“æ„"></a>å †å†…å­˜ç»“æ„</h3><p>å¤§å®¶éƒ½çŸ¥é“: GCåˆ†ä¸ºYGCå’ŒFGCï¼Œå®ƒä»¬å‡å‘ç”Ÿåœ¨JVMçš„å †å†…å­˜ä¸Šã€‚å…ˆæ¥çœ‹ä¸‹JDK8çš„å †å†…å­˜ç»“æ„ï¼š</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå †å†…å­˜é‡‡ç”¨äº†åˆ†ä»£ç»“æ„ï¼ŒåŒ…æ‹¬æ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚æ–°ç”Ÿä»£åˆåˆ†ä¸ºï¼šEdenåŒºï¼ŒFrom SurvivoråŒºï¼ˆç®€ç§°S0ï¼‰ï¼ŒTo SurvivoråŒºï¼ˆç®€ç§°S1åŒºï¼‰ï¼Œä¸‰è€…çš„é»˜è®¤æ¯”ä¾‹ä¸º8:1:1ã€‚å¦å¤–ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„é»˜è®¤æ¯”ä¾‹ä¸º1:2ã€‚</p><p>å †å†…å­˜ä¹‹æ‰€ä»¥é‡‡ç”¨åˆ†ä»£ç»“æ„ï¼Œæ˜¯è€ƒè™‘åˆ°ç»å¤§éƒ¨åˆ†å¯¹è±¡éƒ½æ˜¯çŸ­ç”Ÿå‘½å‘¨æœŸçš„ï¼Œè¿™æ ·ä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡å¯æ”¾åœ¨ä¸åŒçš„åŒºåŸŸä¸­ï¼Œç„¶åé’ˆå¯¹æ–°ç”Ÿä»£å’Œè€å¹´ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œä»è€Œä½¿å¾—GCæ•ˆç‡æœ€é«˜ã€‚</p><h3 id="YGCæ˜¯ä»€ä¹ˆæ—¶å€™è§¦å‘çš„ï¼Ÿ"><a href="#YGCæ˜¯ä»€ä¹ˆæ—¶å€™è§¦å‘çš„ï¼Ÿ" class="headerlink" title="YGCæ˜¯ä»€ä¹ˆæ—¶å€™è§¦å‘çš„ï¼Ÿ"></a>YGCæ˜¯ä»€ä¹ˆæ—¶å€™è§¦å‘çš„ï¼Ÿ</h3><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡ç›´æ¥åœ¨å¹´è½»ä»£ä¸­çš„EdenåŒºè¿›è¡Œåˆ†é…ï¼Œå¦‚æœEdenåŒºåŸŸæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘YGCï¼ˆMinor GCï¼‰ï¼ŒYGCå¤„ç†çš„åŒºåŸŸåªæœ‰æ–°ç”Ÿä»£ã€‚å› ä¸ºå¤§éƒ¨åˆ†å¯¹è±¡åœ¨çŸ­æ—¶é—´å†…éƒ½æ˜¯å¯æ”¶å›æ‰çš„ï¼Œå› æ­¤YGCååªæœ‰æå°‘æ•°çš„å¯¹è±¡èƒ½å­˜æ´»ä¸‹æ¥ï¼Œè€Œè¢«ç§»åŠ¨åˆ°S0åŒºï¼ˆé‡‡ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•ï¼‰ã€‚</p><p>å½“è§¦å‘ä¸‹ä¸€æ¬¡YGCæ—¶ï¼Œä¼šå°†EdenåŒºå’ŒS0åŒºçš„å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°S1åŒºï¼ŒåŒæ—¶æ¸…ç©ºEdenåŒºå’ŒS0åŒºã€‚å½“å†æ¬¡è§¦å‘YGCæ—¶ï¼Œè¿™æ—¶å€™å¤„ç†çš„åŒºåŸŸå°±å˜æˆäº†EdenåŒºå’ŒS1åŒºï¼ˆå³S0å’ŒS1è¿›è¡Œè§’è‰²äº¤æ¢ï¼‰ã€‚æ¯ç»è¿‡ä¸€æ¬¡YGCï¼Œå­˜æ´»å¯¹è±¡çš„å¹´é¾„å°±ä¼šåŠ 1ã€‚</p><h3 id="FGCåˆæ˜¯ä»€ä¹ˆæ—¶å€™è§¦å‘çš„ï¼Ÿ"><a href="#FGCåˆæ˜¯ä»€ä¹ˆæ—¶å€™è§¦å‘çš„ï¼Ÿ" class="headerlink" title="FGCåˆæ˜¯ä»€ä¹ˆæ—¶å€™è§¦å‘çš„ï¼Ÿ"></a>FGCåˆæ˜¯ä»€ä¹ˆæ—¶å€™è§¦å‘çš„ï¼Ÿ</h3><p>ä¸‹é¢4ç§æƒ…å†µï¼Œå¯¹è±¡ä¼šè¿›å…¥åˆ°è€å¹´ä»£ä¸­ï¼š</p><ul><li>YGCæ—¶ï¼ŒTo SurvivoråŒºä¸è¶³ä»¥å­˜æ”¾å­˜æ´»çš„å¯¹è±¡ï¼Œå¯¹è±¡ä¼šç›´æ¥è¿›å…¥åˆ°è€å¹´ä»£ã€‚</li><li>ç»è¿‡å¤šæ¬¡YGCåï¼Œå¦‚æœå­˜æ´»å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°äº†è®¾å®šé˜ˆå€¼ï¼Œåˆ™ä¼šæ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚</li><li>åŠ¨æ€å¹´é¾„åˆ¤å®šè§„åˆ™ï¼ŒTo SurvivoråŒºä¸­ç›¸åŒå¹´é¾„çš„å¯¹è±¡ï¼Œå¦‚æœå…¶å¤§å°ä¹‹å’Œå åˆ°äº† To SurvivoråŒºä¸€åŠä»¥ä¸Šçš„ç©ºé—´ï¼Œé‚£ä¹ˆå¤§äºæ­¤å¹´é¾„çš„å¯¹è±¡ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œè€Œä¸éœ€è¦è¾¾åˆ°é»˜è®¤çš„åˆ†ä»£å¹´é¾„ã€‚</li><li>å¤§å¯¹è±¡ï¼šç”±-XX:PretenureSizeThresholdå¯åŠ¨å‚æ•°æ§åˆ¶ï¼Œè‹¥å¯¹è±¡å¤§å°å¤§äºæ­¤å€¼ï¼Œå°±ä¼šç»•è¿‡æ–°ç”Ÿä»£, ç›´æ¥åœ¨è€å¹´ä»£ä¸­åˆ†é…ã€‚</li></ul><p>å½“æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§äºäº†è€å¹´ä»£çš„å‰©ä½™ç©ºé—´æ—¶ï¼Œå°±ä¼šè§¦å‘FGCï¼ˆMajor GCï¼‰ï¼ŒFGCå¤„ç†çš„åŒºåŸŸåŒæ—¶åŒ…æ‹¬æ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹4ç§æƒ…å†µä¹Ÿä¼šè§¦å‘FGCï¼š</p><ul><li>è€å¹´ä»£çš„å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ°äº†ä¸€å®šé˜ˆå€¼ï¼ˆå¯é€šè¿‡å‚æ•°è°ƒæ•´ï¼‰ï¼Œç›´æ¥è§¦å‘FGCã€‚</li><li>ç©ºé—´åˆ†é…æ‹…ä¿ï¼šåœ¨YGCä¹‹å‰ï¼Œä¼šå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»ç©ºé—´ã€‚å¦‚æœå°äºï¼Œè¯´æ˜YGCæ˜¯ä¸å®‰å…¨çš„ï¼Œåˆ™ä¼šæŸ¥çœ‹å‚æ•° HandlePromotionFailure æ˜¯å¦è¢«è®¾ç½®æˆäº†å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå¦‚æœä¸å…è®¸åˆ™ç›´æ¥è§¦å‘Full GCï¼›å¦‚æœå…è®¸ï¼Œé‚£ä¹ˆä¼šè¿›ä¸€æ­¥æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå°äºä¹Ÿä¼šè§¦å‘ Full GCã€‚</li><li>Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰åœ¨ç©ºé—´ä¸è¶³æ—¶ä¼šè¿›è¡Œæ‰©å®¹ï¼Œå½“æ‰©å®¹åˆ°äº†-XX:MetaspaceSize å‚æ•°çš„æŒ‡å®šå€¼æ—¶ï¼Œä¹Ÿä¼šè§¦å‘FGCã€‚</li><li>System.gc() æˆ–è€…Runtime.gc() è¢«æ˜¾å¼è°ƒç”¨æ—¶ï¼Œè§¦å‘FGCã€‚</li></ul><h3 id="åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼ŒGCä¼šå¯¹ç¨‹åºäº§ç”Ÿå½±å“ï¼Ÿ"><a href="#åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼ŒGCä¼šå¯¹ç¨‹åºäº§ç”Ÿå½±å“ï¼Ÿ" class="headerlink" title="åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼ŒGCä¼šå¯¹ç¨‹åºäº§ç”Ÿå½±å“ï¼Ÿ"></a>åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼ŒGCä¼šå¯¹ç¨‹åºäº§ç”Ÿå½±å“ï¼Ÿ</h3><p>ä¸ç®¡YGCè¿˜æ˜¯FGCï¼Œéƒ½ä¼šé€ æˆä¸€å®šç¨‹åº¦çš„ç¨‹åºå¡é¡¿ï¼ˆå³Stop The Worldé—®é¢˜ï¼šGCçº¿ç¨‹å¼€å§‹å·¥ä½œï¼Œå…¶ä»–å·¥ä½œçº¿ç¨‹è¢«æŒ‚èµ·ï¼‰ï¼Œå³ä½¿é‡‡ç”¨ParNewã€CMSæˆ–è€…G1è¿™äº›æ›´å…ˆè¿›çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œä¹Ÿåªæ˜¯åœ¨å‡å°‘å¡é¡¿æ—¶é—´ï¼Œè€Œå¹¶ä¸èƒ½å®Œå…¨æ¶ˆé™¤å¡é¡¿ã€‚</p><p>é‚£åˆ°åº•ä»€ä¹ˆæƒ…å†µä¸‹ï¼ŒGCä¼šå¯¹ç¨‹åºäº§ç”Ÿå½±å“å‘¢ï¼Ÿæ ¹æ®ä¸¥é‡ç¨‹åº¦ä»é«˜åˆ°åº•ï¼Œæˆ‘è®¤ä¸ºåŒ…æ‹¬ä»¥ä¸‹4ç§æƒ…å†µï¼š</p><ul><li>FGCè¿‡äºé¢‘ç¹ï¼šFGCé€šå¸¸æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œå°‘åˆ™å‡ ç™¾æ¯«ç§’ï¼Œå¤šåˆ™å‡ ç§’ï¼Œæ­£å¸¸æƒ…å†µFGCæ¯éš”å‡ ä¸ªå°æ—¶ç”šè‡³å‡ å¤©æ‰æ‰§è¡Œä¸€æ¬¡ï¼Œå¯¹ç³»ç»Ÿçš„å½±å“è¿˜èƒ½æ¥å—ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦å‡ºç°FGCé¢‘ç¹ï¼ˆæ¯”å¦‚å‡ ååˆ†é’Ÿå°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œè¿™ç§è‚¯å®šæ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œå®ƒä¼šå¯¼è‡´å·¥ä½œçº¿ç¨‹é¢‘ç¹è¢«åœæ­¢ï¼Œè®©ç³»ç»Ÿçœ‹èµ·æ¥ä¸€ç›´æœ‰å¡é¡¿ç°è±¡ï¼Œä¹Ÿä¼šä½¿å¾—ç¨‹åºçš„æ•´ä½“æ€§èƒ½å˜å·®ã€‚</li><li>YGCè€—æ—¶è¿‡é•¿ï¼šä¸€èˆ¬æ¥è¯´ï¼ŒYGCçš„æ€»è€—æ—¶åœ¨å‡ åæˆ–è€…ä¸Šç™¾æ¯«ç§’æ˜¯æ¯”è¾ƒæ­£å¸¸çš„ï¼Œè™½ç„¶ä¼šå¼•èµ·ç³»ç»Ÿå¡é¡¿å‡ æ¯«ç§’æˆ–è€…å‡ åæ¯«ç§’ï¼Œè¿™ç§æƒ…å†µå‡ ä¹å¯¹ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œå¯¹ç¨‹åºçš„å½±å“å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä½†æ˜¯å¦‚æœYGCè€—æ—¶è¾¾åˆ°äº†1ç§’ç”šè‡³å‡ ç§’ï¼ˆéƒ½å¿«èµ¶ä¸ŠFGCçš„è€—æ—¶äº†ï¼‰ï¼Œé‚£å¡é¡¿æ—¶é—´å°±ä¼šå¢å¤§ï¼ŒåŠ ä¸ŠYGCæœ¬èº«æ¯”è¾ƒé¢‘ç¹ï¼Œå°±ä¼šå¯¼è‡´æ¯”è¾ƒå¤šçš„æœåŠ¡è¶…æ—¶é—®é¢˜ã€‚</li><li>FGCè€—æ—¶è¿‡é•¿ï¼šFGCè€—æ—¶å¢åŠ ï¼Œå¡é¡¿æ—¶é—´ä¹Ÿä¼šéšä¹‹å¢åŠ ï¼Œå°¤å…¶å¯¹äºé«˜å¹¶å‘æœåŠ¡ï¼Œå¯èƒ½å¯¼è‡´FGCæœŸé—´æ¯”è¾ƒå¤šçš„è¶…æ—¶é—®é¢˜ï¼Œå¯ç”¨æ€§é™ä½ï¼Œè¿™ç§ä¹Ÿéœ€è¦å…³æ³¨ã€‚</li><li>YGCè¿‡äºé¢‘ç¹ï¼šå³ä½¿YGCä¸ä¼šå¼•èµ·æœåŠ¡è¶…æ—¶ï¼Œä½†æ˜¯YGCè¿‡äºé¢‘ç¹ä¹Ÿä¼šé™ä½æœåŠ¡çš„æ•´ä½“æ€§èƒ½ï¼Œå¯¹äºé«˜å¹¶å‘æœåŠ¡ä¹Ÿæ˜¯éœ€è¦å…³æ³¨çš„ã€‚</li></ul><p>å…¶ä¸­ï¼Œã€ŒFGCè¿‡äºé¢‘ç¹ã€å’Œã€ŒYGCè€—æ—¶è¿‡é•¿ã€ï¼Œè¿™ä¸¤ç§æƒ…å†µå±äºæ¯”è¾ƒå…¸å‹çš„GCé—®é¢˜ï¼Œå¤§æ¦‚ç‡ä¼šå¯¹ç¨‹åºçš„æœåŠ¡è´¨é‡äº§ç”Ÿå½±å“ã€‚å‰©ä½™ä¸¤ç§æƒ…å†µçš„ä¸¥é‡ç¨‹åº¦ä½ä¸€äº›ï¼Œä½†æ˜¯å¯¹äºé«˜å¹¶å‘æˆ–è€…é«˜å¯ç”¨çš„ç¨‹åºä¹Ÿéœ€è¦å…³æ³¨ã€‚</p><h2 id="æ’æŸ¥FGCé—®é¢˜çš„å®è·µæŒ‡å—"><a href="#æ’æŸ¥FGCé—®é¢˜çš„å®è·µæŒ‡å—" class="headerlink" title="æ’æŸ¥FGCé—®é¢˜çš„å®è·µæŒ‡å—"></a>æ’æŸ¥FGCé—®é¢˜çš„å®è·µæŒ‡å—</h2><p>é€šè¿‡ä¸Šé¢çš„æ¡ˆä¾‹åˆ†æä»¥åŠç†è®ºä»‹ç»ï¼Œå†æ€»ç»“ä¸‹FGCé—®é¢˜çš„æ’æŸ¥æ€è·¯ï¼Œä½œä¸ºä¸€ä»½å®è·µæŒ‡å—ä¾›å¤§å®¶å‚è€ƒã€‚</p><h3 id="æ¸…æ¥šä»ç¨‹åºè§’åº¦ï¼Œæœ‰å“ªäº›åŸå› å¯¼è‡´FGCï¼Ÿ"><a href="#æ¸…æ¥šä»ç¨‹åºè§’åº¦ï¼Œæœ‰å“ªäº›åŸå› å¯¼è‡´FGCï¼Ÿ" class="headerlink" title="æ¸…æ¥šä»ç¨‹åºè§’åº¦ï¼Œæœ‰å“ªäº›åŸå› å¯¼è‡´FGCï¼Ÿ"></a>æ¸…æ¥šä»ç¨‹åºè§’åº¦ï¼Œæœ‰å“ªäº›åŸå› å¯¼è‡´FGCï¼Ÿ</h3><ul><li>å¤§å¯¹è±¡ï¼šç³»ç»Ÿä¸€æ¬¡æ€§åŠ è½½äº†è¿‡å¤šæ•°æ®åˆ°å†…å­˜ä¸­ï¼ˆæ¯”å¦‚SQLæŸ¥è¯¢æœªåšåˆ†é¡µï¼‰ï¼Œå¯¼è‡´å¤§å¯¹è±¡è¿›å…¥äº†è€å¹´ä»£ã€‚</li><li>å†…å­˜æ³„æ¼ï¼šé¢‘ç¹åˆ›å»ºäº†å¤§é‡å¯¹è±¡ï¼Œä½†æ˜¯æ— æ³•è¢«å›æ”¶ï¼ˆæ¯”å¦‚IOå¯¹è±¡ä½¿ç”¨å®Œåæœªè°ƒç”¨closeæ–¹æ³•é‡Šæ”¾èµ„æºï¼‰ï¼Œå…ˆå¼•å‘FGCï¼Œæœ€åå¯¼è‡´OOM.</li><li>ç¨‹åºé¢‘ç¹ç”Ÿæˆä¸€äº›é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œå½“è¿™äº›å¯¹è±¡çš„å­˜æ´»å¹´é¾„è¶…è¿‡åˆ†ä»£å¹´é¾„æ—¶ä¾¿ä¼šè¿›å…¥è€å¹´ä»£ï¼Œæœ€åå¼•å‘FGC. ï¼ˆå³æœ¬æ–‡ä¸­çš„æ¡ˆä¾‹ï¼‰</li><li>ç¨‹åºBUGå¯¼è‡´åŠ¨æ€ç”Ÿæˆäº†å¾ˆå¤šæ–°ç±»ï¼Œä½¿å¾— Metaspace ä¸æ–­è¢«å ç”¨ï¼Œå…ˆå¼•å‘FGCï¼Œæœ€åå¯¼è‡´OOM.</li><li>ä»£ç ä¸­æ˜¾å¼è°ƒç”¨äº†gcæ–¹æ³•ï¼ŒåŒ…æ‹¬è‡ªå·±çš„ä»£ç ç”šè‡³æ¡†æ¶ä¸­çš„ä»£ç ã€‚</li><li>JVMå‚æ•°è®¾ç½®é—®é¢˜ï¼šåŒ…æ‹¬æ€»å†…å­˜å¤§å°ã€æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å¤§å°ã€EdenåŒºå’ŒSåŒºçš„å¤§å°ã€å…ƒç©ºé—´å¤§å°ã€åƒåœ¾å›æ”¶ç®—æ³•ç­‰ç­‰ã€‚</li></ul><h3 id="æ¸…æ¥šæ’æŸ¥é—®é¢˜æ—¶èƒ½ä½¿ç”¨å“ªäº›å·¥å…·"><a href="#æ¸…æ¥šæ’æŸ¥é—®é¢˜æ—¶èƒ½ä½¿ç”¨å“ªäº›å·¥å…·" class="headerlink" title="æ¸…æ¥šæ’æŸ¥é—®é¢˜æ—¶èƒ½ä½¿ç”¨å“ªäº›å·¥å…·"></a>æ¸…æ¥šæ’æŸ¥é—®é¢˜æ—¶èƒ½ä½¿ç”¨å“ªäº›å·¥å…·</h3><ul><li><p>å…¬å¸çš„ç›‘æ§ç³»ç»Ÿï¼šå¤§éƒ¨åˆ†å…¬å¸éƒ½ä¼šæœ‰ï¼Œå¯å…¨æ–¹ä½ç›‘æ§JVMçš„å„é¡¹æŒ‡æ ‡ã€‚</p></li><li><p>JDKçš„è‡ªå¸¦å·¥å…·ï¼ŒåŒ…æ‹¬jmapã€jstatç­‰å¸¸ç”¨å‘½ä»¤ï¼š</p><p># æŸ¥çœ‹å †å†…å­˜å„åŒºåŸŸçš„ä½¿ç”¨ç‡ä»¥åŠGCæƒ…å†µ</p><p>jstat -gcutil -h20 pid 1000</p><p># æŸ¥çœ‹å †å†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œå¹¶æŒ‰ç©ºé—´æ’åº</p><p>jmap -histo pid | head -n20</p><p># dumpå †å†…å­˜æ–‡ä»¶</p><p>jmap -dump:format=b,file=heap pid</p></li><li><p>å¯è§†åŒ–çš„å †å†…å­˜åˆ†æå·¥å…·ï¼šJVisualVMã€MATç­‰</p></li></ul><h3 id="æ’æŸ¥æŒ‡å—"><a href="#æ’æŸ¥æŒ‡å—" class="headerlink" title="æ’æŸ¥æŒ‡å—"></a>æ’æŸ¥æŒ‡å—</h3><ul><li><p>æŸ¥çœ‹ç›‘æ§ï¼Œä»¥äº†è§£å‡ºç°é—®é¢˜çš„æ—¶é—´ç‚¹ä»¥åŠå½“å‰FGCçš„é¢‘ç‡ï¼ˆå¯å¯¹æ¯”æ­£å¸¸æƒ…å†µçœ‹é¢‘ç‡æ˜¯å¦æ­£å¸¸ï¼‰</p></li><li><p>äº†è§£è¯¥æ—¶é—´ç‚¹ä¹‹å‰æœ‰æ²¡æœ‰ç¨‹åºä¸Šçº¿ã€åŸºç¡€ç»„ä»¶å‡çº§ç­‰æƒ…å†µã€‚</p></li><li><p>äº†è§£JVMçš„å‚æ•°è®¾ç½®ï¼ŒåŒ…æ‹¬ï¼šå †ç©ºé—´å„ä¸ªåŒºåŸŸçš„å¤§å°è®¾ç½®ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£åˆ†åˆ«é‡‡ç”¨äº†å“ªäº›åƒåœ¾æ”¶é›†å™¨ï¼Œç„¶ååˆ†æJVMå‚æ•°è®¾ç½®æ˜¯å¦åˆç†ã€‚</p></li><li><p>å†å¯¹æ­¥éª¤1ä¸­åˆ—å‡ºçš„å¯èƒ½åŸå› åšæ’é™¤æ³•ï¼Œå…¶ä¸­å…ƒç©ºé—´è¢«æ‰“æ»¡ã€å†…å­˜æ³„æ¼ã€ä»£ç æ˜¾å¼è°ƒç”¨gcæ–¹æ³•æ¯”è¾ƒå®¹æ˜“æ’æŸ¥ã€‚</p></li><li><p>é’ˆå¯¹å¤§å¯¹è±¡æˆ–è€…é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å¯¼è‡´çš„FGCï¼Œå¯é€šè¿‡ jmap -histo å‘½ä»¤å¹¶ç»“åˆdumpå †å†…å­˜æ–‡ä»¶ä½œè¿›ä¸€æ­¥åˆ†æï¼Œéœ€è¦å…ˆå®šä½åˆ°å¯ç–‘å¯¹è±¡ã€‚</p></li><li><p>é€šè¿‡å¯ç–‘å¯¹è±¡å®šä½åˆ°å…·ä½“ä»£ç å†æ¬¡åˆ†æï¼Œè¿™æ—¶å€™è¦ç»“åˆGCåŸç†å’ŒJVMå‚æ•°è®¾ç½®ï¼Œå¼„æ¸…æ¥šå¯ç–‘å¯¹è±¡æ˜¯å¦æ»¡è¶³äº†è¿›å…¥åˆ°è€å¹´ä»£çš„æ¡ä»¶æ‰èƒ½ä¸‹ç»“è®ºã€‚</p></li></ul><p>æœ€åçš„è¯</p><p>è¿™ç¯‡æ–‡ç« é€šè¿‡çº¿ä¸Šæ¡ˆä¾‹å¹¶ç»“åˆGCåŸç†è¯¦ç»†ä»‹ç»äº†FGCçš„æ’æŸ¥è¿‡ç¨‹ï¼ŒåŒæ—¶ç»™å‡ºäº†ä¸€ä»½å®è·µæŒ‡å—ã€‚</p><p>åç»­ä¼šä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œå†åˆ†äº«ä¸€ä¸ªYGCè€—æ—¶è¿‡é•¿çš„æ¡ˆä¾‹ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶åƒé€GCé—®é¢˜æ’æŸ¥ï¼Œå¦‚æœè§‰å¾—æœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·å¸®å¿™è½¬å‘æˆ–è€…ç‚¹ä¸ªå†çœ‹ï¼</p><end></end>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€æ¬¡jvmé—®é¢˜æ’æŸ¥è¿‡ç¨‹</title>
      <link href="/2020/07/15/6.%20JVM/%E4%B8%80%E6%AC%A1jvm%E9%97%AE%E9%A2%98/"/>
      <url>/2020/07/15/6.%20JVM/%E4%B8%80%E6%AC%A1jvm%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="1-é—®é¢˜"><a href="#1-é—®é¢˜" class="headerlink" title="1. é—®é¢˜"></a>1. é—®é¢˜</h1><p>å¹´è€ä»£æŠ¥è­¦ï¼šå†…å­˜å ç”¨95%ä»¥ä¸Šï¼ŒæŒç»­1åˆ†é’Ÿä»¥ä¸Šï¼Œåªèƒ½é‡å¯tomcat server</p><p>è¯­ä¹‰æŠ¥è­¦ï¼šè¿ç»­3æ¬¡ï¼Œé—´éš”10ç§’ï¼ŒæœåŠ¡å™¨æ²¡æœ‰å“åº”</p><h1 id="2-ä¿¡æ¯æ”¶é›†"><a href="#2-ä¿¡æ¯æ”¶é›†" class="headerlink" title="2. ä¿¡æ¯æ”¶é›†"></a>2. ä¿¡æ¯æ”¶é›†</h1><p>è®¿é—®æ—¥å¿—ï¼š$TOMCAT_HOME/log/localhost_access_log.txt</p><p>gcæ—¥å¿—ï¼š$TOMCAT_HOME/log/gc.log</p><p>åº”ç”¨æ—¥å¿—ï¼š</p><p>heapdumpï¼šæŠ¥è­¦æ—¶æ”¶é›†</p><h1 id="3-åˆ†æä¸å®šä½"><a href="#3-åˆ†æä¸å®šä½" class="headerlink" title="3. åˆ†æä¸å®šä½"></a>3. åˆ†æä¸å®šä½</h1><h2 id="3-1-è®¿é—®æ—¥å¿—åˆ†æ"><a href="#3-1-è®¿é—®æ—¥å¿—åˆ†æ" class="headerlink" title="3.1 è®¿é—®æ—¥å¿—åˆ†æ"></a>3.1 è®¿é—®æ—¥å¿—åˆ†æ</h2><p>é—®é¢˜æ—¶é—´æ®µå†… è€—æ—¶60ç§’ä»¥ä¸Šçš„urlå¤§éƒ¨åˆ†éƒ½æ˜¯/client/account/overview/accountReport!reportJson.action</p><p>æŸ¥çœ‹Strutsé…ç½®ï¼Œå¯¹åº”çš„Actionç±»å’Œæ–¹æ³•æ˜¯com.baidu.union.report.InitAccountReportAction.reportJson()</p><h2 id="3-2-gcæ—¥å¿—åˆ†æ"><a href="#3-2-gcæ—¥å¿—åˆ†æ" class="headerlink" title="3.2 gcæ—¥å¿—åˆ†æ"></a>3.2 gcæ—¥å¿—åˆ†æ</h2><p>![image-20201028095230949](/Users/hepeitan/Library/Application Support/typora-user-images/image-20201028095230949.png)</p><p>å¹´è€ä»£æ— æ³•å›æ”¶ï¼Œé¢‘ç¹å‘ç”ŸCMSæ”¶é›†ï¼Œè¢«minor gcæ‰“æ–­å‘ç”Ÿconcurrent mode failureï¼Œè½¬ä¸ºä¸²è¡Œæ”¶é›†ã€‚</p><p>åˆæ­¥ç»“è®ºï¼šç»“åˆ3.1ã€3.2å ç”¨å†…å­˜è¾ƒå¤§çš„æ–¹æ³•å¿…ç„¶æ‰§è¡Œæ—¶é—´å¾ˆé•¿ï¼Œæ˜¯InitAccountReportAction.reportJson()å¯¼è‡´äº†é—®é¢˜</p><h2 id="3-3-heapdumpåˆ†æ"><a href="#3-3-heapdumpåˆ†æ" class="headerlink" title="3.3 heapdumpåˆ†æ"></a>3.3 heapdumpåˆ†æ</h2><p>ä¸¤ä¸ªè¾ƒå¤§å¯¹è±¡ï¼šArrayListå’Œbyte[]ï¼ŒArrayListçš„è¯¦ç»†ç±»å‹å±•å¼€å¯ä»¥çœ‹åˆ°ArrayList&lt;HashMap&lt;String, Long&gt;&gt;</p><h2 id="3-4-åº”ç”¨æ—¥å¿—"><a href="#3-4-åº”ç”¨æ—¥å¿—" class="headerlink" title="3.4 åº”ç”¨æ—¥å¿—"></a>3.4 åº”ç”¨æ—¥å¿—</h2><p><strong>===============response head from doris======================================<br>ActualRecNum: 1385308800<br>TotalNum: 0<br>RecordSize: 187<br>StatusCode: 0<br>=================response head from doris====================================</strong></p><p><a href="http://wiki.baidu.com/pages/createpage.action?spaceKey=ecomop&title=ActualRecNum&linkCreation=true&fromPageId=104888992" target="_blank" rel="noopener">ActualRecNum</a>: 1385308800 è¿™ä¸ªè¿”å›æ•°æ®é‡æ˜æ˜¾æœ‰é—®é¢˜</p><p>æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼š</p><p>[work@yf-cloud04root]$ more root.log.2013-12-11-18|grep Exception<br><a href="http://java.net/" target="_blank" rel="noopener">java.net</a>.SocketException:Socket is closed<br><a href="http://java.net/" target="_blank" rel="noopener">java.net</a>.SocketException:Socket closed<br><a href="http://java.net/" target="_blank" rel="noopener">java.net</a>.SocketException:Broken pipe</p><p>è²Œä¼¼æ˜¯å¤šçº¿ç¨‹çš„é—®é¢˜ï¼Œå¹¶å‘çº¿ç¨‹å…±äº«ä¸€ä¸ªsocketå¯¼è‡´ã€‚</p><h2 id="3-5-æŸ¥çœ‹ä»£ç "><a href="#3-5-æŸ¥çœ‹ä»£ç " class="headerlink" title="3.5 æŸ¥çœ‹ä»£ç "></a>3.5 æŸ¥çœ‹ä»£ç </h2><p>æ ¹æ®3.3ã€3.4ï¼Œé—®é¢˜å¯èƒ½å‡ºç°åœ¨dorisè®¿é—®ä¸Šï¼ŒæŸ¥çœ‹dorisä»£ç ï¼ŒgetDortisDataæ–¹æ³•è¿”å›å€¼ArrayListä¸Heapdumpä¸­4Gå¯¹è±¡ç›¸åŒ</p><p><img alt="img" data-src="http://wiki.baidu.com/download/attachments/104888992/c381e12ac84f1353dbbc35fd48366347.png?version=1&modificationDate=1434457675847&api=v2" class="lazyload"></p><p>è·å–dorisè¿”å›æ•°æ®ä»£ç </p><p><img alt="img" data-src="http://wiki.baidu.com/download/attachments/104888992/de727ccf69245da0b0297274e59ae43f.png?version=1&modificationDate=1434457675849&api=v2" class="lazyload"></p><p>æ„é€ javaå¯¹è±¡ä»£ç </p><p><img alt="img" data-src="http://wiki.baidu.com/download/attachments/104888992/2d9d8d47d776fdea291172ab2f51e97d.png?version=1&modificationDate=1434457675858&api=v2" class="lazyload"></p><p>unionwebçš„doriså®¢æˆ·ç«¯ä¼šæ ¹æ®è¿”å›æ•°æ®çš„å­—èŠ‚ç ä½ç½®è§£æè¿”å›æ•°æ®å¤§å°ã€ä¸šåŠ¡æ•°æ®ç­‰ä¿¡æ¯ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹å…±äº«ä¸€ä¸ªsocketï¼Œ</p><p>å°±ä¼šå‡ºç°è¿”å›æ•°æ®è§£æé”™è¯¯ï¼Œæ¯”å¦‚ActualRecNum: 1385308800ï¼Œè¿™ç§é—®é¢˜ã€‚</p><h2 id="3-6-å¤šçº¿ç¨‹é—®é¢˜åˆ†æ"><a href="#3-6-å¤šçº¿ç¨‹é—®é¢˜åˆ†æ" class="headerlink" title="3.6 å¤šçº¿ç¨‹é—®é¢˜åˆ†æ"></a>3.6 å¤šçº¿ç¨‹é—®é¢˜åˆ†æ</h2><p>é¦–å…ˆæŸ¥çœ‹socketè¿æ¥æ± çš„è·å–ã€å›æ”¶æ–¹æ³•ï¼Œæ²¡æœ‰é—®é¢˜ã€‚</p><p>union-webä½¿ç”¨SSHï¼Œç»å…¸çš„Action-Serivce-Daoä¸‰å±‚ç»“æ„ï¼Œspringé»˜è®¤ä½¿ç”¨singlitonç®¡ç†beanï¼Œä¸‰å±‚ä¸­æœ‰ä¸€ä¸ªbeanæ˜¯å…±äº«çš„éƒ½å¯èƒ½å¯¼è‡´è¿™ä¸ªé—®é¢˜ã€‚</p><p>ä½¿ç”¨btraceè°ƒè¯•ä»£ç ï¼Œå‘ç°é—®é¢˜å‘ç”Ÿåœ¨Serviceå±‚ï¼Œå¯¹è±¡åœ°å€ä¸€æ ·è¯´æ˜æ˜¯åŒä¸€ä¸ªå¯¹è±¡</p><h2 id="3-7-å…¶ä»–é—®é¢˜"><a href="#3-7-å…¶ä»–é—®é¢˜" class="headerlink" title="3.7 å…¶ä»–é—®é¢˜"></a>3.7 å…¶ä»–é—®é¢˜</h2><p>è®°å½•è°ƒè¯•æ—¥å¿—å‘ç°socketè¿æ¥æ± å¯ç”¨è¿æ¥ä¸€ç›´æ˜¯0ï¼Œä½†æ˜¯activeå´èƒ½è¾¾åˆ°max 100,</p><p>è°ƒè¯•å‘ç°è¿™æ®µä»£ç æœ‰é—®é¢˜</p><p>com.baidu.darwin.doris.driver.SocketDriverä¸­</p><p>ç»“åˆé…ç½®æ–‡ä»¶ï¼Œä»£ç ä¸­ç¼ºå°‘æ­£ç¡®åˆ›å»ºsocketè·³å‡ºçš„æœºåˆ¶ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ— æ³•è¿”å›poolçš„socket</p><p>æœ€ç»ˆPoolé€šè¿‡_numActiveè®¡æ•°åˆ°è¾¾maxï¼Œä½†æ˜¯ä»…æœ‰ä¸€ä¸ªsocketå¯ç”¨</p><h1 id="4-ä¿®å¤é—®é¢˜"><a href="#4-ä¿®å¤é—®é¢˜" class="headerlink" title="4. ä¿®å¤é—®é¢˜"></a>4. ä¿®å¤é—®é¢˜</h1><p>4.1 ä¿®æ”¹springå…³äº*Mgr *Daoçš„é…ç½®ï¼Œæ·»åŠ æ³¨è§£ï¼Œscopeæ”¹ä¸ºprototype</p><p>4.2 ä¿®æ”¹ä»£ç ï¼Œsocketæ­£ç¡®åˆ›å»ºåˆ™è·³å‡ºå¾ªç¯</p>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMåŸºç¡€</title>
      <link href="/2020/07/15/6.%20JVM/JVM%E5%9F%BA%E7%A1%80/"/>
      <url>/2020/07/15/6.%20JVM/JVM%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="JVMåŸºç¡€"><a href="#JVMåŸºç¡€" class="headerlink" title="JVMåŸºç¡€"></a>JVMåŸºç¡€</h2><h2 id="ç®€ä»‹ï¼š"><a href="#ç®€ä»‹ï¼š" class="headerlink" title="ç®€ä»‹ï¼š"></a>ç®€ä»‹ï¼š</h2><p>æœ¬æ–‡ä»‹ç»äº†ä¸€äº›å¸¸è§çš„JVMä¸­çš„é¢è¯•é¢˜</p><hr><h2 id="Java-ä¸­éƒ½æœ‰å“ªäº›å¼•ç”¨ç±»å‹ï¼Ÿ"><a href="#Java-ä¸­éƒ½æœ‰å“ªäº›å¼•ç”¨ç±»å‹ï¼Ÿ" class="headerlink" title="Java ä¸­éƒ½æœ‰å“ªäº›å¼•ç”¨ç±»å‹ï¼Ÿ"></a>Java ä¸­éƒ½æœ‰å“ªäº›å¼•ç”¨ç±»å‹ï¼Ÿ</h2><ul><li><p><code>å¼ºå¼•ç”¨ï¼š</code>å‘ç”Ÿ gc çš„æ—¶å€™ä¸ä¼šè¢«å›æ”¶ã€‚</p><p>ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨çš„å¤§éƒ¨åˆ†å¼•ç”¨å®é™…ä¸Šéƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œè¿™æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ä¸­çš„objectå’Œstréƒ½æ˜¯å¼ºå¼•ç”¨ï¼š</p><pre><code class="java">Object object = new Object();String str = &quot;StrongReference&quot;;</code></pre></li><li><p><code>è½¯å¼•ç”¨ï¼š</code>æœ‰ç”¨ä½†ä¸æ˜¯å¿…é¡»çš„å¯¹è±¡ï¼Œåœ¨å‘ç”Ÿå†…å­˜æº¢å‡ºä¹‹å‰ä¼šè¢«å›æ”¶ã€‚åœ¨Javaä¸­ç”¨java.lang.ref.SoftReferenceç±»æ¥è¡¨ç¤ºã€‚å› æ­¤ï¼Œè¿™ä¸€ç‚¹å¯ä»¥å¾ˆå¥½åœ°ç”¨æ¥è§£å†³OOMçš„é—®é¢˜ï¼Œå¹¶ä¸”è¿™ä¸ªç‰¹æ€§å¾ˆé€‚åˆç”¨æ¥å®ç°ç¼“å­˜ï¼šæ¯”å¦‚ç½‘é¡µç¼“å­˜ã€å›¾ç‰‡ç¼“å­˜ç­‰ã€‚</p></li><li><p><code>å¼±å¼•ç”¨ï¼š</code>æœ‰ç”¨ä½†ä¸æ˜¯å¿…é¡»çš„å¯¹è±¡ï¼Œåœ¨ä¸‹ä¸€æ¬¡GCæ—¶ä¼šè¢«å›æ”¶ã€‚åº”ç”¨åœºæ™¯ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯å¶å°”çš„ä½¿ç”¨ï¼Œå¹¶ä¸”å¸Œæœ›åœ¨ä½¿ç”¨æ—¶éšæ—¶å°±èƒ½è·å–åˆ°ï¼Œä½†åˆä¸æƒ³å½±å“æ­¤å¯¹è±¡çš„åƒåœ¾æ”¶é›†ï¼Œé‚£ä¹ˆåº”è¯¥ç”¨ Weak Reference æ¥è®°ä½æ­¤å¯¹è±¡ã€‚æˆ–è€…æƒ³å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½ ä¸æƒ³ä»‹å…¥è¿™ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ—¶å€™å°±åº”è¯¥ç”¨å¼±å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨ä¸ä¼šåœ¨å¯¹è±¡çš„åƒåœ¾å›æ”¶åˆ¤æ–­ä¸­äº§ç”Ÿä»»ä½•é™„åŠ çš„å½±å“ã€‚</p></li><li><p><code>è™šå¼•ç”¨ï¼š</code>å’Œå‰é¢çš„è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ä¸åŒï¼Œå®ƒå¹¶ä¸å½±å“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨javaä¸­ç”¨java.lang.ref.PhantomReferenceç±»è¡¨ç¤ºã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸è™šå¼•ç”¨å…³è”ï¼Œåˆ™è·Ÿæ²¡æœ‰å¼•ç”¨ä¸ä¹‹å…³è”ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨ã€‚</p></li></ul><h2 id="Javaå†…å­˜åŒºåŸŸ"><a href="#Javaå†…å­˜åŒºåŸŸ" class="headerlink" title="Javaå†…å­˜åŒºåŸŸ"></a>Javaå†…å­˜åŒºåŸŸ</h2><h3 id="è¯´ä¸€ä¸‹-JVM-çš„ä¸»è¦ç»„æˆéƒ¨åˆ†åŠå…¶ä½œç”¨ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹-JVM-çš„ä¸»è¦ç»„æˆéƒ¨åˆ†åŠå…¶ä½œç”¨ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹ JVM çš„ä¸»è¦ç»„æˆéƒ¨åˆ†åŠå…¶ä½œç”¨ï¼Ÿ"></a>è¯´ä¸€ä¸‹ JVM çš„ä¸»è¦ç»„æˆéƒ¨åˆ†åŠå…¶ä½œç”¨ï¼Ÿ</h3><p><img alt="image-20200607182848130" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfjwj4acnpj31ho0tkwvt.jpg" class="lazyload"></p><p>JVMåŒ…å«ä¸¤ä¸ªå­ç³»ç»Ÿå’Œä¸¤ä¸ªç»„ä»¶ï¼Œä¸¤ä¸ªå­ç³»ç»Ÿä¸ºClass loader(ç±»è£…è½½)ã€Execution engine(æ‰§è¡Œå¼•æ“)ï¼›ä¸¤ä¸ªç»„ä»¶ä¸ºRuntime data area(è¿è¡Œæ—¶æ•°æ®åŒº)ã€Native Interface(æœ¬åœ°æ¥å£)ã€‚</p><ul><li>Class loader(ç±»è£…è½½)ï¼šæ ¹æ®ç»™å®šçš„å…¨é™å®šåç±»å(å¦‚ï¼šjava.lang.Object)æ¥è£…è½½classæ–‡ä»¶åˆ°Runtime data areaä¸­çš„method areaã€‚</li><li>Execution engineï¼ˆæ‰§è¡Œå¼•æ“ï¼‰ï¼šæ‰§è¡Œclassesä¸­çš„æŒ‡ä»¤ã€‚</li><li>Native Interface(æœ¬åœ°æ¥å£)ï¼šä¸native librariesäº¤äº’ï¼Œæ˜¯å…¶å®ƒç¼–ç¨‹è¯­è¨€äº¤äº’çš„æ¥å£ã€‚</li><li>Runtime data area(è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ)ï¼šè¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„JVMçš„å†…å­˜ã€‚</li></ul><p><strong>ä½œç”¨</strong> ï¼šé¦–å…ˆé€šè¿‡ç¼–è¯‘å™¨æŠŠ Java ä»£ç è½¬æ¢æˆå­—èŠ‚ç ï¼Œç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰å†æŠŠå­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå°†å…¶æ”¾åœ¨è¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime data areaï¼‰çš„æ–¹æ³•åŒºå†…ï¼Œè€Œå­—èŠ‚ç æ–‡ä»¶åªæ˜¯ JVM çš„ä¸€å¥—æŒ‡ä»¤é›†è§„èŒƒï¼Œå¹¶ä¸èƒ½ç›´æ¥äº¤ç»™åº•å±‚æ“ä½œç³»ç»Ÿå»æ‰§è¡Œï¼Œå› æ­¤éœ€è¦ç‰¹å®šçš„å‘½ä»¤è§£æå™¨æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰ï¼Œå°†å­—èŠ‚ç ç¿»è¯‘æˆåº•å±‚ç³»ç»ŸæŒ‡ä»¤ï¼Œå†äº¤ç”± CPU å»æ‰§è¡Œï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è°ƒç”¨å…¶ä»–è¯­è¨€çš„æœ¬åœ°åº“æ¥å£ï¼ˆNative Interfaceï¼‰æ¥å®ç°æ•´ä¸ªç¨‹åºçš„åŠŸèƒ½ã€‚</p><h3 id="JVMçš„æ–¹æ³•åŒºå’Œæ°¸ä¹…å¸¦æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#JVMçš„æ–¹æ³•åŒºå’Œæ°¸ä¹…å¸¦æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="JVMçš„æ–¹æ³•åŒºå’Œæ°¸ä¹…å¸¦æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>JVMçš„æ–¹æ³•åŒºå’Œæ°¸ä¹…å¸¦æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3><p>ï¼ˆ1ï¼‰æ–¹æ³•åŒºæ˜¯è§„èŒƒå±‚é¢çš„ä¸œè¥¿ï¼Œè§„å®šäº†è¿™ä¸€ä¸ªåŒºåŸŸè¦å­˜æ”¾å“ªäº›ä¸œè¥¿</p><p>ï¼ˆ2ï¼‰æ°¸ä¹…å¸¦æˆ–è€…æ˜¯metaspaceæ˜¯å¯¹æ–¹æ³•åŒºçš„ä¸åŒå®ç°ï¼Œæ˜¯å®ç°å±‚é¢çš„ä¸œè¥¿ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£-PermGen-æ›¿æ¢ä¸ºå…ƒç©ºé—´-MetaSpace-å‘¢"><a href="#ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£-PermGen-æ›¿æ¢ä¸ºå…ƒç©ºé—´-MetaSpace-å‘¢" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£ (PermGen) æ›¿æ¢ä¸ºå…ƒç©ºé—´ (MetaSpace) å‘¢?"></a>ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£ (PermGen) æ›¿æ¢ä¸ºå…ƒç©ºé—´ (MetaSpace) å‘¢?</h3><ol><li><p>æ•´ä¸ªæ°¸ä¹…ä»£æœ‰ä¸€ä¸ª JVM æœ¬èº«è®¾ç½®å›ºå®šå¤§å°ä¸Šé™ï¼Œæ— æ³•è¿›è¡Œè°ƒæ•´ï¼Œè€Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ï¼Œå—æœ¬æœºå¯ç”¨å†…å­˜çš„é™åˆ¶ï¼Œè™½ç„¶å…ƒç©ºé—´ä»æ—§å¯èƒ½æº¢å‡ºï¼Œä½†æ˜¯æ¯”åŸæ¥å‡ºç°çš„å‡ ç‡ä¼šæ›´å°ã€‚é—´æ¥æ€§åœ°è§£å†³äº†æ°¸ä¹…ä»£çš„OOMé—®é¢˜ã€‚</p><pre><code>MetaspaceSizeï¼šåˆå§‹åŒ–å…ƒç©ºé—´å¤§å°ï¼Œæ§åˆ¶å‘ç”ŸGCMaxMetaspaceSizeï¼šé™åˆ¶å…ƒç©ºé—´å¤§å°ä¸Šé™ï¼Œé˜²æ­¢å ç”¨è¿‡å¤šç‰©ç†å†…å­˜ã€‚</code></pre></li><li><p>åœ¨ JDK8ï¼Œåˆå¹¶ HotSpot å’Œ JRockit çš„ä»£ç æ—¶, JRockit ä»æ¥æ²¡æœ‰ä¸€ä¸ªå«æ°¸ä¹…ä»£çš„ä¸œè¥¿, åˆå¹¶ä¹‹åå°±æ²¡æœ‰å¿…è¦é¢å¤–çš„è®¾ç½®è¿™ä¹ˆä¸€ä¸ªæ°¸ä¹…ä»£çš„åœ°æ–¹äº†ã€‚</p></li></ol><h3 id="CodeCache"><a href="#CodeCache" class="headerlink" title="CodeCache"></a>CodeCache</h3><h4 id="JITç®€ä»‹"><a href="#JITç®€ä»‹" class="headerlink" title="JITç®€ä»‹"></a>JITç®€ä»‹</h4><p>JITæ˜¯just in timeçš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯å³æ—¶ç¼–è¯‘ã€‚é€šè¿‡JITæŠ€æœ¯ï¼Œèƒ½å¤Ÿåšåˆ°Javaç¨‹åºæ‰§è¡Œé€Ÿåº¦çš„åŠ é€Ÿã€‚é‚£ä¹ˆï¼Œæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJavaæ˜¯ä¸€é—¨è§£é‡Šå‹è¯­è¨€ï¼ˆæˆ–è€…è¯´æ˜¯åŠç¼–è¯‘ï¼ŒåŠè§£é‡Šå‹è¯­è¨€ï¼‰ã€‚Javaé€šè¿‡ç¼–è¯‘å™¨javacå…ˆå°†æºç¨‹åºç¼–è¯‘æˆä¸å¹³å°æ— å…³çš„Javaå­—èŠ‚ç æ–‡ä»¶ï¼ˆ.classï¼‰ï¼Œå†ç”±JVMè§£é‡Šæ‰§è¡Œå­—èŠ‚ç æ–‡ä»¶ï¼Œä»è€Œåšåˆ°å¹³å°æ— å…³ã€‚ ä½†æ˜¯ï¼Œæœ‰åˆ©å¿…æœ‰å¼Šã€‚å¯¹å­—èŠ‚ç çš„è§£é‡Šæ‰§è¡Œè¿‡ç¨‹å®è´¨ä¸ºï¼š<strong>JVMå…ˆå°†å­—èŠ‚ç ç¿»è¯‘ä¸ºå¯¹åº”çš„æœºå™¨æŒ‡ä»¤ï¼Œç„¶åæ‰§è¡Œæœºå™¨æŒ‡ä»¤ã€‚</strong>å¾ˆæ˜¾ç„¶ï¼Œè¿™æ ·ç»è¿‡è§£é‡Šæ‰§è¡Œï¼Œå…¶æ‰§è¡Œé€Ÿåº¦å¿…ç„¶ä¸å¦‚ç›´æ¥æ‰§è¡ŒäºŒè¿›åˆ¶å­—èŠ‚ç æ–‡ä»¶ã€‚</p><p>è€Œä¸ºäº†æé«˜æ‰§è¡Œé€Ÿåº¦ï¼Œä¾¿å¼•å…¥äº† JIT æŠ€æœ¯ã€‚é€šè¿‡<code>çƒ­ç‚¹æ¢æµ‹</code>ï¼Œ<strong>å½“JVMå‘ç°æŸä¸ªæ–¹æ³•æˆ–ä»£ç å—è¿è¡Œç‰¹åˆ«é¢‘ç¹çš„æ—¶å€™ï¼Œå°±ä¼šè®¤ä¸ºè¿™æ˜¯â€œçƒ­ç‚¹ä»£ç â€ï¼ˆHot Spot Code)ã€‚ç„¶åJITä¼šæŠŠéƒ¨åˆ†â€œçƒ­ç‚¹ä»£ç â€ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç›¸å…³çš„æœºå™¨ç ï¼Œå¹¶è¿›è¡Œä¼˜åŒ–ï¼Œç„¶åå†æŠŠç¼–è¯‘åçš„æœºå™¨ç ç¼“å­˜èµ·æ¥ï¼Œä»¥å¤‡ä¸‹æ¬¡ä½¿ç”¨ã€‚</strong></p><p><strong><img alt="img" data-src="https://img-blog.csdnimg.cn/20190101150248567.PNG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0OTAyNjg0,size_16,color_FFFFFF,t_70" class="lazyload"></strong></p><p><code>codecache</code>ä»£ç ç¼“å­˜åŒº,ä¸»è¦å­˜æ”¾JITæ‰€ç¼–è¯‘çš„ä»£ç ,åŒæ—¶è¿˜æœ‰Javaæ‰€ä½¿ç”¨çš„æœ¬åœ°æ–¹æ³•ä»£ç ä¹Ÿä¼šå­˜å‚¨åœ¨codecacheä¸­.</p><p><code>ç›¸å…³å‚æ•°:</code></p><p><code>-XX:ReservedCodeCacheSize</code>  ï¼šè®¾ç½®codeCacheçš„sizeå¤§å°</p><p>ä¸€ç§æ¨èçš„è®¾ç½®æ€è·¯æ˜¯è®¾ç½®ä¸ºå½“å‰å€¼ï¼ˆæˆ–è€…é»˜è®¤å€¼ï¼‰çš„2å€ å¯¹äº64ä½jvmï¼Œç”±äºå†…å­˜ç©ºé—´è¶³å¤Ÿå¤§ï¼ŒcodeCacheè®¾ç½®çš„è¿‡å¤§ä¸ä¼šå¯¹åº”ç”¨äº§ç”Ÿæ˜æ˜¾å½±å“</p><p><code>-XX:+UseCodeCacheFlushing</code> ï¼šå¯ç”¨code cacheçš„å›æ”¶æœºåˆ¶ã€‚</p><ul><li>å½“codeCacheå°†è¦è€—å°½æ—¶ï¼Œæœ€æ—©è¢«ç¼–è¯‘çš„ä¸€åŠæ–¹æ³•å°†ä¼šè¢«æ”¾åˆ°ä¸€ä¸ªoldåˆ—è¡¨ä¸­ç­‰å¾…å›æ”¶,åœ¨ä¸€å®šæ—¶é—´é—´éš”å†…ï¼Œå¦‚æœæ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¢«ä»codeCacheå……æ¸…é™¤</li></ul><p>åœ¨jdk8ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªå¯åŠ¨å‚æ•°XX:+PrintCodeCacheåœ¨jvmåœæ­¢çš„æ—¶å€™æ‰“å°å‡ºcodeCacheçš„ä½¿ç”¨æƒ…å†µ</p><p>ç”±äºJITæ˜¯éšç€ä»£ç è¢«è°ƒç”¨çš„æ¬¡æ•°è¾¾åˆ°CompileThresholdä¹‹åè¿›è¡Œçš„ï¼Œå› æ­¤ï¼Œcodecacheä½¿ç”¨ä¹Ÿä¼šéšä¹‹å¢åŠ ï¼Œå¸¸è§çš„é—®é¢˜å°±æ˜¯ï¼Œéšç€æ—¶é—´çš„æ¨ç§»åº”ç”¨å ç”¨CPUä¼šéšä¹‹å¢é«˜ï¼Œè¯·æ±‚ç›¸åº”å˜æ…¢ç­‰é—®é¢˜ï¼Œè¿™æ—¶å°±éœ€è¦è€ƒè™‘codecacheçš„é—®é¢˜äº†ã€‚</p><h3 id="è¯´ä¸€ä¸‹-JVM-è¿è¡Œæ—¶æ•°æ®åŒº"><a href="#è¯´ä¸€ä¸‹-JVM-è¿è¡Œæ—¶æ•°æ®åŒº" class="headerlink" title="è¯´ä¸€ä¸‹ JVM è¿è¡Œæ—¶æ•°æ®åŒº"></a>è¯´ä¸€ä¸‹ JVM è¿è¡Œæ—¶æ•°æ®åŒº</h3><p><strong>Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œ Java ç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒæ‰€ç®¡ç†çš„å†…å­˜åŒºåŸŸåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸ</strong>ã€‚è¿™äº›åŒºåŸŸéƒ½æœ‰å„è‡ªçš„ç”¨é€”ï¼Œä»¥åŠåˆ›å»ºå’Œé”€æ¯çš„æ—¶é—´ï¼Œæœ‰äº›åŒºåŸŸéšç€è™šæ‹Ÿæœºè¿›ç¨‹çš„å¯åŠ¨è€Œå­˜åœ¨ï¼Œæœ‰äº›åŒºåŸŸåˆ™æ˜¯ä¾èµ–çº¿ç¨‹çš„å¯åŠ¨å’Œç»“æŸè€Œå»ºç«‹å’Œé”€æ¯ã€‚Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜è¢«åˆ’åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªåŒºåŸŸï¼š</p><p><img alt="image-20200610123657999" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn37yjhp4j30iq0czwh3.jpg" class="lazyload"></p><h4 id="åˆ†åˆ«ä»‹ç»"><a href="#åˆ†åˆ«ä»‹ç»" class="headerlink" title="åˆ†åˆ«ä»‹ç»"></a>åˆ†åˆ«ä»‹ç»</h4><ul><li><code>ç¨‹åºè®¡æ•°å™¨</code>ï¼šç¨‹åºè®¡æ•°å™¨å…¶å®å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘äº†æˆ‘ä»¬ç¨‹åºä¸­ä¸‹ä¸€å¥éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå®ƒä¹Ÿæ˜¯å†…å­˜åŒºåŸŸä¸­å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç°OutOfMemoryErrorçš„åŒºåŸŸï¼Œè€Œä¸”å ç”¨å†…å­˜ç©ºé—´å°åˆ°åŸºæœ¬å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚è¿™ä¸ªå†…å­˜ä»…ä»£è¡¨å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œå­—èŠ‚ç è§£æå™¨é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</li><li><code>è™šæ‹Ÿæœºæ ˆ</code>ï¼šç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ï¼›<ul><li>æ¯ä¸ªæ ˆå¸§éƒ½å­˜æ”¾ä»¥ä¸Š4ä¸ªä¿¡æ¯ï¼Œæ¯ä¸ªæ ˆå¸§æ˜¯ä¸€ä¸ª<strong>æ–¹æ³•</strong></li><li><strong>å±€éƒ¨å˜é‡è¡¨</strong>ï¼Œå­˜æ”¾å±€éƒ¨å˜é‡ï¼Œä¾‹å¦‚int a=2;</li><li><strong>æ“ä½œæ•°æ ˆ</strong>å­˜æ”¾å¸®åŠ©æ ˆå¸§è¿›è¡Œè¿ç®—çš„ä¸´æ—¶æ“ä½œæ•°ã€‚</li><li><strong>åŠ¨æ€é“¾æ¥</strong>ï¼šé€šè¿‡javapå‘½ä»¤æŸ¥çœ‹classæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šç¬¦å·å¼•ç”¨ï¼Œåœ¨ç±»åŠ è½½çš„è¿‡ç¨‹ï¼ˆé™æ€é“¾æ¥ï¼‰æˆ–è¿è¡Œè¿‡ç¨‹ä¼šå°†éƒ¨åˆ†ç¬¦å·å¼•ç”¨åœ¨è¿è¡ŒæœŸé—´è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ã€‚ç›´æ¥å¼•ç”¨å¯è¢«jvmé€šè¿‡å‘½ä»¤è°ƒç”¨ã€‚</li></ul></li><li><code>æœ¬åœ°æ–¹æ³•æ ˆ</code>ï¼šä¸è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è™šæ‹Ÿæœºæ ˆæ˜¯æœåŠ¡ Java æ–¹æ³•çš„ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºè™šæ‹Ÿæœºè°ƒç”¨ Native æ–¹æ³•æœåŠ¡çš„ï¼›</li><li><code>Javaå †</code>ï¼šJava è™šæ‹Ÿæœºä¸­å†…å­˜æœ€å¤§çš„ä¸€å—ï¼Œæ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ï¼›</li><li><code>æ–¹æ³•åŒº</code>ï¼šç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»å…ƒä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</li></ul><p><img alt="image-20200610124342656" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn3exp8l0j30he09uwfo.jpg" class="lazyload"></p><h4 id="Java-è™šæ‹Ÿæœºæ ˆä¼šå‡ºç°ä¸¤ç§é”™è¯¯ï¼š"><a href="#Java-è™šæ‹Ÿæœºæ ˆä¼šå‡ºç°ä¸¤ç§é”™è¯¯ï¼š" class="headerlink" title="Java è™šæ‹Ÿæœºæ ˆä¼šå‡ºç°ä¸¤ç§é”™è¯¯ï¼š"></a>Java è™šæ‹Ÿæœºæ ˆä¼šå‡ºç°ä¸¤ç§é”™è¯¯ï¼š</h4><p>StackOverFlowError å’Œ OutOfMemoryErrorã€‚</p><ul><li><strong>StackOverFlowErrorï¼š</strong> è‹¥ Java è™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡º StackOverFlowError é”™è¯¯ã€‚</li><li><strong>OutOfMemoryErrorï¼š</strong> è‹¥ Java è™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°å…è®¸åŠ¨æ€æ‰©å±•ï¼Œä¸”å½“çº¿ç¨‹è¯·æ±‚æ ˆæ—¶å†…å­˜ç”¨å®Œäº†ï¼Œæ— æ³•å†åŠ¨æ€æ‰©å±•äº†ï¼Œæ­¤æ—¶æŠ›å‡º OutOfMemoryError é”™è¯¯ã€‚</li></ul><p>Java è™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å„è‡ªçš„ Java è™šæ‹Ÿæœºæ ˆï¼Œè€Œä¸”éšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„æ­»äº¡è€Œæ­»äº¡ã€‚</p><h4 id="è™šæ‹Ÿæœºæ ˆå’Œè™šæ‹Ÿæœºå †åŒºåˆ«"><a href="#è™šæ‹Ÿæœºæ ˆå’Œè™šæ‹Ÿæœºå †åŒºåˆ«" class="headerlink" title="è™šæ‹Ÿæœºæ ˆå’Œè™šæ‹Ÿæœºå †åŒºåˆ«"></a>è™šæ‹Ÿæœºæ ˆå’Œè™šæ‹Ÿæœºå †åŒºåˆ«</h4><p>ä¸€å¥è¯ä¾¿æ˜¯ï¼šæ ˆç®¡è¿è¡Œï¼Œå †ç®¡å­˜å‚¨ã€‚åˆ™è™šæ‹Ÿæœºæ ˆè´Ÿè´£è¿è¡Œä»£ç ï¼Œè€Œè™šæ‹Ÿæœºå †è´Ÿè´£å­˜å‚¨æ•°æ®ã€‚</p><h3 id="Javaæ–‡ä»¶å®Œæ•´çš„åŠ è½½è¿è¡Œè¿‡ç¨‹"><a href="#Javaæ–‡ä»¶å®Œæ•´çš„åŠ è½½è¿è¡Œè¿‡ç¨‹" class="headerlink" title="Javaæ–‡ä»¶å®Œæ•´çš„åŠ è½½è¿è¡Œè¿‡ç¨‹"></a>Javaæ–‡ä»¶å®Œæ•´çš„åŠ è½½è¿è¡Œè¿‡ç¨‹</h3><p>ä¸€ä¸ªç®€å•çš„å­¦ç”Ÿç±» <a href="https://camo.githubusercontent.com/6349bcfb73fc5bbf962fdaab7546c381b828136a/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f32393034366137323163323534386530613036383065633562616634656139352d6e65772d696d61676562306234326535652d386532352d343039652d623762392d3635383661333961306238642e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/6349bcfb73fc5bbf962fdaab7546c381b828136a/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f32393034366137323163323534386530613036383065633562616634656139352d6e65772d696d61676562306234326535652d386532352d343039652d623762392d3635383661333961306238642e706e67" class="lazyload"></a></p><p>ä¸€ä¸ªmainæ–¹æ³• <a href="https://camo.githubusercontent.com/6c5bb22ea8dbc90158b3207d8fd602731a14b42a/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f61336433346433336561623734663666383734336563663632383037343435632d6e65772d696d61676530383530366139652d353130312d346633302d623062632d3361626263623866313839342e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/6c5bb22ea8dbc90158b3207d8fd602731a14b42a/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f61336433346433336561623734663666383734336563663632383037343435632d6e65772d696d61676530383530366139652d353130312d346633302d623062632d3361626263623866313839342e706e67" class="lazyload"></a></p><p>æ‰§è¡Œmainæ–¹æ³•çš„æ­¥éª¤å¦‚ä¸‹:</p><ol><li>ç¼–è¯‘å¥½ App.java åå¾—åˆ° App.class åï¼Œæ‰§è¡Œ App.classï¼Œç³»ç»Ÿä¼šå¯åŠ¨ä¸€ä¸ª JVM è¿›ç¨‹ï¼Œä» classpath è·¯å¾„ä¸­æ‰¾åˆ°ä¸€ä¸ªåä¸º App.class çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°† App çš„ç±»ä¿¡æ¯åŠ è½½åˆ°è¿è¡Œæ—¶æ•°æ®åŒºçš„æ–¹æ³•åŒºå†…ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš App ç±»çš„åŠ è½½</li><li>JVM æ‰¾åˆ° App çš„ä¸»ç¨‹åºå…¥å£ï¼Œæ‰§è¡Œmainæ–¹æ³•</li><li>è¿™ä¸ªmainä¸­çš„ç¬¬ä¸€æ¡è¯­å¥ä¸º Student student = new Student(â€œtellUrDreamâ€) ï¼Œå°±æ˜¯è®© JVM åˆ›å»ºä¸€ä¸ªStudentå¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™æ–¹æ³•åŒºä¸­æ˜¯æ²¡æœ‰ Student ç±»çš„ä¿¡æ¯çš„ï¼Œæ‰€ä»¥ JVM é©¬ä¸ŠåŠ è½½ Student ç±»ï¼ŒæŠŠ Student ç±»çš„ä¿¡æ¯æ”¾åˆ°æ–¹æ³•åŒºä¸­</li><li>åŠ è½½å®Œ Student ç±»åï¼ŒJVM åœ¨å †ä¸­ä¸ºä¸€ä¸ªæ–°çš„ Student å®ä¾‹åˆ†é…å†…å­˜ï¼Œç„¶åè°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ– Student å®ä¾‹ï¼Œè¿™ä¸ª Student å®ä¾‹æŒæœ‰ <strong>æŒ‡å‘æ–¹æ³•åŒºä¸­çš„ Student ç±»çš„å…ƒä¿¡æ¯</strong> çš„å¼•ç”¨</li><li>æ‰§è¡Œstudent.sayName();æ—¶ï¼ŒJVM æ ¹æ® student çš„å¼•ç”¨æ‰¾åˆ° student å¯¹è±¡ï¼Œç„¶åæ ¹æ® student å¯¹è±¡æŒæœ‰çš„å¼•ç”¨å®šä½åˆ°æ–¹æ³•åŒºä¸­ student ç±»çš„ç±»å‹ä¿¡æ¯çš„æ–¹æ³•è¡¨ï¼Œè·å¾— sayName() çš„å­—èŠ‚ç åœ°å€ã€‚</li><li>æ‰§è¡ŒsayName()</li></ol><p>å…¶å®ä¹Ÿä¸ç”¨ç®¡å¤ªå¤šï¼Œåªéœ€è¦çŸ¥é“å¯¹è±¡å®ä¾‹åˆå§‹åŒ–æ—¶ä¼šå»æ–¹æ³•åŒºä¸­æ‰¾ç±»ä¿¡æ¯ï¼Œå®Œæˆåå†åˆ°æ ˆé‚£é‡Œå»è¿è¡Œæ–¹æ³•ã€‚æ‰¾æ–¹æ³•å°±åœ¨æ–¹æ³•è¡¨ä¸­æ‰¾ã€‚</p><h2 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h2><p>ä¹‹å‰ä¹Ÿæåˆ°äº†å®ƒæ˜¯è´Ÿè´£åŠ è½½.classæ–‡ä»¶çš„ï¼Œå®ƒä»¬åœ¨æ–‡ä»¶å¼€å¤´ä¼šæœ‰ç‰¹å®šçš„æ–‡ä»¶æ ‡ç¤ºï¼Œå°†classæ–‡ä»¶å­—èŠ‚ç å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†è¿™äº›å†…å®¹è½¬æ¢æˆæ–¹æ³•åŒºä¸­çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”ClassLoaderåªè´Ÿè´£classæ–‡ä»¶çš„åŠ è½½ï¼Œè€Œæ˜¯å¦èƒ½å¤Ÿè¿è¡Œåˆ™ç”± Execution Engine æ¥å†³å®š</p><h3 id="ç±»åŠ è½½å™¨çš„æµç¨‹ï¼ˆåŠ æ ¡å‡†è§£åˆä½¿å¸ï¼‰"><a href="#ç±»åŠ è½½å™¨çš„æµç¨‹ï¼ˆåŠ æ ¡å‡†è§£åˆä½¿å¸ï¼‰" class="headerlink" title="ç±»åŠ è½½å™¨çš„æµç¨‹ï¼ˆåŠ æ ¡å‡†è§£åˆä½¿å¸ï¼‰"></a>ç±»åŠ è½½å™¨çš„æµç¨‹ï¼ˆåŠ æ ¡å‡†è§£åˆä½¿å¸ï¼‰</h3><p>ä»ç±»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°é‡Šæ”¾å†…å­˜æ€»å…±æœ‰7ä¸ªæ­¥éª¤ï¼šåŠ è½½ï¼Œæ ¡éªŒï¼Œå‡†å¤‡ï¼Œè§£æï¼Œåˆå§‹åŒ–ï¼Œä½¿ç”¨ï¼Œå¸è½½ã€‚å…¶ä¸­<strong>éªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥</strong></p><h4 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h4><ol><li>å°†classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜</li><li>å°†é™æ€æ•°æ®ç»“æ„è½¬åŒ–æˆæ–¹æ³•åŒºä¸­è¿è¡Œæ—¶çš„æ•°æ®ç»“æ„</li><li>åœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ java.lang.Classå¯¹è±¡ä½œä¸ºæ•°æ®è®¿é—®çš„å…¥å£</li></ol><h4 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h4><ol><li>éªŒè¯ï¼šç¡®ä¿åŠ è½½çš„ç±»ç¬¦åˆ JVM è§„èŒƒå’Œå®‰å…¨ï¼Œä¿è¯è¢«æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºçš„äº‹ä»¶ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå®‰å…¨æ£€æŸ¥</li><li>å‡†å¤‡ï¼šä¸ºstaticå˜é‡åœ¨æ–¹æ³•åŒºä¸­åˆ†é…å†…å­˜ç©ºé—´ï¼Œè®¾ç½®å˜é‡çš„åˆå§‹å€¼ï¼Œä¾‹å¦‚ static int a = 3 ï¼ˆæ³¨æ„ï¼šå‡†å¤‡é˜¶æ®µåªè®¾ç½®ç±»ä¸­çš„é™æ€å˜é‡ï¼ˆæ–¹æ³•åŒºä¸­ï¼‰ï¼Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼ˆå †å†…å­˜ä¸­ï¼‰ï¼Œå®ä¾‹å˜é‡æ˜¯å¯¹è±¡åˆå§‹åŒ–æ—¶èµ‹å€¼çš„ï¼‰ï¼Œä½†è¿™é‡Œåªæ˜¯èµ‹å€¼ä¸ºint a=0ï¼Œå³æ ¹æ®æ•°æ®ç±»å‹ç¬¦é»˜è®¤å€¼ã€‚</li><li>è§£æï¼šè™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„<strong>ç¬¦å·å¼•ç”¨</strong>æ›¿æ¢ä¸º<strong>ç›´æ¥å¼•ç”¨</strong>çš„è¿‡ç¨‹ï¼ˆç¬¦å·å¼•ç”¨æ¯”å¦‚æˆ‘ç°åœ¨import java.util.ArrayListè¿™å°±ç®—ç¬¦å·å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨å°±æ˜¯æŒ‡é’ˆæˆ–è€…å¯¹è±¡åœ°å€ï¼Œæ³¨æ„å¼•ç”¨å¯¹è±¡ä¸€å®šæ˜¯åœ¨å†…å­˜è¿›è¡Œï¼‰</li></ol><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>åˆå§‹åŒ–å…¶å®å°±æ˜¯ä¸€ä¸ªèµ‹å€¼çš„æ“ä½œï¼Œå®ƒä¼šæ‰§è¡Œä¸€ä¸ªç±»æ„é€ å™¨çš„<clinit>()æ–¹æ³•ã€‚ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­æ‰€æœ‰å˜é‡çš„èµ‹å€¼åŠ¨ä½œï¼Œæ­¤æ—¶å‡†å¤‡é˜¶æ®µæ—¶çš„é‚£ä¸ª static int a = 3 çš„ä¾‹å­ï¼Œåœ¨è¿™ä¸ªæ—¶å€™å°±æ­£å¼èµ‹å€¼ä¸º3</clinit></p><h4 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h4><p>GCå°†æ— ç”¨å¯¹è±¡ä»å†…å­˜ä¸­å¸è½½</p><h3 id="ç±»åŠ è½½å™¨çš„åŠ è½½é¡ºåº"><a href="#ç±»åŠ è½½å™¨çš„åŠ è½½é¡ºåº" class="headerlink" title="ç±»åŠ è½½å™¨çš„åŠ è½½é¡ºåº"></a>ç±»åŠ è½½å™¨çš„åŠ è½½é¡ºåº</h3><p>åŠ è½½ä¸€ä¸ªClassç±»çš„é¡ºåºä¹Ÿæ˜¯æœ‰ä¼˜å…ˆçº§çš„ï¼Œç±»åŠ è½½å™¨ä»æœ€åº•å±‚å¼€å§‹å¾€ä¸Šçš„é¡ºåºæ˜¯è¿™æ ·çš„</p><ol><li>å¯åŠ¨ç±»åŠ è½½å™¨ï¼šBootStrap ClassLoaderï¼šrt.jar</li><li>æ‹“å±•ç±»åŠ è½½å™¨ï¼šExtention ClassLoader: åŠ è½½æ‰©å±•çš„jaråŒ…</li><li>åº”ç”¨ç±»åŠ è½½å™¨ï¼šApp ClassLoaderï¼šæŒ‡å®šçš„classpathä¸‹é¢çš„jaråŒ…</li><li>è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼šCustom ClassLoader</li></ol><h3 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h3><p>å½“ä¸€ä¸ªç±»æ”¶åˆ°äº†åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒæ˜¯ä¸ä¼šå…ˆè‡ªå·±å»å°è¯•åŠ è½½çš„ï¼Œè€Œæ˜¯å§”æ´¾ç»™çˆ¶ç±»å»å®Œæˆï¼Œæ¯”å¦‚æˆ‘ç°åœ¨è¦newä¸€ä¸ªPersonï¼Œè¿™ä¸ªPersonæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ï¼Œå¦‚æœæˆ‘ä»¬è¦åŠ è½½å®ƒï¼Œå°±ä¼šå…ˆå§”æ´¾App ClassLoaderï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨éƒ½åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªè¯·æ±‚ï¼ˆä¹Ÿå°±æ˜¯çˆ¶ç±»åŠ è½½å™¨éƒ½æ²¡æœ‰æ‰¾åˆ°åŠ è½½æ‰€éœ€çš„Classï¼‰æ—¶ï¼Œå­ç±»åŠ è½½å™¨æ‰ä¼šè‡ªè¡Œå°è¯•åŠ è½½</p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼ŒåŠ è½½ä½äºrt.jaråŒ…ä¸­çš„ç±»æ—¶ä¸ç®¡æ˜¯å“ªä¸ªåŠ è½½å™¨åŠ è½½ï¼Œæœ€ç»ˆéƒ½ä¼šå§”æ‰˜åˆ°BootStrap ClassLoaderè¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·ä¿è¯äº†ä½¿ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨å¾—åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªç»“æœã€‚</p><p>å…¶å®è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªéš”ç¦»çš„ä½œç”¨ï¼Œé¿å…äº†æˆ‘ä»¬çš„ä»£ç å½±å“äº†JDKçš„ä»£ç ã€‚</p><h3 id="è‡ªå®šä¹‰ClassLoader"><a href="#è‡ªå®šä¹‰ClassLoader" class="headerlink" title="è‡ªå®šä¹‰ClassLoader"></a>è‡ªå®šä¹‰ClassLoader</h3><h4 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h4><p>Javaç±»åŠ è½½æœºåˆ¶çš„å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„ClassLoaderï¼Œè‡ªå®šä¹‰ClassLoaderæ˜¯Tomcatå®ç°åº”ç”¨éš”ç¦»ã€æ”¯æŒJSPï¼ŒOSGIå®ç°åŠ¨æ€æ¨¡å—åŒ–çš„åŸºç¡€ã€‚ </p><p>æ€ä¹ˆè‡ªå®šä¹‰å‘¢ï¼Ÿä¸€èˆ¬è€Œè¨€ï¼Œç»§æ‰¿ç±»ClassLoaderï¼Œé‡å†™findClasså°±å¯ä»¥äº†ã€‚æ€ä¹ˆå®ç°findClasså‘¢ï¼Ÿä½¿ç”¨è‡ªå·±çš„é€»è¾‘å¯»æ‰¾classæ–‡ä»¶å­—èŠ‚ç çš„å­—èŠ‚å½¢å¼ï¼Œæ‰¾åˆ°åï¼Œä½¿ç”¨å¦‚ä¸‹æ–¹æ³•è½¬æ¢ä¸ºClasså¯¹è±¡ï¼š</p><p>protected final Class&lt;?&gt; defineClass(String name, byte[] b, int off, int len)</p><p>nameè¡¨ç¤ºç±»åï¼Œbæ˜¯å­˜æ”¾å­—èŠ‚ç æ•°æ®çš„å­—èŠ‚æ•°ç»„ï¼Œæœ‰æ•ˆæ•°æ®ä»offå¼€å§‹ï¼Œé•¿åº¦ä¸ºlenã€‚</p><p>çœ‹ä¸ªä¾‹å­ï¼š</p><pre><code class="java">    public class MyClassLoader extends ClassLoader {    private static final String BASE_DIR = &quot;data/c87/&quot;;    @Override    protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException {        String fileName = name.replaceAll(&quot;\\.&quot;, &quot;/&quot;);        fileName = BASE_DIR + fileName + &quot;.class&quot;;        try {            byte[] bytes = BinaryFileUtils.readFileToByteArray(fileName);            return defineClass(name, bytes, 0, bytes.length);        } catch (IOException ex) {            throw new ClassNotFoundException(&quot;failed to load class &quot; + name, ex);        }    }}</code></pre><p>MyClassLoaderä»BASE_DIRä¸‹çš„è·¯å¾„ä¸­åŠ è½½ç±»ï¼Œè½¬æ¢ä¸ºbyteæ•°ç»„ã€‚MyClassLoaderæ²¡æœ‰æŒ‡å®šçˆ¶ClassLoaderï¼Œé»˜è®¤æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œå³ClassLoader.getSystemClassLoader()çš„è¿”å›å€¼ï¼Œä¸è¿‡ï¼ŒClassLoaderæœ‰ä¸€ä¸ªå¯é‡å†™çš„æ„é€ æ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®šçˆ¶ClassLoaderï¼šprotected ClassLoader(ClassLoader parent) </p><h4 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h4><p>è¿™åˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><ul><li>å¯ä»¥å®ç°<code>éš”ç¦»</code>ï¼Œä¸€ä¸ªå¤æ‚çš„ç¨‹åºï¼Œå†…éƒ¨å¯èƒ½æŒ‰æ¨¡å—ç»„ç»‡ï¼Œä¸åŒæ¨¡å—å¯èƒ½ä½¿ç”¨åŒä¸€ä¸ªç±»ï¼Œä½†ä½¿ç”¨çš„æ˜¯ä¸åŒç‰ˆæœ¬ï¼Œå¦‚æœä½¿ç”¨åŒä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œå®ƒä»¬æ˜¯æ— æ³•å…±å­˜çš„ï¼Œä¸åŒæ¨¡å—ä½¿ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨å°±å¯ä»¥å®ç°éš”ç¦»ï¼ŒTomcatä½¿ç”¨å®ƒéš”ç¦»ä¸åŒçš„Webåº”ç”¨ï¼ŒOSGIä½¿ç”¨å®ƒéš”ç¦»ä¸åŒæ¨¡å—ã€‚</li><li>å¯ä»¥å®ç°<code>çƒ­éƒ¨ç½²</code>ï¼Œä½¿ç”¨åŒä¸€ä¸ªClassLoaderï¼Œç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼ŒåŠ è½½åï¼Œå³ä½¿classæ–‡ä»¶å·²ç»å˜äº†ï¼Œå†æ¬¡åŠ è½½ï¼Œå¾—åˆ°çš„ä¹Ÿè¿˜æ˜¯åŸæ¥çš„Classå¯¹è±¡ï¼Œè€Œä½¿ç”¨MyClassLoaderï¼Œåˆ™å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ClassLoaderï¼Œå†ç”¨å®ƒåŠ è½½Classï¼Œå¾—åˆ°çš„Classå¯¹è±¡å°±æ˜¯æ–°çš„ï¼Œä»è€Œå®ç°åŠ¨æ€æ›´æ–°ã€‚</li></ul><h2 id="è™šæ‹Ÿæœºå †"><a href="#è™šæ‹Ÿæœºå †" class="headerlink" title="è™šæ‹Ÿæœºå †"></a>è™šæ‹Ÿæœºå †</h2><h3 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h3><p><img alt="image-20200812110120377" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghnuhus4w6j316h0kh446.jpg" class="lazyload"></p><p>â€‹        JVMå†…å­˜ä¼šåˆ’åˆ†ä¸ºå †å†…å­˜å’Œéå †å†…å­˜ï¼Œå †å†…å­˜ä¸­ä¹Ÿä¼šåˆ’åˆ†ä¸º<strong>å¹´è½»ä»£</strong>å’Œ<strong>è€å¹´ä»£</strong>ï¼Œé»˜è®¤æ¯”ä¾‹æ˜¯1:2ï¼Œè€Œéå †å†…å­˜åˆ™ä¸º<strong>æ°¸ä¹…ä»£</strong>ï¼ˆï¼‰ã€‚å¹´è½»ä»£åˆä¼šåˆ†ä¸º<strong>Eden</strong>å’Œ<strong>Survivor</strong>åŒºã€‚Survivorä¹Ÿä¼šåˆ†ä¸º<strong>FromPlace</strong>å’Œ<strong>ToPlace</strong>ï¼ŒtoPlaceçš„survivoråŒºåŸŸæ˜¯ç©ºçš„ã€‚Edenï¼ŒFromPlaceå’ŒToPlaceçš„é»˜è®¤å æ¯”ä¸º <strong>8:1:1</strong>ã€‚</p><h3 id="åƒåœ¾å›æ”¶çš„è¿‡ç¨‹"><a href="#åƒåœ¾å›æ”¶çš„è¿‡ç¨‹" class="headerlink" title="åƒåœ¾å›æ”¶çš„è¿‡ç¨‹"></a>åƒåœ¾å›æ”¶çš„è¿‡ç¨‹</h3><ol><li><p>å½“æˆ‘ä»¬newä¸€ä¸ªå¯¹è±¡åï¼Œä¼šå…ˆæ”¾åˆ°<strong>Eden</strong>åˆ’åˆ†å‡ºæ¥çš„ä¸€å—ä½œä¸ºå­˜å‚¨ç©ºé—´çš„å†…å­˜ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å¯¹å †å†…å­˜æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ªå¯¹è±¡å…±ç”¨ä¸€ä¸ªå†…å­˜çš„æƒ…å†µã€‚è¿™é‡ŒJVMçš„å¤„ç†æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½ä¼š<strong>é¢„å…ˆç”³è¯·</strong>å¥½ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´å¹¶è§„å®šäº†å¯¹è±¡å­˜æ”¾çš„ä½ç½®ã€‚</p></li><li><p>å½“Edenç©ºé—´æ»¡äº†ä¹‹åï¼Œä¼šè§¦å‘ä¸€ä¸ªå«åš<code>Minor GC</code>ï¼ˆå°±æ˜¯ä¸€ä¸ªå‘ç”Ÿåœ¨å¹´è½»ä»£çš„GCï¼‰çš„æ“ä½œï¼Œå­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ç§»åŠ¨åˆ°Survivor0åŒºã€‚Survivor0åŒºæ»¡åè§¦å‘ <code>Minor GC</code>ï¼Œå°±ä¼šå°†å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°Survivor1åŒºï¼Œæ­¤æ—¶è¿˜ä¼šæŠŠfromå’Œtoä¸¤ä¸ªæŒ‡é’ˆäº¤æ¢ï¼Œè¿™æ ·ä¿è¯äº†ä¸€æ®µæ—¶é—´å†…æ€»æœ‰ä¸€ä¸ªsurvivoråŒºä¸ºç©ºä¸”toæ‰€æŒ‡å‘çš„survivoråŒºä¸ºç©ºã€‚</p></li><li><p>ç»è¿‡å¤šæ¬¡çš„ Minor GCåä»ç„¶å­˜æ´»çš„å¯¹è±¡ï¼ˆ<strong>è¿™é‡Œçš„å­˜æ´»åˆ¤æ–­æ˜¯15æ¬¡ï¼Œå¯¹åº”è™šæ‹Ÿæœºå‚æ•°XX:MaxTenuringThreshold ã€‚ä¸ºä»€ä¹ˆæ˜¯15ï¼Œå› ä¸ºHotSpotä¼šåœ¨å¯¹è±¡æŠ•ä¸­çš„æ ‡è®°å­—æ®µé‡Œè®°å½•å¹´é¾„ï¼Œåˆ†é…åˆ°çš„ç©ºé—´ä»…æœ‰4ä½ï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½è®°å½•åˆ°15</strong>ï¼‰ä¼šç§»åŠ¨åˆ°è€å¹´ä»£ã€‚</p></li><li><p>è€å¹´ä»£æ˜¯å­˜å‚¨é•¿æœŸå­˜æ´»çš„å¯¹è±¡çš„ï¼Œå æ»¡æ—¶å°±ä¼šè§¦å‘æˆ‘ä»¬æœ€å¸¸å¬è¯´çš„Full GCï¼ŒæœŸé—´ä¼šåœæ­¢æ‰€æœ‰çº¿ç¨‹ç­‰å¾…GCçš„å®Œæˆã€‚æ‰€ä»¥å¯¹äºå“åº”è¦æ±‚é«˜çš„åº”ç”¨åº”è¯¥å°½é‡å»å‡å°‘å‘ç”ŸFull GCä»è€Œé¿å…å“åº”è¶…æ—¶çš„é—®é¢˜ã€‚</p></li><li><p>å½“è€å¹´åŒºæ‰§è¡Œäº†full gcä¹‹åä»ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡ä¿å­˜çš„æ“ä½œï¼Œå°±ä¼šäº§ç”ŸOOMï¼Œè¿™æ—¶å€™å°±æ˜¯è™šæ‹Ÿæœºä¸­çš„å †å†…å­˜ä¸è¶³ï¼ŒåŸå› å¯èƒ½ä¼šæ˜¯<strong>å †å†…å­˜è®¾ç½®çš„å¤§å°è¿‡å°</strong>ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡å‚æ•°-Xmsã€-Xmxæ¥è°ƒæ•´ã€‚ä¹Ÿå¯èƒ½æ˜¯ä»£ç ä¸­åˆ›å»ºçš„<strong>å¯¹è±¡å¤§ä¸”å¤š</strong>ï¼Œè€Œä¸”å®ƒä»¬ä¸€ç›´åœ¨<strong>è¢«å¼•ç”¨</strong>ä»è€Œé•¿æ—¶é—´åƒåœ¾æ”¶é›†æ— æ³•æ”¶é›†å®ƒä»¬ã€‚JVMé»˜è®¤ä½¿ç”¨ç³»ç»Ÿå†…å­˜çš„1/4ã€‚</p></li></ol><p><a href="https://camo.githubusercontent.com/3c6ec61a270148e9f2bea602bce6998d8aa31bde/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f63303265636261336333336634333432396137363539383762393238653432332d6e65772d696d61676539336234366633642d333366392d343666392d613832352d6563373132396230303466362e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/3c6ec61a270148e9f2bea602bce6998d8aa31bde/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f63303265636261336333336634333432396137363539383762393238653432332d6e65772d696d61676539336234366633642d333366392d343666392d613832352d6563373132396230303466362e706e67" class="lazyload"></a></p><h3 id="åŠ¨æ€å¹´é¾„åˆ¤æ–­"><a href="#åŠ¨æ€å¹´é¾„åˆ¤æ–­" class="headerlink" title="åŠ¨æ€å¹´é¾„åˆ¤æ–­"></a>åŠ¨æ€å¹´é¾„åˆ¤æ–­</h3><p>â€‹        ä¸€å¥è¯ï¼šå½“æŸå¹´é¾„åœ¨survivoråŒºå æ¯”è¶…è¿‡é¢„è®¾å€¼æ—¶ï¼Œå¤§äºç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡ä¼šç›´æ¥è¿›è¡Œè€å¹´ä»£ï¼Œæ— éœ€ç­‰åˆ°MaxTenuringThresholdä¸­è¦æ±‚çš„15ã€‚</p><p>â€‹        è®¾å®šçš„å‚æ•°ä¸ºï¼š-XX:TargetSurvivorRatio</p><h3 id="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡éœ€è¦è¢«å¹²æ‰"><a href="#å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡éœ€è¦è¢«å¹²æ‰" class="headerlink" title="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡éœ€è¦è¢«å¹²æ‰"></a>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡éœ€è¦è¢«å¹²æ‰</h3><p><a href="https://camo.githubusercontent.com/29dbca08b9255c2e71c234dcf599ed0d93e90c81/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f31633164383562356662386234373233396166326135633034333665623264372d6e65772d696d61676530636431303832372d326639362d343333632d396231362d3933643466653439316438382e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/29dbca08b9255c2e71c234dcf599ed0d93e90c81/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f31633164383562356662386234373233396166326135633034333665623264372d6e65772d696d61676530636431303832372d326639362d343333632d396231362d3933643466653439316438382e706e67" class="lazyload"></a></p><p>â€‹        ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆï¼Œ3ä¸ªåŒºåŸŸéšç€çº¿ç¨‹çš„ç”Ÿå­˜è€Œç”Ÿå­˜çš„ã€‚å†…å­˜åˆ†é…å’Œå›æ”¶éƒ½æ˜¯ç¡®å®šçš„ã€‚éšç€çº¿ç¨‹çš„ç»“æŸå†…å­˜è‡ªç„¶å°±è¢«å›æ”¶äº†ï¼Œå› æ­¤ä¸éœ€è¦è€ƒè™‘åƒåœ¾å›æ”¶çš„é—®é¢˜ã€‚è€ŒJavaå †å’Œæ–¹æ³•åŒºåˆ™ä¸ä¸€æ ·ï¼Œå„çº¿ç¨‹å…±äº«ï¼Œå†…å­˜çš„åˆ†é…å’Œå›æ”¶éƒ½æ˜¯åŠ¨æ€çš„ã€‚å› æ­¤åƒåœ¾æ”¶é›†å™¨æ‰€å…³æ³¨çš„éƒ½æ˜¯å †å’Œæ–¹æ³•è¿™éƒ¨åˆ†å†…å­˜ã€‚</p><p>åœ¨è¿›è¡Œå›æ”¶å‰å°±è¦åˆ¤æ–­å“ªäº›å¯¹è±¡è¿˜å­˜æ´»ï¼Œå“ªäº›å·²ç»æ­»å»ã€‚ä¸‹é¢ä»‹ç»ä¸¤ä¸ªåŸºç¡€çš„è®¡ç®—æ–¹æ³•ï¼š</p><p>1.<code>å¼•ç”¨è®¡æ•°å™¨</code>ï¼šç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯æ¬¡å¼•ç”¨è¿™ä¸ªå¯¹è±¡æ—¶è®¡æ•°å™¨åŠ ä¸€ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶å‡ä¸€ï¼Œè®¡æ•°å™¨ç­‰äº0æ—¶å°±æ˜¯ä¸ä¼šå†æ¬¡ä½¿ç”¨çš„ã€‚ä¸è¿‡è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯å‡ºç°å¯¹è±¡çš„å¾ªç¯å¼•ç”¨æ—¶GCæ²¡æ³•å›æ”¶ã€‚</p><p>2.<code>å¯è¾¾æ€§åˆ†æ</code>ï¼šè¿™æ˜¯ä¸€ç§ç±»ä¼¼äºäºŒå‰æ ‘çš„å®ç°ï¼Œå°†ä¸€ç³»åˆ—çš„GC ROOTSä½œä¸ºèµ·å§‹çš„å­˜æ´»å¯¹è±¡é›†ï¼Œä»è¿™ä¸ªèŠ‚ç‚¹å¾€ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„æˆä¸ºå¼•ç”¨é“¾ï¼ŒæŠŠèƒ½è¢«è¯¥é›†åˆå¼•ç”¨åˆ°çš„å¯¹è±¡åŠ å…¥åˆ°é›†åˆä¸­ã€‚æœç´¢å½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä½¿ç”¨ä»»ä½•å¼•ç”¨é“¾æ—¶ï¼Œåˆ™è¯´æ˜è¯¥å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚</p><p><code>èƒ½ä½œä¸ºGC Rootsçš„å¯¹è±¡åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</code></p><ol><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆå±€éƒ¨å˜é‡ï¼‰</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­é™æ€å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡å’Œå¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼ˆé™æ€å˜é‡ï¼‰</li></ol><p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿè§£å†³<strong>å¾ªç¯å¼•ç”¨</strong>çš„é—®é¢˜ï¼Œå¯å®ƒçš„å®ç°éœ€è¦è€—è´¹å¤§é‡èµ„æºå’Œæ—¶é—´ï¼Œä¹Ÿéœ€è¦GCï¼ˆå®ƒçš„åˆ†æè¿‡ç¨‹å¼•ç”¨å…³ç³»ä¸èƒ½å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦åœæ­¢æ‰€æœ‰è¿›ç¨‹ï¼‰</p><h3 id="å¦‚ä½•å®£å‘Šä¸€ä¸ªå¯¹è±¡çš„çœŸæ­£æ­»äº¡"><a href="#å¦‚ä½•å®£å‘Šä¸€ä¸ªå¯¹è±¡çš„çœŸæ­£æ­»äº¡" class="headerlink" title="å¦‚ä½•å®£å‘Šä¸€ä¸ªå¯¹è±¡çš„çœŸæ­£æ­»äº¡"></a>å¦‚ä½•å®£å‘Šä¸€ä¸ªå¯¹è±¡çš„çœŸæ­£æ­»äº¡</h3><p>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„æ­»äº¡è‡³å°‘éœ€è¦ä¸¤æ¬¡æ ‡è®°</p><ol><li>å¦‚æœå¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æä¹‹åæ²¡å‘ç°ä¸GC Rootsç›¸è¿çš„å¼•ç”¨é“¾ï¼Œé‚£å®ƒå°†ä¼šç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ã€‚åˆ¤æ–­çš„æ¡ä»¶æ˜¯å†³å®šè¿™ä¸ªå¯¹è±¡æ˜¯å¦é‡å†™äº†finalize()æ–¹æ³•ã€‚å¦‚æœå¯¹è±¡é‡å†™äº†finalize()æ–¹æ³•ï¼Œåˆ™è¢«æ”¾å…¥F-Queueé˜Ÿåˆ—ä¸­ã€‚</li><li>GCå¯¹F-Queueé˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡ŒäºŒæ¬¡æ ‡è®°ã€‚å¦‚æœå¯¹è±¡åœ¨finalize()æ–¹æ³•ä¸­é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹äº†å…³è”ï¼Œé‚£ä¹ˆäºŒæ¬¡æ ‡è®°æ—¶åˆ™ä¼šå°†å®ƒç§»å‡ºâ€œå³å°†å›æ”¶â€é›†åˆã€‚å¦‚æœæ­¤æ—¶å¯¹è±¡è¿˜æ²¡æˆåŠŸé€ƒè„±ï¼Œé‚£ä¹ˆåªèƒ½è¢«å›æ”¶äº†ã€‚</li></ol><h3 id="é€ƒé€¸åˆ†æ"><a href="#é€ƒé€¸åˆ†æ" class="headerlink" title="é€ƒé€¸åˆ†æ"></a>é€ƒé€¸åˆ†æ</h3><p><img alt="image-20200610210559246" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfnhxjqulej30j607sdjv.jpg" class="lazyload"></p><p>ä¾‹å¦‚ï¼š</p><p>å¼€å¯é€ƒé€¸åˆ†æåtest2ä¸­çš„userå¯¹è±¡ï¼Œç›´æ¥åœ¨æ ˆå†…å­˜ä¸­åˆ›å»ºï¼Œå½“æ–¹æ³•å®Œæˆåç›´æ¥è¢«åƒåœ¾å›æ”¶ã€‚jdk7ä»¥åé»˜è®¤å¼€å¯é€ƒé€¸åˆ†æã€‚</p><p><img alt="image-20200610210625390" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfnhy0h9yyj309m09yzlk.jpg" class="lazyload"></p><h2 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h2><p>å¸¸ç”¨çš„æœ‰æ ‡è®°æ¸…é™¤ï¼Œå¤åˆ¶ï¼Œæ ‡è®°æ•´ç†å’Œåˆ†ä»£æ”¶é›†ç®—æ³•</p><h3 id="å¤åˆ¶ç®—æ³•"><a href="#å¤åˆ¶ç®—æ³•" class="headerlink" title="å¤åˆ¶ç®—æ³•"></a>å¤åˆ¶ç®—æ³•</h3><p>Hotspot JVMæŠŠå¹´è½»ä»£åˆ†ä¸ºäº†ä¸‰éƒ¨åˆ†:1ä¸ªEdenåŒºå’Œ2ä¸ª SurvivoråŒº(åˆ†åˆ«å«fromå’Œto),é»˜è®¤æ¯”ä¾‹ä¸º8:1:1,ä¸€èˆ¬æƒ…å†µä¸‹ æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åˆ°EdenåŒº(ä¸€äº›å¤§å¯¹è±¡ç‰¹æ®Šå¤„ç†),è¿™äº›å¯¹è±¡ç»è¿‡ç¬¬ä¸€æ¬¡ Minor gcå,å¦‚æœä»ç„¶å­˜æ´»,å°†ä¼šè¢«ç§»åˆ° SurvivoråŒºã€‚å¯¹è±¡åœ¨ SurvivoråŒºä¸­æ¯ç†¬è¿‡ä¸€æ¬¡ Minor gc,å¹´é½¡å°±ä¼šå¢åŠ 1å²,å½“å®ƒçš„å¹´é½¡(15é»˜è®¤)å¢åŠ åˆ°ä¸€å®šç¨‹åº¦æ—¶,å°±ä¼šè¢«ç§»åŠ¨åˆ° å¹´è€ä»£ä¸­ã€‚å› ä¸ºå¹´è½»ä»£ä¸­çš„å¯¹è±¡åŸºæœ¬éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„(80%ä»¥ä¸Š),æ‰€ä»¥åœ¨<strong>å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ç®—æ³•ä½¿ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•</strong>,å¤åˆ¶ç®—æ³•çš„åŸºæœ¬æ€æƒ³å°±æ˜¯å°†å†…å­˜åˆ†ä¸ºä¸¤å—,æ¯æ¬¡åªç”¨å…¶ä¸­ä¸€å—,å½“è¿™ä¸€å—å†…å­˜ç”¨å®Œ,å°±å°†è¿˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ã€‚</p><p><code>å¥½å¤„</code>ï¼šå¤åˆ¶ç®—æ³•ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå¯¹è±¡å®Œæ•´ä¸ä¼šä¸¢ã€‚</p><p><code>ç¼ºç‚¹</code>ï¼šæµªè´¹äº†10%ç©ºé—´ã€‚</p><p><a href="https://camo.githubusercontent.com/532263eb835a296a059c16f25be1a2b2b4b23893/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f66633334396662623962323034343935613533323166656265323738313864342d6e65772d696d61676534353932306139612d353532632d343635362d393464362d6533636134356666396237362e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/532263eb835a296a059c16f25be1a2b2b4b23893/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f66633334396662623962323034343935613533323166656265323738313864342d6e65772d696d61676534353932306139612d353532632d343635362d393464362d6533636134356666396237362e706e67" class="lazyload"></a></p><h3 id="æ ‡è®°æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°æ¸…é™¤ç®—æ³•"></a>æ ‡è®°æ¸…é™¤ç®—æ³•</h3><p>æ ‡è®°æ¸…é™¤ç®—æ³•å°±æ˜¯åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªé˜¶æ®µã€‚<strong>æ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œæ ‡è®°ç»“æŸåç»Ÿä¸€å›æ”¶</strong>ã€‚</p><p>å…¶å®å®ƒå°±æ˜¯æŠŠå·²æ­»äº¡çš„å¯¹è±¡æ ‡è®°ä¸ºç©ºé—²å†…å­˜ï¼Œç„¶åè®°å½•åœ¨ä¸€ä¸ªç©ºé—²åˆ—è¡¨ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦newä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå†…å­˜ç®¡ç†æ¨¡å—ä¼šä»ç©ºé—²åˆ—è¡¨ä¸­å¯»æ‰¾ç©ºé—²çš„å†…å­˜æ¥åˆ†ç»™æ–°çš„å¯¹è±¡ã€‚</p><p>ä¸è¶³çš„æ–¹é¢å°±æ˜¯æ ‡è®°å’Œæ¸…é™¤çš„æ•ˆç‡æ¯”è¾ƒä½ä¸‹ã€‚ä¸”è¿™ç§åšæ³•ä¼šè®©å†…å­˜ä¸­çš„ç¢ç‰‡éå¸¸å¤šã€‚è¿™ä¸ªå¯¼è‡´äº†å¦‚æœæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°è¾ƒå¤§çš„å†…å­˜å—æ—¶ï¼Œæ— æ³•åˆ†é…åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜ã€‚æ¯”å¦‚ä¸‹å›¾</p><p><a href="https://camo.githubusercontent.com/f54d91118e4ffbd266bf7be3b7149881cb0a63fc/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f30313630356439366438356634646161623962666135653730303066306433312d6e65772d696d61676537386530336238352d666265662d346466392d623431652d3262363364373864313139662e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/f54d91118e4ffbd266bf7be3b7149881cb0a63fc/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f30313630356439366438356634646161623962666135653730303066306433312d6e65772d696d61676537386530336238352d666265662d346466392d623431652d3262363364373864313139662e706e67" class="lazyload"></a></p><p>æ­¤æ—¶å¯ä½¿ç”¨çš„å†…å­˜å—éƒ½æ˜¯é›¶é›¶æ•£æ•£çš„ï¼Œå¯¼è‡´äº†åˆšåˆšæåˆ°çš„å¤§å†…å­˜å¯¹è±¡é—®é¢˜</p><h3 id="æ ‡è®°æ•´ç†ç®—æ³•"><a href="#æ ‡è®°æ•´ç†ç®—æ³•" class="headerlink" title="æ ‡è®°æ•´ç†ç®—æ³•"></a>æ ‡è®°æ•´ç†ç®—æ³•</h3><p>å¤åˆ¶ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡é«˜çš„æ—¶å€™ä¼šæœ‰ä¸€å®šçš„æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p><p>æ ‡è®°æ•´ç†ç®—æ³•å”¯ä¸€çš„<code>ç¼ºç‚¹</code>å°±æ˜¯æ•ˆç‡ä¹Ÿä¸é«™,ä¸ä»…è¦<strong>æ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡,è¿˜è¦æ•´ç†æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„å¼•ç”¨åœ°å€</strong>ã€‚ä»æ•ˆç‡ä¸Šæ¥è¯´,æ ‡è®°æ•´ç†ç®—æ³•è¦ä½äºå¤åˆ¶ç®—æ³•ã€‚</p><p><a href="https://camo.githubusercontent.com/24d3da571e399084768678257c97c1ecefadac06/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f32353939653966373232303734643334613366376664396630303736663132312d6e65772d696d61676563373631393265632d623633612d343365332d613664362d6366303166373439393533662e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/24d3da571e399084768678257c97c1ecefadac06/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f32353939653966373232303734643334613366376664396630303736663132312d6e65772d696d61676563373631393265632d623633612d343365332d613664362d6366303166373439393533662e706e67" class="lazyload"></a></p><h3 id="åˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#åˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="åˆ†ä»£æ”¶é›†ç®—æ³•"></a>åˆ†ä»£æ”¶é›†ç®—æ³•</h3><p>è¿™ç§ç®—æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆæ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ã€‚ä¸€èˆ¬æ˜¯æŠŠJavaå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†æ—¶éƒ½å‘ç°æœ‰å¤§æ‰¹å¯¹è±¡æ­»å»ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œé‚£å°±é€‰ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›†ã€‚è€Œè€å¹´ä»£ä¸­å› ä¸ºå¯¹è±¡å­˜æ´»ç‡é«˜ã€æ²¡æœ‰é¢å¤–ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œå°±å¿…é¡»ä½¿ç”¨â€œæ ‡è®°-æ¸…ç†â€æˆ–è€…â€œæ ‡è®°-æ•´ç†â€ç®—æ³•æ¥è¿›è¡Œå›æ”¶ã€‚</p><p>è¯´ç™½äº†å°±æ˜¯å…«ä»™è¿‡æµ·å„æ˜¾ç¥é€šï¼Œå…·ä½“é—®é¢˜å…·ä½“åˆ†æäº†è€Œå·²ã€‚</p><h2 id="åƒåœ¾å›æ”¶å™¨"><a href="#åƒåœ¾å›æ”¶å™¨" class="headerlink" title="åƒåœ¾å›æ”¶å™¨"></a>åƒåœ¾å›æ”¶å™¨</h2><p>HotSpot VMä¸­çš„åƒåœ¾å›æ”¶å™¨ï¼Œä»¥åŠé€‚ç”¨åœºæ™¯ <a href="https://camo.githubusercontent.com/e5b0e914fca887cfb0906a3a73b30a60d8fa984b/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f31316539646364306631656534663235383336653666316334373130346335312d6e65772d696d61676536396531633536612d316434302d343933612d393930312d3665666336343761303166332e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/e5b0e914fca887cfb0906a3a73b30a60d8fa984b/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f31316539646364306631656534663235383336653666316334373130346335312d6e65772d696d61676536396531633536612d316434302d343933612d393930312d3665666336343761303166332e706e67" class="lazyload"></a></p><p>ä¸²è¡Œï¼šSerialï¼ˆæ–°ç”Ÿä»£ï¼‰ ï¼ŒSerial Oldï¼ˆè€å¹´ä»£ï¼‰ï¼Œé€‚ç”¨äºå•CPUçš„Clientæ¨¡å¼</p><p>å¹¶è¡Œï¼šParallel Scavenge ï¼ˆæ–°ç”Ÿä»£ï¼‰å’Œ Parallel Oldï¼ˆè€å¹´ä»£ï¼‰ï¼Œä¾§é‡äºååé‡ï¼ˆååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰ï¼‰ä¼˜å…ˆï¼Œæ˜¯jdk8é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ï¼Œæ‰€ä»¥æ›´é€‚åˆåšåå°è¿ç®—ç­‰ä¸éœ€è¦å¤ªå¤šç”¨æˆ·äº¤äº’çš„ä»»åŠ¡ã€‚Parallel Oldä½¿ç”¨å¤šçº¿ç¨‹å’Œæ ‡è®°æ•´ç†æ³•</p><p>å¹¶è¡Œï¼šParNewï¼ˆæ–°ç”Ÿä»£ï¼‰å’ŒCMSï¼ˆè€å¹´ä»£ï¼‰ï¼Œä¾§é‡äºå“åº”é€Ÿåº¦ä¼˜å…ˆã€‚</p><p><code>ParNewï¼š</code></p><p>å¤šçº¿ç¨‹ç‰ˆçš„ Serialã€‚å¤šçº¿ç¨‹å¯ä»¥è®©åƒåœ¾å›æ”¶å¾—æ›´å¿«ï¼Œä¹Ÿå°±æ˜¯å‡å°‘äº† STW æ—¶é—´ï¼Œèƒ½æå‡å“åº”æ—¶é—´ï¼Œ<strong>åªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨é…åˆå·¥ä½œ</strong>ã€‚</p><h2 id="CMSåƒåœ¾å›æ”¶å™¨"><a href="#CMSåƒåœ¾å›æ”¶å™¨" class="headerlink" title="CMSåƒåœ¾å›æ”¶å™¨"></a>CMSåƒåœ¾å›æ”¶å™¨</h2><p>å…³æ³¨ç‚¹æ˜¯è·å¾—æœ€çŸ­çš„å›æ”¶åœé¡¿æ—¶é—´ï¼Œç”¨çš„æ˜¯â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ï¼Œå®ƒè¿ä½œè¿‡ç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆå§‹æ ‡è®°ï¼ˆCMS initial markï¼‰- Stop The Worldï¼Œæ ‡è®°GC_ROOTæ ¹èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ï¼Œæ—¶é—´çŸ­</li><li>å¹¶å‘æ ‡è®°ï¼ˆCMS concurrent markï¼‰ï¼Œæ ‡è®°ç¬¬ä¸€æ­¥æ¥ä¸‹æ¥çš„èŠ‚ç‚¹ã€‚</li><li>é‡æ–°æ ‡è®°ï¼ˆCMS remarkï¼‰- Stop The Worldï¼šè¡¥å……æ ‡è®°å‰ä¸¤æ­¥åæ–°ç”Ÿæˆçš„èŠ‚ç‚¹ã€‚</li><li>å¹¶å‘æ¸…é™¤ï¼ˆCMS concurrent sweepï¼‰ï¼Œ</li></ul><p>å…¶ä¸­å¹¶å‘æ ‡è®°ã€å¹¶å‘æ¸…é™¤æ—¶é—´æ˜¯ç›¸å¯¹è¾ƒé•¿çš„ï¼Œéƒ½æ˜¯å¯ä»¥å’Œç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„ï¼Œæ‰€ä»¥Stop The Worldæ—¶é—´æ˜¯å¾ˆçŸ­çš„ï¼Œæ€»ä½“ä¸Šæ¥çœ‹å°±æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œè¿™å¯¹è¦æ±‚å“åº”é€Ÿåº¦è¾ƒå¿«çš„åº”ç”¨åœºæ™¯æ¯”è¾ƒé€‚åˆã€‚</p><p><code>CMSç¼ºç‚¹ï¼š</code></p><ul><li>å¯¹CPUèµ„æºæ•æ„Ÿï¼ŒæŠ¢å CPUèµ„æºå°†å¯¼è‡´ç”¨æˆ·çº¿ç¨‹çš„CPUèµ„æºå‡å°‘è€Œå˜å¾—ç¼“æ…¢ï¼›</li><li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œåœ¨å¹¶å‘å›æ”¶åƒåœ¾æ—¶ï¼Œç”¨æˆ·çº¿ç¨‹ä¼šäº§ç”Ÿæ–°çš„åƒåœ¾å¯¹è±¡ï¼Œè¿™äº›åƒåœ¾è¦ç­‰ä¸‹æ¬¡å›æ”¶ï¼›</li><li>ç”±äºåœ¨å¹¶å‘å›æ”¶çš„è¿‡ç¨‹ç”¨æˆ·çº¿ç¨‹è¿˜åœ¨å·¥ä½œï¼Œè¿™å°±éœ€è¦é¢„ç•™ä¸€å®šçš„å†…å­˜ç©ºé—´ç»™ç”¨æˆ·çº¿ç¨‹ï¼Œå¯¼è‡´å†…å­˜ç©ºé—´åˆ©ç”¨ç‡ä¸‹é™ï¼›ç„¶è¿™ä¸ªæ¯”ä¾‹å¯ä»¥é€šè¿‡ -XX:CMSInitiatingOccupancyFraction æ¥è®¾ç½®ï¼Œä½†æ˜¯å¦‚æœè®¾ç½®åœ°å¤ªé«˜å¾ˆå®¹æ˜“å¯¼è‡´åœ¨ CMS è¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºè¦æ±‚ï¼Œä¼šå¯¼è‡´ <strong>Concurrent Mode Failure</strong> å¤±è´¥ï¼Œè¿™æ—¶ä¼šå¯ç”¨ Serial Old æ”¶é›†å™¨æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„æ”¶é›†ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ Serial Old æ”¶é›†å™¨æ˜¯å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ STW æ›´é•¿äº†ã€‚</li><li>CMSé‡‡ç”¨çš„æ˜¯æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œè¿™å°±å¯¼è‡´å†…å­˜ç¢ç‰‡åŒ–ã€‚è‹¥å‡ºç°å†…å­˜ç©ºé—´è¿˜å¾ˆå¤šï¼Œä½†ç”±äºç¢ç‰‡åŒ–çš„æƒ…å†µï¼Œæ— æ³•æ»¡è¶³å¤§å¯¹è±¡çš„åˆ†é…ï¼Œå½“é¡¶ä¸ä½è¦è§¦å‘Full GCæ—¶å¼€å¯å†…å­˜ç¢ç‰‡åˆå¹¶æ•´ç†è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸èƒ½å¹¶å‘çš„ï¼Œä¼šStop The Worldã€‚</li></ul><p>åˆ°jdk8ä¸ºæ­¢ï¼Œé»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨æ˜¯Parallel Scavenge å’Œ Parallel Old</p><p>ä»jdk9å¼€å§‹ï¼ŒG1æ”¶é›†å™¨æˆä¸ºé»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ ç›®å‰æ¥çœ‹ï¼ŒG1å›æ”¶å™¨åœé¡¿æ—¶é—´æœ€çŸ­è€Œä¸”æ²¡æœ‰æ˜æ˜¾ç¼ºç‚¹ï¼Œéå¸¸é€‚åˆWebåº”ç”¨ã€‚åœ¨jdk8ä¸­æµ‹è¯•Webåº”ç”¨ï¼Œå †å†…å­˜6Gï¼Œæ–°ç”Ÿä»£4.5Gçš„æƒ…å†µä¸‹ï¼ŒParallel Scavenge å›æ”¶æ–°ç”Ÿä»£åœé¡¿é•¿è¾¾1.5ç§’ã€‚G1å›æ”¶å™¨å›æ”¶åŒæ ·å¤§å°çš„æ–°ç”Ÿä»£åªåœé¡¿0.2ç§’ã€‚</p><p><img alt="image-20200611140259211" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfobbsd03zj30hj0eygmu.jpg" class="lazyload"></p><h2 id="G1-åƒåœ¾æ”¶é›†å™¨"><a href="#G1-åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="G1 åƒåœ¾æ”¶é›†å™¨"></a>G1 åƒåœ¾æ”¶é›†å™¨</h2><p>â€‹        é€šè¿‡å¼•å…¥ <code>Region</code> çš„æ¦‚å¿µï¼Œä»è€Œå°†åŸæ¥çš„æ•´å—å †å†…å­˜ç©ºé—´åˆ’åˆ†æˆ2048ä¸ªçš„å°ç©ºé—´ï¼Œä½¿å¾—æ¯ä¸ªå°ç©ºé—´å¯ä»¥å•ç‹¬è¿›è¡Œåƒåœ¾å›æ”¶ã€‚æ¯å—å¯ä½œä¸ºEdenã€Survivorã€Oldã€Humongousä¸­çš„ä¸€ç§ã€‚</p><p>â€‹        è¿™ç§åˆ’åˆ†æ–¹æ³•å¸¦æ¥äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä½¿å¾—å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹æˆä¸ºå¯èƒ½ã€‚é€šè¿‡è®°å½•æ¯ä¸ª <code>Region</code> åƒåœ¾å›æ”¶æ—¶é—´ä»¥åŠå›æ”¶æ‰€è·å¾—çš„ç©ºé—´ï¼ˆè¿™ä¸¤ä¸ªå€¼æ˜¯é€šè¿‡è¿‡å»å›æ”¶çš„ç»éªŒè·å¾—ï¼‰ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„ Regionã€‚</p><p>â€‹        æ¯ä¸ª <code>Region</code> éƒ½æœ‰ä¸€ä¸ª <code>Remembered Set</code>ï¼Œç”¨æ¥è®°å½•è¯¥ <code>Region</code> å¯¹è±¡çš„å¼•ç”¨å¯¹è±¡æ‰€åœ¨çš„ <code>Region</code>ã€‚åœ¨åšå¯è¾¾æ€§åˆ†æçš„æ—¶å€™å°±å¯ä»¥é¿å…å…¨å †æ‰«æã€‚</p><ul><li><strong>åˆå§‹æ ‡è®°</strong></li><li><strong>å¹¶å‘æ ‡è®°</strong></li><li><strong>æœ€ç»ˆæ ‡è®°</strong>ï¼šä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹çš„ <code>Remembered Set Logs</code> é‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠ <code>Remembered Set Logs</code> çš„æ•°æ®åˆå¹¶åˆ° <code>Remembered Set</code> ä¸­ã€‚è¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œã€‚</li><li><strong>ç­›é€‰å›æ”¶</strong>ï¼šé¦–å…ˆå¯¹å„ä¸ª <code>Region</code> ä¸­çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„ GC åœé¡¿æ˜¯æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚æ­¤é˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ† <code>Region</code>ï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…åº¦æé«˜æ”¶é›†æ•ˆç‡ã€‚</li></ul><p><code>ä¼˜ç‚¹</code>ï¼š</p><ul><li>ç©ºé—´æ•´ç†ï¼Œä¸<strong>CMS</strong>çš„<strong>æ ‡è®°-æ¸…ç†</strong>ç›¸æ¯”ï¼Œå®ƒé‡‡ç”¨çš„æ˜¯<strong>æ ‡è®°-æ•´ç†</strong>ï¼Œä»å±€éƒ¨Regionæ¥çœ‹åˆæ˜¯<strong>å¤åˆ¶ç®—æ³•</strong>ï¼›å¦å¤–CMSåœ¨å›æ”¶é˜¶æ®µå°†æ ‡è®°çš„åƒåœ¾å…¨éƒ¨å›æ”¶ï¼Œä½†G1æ ¹æ®è®¾å®šå‚æ•°ï¼Œæ’åºåï¼Œåªå›æ”¶ä¼˜å…ˆçº§é«˜çš„åƒåœ¾ï¼Œç¼©çŸ­äº†åƒåœ¾å›æ”¶çš„æ—¶é—´ï¼Œä¿è¯äº†å“åº”é€Ÿåº¦ã€‚</li><li>å¯é¢„æµ‹åœé¡¿ï¼Œå¯ä»¥è®©ä½¿ç”¨è¿™æŒ‡å®šåœ¨é•¿åº¦ä¸ºMæ¯«ç§’çš„æ˜¯æ—¶é—´å†…ï¼Œåƒåœ¾æ”¶é›†æ—¶é—´ä¸èƒ½è¶…è¿‡Næ¯«ç§’ï¼›</li><li>å¹´è½»ä»£åˆå§‹èµ‹å€¼5%çš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœè¾¾åˆ°æ­¤ç©ºé—´ï¼Œä½†è¿˜æ²¡è¾¾åˆ°è®¾ç½®çš„GCæ—¶é—´ï¼Œå°±ä¼šåŠ¨æ€å¢åŠ å¹´è½»ä»£çš„Regionã€‚</li></ul><p><img alt="image-20200610154046331" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggq7zvne60j30g8059tao.jpg" class="lazyload"></p><p>å½“ä¸€ä¸ªå¯¹è±¡å¤§äºRegionå¤§å°çš„50%ï¼Œç§°ä¸ºå·¨å‹å¯¹è±¡ï¼›å®ƒå°±ä¼šç‹¬å ä¸€ä¸ªæˆ–å¤šä¸ªRegionï¼Œå·¨å‹å¯¹è±¡ä¼šç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œæ‰€å ç”¨çš„è¿ç»­ç©ºé—´ç§°ä¸ºå·¨å‹åˆ†åŒº-Humongous Region</p><h2 id="JVMçš„å¸¸ç”¨å‚æ•°"><a href="#JVMçš„å¸¸ç”¨å‚æ•°" class="headerlink" title="JVMçš„å¸¸ç”¨å‚æ•°"></a>JVMçš„å¸¸ç”¨å‚æ•°</h2><h3 id="é€šç”¨å‚æ•°"><a href="#é€šç”¨å‚æ•°" class="headerlink" title="é€šç”¨å‚æ•°"></a>é€šç”¨å‚æ•°</h3><p><code>-Xms</code></p><p>åˆå§‹å¤§å°å†…å­˜ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜ 1/64</p><p>ç­‰ä»·äº -XX:InitialHeapSize</p><p><code>-Xmx</code></p><p>æœ€å¤§åˆ†é…å†…å­˜ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4</p><p>ç­‰ä»·äº -XX:MaxHeapSize</p><p><strong>-Xmså’Œ-Xmxæœ€å¥½ä¸€è‡´ï¼Œä»¥é¿å…æ¯æ¬¡åƒåœ¾å›æ”¶å®ŒæˆåJVMé‡æ–°åˆ†é…å†…å­˜ã€‚</strong></p><p><code>-XX:SurvivorRatio</code></p><p>è®¾ç½®æ–°ç”Ÿä»£ä¸­ eden å’Œ S0/S1 ç©ºé—´æ¯”ä¾‹</p><p>é»˜è®¤ -XX:SurvivorRatio=8ï¼ŒEden : S0 : S1 = 8 : 1 : 1</p><p><code>-XX:NewRatio</code></p><p>é…ç½®å¹´è½»ä»£å’Œè€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”</p><p>é»˜è®¤ -XX:NewRatio=2 æ–°ç”Ÿä»£å 1ï¼Œè€å¹´ä»£å 2ï¼Œå¹´è½»ä»£å æ•´ä¸ªå †çš„ 1/3</p><p><code>-Xss</code></p><p>è®¾ç½®å•ä¸ªçº¿ç¨‹æ ˆçš„å¤§å°ï¼Œä¸€èˆ¬é»˜è®¤ä¸º 512-1024k</p><p>ç­‰ä»·äº -XX:ThreadStackSize</p><p>åœ¨ç›¸åŒç‰©ç†å†…å­˜ä¸‹ï¼Œå‡å°è¿™ä¸ªå€¼èƒ½ç”Ÿæˆæ›´å¤šçš„çº¿ç¨‹ã€‚ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸èƒ½æ— é™ç”Ÿæˆï¼Œç»éªŒå€¼åœ¨3000~5000å·¦å³ã€‚</p><p><code>-XX:MetaspaceSize</code></p><p>è®¾ç½®å…ƒç©ºé—´å¤§å°ï¼ˆå…ƒç©ºé—´çš„æœ¬è´¨å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹ JVM è§„èŒƒä¸­çš„æ–¹æ³•åŒºçš„å®ç°ï¼Œä¸è¿‡å…ƒç©ºé—´äºæ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§åŒºåˆ«åœ¨äºï¼Œå…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶ï¼‰</p><p>å…ƒç©ºé—´é»˜è®¤æ¯”è¾ƒå°ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒå¤§ä¸€ç‚¹</p><p><code>-XX:MaxTenuringThreshold</code></p><p>è®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„</p><p><code>-XX:+PrintGCDetails</code></p><p>è¾“å‡ºè¯¦ç»† GC æ”¶é›†æ—¥å¿—ä¿¡æ¯ </p><p><img alt="image-20200812112340234" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghnv54e8gaj30ks01ywh6.jpg" class="lazyload"></p><h3 id="G1-GCçš„å‚æ•°é€‰é¡¹"><a href="#G1-GCçš„å‚æ•°é€‰é¡¹" class="headerlink" title="G1 GCçš„å‚æ•°é€‰é¡¹"></a>G1 GCçš„å‚æ•°é€‰é¡¹</h3><table><thead><tr><th>å‚æ•°å</th><th>å«ä¹‰</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>-XX:+UseG1GC</td><td>==ä½¿ç”¨G1æ”¶é›†å™¨==</td><td>JDK1.8ä¸­è¿˜éœ€è¦æ˜¾å¼æŒ‡å®š</td></tr><tr><td>-XX:MaxGCPauseMillis=n</td><td>è®¾ç½®ä¸€ä¸ª==æœŸæœ›çš„æœ€å¤§GCæš‚åœæ—¶é—´==ï¼Œè¿™æ˜¯ä¸€ä¸ªæŸ”æ€§çš„ç›®æ ‡ï¼ŒJVMä¼šå°½åŠ›å»è¾¾åˆ°è¿™ä¸ªç›®æ ‡</td><td>200</td></tr><tr><td>-XX:InitiatingHeapOccupancyPercent=n</td><td>å½“æ•´ä¸ªå †çš„ç©ºé—´ä½¿ç”¨ç™¾åˆ†æ¯”è¶…è¿‡è¿™ä¸ªå€¼æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡å¹¶å‘æ”¶é›†å‘¨æœŸï¼Œè®°ä½æ˜¯æ•´ä¸ªå †</td><td>45</td></tr><tr><td>-XX:NewRatio=n</td><td>æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹</td><td>2</td></tr><tr><td>-XX:SurvivorRatio=n</td><td>Edenç©ºé—´å’ŒSurvivorç©ºé—´çš„æ¯”ä¾‹</td><td>8</td></tr><tr><td>-XX:MaxTenuringThreshold=n</td><td>å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ç»å†çš„æœ€å¤šçš„æ–°ç”Ÿä»£æ”¶é›†ï¼Œæˆ–è€…è¯´æœ€å¤§çš„å²æ•°</td><td>G1ä¸­æ˜¯15</td></tr><tr><td>-XX:ParallelGCThreads=n</td><td>è®¾ç½®åƒåœ¾æ”¶é›†å™¨çš„å¹¶è¡Œé˜¶æ®µçš„åƒåœ¾æ”¶é›†çº¿ç¨‹æ•°</td><td>ä¸åŒçš„å¹³å°æœ‰ä¸åŒçš„å€¼</td></tr><tr><td>-XX:ConcGCThreads=n</td><td>è®¾ç½®åƒåœ¾æ”¶é›†å™¨å¹¶å‘æ‰§è¡ŒGCçš„çº¿ç¨‹æ•°</td><td>nä¸€èˆ¬æ˜¯ParallelGCThreadsçš„å››åˆ†ä¹‹ä¸€</td></tr><tr><td>-XX:G1ReservePercent=n</td><td>è®¾ç½®ä½œä¸º==ç©ºé—²ç©ºé—´çš„é¢„ç•™å†…å­˜ç™¾åˆ†æ¯”==ï¼Œä»¥é™ä½ç›®æ ‡ç©ºé—´æº¢å‡ºï¼ˆç–æ•£å¤±è´¥ï¼‰çš„é£é™©ã€‚é»˜è®¤å€¼æ˜¯ 10%ã€‚å¢åŠ æˆ–å‡å°‘è¿™ä¸ªå€¼ï¼Œè¯·ç¡®ä¿å¯¹æ€»çš„ Java å †è°ƒæ•´ç›¸åŒçš„é‡</td><td>10</td></tr><tr><td>-XX:G1HeapRegionSize=n</td><td>åˆ†åŒºçš„å¤§å°</td><td>å †å†…å­˜å¤§å°çš„1/2000ï¼Œå•ä½æ˜¯MBï¼Œå€¼æ˜¯2çš„å¹‚ï¼ŒèŒƒå›´æ˜¯1MBåˆ°32MBä¹‹é—´</td></tr><tr><td>-XX:G1HeapWastePercent=n</td><td>è®¾ç½®æ‚¨æ„¿æ„æµªè´¹çš„å †ç™¾åˆ†æ¯”ã€‚å¦‚æœå¯å›æ”¶ç™¾åˆ†æ¯”å°äºå †åºŸç‰©ç™¾åˆ†æ¯”ï¼ŒJavaHotSpotVMä¸ä¼šå¯åŠ¨æ··åˆåƒåœ¾å›æ”¶å‘¨æœŸï¼ˆæ³¨æ„ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥ç”¨äºè°ƒæ•´æ··åˆæ”¶é›†çš„é¢‘ç‡ï¼‰ã€‚</td><td>JDK1.8æ˜¯5</td></tr><tr><td>-XX:G1MixedGCCountTarget=8</td><td>è®¾ç½®å¹¶å‘å‘¨æœŸåéœ€è¦æ‰§è¡Œå¤šå°‘æ¬¡æ··åˆæ”¶é›†ï¼Œå¦‚æœæ··åˆæ”¶é›†ä¸­STWçš„æ—¶é—´è¿‡é•¿ï¼Œå¯ä»¥è€ƒè™‘å¢å¤§è¿™ä¸ªå‚æ•°ã€‚ï¼ˆæ³¨æ„ï¼šè¿™ä¸ªå¯ä»¥ç”¨æ¥è°ƒæ•´æ¯æ¬¡æ··åˆæ”¶é›†ä¸­å›æ”¶æ‰è€å¹´ä»£åˆ†åŒºçš„å¤šå°‘ï¼Œå³è°ƒèŠ‚æ··åˆæ”¶é›†çš„åœé¡¿æ—¶é—´ï¼‰</td><td>8</td></tr><tr><td>-XX:G1MixedGCLiveThresholdPercent=n</td><td>ä¸€ä¸ªåˆ†åŒºæ˜¯å¦ä¼šè¢«æ”¾å…¥mix GCçš„CSetçš„é˜ˆå€¼ã€‚å¯¹äºä¸€ä¸ªåˆ†åŒºæ¥è¯´ï¼Œå®ƒçš„å­˜æ´»å¯¹è±¡ç‡å¦‚æœè¶…è¿‡è¿™ä¸ªæ¯”ä¾‹ï¼Œåˆ™æ”¹åˆ†åŒºä¸ä¼šè¢«åˆ—å…¥mixed gcçš„CSetä¸­</td><td>JDK1.6å’Œ1.7æ˜¯65ï¼ŒJDK1.8æ˜¯85</td></tr></tbody></table><h2 id="å…³äºJVMè°ƒä¼˜çš„ä¸€äº›æ–¹é¢"><a href="#å…³äºJVMè°ƒä¼˜çš„ä¸€äº›æ–¹é¢" class="headerlink" title="å…³äºJVMè°ƒä¼˜çš„ä¸€äº›æ–¹é¢"></a>å…³äºJVMè°ƒä¼˜çš„ä¸€äº›æ–¹é¢</h2><p>æˆ‘ä»¬å¯ä»¥å°è¯•å¯¹JVMè¿›è¡Œè°ƒä¼˜ï¼Œä¸»è¦å°±æ˜¯å †å†…å­˜é‚£å—</p><h3 id="è°ƒæ•´æœ€å¤§å †å†…å­˜å’Œæœ€å°å †å†…å­˜"><a href="#è°ƒæ•´æœ€å¤§å †å†…å­˜å’Œæœ€å°å †å†…å­˜" class="headerlink" title="è°ƒæ•´æœ€å¤§å †å†…å­˜å’Œæœ€å°å †å†…å­˜"></a>è°ƒæ•´æœ€å¤§å †å†…å­˜å’Œæœ€å°å †å†…å­˜</h3><p>-Xmx â€“Xmsï¼šæŒ‡å®šjavaå †æœ€å¤§å€¼ï¼ˆé»˜è®¤å€¼æ˜¯ç‰©ç†å†…å­˜çš„1/4(&lt;1GB)ï¼‰å’Œåˆå§‹javaå †æœ€å°å€¼ï¼ˆé»˜è®¤å€¼æ˜¯ç‰©ç†å†…å­˜çš„1/64(&lt;1GB))</p><p>é»˜è®¤(MinHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å°äº40%æ—¶ï¼ŒJVMå°±ä¼šå¢å¤§å †ç›´åˆ°-Xmxçš„æœ€å¤§é™åˆ¶.ï¼Œé»˜è®¤(MaxHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å¤§äº70%æ—¶ï¼ŒJVMä¼šå‡å°‘å †ç›´åˆ° -Xmsçš„æœ€å°é™åˆ¶ã€‚ç®€å•ç‚¹æ¥è¯´ï¼Œä½ ä¸åœåœ°å¾€å †å†…å­˜é‡Œé¢ä¸¢æ•°æ®ï¼Œç­‰å®ƒå‰©ä½™å¤§å°å°äº40%äº†ï¼ŒJVMå°±ä¼šåŠ¨æ€ç”³è¯·å†…å­˜ç©ºé—´ä¸è¿‡ä¼šå°äº-Xmxï¼Œå¦‚æœå‰©ä½™å¤§å°å¤§äº70%ï¼Œåˆä¼šåŠ¨æ€ç¼©å°ä¸è¿‡ä¸ä¼šå°äºâ€“Xmsã€‚å°±è¿™ä¹ˆç®€å•</p><p>å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šå°† -Xms ä¸ -Xmxä¸¤ä¸ªå‚æ•°çš„é…ç½®ç›¸åŒçš„å€¼ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨javaåƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåä¸éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—å †åŒºçš„å¤§å°è€Œæµªè´¹èµ„æºã€‚</p><p>æˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„ä»£ç </p><pre><code class="java">System.out.println(&quot;Xmx=&quot; + Runtime.getRuntime().maxMemory() / 1024.0 / 1024 + &quot;M&quot;);    //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´System.out.println(&quot;free mem=&quot; + Runtime.getRuntime().freeMemory() / 1024.0 / 1024 + &quot;M&quot;);  //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´System.out.println(&quot;total mem=&quot; + Runtime.getRuntime().totalMemory() / 1024.0 / 1024 + &quot;M&quot;);  //å½“å‰å¯ç”¨çš„æ€»ç©ºé—´</code></pre><p>æ³¨æ„ï¼šæ­¤å¤„è®¾ç½®çš„æ˜¯Javaå †å¤§å°ï¼Œä¹Ÿå°±æ˜¯æ–°ç”Ÿä»£å¤§å° + è€å¹´ä»£å¤§å° <a href="https://camo.githubusercontent.com/9a9d237967393ea65368245aacc26b93eb787f84/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f35653762333532633136643734633738396336363561663436643361323530392d6e65772d696d61676564643634356461652d333037642d343537322d623665322d6235613939323561343663642e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/9a9d237967393ea65368245aacc26b93eb787f84/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f35653762333532633136643734633738396336363561663436643361323530392d6e65772d696d61676564643634356461652d333037642d343537322d623665322d6235613939323561343663642e706e67" class="lazyload"></a></p><p>è®¾ç½®ä¸€ä¸ªVM optionsçš„å‚æ•°</p><pre><code>-Xmx20m -Xms5m -XX:+PrintGCDetails</code></pre><p><a href="https://camo.githubusercontent.com/caf41e27bf203a1281f20969d94cd790258a6a12/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f66653939653335356634373534666134626537343237636236353236316633642d6e65772d696d61676562623563663438352d393966382d343365622d383830392d3261383965366131373638652e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/caf41e27bf203a1281f20969d94cd790258a6a12/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f66653939653335356634373534666134626537343237636236353236316633642d6e65772d696d61676562623563663438352d393966382d343365622d383830392d3261383965366131373638652e706e67" class="lazyload"></a></p><p>å†æ¬¡å¯åŠ¨mainæ–¹æ³•</p><p><a href="https://camo.githubusercontent.com/b536da4f44b4b683f323afb045009f734095da49/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f33303035333966363536303034336464386133666530383564323834323065362d6e65772d696d61676533633538316132652d313936662d346230312d393066312d6332373733316234363130622e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/b536da4f44b4b683f323afb045009f734095da49/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f33303035333966363536303034336464386133666530383564323834323065362d6e65772d696d61676533633538316132652d313936662d346230312d393066312d6332373733316234363130622e706e67" class="lazyload"></a> è¿™é‡ŒGCå¼¹å‡ºäº†ä¸€ä¸ªAllocation Failureåˆ†é…å¤±è´¥ï¼Œè¿™ä¸ªäº‹æƒ…å‘ç”Ÿåœ¨PSYoungGenï¼Œä¹Ÿå°±æ˜¯å¹´è½»ä»£ä¸­</p><p>è¿™æ—¶å€™ç”³è¯·åˆ°çš„å†…å­˜ä¸º18Mï¼Œç©ºé—²å†…å­˜ä¸º4.214195251464844M</p><p>æˆ‘ä»¬æ­¤æ—¶åˆ›å»ºä¸€ä¸ªå­—èŠ‚æ•°ç»„çœ‹çœ‹ï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç </p><pre><code>byte[] b = new byte[1 * 1024 * 1024];System.out.println(&quot;åˆ†é…äº†1Mç©ºé—´ç»™æ•°ç»„&quot;);System.out.println(&quot;Xmx=&quot; + Runtime.getRuntime().maxMemory() / 1024.0 / 1024 + &quot;M&quot;);  //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´System.out.println(&quot;free mem=&quot; + Runtime.getRuntime().freeMemory() / 1024.0 / 1024 + &quot;M&quot;);  //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´System.out.println(&quot;total mem=&quot; + Runtime.getRuntime().totalMemory() / 1024.0 / 1024 + &quot;M&quot;);</code></pre><p><a href="https://camo.githubusercontent.com/1225930990b2cf980c6acf943d630d1cdbd82798/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f62646437313764306133333934626537613733333736303035323737333337342d6e65772d696d61676533373162356435392d303032302d343039312d393837342d3630336330616230303733642e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/1225930990b2cf980c6acf943d630d1cdbd82798/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f62646437313764306133333934626537613733333736303035323737333337342d6e65772d696d61676533373162356435392d303032302d343039312d393837342d3630336330616230303733642e706e67" class="lazyload"></a></p><p>æ­¤æ—¶free memoryå°±åˆç¼©æ°´äº†ï¼Œä¸è¿‡total memoryæ˜¯æ²¡æœ‰å˜åŒ–çš„ã€‚Javaä¼šå°½å¯èƒ½å°†total memçš„å€¼ç»´æŒåœ¨æœ€å°å †å†…å­˜å¤§å°</p><pre><code>byte[] b = new byte[10 * 1024 * 1024];System.out.println(&quot;åˆ†é…äº†10Mç©ºé—´ç»™æ•°ç»„&quot;);System.out.println(&quot;Xmx=&quot; + Runtime.getRuntime().maxMemory() / 1024.0 / 1024 + &quot;M&quot;);  //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´System.out.println(&quot;free mem=&quot; + Runtime.getRuntime().freeMemory() / 1024.0 / 1024 + &quot;M&quot;);  //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´System.out.println(&quot;total mem=&quot; + Runtime.getRuntime().totalMemory() / 1024.0 / 1024 + &quot;M&quot;);  //å½“å‰å¯ç”¨çš„æ€»ç©ºé—´</code></pre><p><a href="https://camo.githubusercontent.com/1eea5da0254d2ebc0dc1af43082a0f4ae47bd0bc/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f30666437353530616532313434616463613865643265646531326435666239362d6e65772d696d61676530633331666632302d323839642d343038382d386336372d6138343664306335643165302e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/1eea5da0254d2ebc0dc1af43082a0f4ae47bd0bc/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f30666437353530616532313434616463613865643265646531326435666239362d6e65772d696d61676530633331666632302d323839642d343038382d386336372d6138343664306335643165302e706e67" class="lazyload"></a></p><p>è¿™æ—¶å€™æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª10Mçš„å­—èŠ‚æ•°æ®ï¼Œè¿™æ—¶å€™æœ€å°å †å†…å­˜æ˜¯é¡¶ä¸ä½çš„ã€‚æˆ‘ä»¬ä¼šå‘ç°ç°åœ¨çš„total memoryå·²ç»å˜æˆäº†15Mï¼Œè¿™å°±æ˜¯å·²ç»ç”³è¯·äº†ä¸€æ¬¡å†…å­˜çš„ç»“æœã€‚</p><p>æ­¤æ—¶æˆ‘ä»¬å†è·‘ä¸€ä¸‹è¿™ä¸ªä»£ç </p><pre><code>System.gc();System.out.println(&quot;Xmx=&quot; + Runtime.getRuntime().maxMemory() / 1024.0 / 1024 + &quot;M&quot;);    //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´System.out.println(&quot;free mem=&quot; + Runtime.getRuntime().freeMemory() / 1024.0 / 1024 + &quot;M&quot;);  //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´System.out.println(&quot;total mem=&quot; + Runtime.getRuntime().totalMemory() / 1024.0 / 1024 + &quot;M&quot;);  //å½“å‰å¯ç”¨çš„æ€»ç©ºé—´</code></pre><p><a href="https://camo.githubusercontent.com/279fdb13bff8b2970b9977f93091f2389c957a25/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f34636334346235643564316334306334383634306563653661323936623161632d6e65772d696d61676534623537626166362d303835622d343135302d396336302d6163353162306638313564372e706e67" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/279fdb13bff8b2970b9977f93091f2389c957a25/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f34636334346235643564316334306334383634306563653661323936623161632d6e65772d696d61676534623537626166362d303835622d343135302d396336302d6163353162306638313564372e706e67" class="lazyload"></a></p><p>æ­¤æ—¶æˆ‘ä»¬æ‰‹åŠ¨æ‰§è¡Œäº†ä¸€æ¬¡fullgcï¼Œæ­¤æ—¶total memoryçš„å†…å­˜ç©ºé—´åˆå˜å›5.5Mäº†ï¼Œæ­¤æ—¶åˆæ˜¯æŠŠç”³è¯·çš„å†…å­˜é‡Šæ”¾æ‰çš„ç»“æœã€‚</p><h3 id="è°ƒæ•´æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”å€¼"><a href="#è°ƒæ•´æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”å€¼" class="headerlink" title="è°ƒæ•´æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”å€¼"></a>è°ƒæ•´æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”å€¼</h3><p>-XX:NewRatio â€” æ–°ç”Ÿä»£ï¼ˆeden+2*Survivorï¼‰å’Œè€å¹´ä»£ï¼ˆä¸åŒ…å«æ°¸ä¹…åŒºï¼‰çš„æ¯”å€¼</p><p>ä¾‹å¦‚ï¼š-XX:NewRatio=4ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£:è€å¹´ä»£=1:4ï¼Œå³æ–°ç”Ÿä»£å æ•´ä¸ªå †çš„1/5ã€‚åœ¨Xms=Xmxå¹¶ä¸”è®¾ç½®äº†Xmnçš„æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°ä¸éœ€è¦è¿›è¡Œè®¾ç½®ã€‚</p><h3 id="è°ƒæ•´SurvivoråŒºå’ŒEdenåŒºçš„æ¯”å€¼"><a href="#è°ƒæ•´SurvivoråŒºå’ŒEdenåŒºçš„æ¯”å€¼" class="headerlink" title="è°ƒæ•´SurvivoråŒºå’ŒEdenåŒºçš„æ¯”å€¼"></a>è°ƒæ•´SurvivoråŒºå’ŒEdenåŒºçš„æ¯”å€¼</h3><p>-XX:SurvivorRatioï¼ˆå¹¸å­˜ä»£ï¼‰â€” è®¾ç½®ä¸¤ä¸ªSurvivoråŒºå’Œedençš„æ¯”å€¼</p><p>ä¾‹å¦‚ï¼š8ï¼Œè¡¨ç¤ºä¸¤ä¸ªSurvivor:eden=2:8ï¼Œå³ä¸€ä¸ªSurvivorå å¹´è½»ä»£çš„1/10</p><h3 id="è®¾ç½®å¹´è½»ä»£å’Œè€å¹´ä»£çš„å¤§å°"><a href="#è®¾ç½®å¹´è½»ä»£å’Œè€å¹´ä»£çš„å¤§å°" class="headerlink" title="è®¾ç½®å¹´è½»ä»£å’Œè€å¹´ä»£çš„å¤§å°"></a>è®¾ç½®å¹´è½»ä»£å’Œè€å¹´ä»£çš„å¤§å°</h3><p>-XX:NewSize â€” è®¾ç½®å¹´è½»ä»£å¤§å°</p><p>-XX:MaxNewSize â€” è®¾ç½®å¹´è½»ä»£æœ€å¤§å€¼</p><p>å¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒå‚æ•°æ¥æµ‹è¯•ä¸åŒçš„æƒ…å†µï¼Œåæ­£æœ€ä¼˜è§£å½“ç„¶å°±æ˜¯å®˜æ–¹çš„Edenå’ŒSurvivorçš„å æ¯”ä¸º8:1:1ï¼Œç„¶ååœ¨åˆšåˆšä»‹ç»è¿™äº›å‚æ•°çš„æ—¶å€™éƒ½å·²ç»é™„å¸¦äº†ä¸€äº›è¯´æ˜ï¼Œæ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥çœ‹çœ‹ã€‚åæ­£æœ€å¤§å †å†…å­˜å’Œæœ€å°å †å†…å­˜å¦‚æœæ•°å€¼ä¸åŒä¼šå¯¼è‡´å¤šæ¬¡çš„gcï¼Œéœ€è¦æ³¨æ„ã€‚</p><h3 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h3><p>æ ¹æ®å®é™…äº‹æƒ…è°ƒæ•´æ–°ç”Ÿä»£å’Œå¹¸å­˜ä»£çš„å¤§å°ï¼Œå®˜æ–¹æ¨èæ–°ç”Ÿä»£å javaå †çš„3/8ï¼Œå¹¸å­˜ä»£å æ–°ç”Ÿä»£çš„1/10</p><p>åœ¨OOMæ—¶ï¼Œè®°å¾—Dumpå‡ºå †ï¼Œç¡®ä¿å¯ä»¥æ’æŸ¥ç°åœºé—®é¢˜ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤ä½ å¯ä»¥è¾“å‡ºä¸€ä¸ª.dumpæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥ä½¿ç”¨VisualVMæˆ–è€…Javaè‡ªå¸¦çš„Java VisualVMå·¥å…·ã€‚</p><pre><code>-Xmx20m -Xms5m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=ä½ è¦è¾“å‡ºçš„æ—¥å¿—è·¯å¾„</code></pre><p>ä¸€èˆ¬æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬çš„æ–¹å¼æ¥è®©OOMå‡ºç°æ—¶ç»™æˆ‘ä»¬æŠ¥ä¸ªä¿¡ï¼Œå¯ä»¥é€šè¿‡å‘é€é‚®ä»¶æˆ–è€…é‡å¯ç¨‹åºç­‰æ¥è§£å†³ã€‚</p><h3 id="æ°¸ä¹…åŒºçš„è®¾ç½®"><a href="#æ°¸ä¹…åŒºçš„è®¾ç½®" class="headerlink" title="æ°¸ä¹…åŒºçš„è®¾ç½®"></a>æ°¸ä¹…åŒºçš„è®¾ç½®</h3><pre><code>-XX:PermSize -XX:MaxPermSize</code></pre><p>åˆå§‹ç©ºé—´ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/64ï¼‰å’Œæœ€å¤§ç©ºé—´ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/4ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œjvmå¯åŠ¨æ—¶ï¼Œæ°¸ä¹…åŒºä¸€å¼€å§‹å°±å ç”¨äº†PermSizeå¤§å°çš„ç©ºé—´ï¼Œå¦‚æœç©ºé—´è¿˜ä¸å¤Ÿï¼Œå¯ä»¥ç»§ç»­æ‰©å±•ï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡MaxPermSizeï¼Œå¦åˆ™ä¼šOOMã€‚</p><p>tipsï¼šå¦‚æœå †ç©ºé—´æ²¡æœ‰ç”¨å®Œä¹ŸæŠ›å‡ºäº†OOMï¼Œæœ‰å¯èƒ½æ˜¯æ°¸ä¹…åŒºå¯¼è‡´çš„ã€‚å †ç©ºé—´å®é™…å ç”¨éå¸¸å°‘ï¼Œä½†æ˜¯æ°¸ä¹…åŒºæº¢å‡º ä¸€æ ·æŠ›å‡ºOOMã€‚</p><h3 id="JVMçš„æ ˆå‚æ•°è°ƒä¼˜"><a href="#JVMçš„æ ˆå‚æ•°è°ƒä¼˜" class="headerlink" title="JVMçš„æ ˆå‚æ•°è°ƒä¼˜"></a>JVMçš„æ ˆå‚æ•°è°ƒä¼˜</h3><h4 id="è°ƒæ•´æ¯ä¸ªçº¿ç¨‹æ ˆç©ºé—´çš„å¤§å°"><a href="#è°ƒæ•´æ¯ä¸ªçº¿ç¨‹æ ˆç©ºé—´çš„å¤§å°" class="headerlink" title="è°ƒæ•´æ¯ä¸ªçº¿ç¨‹æ ˆç©ºé—´çš„å¤§å°"></a>è°ƒæ•´æ¯ä¸ªçº¿ç¨‹æ ˆç©ºé—´çš„å¤§å°</h4><p>å¯ä»¥é€šè¿‡-Xssï¼šè°ƒæ•´æ¯ä¸ªçº¿ç¨‹æ ˆç©ºé—´çš„å¤§å°</p><p>JDK5.0ä»¥åæ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º1Mï¼Œä»¥å‰æ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º256Kã€‚åœ¨ç›¸åŒç‰©ç†å†…å­˜ä¸‹,å‡å°è¿™ä¸ªå€¼èƒ½ç”Ÿæˆæ›´å¤šçš„çº¿ç¨‹ã€‚ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸èƒ½æ— é™ç”Ÿæˆï¼Œç»éªŒå€¼åœ¨3000~5000å·¦å³</p><h4 id="è®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å°"><a href="#è®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å°" class="headerlink" title="è®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å°"></a>è®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å°</h4><pre><code>-XXThreadStackSizeï¼š    è®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å°(0 means use default stack size)</code></pre><p>è¿™äº›å‚æ•°éƒ½æ˜¯å¯ä»¥é€šè¿‡è‡ªå·±ç¼–å†™ç¨‹åºå»ç®€å•æµ‹è¯•çš„ï¼Œè¿™é‡Œç¢äºç¯‡å¹…é—®é¢˜å°±ä¸å†æä¾›demoäº†</p><h3 id="JVMå…¶ä»–å‚æ•°ä»‹ç»"><a href="#JVMå…¶ä»–å‚æ•°ä»‹ç»" class="headerlink" title="JVMå…¶ä»–å‚æ•°ä»‹ç»"></a>JVMå…¶ä»–å‚æ•°ä»‹ç»</h3><p>å½¢å½¢è‰²è‰²çš„å‚æ•°å¾ˆå¤šï¼Œå°±ä¸ä¼šè¯´æŠŠæ‰€æœ‰éƒ½æ‰¯ä¸ªéäº†ï¼Œå› ä¸ºå¤§å®¶å…¶å®ä¹Ÿä¸ä¼šè¯´ä¸€å®šè¦å»æ·±ç©¶åˆ°åº•ã€‚</p><h4 id="è®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„"><a href="#è®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„" class="headerlink" title="è®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„"></a>è®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„</h4><pre><code>-XX:MaxTenuringThreshold    è®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„ã€‚å¦‚æœè®¾ç½®ä¸º0çš„è¯,åˆ™å¹´è½»ä»£å¯¹è±¡ä¸ç»è¿‡SurvivoråŒº,ç›´æ¥è¿›å…¥å¹´è€ä»£.    å¯¹äºå¹´è€ä»£æ¯”è¾ƒå¤šçš„åº”ç”¨,å¯ä»¥æé«˜æ•ˆç‡ã€‚å¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§å€¼,    åˆ™å¹´è½»ä»£å¯¹è±¡ä¼šåœ¨SurvivoråŒºè¿›è¡Œå¤šæ¬¡å¤åˆ¶,è¿™æ ·å¯ä»¥å¢åŠ å¯¹è±¡å†å¹´è½»ä»£çš„å­˜æ´»æ—¶é—´,    å¢åŠ åœ¨å¹´è½»ä»£å³è¢«å›æ”¶çš„æ¦‚ç‡ã€‚è¯¥å‚æ•°åªæœ‰åœ¨ä¸²è¡ŒGCæ—¶æ‰æœ‰æ•ˆ.</code></pre><h4 id="è®¾ç½®å †ç©ºé—´å­˜æ´»æ—¶é—´"><a href="#è®¾ç½®å †ç©ºé—´å­˜æ´»æ—¶é—´" class="headerlink" title="è®¾ç½®å †ç©ºé—´å­˜æ´»æ—¶é—´"></a>è®¾ç½®å †ç©ºé—´å­˜æ´»æ—¶é—´</h4><pre><code>-XX:SoftRefLRUPolicyMSPerMB    è®¾ç½®æ¯å…†å †ç©ºé—²ç©ºé—´ä¸­SoftReferenceçš„å­˜æ´»æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯1sã€‚</code></pre><h4 id="è®¾ç½®å¯¹è±¡ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£"><a href="#è®¾ç½®å¯¹è±¡ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£" class="headerlink" title="è®¾ç½®å¯¹è±¡ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£"></a>è®¾ç½®å¯¹è±¡ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£</h4><pre><code>-XX:PretenureSizeThreshold    è®¾ç½®å¯¹è±¡è¶…è¿‡å¤šå¤§æ—¶ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œé»˜è®¤å€¼æ˜¯0ã€‚</code></pre><h4 id="è®¾ç½®TLABå edenåŒºçš„æ¯”ä¾‹"><a href="#è®¾ç½®TLABå edenåŒºçš„æ¯”ä¾‹" class="headerlink" title="è®¾ç½®TLABå edenåŒºçš„æ¯”ä¾‹"></a>è®¾ç½®TLABå edenåŒºçš„æ¯”ä¾‹</h4><pre><code>-XX:TLABWasteTargetPercent    è®¾ç½®TLABå edenåŒºçš„ç™¾åˆ†æ¯”ï¼Œé»˜è®¤å€¼æ˜¯1% ã€‚ </code></pre><h4 id="è®¾ç½®æ˜¯å¦ä¼˜å…ˆYGC"><a href="#è®¾ç½®æ˜¯å¦ä¼˜å…ˆYGC" class="headerlink" title="è®¾ç½®æ˜¯å¦ä¼˜å…ˆYGC"></a>è®¾ç½®æ˜¯å¦ä¼˜å…ˆYGC</h4><pre><code>-XX:+CollectGen0First    è®¾ç½®FullGCæ—¶æ˜¯å¦å…ˆYGCï¼Œé»˜è®¤å€¼æ˜¯falseã€‚</code></pre>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¶ˆæ¯é˜Ÿåˆ—é¢è¯•æ€»ç»“</title>
      <link href="/2020/05/19/4.%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
      <url>/2020/05/19/4.%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h2><h2 id="å†™åœ¨å‰é¢çš„è¯"><a href="#å†™åœ¨å‰é¢çš„è¯" class="headerlink" title="å†™åœ¨å‰é¢çš„è¯"></a>å†™åœ¨å‰é¢çš„è¯</h2><p>ç½‘ä¸ŠJavaçš„èµ„æ–™é›¶é›¶æ•£æ•£ï¼Œç”šè‡³æœ‰ä¸€äº›é”™è¯¯ï¼Œä½œè€…å¸Œæœ›èƒ½ç»“åˆè‡ªå·±çš„å®é™…å¼€å‘ç»éªŒå’Œé¢è¯•ç»éªŒï¼Œå¯¹SpringçŸ¥è¯†ä½“ç³»è¿›è¡Œç³»ç»Ÿæ¢³ç†ã€‚</p><p>æœ¬æ–‡å‚è€ƒä¸»è¦ã€å¼•ç”¨ã€‘ä¸­çš„å†…å®¹ï¼Œå¹¶ç»“åˆè‡ªå·±çš„æ—¥å¸¸ç§¯ç´¯ï¼Œæ¬¢è¿ç•™è¨€äº¤æµæŒ‡æ­£ã€‚</p><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"></a><strong>ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</strong></h2><p>ï¼ˆ1ï¼‰<code>è§£è€¦</code>ï¼šå¯ä»¥åœ¨å¤šä¸ªç³»ç»Ÿä¹‹é—´è¿›è¡Œè§£è€¦ï¼Œå°†åŸæœ¬é€šè¿‡ç½‘ç»œä¹‹é—´çš„è°ƒç”¨çš„æ–¹å¼æ”¹ä¸ºä½¿ç”¨MQè¿›è¡Œæ¶ˆæ¯çš„å¼‚æ­¥é€šè®¯ï¼Œåªè¦è¯¥æ“ä½œä¸æ˜¯éœ€è¦åŒæ­¥çš„ï¼Œå°±å¯ä»¥æ”¹ä¸ºä½¿ç”¨MQè¿›è¡Œä¸åŒç³»ç»Ÿä¹‹é—´çš„è”ç³»ï¼Œè¿™æ ·é¡¹ç›®ä¹‹é—´ä¸ä¼šå­˜åœ¨è€¦åˆï¼Œç³»ç»Ÿä¹‹é—´ä¸ä¼šäº§ç”Ÿå¤ªå¤§çš„å½±å“ï¼Œå°±ç®—ä¸€ä¸ªç³»ç»ŸæŒ‚äº†ï¼Œä¹Ÿåªæ˜¯æ¶ˆæ¯æŒ¤å‹åœ¨MQé‡Œé¢æ²¡äººè¿›è¡Œæ¶ˆè´¹è€Œå·²ï¼Œä¸ä¼šå¯¹å…¶ä»–çš„ç³»ç»Ÿäº§ç”Ÿå½±å“ã€‚</p><p> <strong>æˆ‘ç”¨çº¿ç¨‹ï¼Œçº¿ç¨‹æ± å»åšä¸æ˜¯ä¸€æ ·çš„ä¹ˆï¼Ÿ</strong></p><p>ä½ ä¸€ä¸ªè®¢å•æµç¨‹ï¼Œä½ æ‰£ç§¯åˆ†ï¼Œæ‰£ä¼˜æƒ åˆ¸ï¼Œå‘çŸ­ä¿¡ï¼Œæ‰£åº“å­˜ã€‚ã€‚ã€‚ç­‰ç­‰è¿™ä¹ˆå¤šä¸šåŠ¡è¦è°ƒç”¨è¿™ä¹ˆå¤šçš„æ¥å£ï¼Œ<strong>æ¯æ¬¡åŠ ä¸€ä¸ªä½ è¦è°ƒç”¨ä¸€ä¸ªæ¥å£ç„¶åè¿˜è¦é‡æ–°å‘å¸ƒç³»ç»Ÿ</strong>ï¼Œè€Œä¸”åŠ æ¶ˆæ¯é˜Ÿåˆ—å‡ºé—®é¢˜æ˜“äºåˆ†ç¦»å®šä½.</p><p>ï¼ˆ2ï¼‰<code>å¼‚æ­¥</code>ï¼šåŠ å…¥ä¸€ä¸ªæ“ä½œè®¾è®¡åˆ°å¥½å‡ ä¸ªæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤ä¹‹é—´ä¸éœ€è¦åŒæ­¥å®Œæˆï¼Œæ¯”å¦‚å®¢æˆ·å»åˆ›å»ºäº†ä¸€ä¸ªè®¢å•ï¼Œè¿˜è¦å»å®¢æˆ·è½¨è¿¹ç³»ç»Ÿæ·»åŠ ä¸€æ¡è½¨è¿¹ã€å»åº“å­˜ç³»ç»Ÿæ›´æ–°åº“å­˜ã€å»å®¢æˆ·ç³»ç»Ÿä¿®æ”¹å®¢æˆ·çš„çŠ¶æ€ç­‰ç­‰ã€‚è¿™æ ·å¦‚æœè¿™ä¸ªç³»ç»Ÿéƒ½ç›´æ¥è¿›è¡Œè°ƒç”¨ï¼Œé‚£ä¹ˆå°†ä¼šäº§ç”Ÿå¤§é‡çš„æ—¶é—´ï¼Œè¿™æ ·å¯¹äºå®¢æˆ·æ˜¯æ— æ³•æ¥æ”¶çš„ï¼›å¹¶ä¸”åƒæ·»åŠ å®¢æˆ·è½¨è¿¹è¿™ç§æ“ä½œæ˜¯ä¸éœ€è¦å»åŒæ­¥æ“ä½œçš„ï¼Œå¦‚æœä½¿ç”¨MQå°†å®¢æˆ·åˆ›å»ºè®¢å•æ—¶ï¼Œå°†åé¢çš„è½¨è¿¹ã€åº“å­˜ã€çŠ¶æ€ç­‰ä¿¡æ¯çš„æ›´æ–°å…¨éƒ½æ”¾åˆ°MQé‡Œé¢ç„¶åå»å¼‚æ­¥æ“ä½œï¼Œè¿™æ ·å°±å¯åŠ å¿«ç³»ç»Ÿçš„è®¿é—®é€Ÿåº¦ï¼Œæä¾›æ›´å¥½çš„å®¢æˆ·ä½“éªŒã€‚</p><p><strong>åº”ç”¨</strong>ï¼šå‘é€é‚®ä»¶ã€çŸ­ä¿¡ã€å¾®ä¿¡æ¨é€</p><p>ï¼ˆ3ï¼‰<code>å‰Šå³°</code>ï¼šä¸€ä¸ªç³»ç»Ÿè®¿é—®æµé‡æœ‰é«˜å³°æ—¶æœŸï¼Œä¹Ÿæœ‰ä½å³°æ—¶æœŸï¼Œæ¯”å¦‚è¯´ï¼Œä¸­åˆæ•´ç‚¹æœ‰ä¸€ä¸ªæŠ¢è´­æ´»åŠ¨ç­‰ç­‰ã€‚æ¯”å¦‚ç³»ç»Ÿå¹³æ—¶æµé‡å¹¶ä¸é«˜ï¼Œä¸€ç§’é’Ÿåªæœ‰100å¤šä¸ªå¹¶å‘è¯·æ±‚ï¼Œç³»ç»Ÿå¤„ç†æ²¡æœ‰ä»»ä½•å‹åŠ›ï¼Œä¸€åˆ‡é£å¹³æµªé™ï¼Œåˆ°äº†æŸä¸ªæŠ¢è´­æ´»åŠ¨æ—¶é—´ï¼Œç³»ç»Ÿå¹¶å‘è®¿é—®äº†å‰§å¢ï¼Œæ¯”å¦‚è¾¾åˆ°äº†æ¯ç§’5000ä¸ªå¹¶å‘è¯·æ±‚ï¼Œè€Œæˆ‘ä»¬çš„ç³»ç»Ÿæ¯ç§’åªèƒ½å¤„ç†2000ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆç”±äºæµé‡å¤ªå¤§ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿã€æ•°æ®åº“å¯èƒ½å°±ä¼šå´©æºƒã€‚è¿™æ—¶å¦‚æœä½¿ç”¨MQè¿›è¡Œæµé‡å‰Šå³°ï¼Œå°†ç”¨æˆ·çš„å¤§é‡æ¶ˆæ¯ç›´æ¥æ”¾åˆ°MQé‡Œé¢ï¼Œç„¶åæˆ‘ä»¬çš„ç³»ç»Ÿå»æŒ‰è‡ªå·±çš„æœ€å¤§æ¶ˆè´¹èƒ½åŠ›å»æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ï¼Œå°±å¯ä»¥ä¿è¯ç³»ç»Ÿçš„ç¨³å®šï¼Œåªæ˜¯å¯èƒ½è¦è·Ÿè¿›ä¸šåŠ¡é€»è¾‘ï¼Œç»™ç”¨æˆ·è¿”å›ç‰¹å®šé¡µé¢æˆ–è€…ç¨åé€šè¿‡å…¶ä»–æ–¹å¼é€šçŸ¥å…¶ç»“æœã€‚</p><h2 id="æŠ€æœ¯é€‰å‹ï¼Ÿ"><a href="#æŠ€æœ¯é€‰å‹ï¼Ÿ" class="headerlink" title="æŠ€æœ¯é€‰å‹ï¼Ÿ"></a>æŠ€æœ¯é€‰å‹ï¼Ÿ</h2><ul><li><code>RabbitMQ</code></li></ul><p>==ä¼˜ç‚¹==</p><ol><li>æ”¯æŒå¤šç§è¯­è¨€ã€æ–‡æ¡£é½å…¨ï¼›</li><li><strong>å¹¶å‘æ€§èƒ½é«˜</strong>ï¼Œæ€§èƒ½æå…¶å¥½ï¼Œå»¶æ—¶å¾ˆä½ï¼Œè¾¾åˆ°å¾®ç§’çº§ï¼›</li><li>ç®¡ç†ç•Œé¢ è¾ƒä¸°å¯Œï¼Œåœ¨äº’è”ç½‘å…¬å¸ä¹Ÿæœ‰è¾ƒå¤§è§„æ¨¡çš„åº”ç”¨ï¼Œç¤¾åŒºæ´»è·ƒåº¦é«˜ï¼›</li><li>æœ‰å¾ˆå¥½çš„æ¶ˆæ¯å¼‚å¸¸æœºåˆ¶ã€æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ã€æŒä¹…åŒ–æœºåˆ¶ï¼Œå¯é æ€§é«˜ã€‚</li><li>å¦‚æœ æ¶ˆæ¯å¼‚å¸¸ï¼ŒRabbitMQæä¾›æ¶ˆæ¯è·Ÿè¸ªæœºåˆ¶ï¼Œä½¿ç”¨è€…å¯ä»¥æ‰¾å‡ºå‘ç”Ÿäº†ä»€ä¹ˆï¼›é˜Ÿåˆ—å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„æœºå™¨ä¸Š è¿›è¡Œé•œåƒï¼Œä»¥ç¡®ä¿åœ¨ç¡¬ä»¶é—®é¢˜ä¸‹è¿˜ä¿è¯ æ¶ˆæ¯å®‰å…¨ï¼›</li><li>ç®¡ç†ç•Œé¢è¾ƒä¸°å¯Œï¼Œåœ¨äº’è”ç½‘å…¬å¸ä¹Ÿæœ‰è¾ƒå¤§è§„æ¨¡çš„åº”ç”¨ï¼Œç¤¾åŒºæ´»è·ƒåº¦é«˜ã€‚</li></ol><p>==ç¼ºç‚¹==</p><ol><li><p>åŸºäº erlang å¼€å‘ï¼Œå¾ˆéš¾è¿›è¡ŒäºŒæ¬¡å®šåˆ¶å¼€å‘</p></li><li><p>ååé‡æ–¹é¢è™½ç„¶ç¨é€Šäº Kafka å’Œ RocketMQ</p></li></ol><p><code>RocketMQ</code></p><p>==ä¼˜ç‚¹==</p><ol><li><p>Javaè¯­è¨€å¼€å‘ï¼Œä»£ç æˆ‘ä»¬å¯ä»¥ç›´æ¥é˜…è¯»ï¼Œä¾¿äºäºŒæ¬¡å¼€å‘</p><ol start="2"><li>ååé‡è¾ƒå¥½ï¼Œæ”¯æŒåƒä¸‡çº§çš„ååé‡ã€‚</li><li>å¯ç”¨æ€§é«˜ï¼Œæ”¯æŒåˆ†å¸ƒå¼ã€‚<ol start="4"><li>æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡</li></ol></li></ol></li></ol><p>==ç¼ºç‚¹==</p><ol><li>æ”¯æŒçš„å®¢æˆ·ç«¯è¯­è¨€ ä¸å¤šï¼Œç›®å‰æ˜¯Java åŠ C++ï¼Œå…¶ä¸­C++ è¿˜ä¸æˆç†Ÿï¼›</li><li>RocketMQ ç¤¾åŒºå…³æ³¨åº¦åŠæˆç†Ÿåº¦ä¹Ÿä¸åŠå‰ä¸¤è€…ï¼›</li><li>æ²¡æœ‰ Web ç®¡ç†ç•Œé¢ï¼Œæä¾›äº†ä¸€ä¸ª CLI (å‘½ä»¤è¡Œç•Œé¢)     ç®¡ç†å·¥å…·å¸¦æ¥ æŸ¥è¯¢ã€ç®¡ç† å’Œè¯Šæ–­å„ç§é—®é¢˜ï¼›</li><li>æ²¡æœ‰åœ¨ MQ æ ¸å¿ƒé‡Œå®ç° JMS ç­‰æ¥å£ï¼Œæœ‰äº›ç³»ç»Ÿè¦è¿ç§»éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç ï¼›</li></ol><p><code>Kafka</code></p><p>==ä¼˜ç‚¹==</p><ol><li><p>ä½†æ˜¯æä¾›è¶…é«˜çš„ååé‡ï¼Œms çº§çš„å»¶è¿Ÿ</p><ol start="2"><li>æé«˜çš„å¯ç”¨æ€§ä»¥åŠå¯é æ€§ï¼Œè€Œä¸”åˆ†å¸ƒå¼å¯ä»¥ä»»æ„æ‰©å±•ã€‚</li><li>å¦‚æœæ˜¯å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶æ•°æ®åŒæ­¥ã€å®æ—¶è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯ï¼Œç”¨ Kafka æ˜¯ä¸šå†…æ ‡å‡†çš„ï¼Œç»å¯¹æ²¡é—®é¢˜ã€‚</li></ol></li></ol><p>==ç¼ºç‚¹==</p><ol><li>é‡å¤æ¶ˆæ¯ã€‚Kafkaä¿è¯æ¯æ¡æ¶ˆæ¯è‡³å°‘é€è¾¾ä¸€æ¬¡ï¼Œè™½ç„¶å‡ ç‡å¾ˆå°ï¼Œä½†ä¸€æ¡æ¶ˆæ¯å¯èƒ½è¢«é€è¾¾å¤šæ¬¡ã€‚</li><li>æ”¯æŒæ¶ˆæ¯é¡ºåºï¼Œä½†æ˜¯ä¸€å°ä»£ç†å®•æœºåï¼Œå°±ä¼šäº§ç”Ÿæ¶ˆæ¯ä¹±åºï¼›</li><li>å¤æ‚æ€§ã€‚Kafkaéœ€è¦Zookeeperçš„æ”¯æŒï¼ŒTopicä¸€èˆ¬éœ€è¦äººå·¥åˆ›å»ºï¼Œéƒ¨ç½²å’Œç»´æŠ¤æ¯”ä¸€èˆ¬MQæˆæœ¬æ›´é«˜ã€‚</li></ol><p><code>ActiveMQ</code></p><p>==ç¼ºç‚¹==</p><p>  ç¤¾åŒºæ´»è·ƒåº¦ä¸åŠ RabbitMQ é«˜ï¼›</p><p>  æ ¹æ®å…¶ä»–ç”¨æˆ·åé¦ˆï¼Œä¼šå‡ºè«åå…¶å¦™çš„é—®é¢˜ï¼Œä¼šä¸¢å¤±æ¶ˆæ¯ï¼›</p><p>  ç›®å‰é‡å¿ƒæ”¾åˆ° activemq 6.0 äº§å“ Apolloï¼Œå¯¹ 5.x çš„ç»´æŠ¤è¾ƒå°‘ï¼›</p><h2 id="ä¸šåŠ¡åœºæ™¯è½åœ°"><a href="#ä¸šåŠ¡åœºæ™¯è½åœ°" class="headerlink" title="ä¸šåŠ¡åœºæ™¯è½åœ°"></a>ä¸šåŠ¡åœºæ™¯è½åœ°</h2><p>åœ¨APIæ¨¡å—ï¼Œåœ¨æ¥å£æ­£ç¡®è¿”å›æ—¶éœ€è¦éœ€è¦å¹²å‡ ä»¶äº‹æƒ…ï¼š</p><ol><li>å›¾åƒå­˜å‚¨ï¼ˆè€—æ—¶20msï¼‰</li><li>æ‰£å‡å‰©ä½™æ¬¡æ•°ï¼ˆè€—æ—¶100msï¼‰</li><li>æ—¥å¿—è®°å½•ï¼ˆè€—æ—¶80msï¼‰</li><li>æ¥å£ç»Ÿè®¡ï¼ˆè€—æ—¶50msï¼‰</li><li>é‚®ä»¶å‘é€ï¼ˆè€—æ—¶å‡ ç§’ï¼‰ã€‚</li></ol><p><img alt="image-20200526134053813" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf5srua1bjj30lf0cewh1.jpg" class="lazyload"></p><h3 id="é‚£ä½ çš„æµç¨‹èµ°å®Œäº†ï¼Œä½ ä¸ç”¨ç®¡åˆ«äººæ˜¯å¦æˆåŠŸä¹ˆï¼Ÿæ¯”å¦‚ä½ ä¸‹å•äº†ç§¯åˆ†æ²¡åŠ ï¼Œä¼˜æƒ åˆ¸æ²¡æ‰£æ€ä¹ˆåŠï¼Ÿ"><a href="#é‚£ä½ çš„æµç¨‹èµ°å®Œäº†ï¼Œä½ ä¸ç”¨ç®¡åˆ«äººæ˜¯å¦æˆåŠŸä¹ˆï¼Ÿæ¯”å¦‚ä½ ä¸‹å•äº†ç§¯åˆ†æ²¡åŠ ï¼Œä¼˜æƒ åˆ¸æ²¡æ‰£æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="é‚£ä½ çš„æµç¨‹èµ°å®Œäº†ï¼Œä½ ä¸ç”¨ç®¡åˆ«äººæ˜¯å¦æˆåŠŸä¹ˆï¼Ÿæ¯”å¦‚ä½ ä¸‹å•äº†ç§¯åˆ†æ²¡åŠ ï¼Œä¼˜æƒ åˆ¸æ²¡æ‰£æ€ä¹ˆåŠï¼Ÿ"></a>é‚£ä½ çš„æµç¨‹èµ°å®Œäº†ï¼Œä½ ä¸ç”¨ç®¡åˆ«äººæ˜¯å¦æˆåŠŸä¹ˆï¼Ÿæ¯”å¦‚ä½ ä¸‹å•äº†ç§¯åˆ†æ²¡åŠ ï¼Œä¼˜æƒ åˆ¸æ²¡æ‰£æ€ä¹ˆåŠï¼Ÿ</h3><p>é—®é¢˜æ˜¯ä¸ªå¥½é—®é¢˜ï¼Œä½†æ˜¯æ²¡å¿…è¦è€ƒè™‘ï¼Œä¸šåŠ¡ç³»ç»Ÿæœ¬èº«å°±æ˜¯è‡ªå·±çš„å¼€å‘äººå‘˜ç»´æŠ¤çš„ï¼Œä½ ç§¯åˆ†æ‰£å¤±è´¥å…³æˆ‘ä¸‹å•çš„ä»€ä¹ˆäº‹æƒ…ï¼Ÿä½ ç®¡å¥½è‡ªå·±ä¸‹å•ç³»ç»Ÿçš„å°±å¥½äº†ã€‚</p><p><strong>Tip</strong>ï¼šè¯æ˜¯è¿™ä¹ˆè¯´ï¼Œä½†æ˜¯è¿™å…¶å®æ˜¯ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€ä¸ªç¼ºç‚¹ï¼Œæ¶‰åŠåˆ°<strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>çš„çŸ¥è¯†ç‚¹ï¼ŒæŠŠä¸‹å•ï¼Œä¼˜æƒ åˆ¸ï¼Œç§¯åˆ†ã€‚ã€‚ã€‚éƒ½æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œé¢ä¸€æ ·ï¼Œè¦æˆåŠŸä¸€èµ·æˆåŠŸï¼Œè¦å¤±è´¥ä¸€èµ·å¤±è´¥ã€‚</p><h2 id="é›†ç¾¤å´©æºƒ-å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Ÿ"><a href="#é›†ç¾¤å´©æºƒ-å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Ÿ" class="headerlink" title="é›†ç¾¤å´©æºƒ,å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Ÿ"></a>é›†ç¾¤å´©æºƒ,å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Ÿ</h2><h3 id="æŒä¹…åŒ–é˜Ÿåˆ—"><a href="#æŒä¹…åŒ–é˜Ÿåˆ—" class="headerlink" title="æŒä¹…åŒ–é˜Ÿåˆ—"></a>æŒä¹…åŒ–é˜Ÿåˆ—</h3><pre><code class="java">@RabbitListener(queuesToDeclare = @Queue(name = &quot;hello&quot;,durable = &quot;true&quot;) )</code></pre><p>ä½†æ˜¯ç»™helloé˜Ÿåˆ—åšæŒä¹…åŒ–ï¼Œè€Œhello1ä¸åšï¼Œå¹¶é‡å¯rabbitmq</p><p><img alt="img" data-src="https://images2017.cnblogs.com/blog/821560/201801/821560-20180104195009221-4259994.png" class="lazyload"></p><p>ã€€ã€€å¯ä»¥çœ‹åˆ°é‡å¯åï¼Œhelloé˜Ÿåˆ—è¿˜åœ¨ï¼Œhello1é˜Ÿåˆ—æ¶ˆå¤±äº†ï¼Œä½†æ˜¯åŸæœ¬helloä¸­çš„ä¸€æ¡æ¶ˆæ¯ä¹Ÿæ²¡æœ‰ä¿å­˜ä¸‹æ¥ã€‚æ‰€ä»¥åœ¨è¿™è¾¹æˆ‘ä»¬ä»…ä»…åšåˆ°äº†æ¶ˆæ¯é˜Ÿåˆ—çš„æŒä¹…åŒ–ï¼Œè¿˜æ²¡æœ‰åšæ¶ˆæ¯æŒä¹…åŒ–ã€‚</p><h3 id="æ¶ˆæ¯æŒä¹…åŒ–"><a href="#æ¶ˆæ¯æŒä¹…åŒ–" class="headerlink" title="æ¶ˆæ¯æŒä¹…åŒ–"></a>æ¶ˆæ¯æŒä¹…åŒ–</h3><p>RabbitMQéµå¾ªAMQPåè®®,ä½¿ç”¨RabbitTemplate é»˜è®¤æ¶ˆæ¯æ˜¯æŒä¹…åŒ–çš„ï¼Œä½†åªæœ‰åœ¨é˜Ÿåˆ—ä¹Ÿæ˜¯æŒä¹…åŒ–æ—¶æ‰æœ‰ä½œç”¨.RabbitMQä¼šå°†æ¶ˆæ¯å†™å…¥ç£ç›˜ä¸Šçš„ä¸€ä¸ªæŒä¹…åŒ–æ—¥å¿—æ–‡ä»¶</p><h2 id="æ­£å¸¸æ¶ˆè´¹-å¦‚ä½•ä¿éšœæ¶ˆæ¯ä¸ä¼šä¸¢å¤±"><a href="#æ­£å¸¸æ¶ˆè´¹-å¦‚ä½•ä¿éšœæ¶ˆæ¯ä¸ä¼šä¸¢å¤±" class="headerlink" title="æ­£å¸¸æ¶ˆè´¹,å¦‚ä½•ä¿éšœæ¶ˆæ¯ä¸ä¼šä¸¢å¤±"></a>æ­£å¸¸æ¶ˆè´¹,å¦‚ä½•ä¿éšœæ¶ˆæ¯ä¸ä¼šä¸¢å¤±</h2><h3 id="ç”Ÿäº§è€…ç«¯"><a href="#ç”Ÿäº§è€…ç«¯" class="headerlink" title="ç”Ÿäº§è€…ç«¯"></a>ç”Ÿäº§è€…ç«¯</h3><p>RabbitMQ æä¾›äº†ä¸¤ç§å¯é æ€§çš„ç¡®è®¤ç­–ç•¥ Confrim / Transaction.</p><h4 id="Confrim"><a href="#Confrim" class="headerlink" title="Confrim"></a>Confrim</h4><p>å¼‚æ­¥ç¡®è®¤æ¨¡å¼:å‘é€çº¿ç¨‹ä¸ä¼šç«‹å³å¾—åˆ°MQåé¦ˆç»“æœï¼Œå‘é€åé€šè¿‡callbackç¡®è®¤æˆåŠŸå¤±è´¥ï¼Œç±»ä¼¼çº¿ç¨‹æ± ï¼Œæ•ˆç‡é«˜</p><p>å‘é€çº¿ç¨‹ï¼šç”±äºæ˜¯å¼‚æ­¥ç¡®è®¤æ¨¡å¼ï¼Œå½“RabbitMQ Serverçªç„¶å¤±è”ï¼Œå‘é€çº¿ç¨‹ä»ä¼šç»§ç»­å‘é€å¤šæ¡æ¶ˆæ¯ï¼Œä¹‹åå‘ç°é“¾æ¥æ–­å¼€ï¼ŒæŠ›å‡ºå¼‚å¸¸</p><p>å‡è®¾RabbitMQ Server æ¥æ”¶500æŒ‚æ‰</p><p> å‘é€çº¿ç¨‹ï¼š700 </p><p> å®é™…æ¥æ”¶ RabbitMQ Serverï¼š500</p><p> callbackçº¿ç¨‹ å¤±è´¥ï¼š200ï¼ˆé¢„æœŸ æœªå…·ä½“æµ‹è¯•ï¼‰</p><p>ç¼ºç‚¹ï¼šå‘é€çº¿ç¨‹è®¤ä¸ºå·²ç»å‘é€æˆåŠŸï¼Œä½†æ˜¯å´å¤±è´¥äº†ï¼Œåé¦ˆç»“æœåªèƒ½é€šcallbackè·å¾—ï¼Œå¤šçº¿ç¨‹é—®é¢˜ï¼Œå¦‚æœªå¤„ç†callbackï¼Œåˆ™æ¶ˆæ¯ä¸¢å¤±</p><p>ä¼˜ç‚¹ï¼šæ€§èƒ½å¥½</p><p>æ¶ˆæ¯ç¡®è®¤æ¨¡å¼åœ¨SpringBootä¸­çš„ä½¿ç”¨:<a href="https://blog.csdn.net/ABIGJUN/article/details/93385838" target="_blank" rel="noopener">https://blog.csdn.net/ABIGJUN/article/details/93385838</a></p><h4 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h4><p>äº‹åŠ¡ç¡®è®¤æ¨¡å¼:</p><p>å‘é€çº¿ç¨‹ä¼šç«‹å³å¾—åˆ°MQåé¦ˆç»“æœï¼ŒåŒä¸€çº¿ç¨‹ä¸­ï¼Œå¤šä¸ªå‘é€é˜»å¡è¿›è¡Œï¼ŒåŒdb Transactionä¸€æ ·æ”¯æŒå¤±è´¥å›æ»šç­‰ï¼Œæ•ˆç‡é«˜</p><p>å‘é€çº¿ç¨‹ï¼šç”±äºæ˜¯äº‹åŠ¡ç¡®è®¤æ¨¡å¼ï¼Œå½“RabbitMQ Serverçªç„¶å¤±è”ï¼Œå‘é€çº¿ç¨‹å¾—ä¸åˆ°å½“å‰æ­£åœ¨å‘é€æ¶ˆæ¯çš„å›æ‰§ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸</p><p>å‡è®¾RabbitMQ Server æ¥æ”¶500æŒ‚æ‰</p><p> å‘é€çº¿ç¨‹ï¼š500</p><p> å®é™…æ¥æ”¶ RabbitMQ Serverï¼š500</p><p>ç¼ºç‚¹ï¼šåŒæ­¥å‘é€ï¼Œé€æ¡ç¡®è®¤ï¼Œæ•ˆç‡ä½</p><p>ä¼˜ç‚¹ï¼šåŒæ­¥å‘é€ï¼Œå‘é€çº¿ç¨‹å¯ä»¥ç«‹å³å¾—åˆ°åé¦ˆç»“æœï¼Œå¯¹äºä¸»çº¿ç¨‹æ¶ˆæ¯ä¸ä¸¢å¤±</p><h3 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h3><p>RabbitMQéµå¾ªAMQPåè®®,ä½¿ç”¨RabbitTemplate é»˜è®¤æ¶ˆæ¯æ˜¯æŒä¹…åŒ–çš„ï¼Œä½†åªæœ‰åœ¨é˜Ÿåˆ—ä¹Ÿæ˜¯æŒä¹…åŒ–æ—¶æ‰æœ‰ä½œç”¨.RabbitMQä¼šå°†æ¶ˆæ¯å†™å…¥ç£ç›˜ä¸Šçš„ä¸€ä¸ªæŒä¹…åŒ–æ—¥å¿—æ–‡ä»¶.</p><p>è‡ªå®šä¹‰çš„Rabbitå·¥å…·ç±»,å‘é€æ¶ˆæ¯çš„æ—¶å€™å°†deliveryMode=2</p><h3 id="æ¶ˆè´¹è€…ç«¯"><a href="#æ¶ˆè´¹è€…ç«¯" class="headerlink" title="æ¶ˆè´¹è€…ç«¯"></a>æ¶ˆè´¹è€…ç«¯</h3><p>å…³é—­è‡ªåŠ¨ç¡®è®¤æœºåˆ¶,è®¾ç½®æ¶ˆæ¯çš„ack,å½“æ¶ˆè´¹è€…æ¶ˆè´¹ä¸€ä¸ªæ¶ˆæ¯çš„æ—¶å€™,ä¼šè¿”å›ç»™rabbitmqå¯¹åº”queueä¸€ä¸ªackæ¶ˆæ¯,è¿™æ ·å°±ä¿è¯äº†æ¶ˆæ¯æ¶ˆè´¹å®Œæˆ.</p><hr><h2 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§"><a href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§" class="headerlink" title="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§"></a>å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§</h2><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯:"></a>åœºæ™¯:</h3><p>ä¸€èˆ¬æ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬éƒ½æ˜¯æœ‰<strong>é‡è¯•æœºåˆ¶</strong>çš„ï¼Œå°±æ˜¯è¯´æˆ‘ä¸‹æ¸¸çš„ä¸šåŠ¡å‘ç”Ÿå¼‚å¸¸äº†ï¼Œæˆ‘ä¼šæŠ›å‡ºå¼‚å¸¸å¹¶ä¸”è¦æ±‚ä½ <strong>é‡æ–°å‘ä¸€æ¬¡</strong>ã€‚</p><p>æˆ‘è¿™ä¸ªæ´»åŠ¨è¿™é‡Œå‘ç”Ÿé”™è¯¯ï¼Œä½ è¦æ±‚é‡å‘è‚¯å®šæ²¡é—®é¢˜ã€‚ä½†æ˜¯å¤§å®¶<strong>ä»”ç»†æƒ³ä¸€ä¸‹</strong>é—®é¢˜åœ¨å“ªé‡Œï¼Ÿ</p><p>æ˜¯çš„ï¼Œä¸æ­¢ä½ ä¸€ä¸ªäººç›‘å¬è¿™ä¸ªæ¶ˆæ¯å•Šï¼Œ<strong>è¿˜æœ‰åˆ«çš„æœåŠ¡ä¹Ÿåœ¨ç›‘å¬</strong>ï¼Œä»–ä»¬ä¹Ÿä¼šå¤±è´¥å•Šï¼Œä»–ä¸€å¤±è´¥ä»–ä¹Ÿè¦æ±‚é‡å‘ï¼Œä½†æ˜¯ä½ è¿™é‡Œå…¶å®æ˜¯æˆåŠŸçš„ï¼Œé‡å‘äº†ï¼Œä½ çš„é’±ä¸å°±åŠ äº†ä¸¤æ¬¡äº†ï¼Ÿ</p><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p>åœ¨<code>æ¶ˆæ¯ç”Ÿäº§</code>æ—¶ï¼ŒMQ<strong>å†…éƒ¨</strong>é’ˆå¯¹æ¯æ¡ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ç”Ÿæˆä¸€ä¸ªå”¯ä¸€ï¼Œä½œä¸ºå»é‡çš„ä¾æ®ï¼ˆæ¶ˆæ¯æŠ•é€’å¤±è´¥å¹¶é‡ä¼ ï¼‰ï¼Œé¿å…é‡å¤çš„æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—ï¼›<br>åœ¨<code>æ¶ˆæ¯æ¶ˆè´¹</code>æ—¶ï¼Œè¦æ±‚æ¶ˆæ¯ä½“ä¸­å¿…é¡»è¦æœ‰ä¸€ä¸ªbizIdï¼ˆå¯¹äºåŒä¸€ä¸šåŠ¡å…¨å±€å”¯ä¸€ï¼Œå¦‚æ”¯ä»˜IDã€è®¢å•IDã€å¸–å­IDç­‰ï¼‰ä½œä¸ºå»é‡çš„ä¾æ®ï¼Œé¿å…åŒä¸€æ¡æ¶ˆæ¯è¢«é‡å¤æ¶ˆè´¹ã€‚</p><p>è¿™ä¸ªé—®é¢˜é’ˆå¯¹ä¸šåŠ¡åœºæ™¯æ¥ç­”åˆ†ä»¥ä¸‹å‡ ç‚¹ï¼š</p><p>1.æ¯”å¦‚ï¼Œä½ æ‹¿åˆ°è¿™ä¸ªæ¶ˆæ¯åšæ•°æ®åº“çš„insertæ“ä½œã€‚é‚£å°±å®¹æ˜“äº†ï¼Œç»™è¿™ä¸ªæ¶ˆæ¯åšä¸€ä¸ªå”¯ä¸€ä¸»é”®ï¼Œé‚£ä¹ˆå°±ç®—å‡ºç°é‡å¤æ¶ˆè´¹çš„æƒ…å†µï¼Œå°±ä¼šå¯¼è‡´ä¸»é”®å†²çªï¼Œé¿å…æ•°æ®åº“å‡ºç°è„æ•°æ®ã€‚</p><p>2.å†æ¯”å¦‚ï¼Œä½ æ‹¿åˆ°è¿™ä¸ªæ¶ˆæ¯åšredisçš„setçš„æ“ä½œï¼Œé‚£å°±å®¹æ˜“äº†ï¼Œä¸ç”¨è§£å†³ï¼Œå› ä¸ºä½ æ— è®ºsetå‡ æ¬¡ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œsetæ“ä½œæœ¬æ¥å°±ç®—å¹‚ç­‰æ“ä½œã€‚</p><p>3.å¦‚æœä¸Šé¢ä¸¤ç§æƒ…å†µè¿˜ä¸è¡Œï¼Œä¸Šå¤§æ‹›ã€‚å‡†å¤‡ä¸€ä¸ªç¬¬ä¸‰æ–¹ä»‹è´¨,æ¥åšæ¶ˆè´¹è®°å½•ã€‚ä»¥redisä¸ºä¾‹ï¼Œç»™æ¶ˆæ¯åˆ†é…ä¸€ä¸ªå…¨å±€idï¼Œåªè¦æ¶ˆè´¹è¿‡è¯¥æ¶ˆæ¯ï¼Œå°†&lt;id,message&gt;ä»¥K-Vå½¢å¼å†™å…¥redisã€‚é‚£æ¶ˆè´¹è€…å¼€å§‹æ¶ˆè´¹å‰ï¼Œå…ˆå»redisä¸­æŸ¥è¯¢æœ‰æ²¡æ¶ˆè´¹è®°å½•å³å¯ã€‚</p><h2 id="å¦‚ä½•ä¿è¯æ¶ˆè´¹é¡ºåºæ€§"><a href="#å¦‚ä½•ä¿è¯æ¶ˆè´¹é¡ºåºæ€§" class="headerlink" title="å¦‚ä½•ä¿è¯æ¶ˆè´¹é¡ºåºæ€§"></a>å¦‚ä½•ä¿è¯æ¶ˆè´¹é¡ºåºæ€§</h2><h3 id="åœºæ™¯1-å¤šä¸ªconsumer"><a href="#åœºæ™¯1-å¤šä¸ªconsumer" class="headerlink" title="åœºæ™¯1:å¤šä¸ªconsumer"></a>åœºæ™¯1:å¤šä¸ªconsumer</h3><p>ä¸€ä¸ªqueueï¼Œå¤šä¸ªconsumerï¼Œè¿™ä¸æ˜æ˜¾ä¹±äº†,å¦‚ä¸‹ä»£ç :</p><pre><code class="java">@Componentpublic class WorkConsumer {    @RabbitListener(queuesToDeclare = @Queue(name = &quot;work&quot;) )    // @RabbitHandler // ä¸éœ€è¦æ­¤æ³¨è§£äº†    public void receiver1(String message){        System.out.println(&quot;receiver1ï¼š&quot; + message);    }    @RabbitListener(queuesToDeclare = @Queue(name = &quot;work&quot;) )    public void receiver2(String message){        System.out.println(&quot;receiver2ï¼š&quot; + message);    }}</code></pre><p>ç”Ÿäº§è€…æ ¹æ®å•†å“IDè®¡ç®—å‡ºhashå€¼,å¯¹é˜Ÿåˆ—æ•°å–ä½™,å°±å¯ä»¥è®©ç›¸åŒidä¼šå‹åˆ°åŒä¸€é˜Ÿåˆ—;æ‹†åˆ†å¤šä¸ªqueueï¼Œæ¯ä¸ªqueueä¸€ä¸ªconsumerï¼Œå°±æ˜¯å¤šä¸€äº›queueè€Œå·²ï¼Œç¡®å®æ˜¯éº»çƒ¦ç‚¹ï¼Œç„¶åè¿™ä¸ªconsumerå†…éƒ¨ç”¨å†…å­˜é˜Ÿåˆ—åšæ’é˜Ÿï¼Œç„¶ååˆ†å‘ç»™åº•å±‚ä¸åŒçš„workeræ¥å¤„ç†.</p><p><img alt="image-20200526161706292" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf5xacwb7rj30a60e9t92.jpg" class="lazyload"></p><h3 id="åœºæ™¯2-å¤šçº¿ç¨‹"><a href="#åœºæ™¯2-å¤šçº¿ç¨‹" class="headerlink" title="åœºæ™¯2:å¤šçº¿ç¨‹"></a>åœºæ™¯2:å¤šçº¿ç¨‹</h3><p><img alt="image-20200526213155996" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf66dx0l6ij30wy0ahacg.jpg" class="lazyload"></p><hr><h2 id="æœ‰å‡ ç™¾ä¸‡æ¶ˆæ¯æŒç»­ç§¯å‹å‡ å°æ—¶ï¼Œè¯´è¯´æ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#æœ‰å‡ ç™¾ä¸‡æ¶ˆæ¯æŒç»­ç§¯å‹å‡ å°æ—¶ï¼Œè¯´è¯´æ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="æœ‰å‡ ç™¾ä¸‡æ¶ˆæ¯æŒç»­ç§¯å‹å‡ å°æ—¶ï¼Œè¯´è¯´æ€ä¹ˆè§£å†³ï¼Ÿ"></a>æœ‰å‡ ç™¾ä¸‡æ¶ˆæ¯æŒç»­ç§¯å‹å‡ å°æ—¶ï¼Œè¯´è¯´æ€ä¹ˆè§£å†³ï¼Ÿ</h2><h3 id="åœºæ™¯1-å¤§é‡æ¶ˆæ¯åœ¨-mq-é‡Œç§¯å‹äº†å‡ ä¸ªå°æ—¶äº†è¿˜æ²¡è§£å†³"><a href="#åœºæ™¯1-å¤§é‡æ¶ˆæ¯åœ¨-mq-é‡Œç§¯å‹äº†å‡ ä¸ªå°æ—¶äº†è¿˜æ²¡è§£å†³" class="headerlink" title="åœºæ™¯1:å¤§é‡æ¶ˆæ¯åœ¨ mq é‡Œç§¯å‹äº†å‡ ä¸ªå°æ—¶äº†è¿˜æ²¡è§£å†³"></a>åœºæ™¯1:å¤§é‡æ¶ˆæ¯åœ¨ mq é‡Œç§¯å‹äº†å‡ ä¸ªå°æ—¶äº†è¿˜æ²¡è§£å†³</h3><p><code>ç°è±¡</code></p><p>ä½ çœ‹è¿™é—®æ³•ï¼Œå…¶å®æœ¬è´¨é’ˆå¯¹çš„åœºæ™¯ï¼Œéƒ½æ˜¯è¯´å¯èƒ½ä½ çš„æ¶ˆè´¹ç«¯å‡ºäº†é—®é¢˜ï¼Œä¸æ¶ˆè´¹äº†ï¼›æˆ–è€…æ¶ˆè´¹çš„é€Ÿåº¦æå…¶æ…¢ã€‚æ¥ç€å°±å‘çˆ¹äº†ï¼Œå¯èƒ½ä½ çš„æ¶ˆæ¯é˜Ÿåˆ—é›†ç¾¤çš„ç£ç›˜éƒ½å¿«å†™æ»¡äº†ï¼Œéƒ½æ²¡äººæ¶ˆè´¹ï¼Œè¿™ä¸ªæ—¶å€™æ€ä¹ˆåŠï¼Ÿæˆ–è€…æ˜¯è¿™æ•´ä¸ªå°±ç§¯å‹äº†å‡ ä¸ªå°æ—¶ï¼Œä½ è¿™ä¸ªæ—¶å€™æ€ä¹ˆåŠï¼Ÿæˆ–è€…æ˜¯ä½ ç§¯å‹çš„æ—¶é—´å¤ªé•¿äº†ï¼Œå¯¼è‡´æ¯”å¦‚ RabbitMQ è®¾ç½®äº†æ¶ˆæ¯è¿‡æœŸæ—¶é—´åå°±æ²¡äº†æ€ä¹ˆåŠï¼Ÿ</p><p><code>è§£å†³</code></p><p>ä¸€ä¸ªæ¶ˆè´¹è€…ä¸€ç§’æ˜¯ 1000 æ¡ï¼Œä¸€ç§’ 3 ä¸ªæ¶ˆè´¹è€…æ˜¯ 3000 æ¡ï¼Œä¸€åˆ†é’Ÿå°±æ˜¯ 18 ä¸‡æ¡ã€‚æ‰€ä»¥å¦‚æœä½ ç§¯å‹äº†å‡ ç™¾ä¸‡åˆ°ä¸Šåƒä¸‡çš„æ•°æ®ï¼Œå³ä½¿æ¶ˆè´¹è€…æ¢å¤äº†ï¼Œä¹Ÿéœ€è¦å¤§æ¦‚ 1 å°æ—¶çš„æ—¶é—´æ‰èƒ½æ¢å¤è¿‡æ¥ã€‚</p><p>ä¸€èˆ¬è¿™ä¸ªæ—¶å€™ï¼Œåªèƒ½ä¸´æ—¶ç´§æ€¥æ‰©å®¹äº†ï¼Œå…·ä½“æ“ä½œæ­¥éª¤å’Œæ€è·¯å¦‚ä¸‹ï¼š</p><ul><li><strong>å…ˆä¿®å¤ consumer</strong> çš„é—®é¢˜ï¼Œç¡®ä¿å…¶æ¢å¤æ¶ˆè´¹é€Ÿåº¦ï¼Œç„¶åå°†ç°æœ‰ consumer éƒ½åœæ‰ã€‚</li><li>æ–°å»ºä¸€ä¸ª topicï¼Œpartition æ˜¯åŸæ¥çš„ 10 å€ï¼Œ<strong>ä¸´æ—¶å»ºç«‹å¥½åŸå…ˆ 10 å€çš„ queue æ•°é‡</strong>ã€‚</li><li>ç„¶åå†™ä¸€ä¸ªä¸´æ—¶çš„åˆ†å‘æ•°æ®çš„ consumer ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºéƒ¨ç½²ä¸Šå»æ¶ˆè´¹ç§¯å‹çš„æ•°æ®ï¼Œ<strong>æ¶ˆè´¹ä¹‹åä¸åšè€—æ—¶çš„å¤„ç†</strong>ï¼Œç›´æ¥å‡åŒ€è½®è¯¢<strong>å†™å…¥ä¸´æ—¶å»ºç«‹å¥½çš„ 10 å€æ•°é‡çš„ queue</strong>ã€‚</li><li>æ¥ç€ä¸´æ—¶å¾ç”¨ 10 å€çš„æœºå™¨æ¥éƒ¨ç½² consumerï¼Œæ¯ä¸€æ‰¹ consumer æ¶ˆè´¹ä¸€ä¸ªä¸´æ—¶ queue çš„æ•°æ®ã€‚==è¿™ç§åšæ³•ç›¸å½“äºæ˜¯ä¸´æ—¶å°† queue èµ„æºå’Œ consumer èµ„æºæ‰©å¤§ 10 å€ï¼Œä»¥æ­£å¸¸çš„ 10 å€é€Ÿåº¦æ¥æ¶ˆè´¹æ•°æ®ã€‚==</li><li>ç­‰å¿«é€Ÿæ¶ˆè´¹å®Œç§¯å‹æ•°æ®ä¹‹åï¼Œ<strong>å¾—æ¢å¤åŸå…ˆéƒ¨ç½²çš„æ¶æ„</strong>ï¼Œ<strong>é‡æ–°</strong>ç”¨åŸå…ˆçš„ consumer æœºå™¨æ¥æ¶ˆè´¹æ¶ˆæ¯ã€‚</li></ul><h3 id="åœºæ™¯2-mq-ä¸­çš„æ¶ˆæ¯è¿‡æœŸå¤±æ•ˆäº†"><a href="#åœºæ™¯2-mq-ä¸­çš„æ¶ˆæ¯è¿‡æœŸå¤±æ•ˆäº†" class="headerlink" title="åœºæ™¯2:mq ä¸­çš„æ¶ˆæ¯è¿‡æœŸå¤±æ•ˆäº†"></a>åœºæ™¯2:mq ä¸­çš„æ¶ˆæ¯è¿‡æœŸå¤±æ•ˆäº†</h3><p><code>ç°è±¡:</code></p><p>å‡è®¾ä½ ç”¨çš„æ˜¯ RabbitMQï¼ŒRabbtiMQ æ˜¯å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´çš„ï¼Œä¹Ÿå°±æ˜¯ TTLã€‚å¦‚æœæ¶ˆæ¯åœ¨ queue ä¸­ç§¯å‹è¶…è¿‡ä¸€å®šçš„æ—¶é—´å°±ä¼šè¢« RabbitMQ ç»™æ¸…ç†æ‰ï¼Œè¿™ä¸ªæ•°æ®å°±æ²¡äº†ã€‚é‚£è¿™å°±æ˜¯ç¬¬äºŒä¸ªå‘äº†ã€‚è¿™å°±ä¸æ˜¯è¯´æ•°æ®ä¼šå¤§é‡ç§¯å‹åœ¨ mq é‡Œï¼Œè€Œæ˜¯<strong>å¤§é‡çš„æ•°æ®ä¼šç›´æ¥æä¸¢</strong>ã€‚</p><p><code>è§£å†³</code></p><p>è¿™ä¸ªæƒ…å†µä¸‹ï¼Œå°±ä¸æ˜¯è¯´è¦å¢åŠ  consumer æ¶ˆè´¹ç§¯å‹çš„æ¶ˆæ¯ï¼Œå› ä¸ºå®é™…ä¸Šæ²¡å•¥ç§¯å‹ï¼Œè€Œæ˜¯ä¸¢äº†å¤§é‡çš„æ¶ˆæ¯ã€‚æˆ‘ä»¬å¯ä»¥é‡‡å–ä¸€ä¸ªæ–¹æ¡ˆï¼Œå°±æ˜¯<strong>æ‰¹é‡é‡å¯¼</strong>ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰çº¿ä¸Šä¹Ÿæœ‰ç±»ä¼¼çš„åœºæ™¯å¹²è¿‡ã€‚å°±æ˜¯å¤§é‡ç§¯å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å½“æ—¶å°±ç›´æ¥ä¸¢å¼ƒæ•°æ®äº†ï¼Œç„¶åç­‰è¿‡äº†é«˜å³°æœŸä»¥åï¼Œæ¯”å¦‚å¤§å®¶ä¸€èµ·å–å’–å•¡ç†¬å¤œåˆ°æ™šä¸Š12ç‚¹ä»¥åï¼Œç”¨æˆ·éƒ½ç¡è§‰äº†ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¼€å§‹å†™ç¨‹åºï¼Œå°†ä¸¢å¤±çš„é‚£æ‰¹æ•°æ®ï¼Œå†™ä¸ªä¸´æ—¶ç¨‹åºï¼Œä¸€ç‚¹ä¸€ç‚¹çš„æŸ¥å‡ºæ¥ï¼Œç„¶åé‡æ–°çŒå…¥ mq é‡Œé¢å»ï¼ŒæŠŠç™½å¤©ä¸¢çš„æ•°æ®ç»™ä»–è¡¥å›æ¥ã€‚ä¹Ÿåªèƒ½æ˜¯è¿™æ ·äº†ã€‚</p><p>å‡è®¾ 1 ä¸‡ä¸ªè®¢å•ç§¯å‹åœ¨ mq é‡Œé¢ï¼Œæ²¡æœ‰å¤„ç†ï¼Œå…¶ä¸­ 1000 ä¸ªè®¢å•éƒ½ä¸¢äº†ï¼Œä½ åªèƒ½æ‰‹åŠ¨å†™ç¨‹åºæŠŠé‚£ 1000 ä¸ªè®¢å•ç»™æŸ¥å‡ºæ¥ï¼Œæ‰‹åŠ¨å‘åˆ° mq é‡Œå»å†è¡¥ä¸€æ¬¡ã€‚</p><h3 id="åœºæ™¯3-mq-éƒ½å¿«å†™æ»¡äº†"><a href="#åœºæ™¯3-mq-éƒ½å¿«å†™æ»¡äº†" class="headerlink" title="åœºæ™¯3:mq éƒ½å¿«å†™æ»¡äº†"></a>åœºæ™¯3:mq éƒ½å¿«å†™æ»¡äº†</h3><p>å¦‚æœæ¶ˆæ¯ç§¯å‹åœ¨ mq é‡Œï¼Œä½ å¾ˆé•¿æ—¶é—´éƒ½æ²¡æœ‰å¤„ç†æ‰ï¼Œæ­¤æ—¶å¯¼è‡´ mq éƒ½å¿«å†™æ»¡äº†ï¼Œå’‹åŠï¼Ÿè¿™ä¸ªè¿˜æœ‰åˆ«çš„åŠæ³•å—ï¼Ÿæ²¡æœ‰ï¼Œè°è®©ä½ ç¬¬ä¸€ä¸ªæ–¹æ¡ˆæ‰§è¡Œçš„å¤ªæ…¢äº†ï¼Œä½ ä¸´æ—¶å†™ç¨‹åºï¼Œæ¥å…¥æ•°æ®æ¥æ¶ˆè´¹ï¼Œ<strong>æ¶ˆè´¹ä¸€ä¸ªä¸¢å¼ƒä¸€ä¸ªï¼Œéƒ½ä¸è¦äº†</strong>ï¼Œå¿«é€Ÿæ¶ˆè´¹æ‰æ‰€æœ‰çš„æ¶ˆæ¯ã€‚ç„¶åèµ°ç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œåˆ°äº†æ™šä¸Šå†è¡¥æ•°æ®å§ã€‚</p><hr><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="æ­»ä¿¡é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—çš„ä½¿ç”¨"><a href="#æ­»ä¿¡é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—çš„ä½¿ç”¨" class="headerlink" title="æ­»ä¿¡é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—çš„ä½¿ç”¨"></a>æ­»ä¿¡é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—çš„ä½¿ç”¨</h3><p><strong>æ­»ä¿¡æ¶ˆæ¯ï¼š</strong></p><ol><li>æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆBasic.Rejectæˆ–Basic.Nackï¼‰å¹¶ä¸”è®¾ç½® requeue å‚æ•°çš„å€¼ä¸º false</li><li>æ¶ˆæ¯è¿‡æœŸäº†</li><li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§çš„é•¿åº¦</li></ol><p><strong>è¿‡æœŸæ¶ˆæ¯ï¼š</strong></p><p>â€‹        åœ¨ rabbitmq ä¸­å­˜åœ¨2ç§æ–¹å¯è®¾ç½®æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œç¬¬ä¸€ç§é€šè¿‡å¯¹é˜Ÿåˆ—è¿›è¡Œè®¾ç½®ï¼Œè¿™ç§è®¾ç½®åï¼Œè¯¥é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„æ¶ˆæ¯éƒ½å­˜åœ¨ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œç¬¬äºŒç§é€šè¿‡å¯¹æ¶ˆæ¯æœ¬èº«è¿›è¡Œè®¾ç½®ï¼Œé‚£ä¹ˆæ¯æ¡æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´éƒ½ä¸ä¸€æ ·ã€‚å¦‚æœåŒæ—¶ä½¿ç”¨è¿™2ç§æ–¹æ³•ï¼Œé‚£ä¹ˆä»¥è¿‡æœŸæ—¶é—´å°çš„é‚£ä¸ªæ•°å€¼ä¸ºå‡†ã€‚å½“æ¶ˆæ¯è¾¾åˆ°è¿‡æœŸæ—¶é—´è¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œé‚£ä¹ˆé‚£ä¸ªæ¶ˆæ¯å°±æˆä¸ºäº†ä¸€ä¸ª æ­»ä¿¡ æ¶ˆæ¯ã€‚</p><p><strong>é˜Ÿåˆ—è®¾ç½®</strong>ï¼šåœ¨é˜Ÿåˆ—ç”³æ˜çš„æ—¶å€™ä½¿ç”¨ x-message-ttl å‚æ•°ï¼Œå•ä½ä¸º æ¯«ç§’</p><p><strong>å•ä¸ªæ¶ˆæ¯è®¾ç½®</strong>ï¼šæ˜¯è®¾ç½®æ¶ˆæ¯å±æ€§çš„ expiration å‚æ•°çš„å€¼ï¼Œå•ä½ä¸º æ¯«ç§’</p><p><code>å»¶æ—¶é˜Ÿåˆ—</code>ï¼šåœ¨rabbitmqä¸­ä¸å­˜åœ¨å»¶æ—¶é˜Ÿåˆ—ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´å’Œæ­»ä¿¡é˜Ÿåˆ—æ¥æ¨¡æ‹Ÿå‡ºå»¶æ—¶é˜Ÿåˆ—ã€‚æ¶ˆè´¹è€…ç›‘å¬æ­»ä¿¡äº¤æ¢å™¨ç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œä¸è¦ç›‘å¬æ¶ˆæ¯å‘é€çš„é˜Ÿåˆ—ã€‚</p><p><strong>æœ‰äº†ä»¥ä¸Šçš„åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬å®Œæˆä»¥ä¸‹éœ€æ±‚ï¼š</strong></p><p>éœ€æ±‚ï¼šç”¨æˆ·åœ¨ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªè®¢å•ï¼Œå¦‚æœè¶…è¿‡æ—¶é—´ç”¨æˆ·æ²¡æœ‰è¿›è¡Œæ”¯ä»˜ï¼Œé‚£ä¹ˆè‡ªåŠ¨å–æ¶ˆè®¢å•ã€‚</p><p>åˆ†æï¼š</p><p>â€‹    1ã€ä¸Šé¢è¿™ä¸ªæƒ…å†µï¼Œæˆ‘ä»¬å°±é€‚åˆä½¿ç”¨å»¶æ—¶é˜Ÿåˆ—æ¥å®ç°ï¼Œé‚£ä¹ˆå»¶æ—¶é˜Ÿåˆ—å¦‚ä½•åˆ›å»º</p><p>â€‹    2ã€å»¶æ—¶é˜Ÿåˆ—å¯ä»¥ç”± è¿‡æœŸæ¶ˆæ¯+æ­»ä¿¡é˜Ÿåˆ— æ¥æ—¶é—´</p><p>â€‹    3ã€è¿‡æœŸæ¶ˆæ¯é€šè¿‡é˜Ÿåˆ—ä¸­è®¾ç½® x-message-ttl å‚æ•°å®ç°</p><p>â€‹    4ã€æ­»ä¿¡é˜Ÿåˆ—é€šè¿‡åœ¨é˜Ÿåˆ—ç”³æ˜æ—¶ï¼Œç»™é˜Ÿåˆ—è®¾ç½® x-dead-letter-exchange å‚æ•°ï¼Œç„¶åå¦å¤–ç”³æ˜ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šx-dead-letter-exchangeå¯¹åº”çš„äº¤æ¢å™¨ã€‚</p><pre><code class="java">ConnectionFactory factory = new ConnectionFactory(); factory.setHost(&quot;127.0.0.1&quot;); factory.setPort(AMQP.PROTOCOL.PORT); factory.setUsername(&quot;guest&quot;); factory.setPassword(&quot;guest&quot;); Connection connection = factory.newConnection(); Channel channel = connection.createChannel();// å£°æ˜ä¸€ä¸ªæ¥æ”¶è¢«åˆ é™¤çš„æ¶ˆæ¯çš„äº¤æ¢æœºå’Œé˜Ÿåˆ— String EXCHANGE_DEAD_NAME = &quot;exchange.dead&quot;; String QUEUE_DEAD_NAME = &quot;queue_dead&quot;; channel.exchangeDeclare(EXCHANGE_DEAD_NAME, BuiltinExchangeType.DIRECT); channel.queueDeclare(QUEUE_DEAD_NAME, false, false, false, null); channel.queueBind(QUEUE_DEAD_NAME, EXCHANGE_DEAD_NAME, &quot;routingkey.dead&quot;); String EXCHANGE_NAME = &quot;exchange.fanout&quot;; String QUEUE_NAME = &quot;queue_name&quot;; channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT); Map&lt;String, Object&gt; arguments = new HashMap&lt;String, Object&gt;(); // ç»Ÿä¸€è®¾ç½®é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ arguments.put(&quot;x-message-ttl&quot;, 30000); // è®¾ç½®è¶…è¿‡å¤šå°‘æ¯«ç§’æ²¡æœ‰æ¶ˆè´¹è€…æ¥è®¿é—®é˜Ÿåˆ—ï¼Œå°±åˆ é™¤é˜Ÿåˆ—çš„æ—¶é—´ arguments.put(&quot;x-expires&quot;, 20000); // è®¾ç½®é˜Ÿåˆ—çš„æœ€æ–°çš„Næ¡æ¶ˆæ¯ï¼Œå¦‚æœè¶…è¿‡Næ¡ï¼Œå‰é¢çš„æ¶ˆæ¯å°†ä»é˜Ÿåˆ—ä¸­ç§»é™¤æ‰ arguments.put(&quot;x-max-length&quot;, 4); // è®¾ç½®é˜Ÿåˆ—çš„å†…å®¹çš„æœ€å¤§ç©ºé—´ï¼Œè¶…è¿‡è¯¥é˜ˆå€¼å°±åˆ é™¤ä¹‹å‰çš„æ¶ˆæ¯arguments.put(&quot;x-max-length-bytes&quot;, 1024); // å°†åˆ é™¤çš„æ¶ˆæ¯æ¨é€åˆ°æŒ‡å®šçš„äº¤æ¢æœºï¼Œä¸€èˆ¬x-dead-letter-exchangeå’Œx-dead-letter-routing-keyéœ€è¦åŒæ—¶è®¾ç½®arguments.put(&quot;x-dead-letter-exchange&quot;, &quot;exchange.dead&quot;); // å°†åˆ é™¤çš„æ¶ˆæ¯æ¨é€åˆ°æŒ‡å®šçš„äº¤æ¢æœºå¯¹åº”çš„è·¯ç”±é”® arguments.put(&quot;x-dead-letter-routing-key&quot;, &quot;routingkey.dead&quot;); // è®¾ç½®æ¶ˆæ¯çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§å¤§çš„ä¼˜å…ˆè¢«æ¶ˆè´¹ arguments.put(&quot;x-max-priority&quot;, 10); channel.queueDeclare(QUEUE_NAME, false, false, false, arguments); channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;&quot;); String message = &quot;Hello RabbitMQ: &quot;; for(int i = 1; i &lt;= 5; i++) {     // expiration: è®¾ç½®å•æ¡æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´     AMQP.BasicProperties.Builder properties = new AMQP.BasicProperties().builder()            .priority(i).expiration( i * 1000 + &quot;&quot;);     channel.basicPublish(EXCHANGE_NAME, &quot;&quot;, properties.build(), (message + i).getBytes(&quot;UTF-8&quot;)); } channel.close(); connection.close();</code></pre><hr><h3 id="rabbitmqçš„é•œåƒé›†ç¾¤-åç»­æ‹“å±•"><a href="#rabbitmqçš„é•œåƒé›†ç¾¤-åç»­æ‹“å±•" class="headerlink" title="rabbitmqçš„é•œåƒé›†ç¾¤(åç»­æ‹“å±•)"></a>rabbitmqçš„é•œåƒé›†ç¾¤(åç»­æ‹“å±•)</h3><p>è¿™ç§æ¨¡å¼ï¼Œæ‰æ˜¯æ‰€è°“çš„ RabbitMQ çš„é«˜å¯ç”¨æ¨¡å¼ã€‚è·Ÿæ™®é€šé›†ç¾¤æ¨¡å¼ä¸ä¸€æ ·çš„æ˜¯ï¼Œåœ¨é•œåƒé›†ç¾¤æ¨¡å¼ä¸‹ï¼Œä½ åˆ›å»ºçš„ queueï¼Œæ— è®ºå…ƒæ•°æ®è¿˜æ˜¯ queue é‡Œçš„æ¶ˆæ¯éƒ½ä¼š<strong>å­˜åœ¨äºå¤šä¸ªå®ä¾‹ä¸Š</strong>ï¼Œå°±æ˜¯è¯´ï¼Œæ¯ä¸ª RabbitMQ èŠ‚ç‚¹éƒ½æœ‰è¿™ä¸ª queue çš„ä¸€ä¸ª<strong>å®Œæ•´é•œåƒ</strong>ï¼ŒåŒ…å« queue çš„å…¨éƒ¨æ•°æ®çš„æ„æ€ã€‚ç„¶åæ¯æ¬¡ä½ å†™æ¶ˆæ¯åˆ° queue çš„æ—¶å€™ï¼Œéƒ½ä¼šè‡ªåŠ¨æŠŠ<strong>æ¶ˆæ¯åŒæ­¥</strong>åˆ°å¤šä¸ªå®ä¾‹çš„ queue ä¸Šã€‚</p><p><img alt="image-20200526162823922" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf5xm3e7j6j30hf0cgmxi.jpg" class="lazyload"></p><p>é‚£ä¹ˆ<strong>å¦‚ä½•å¼€å¯è¿™ä¸ªé•œåƒé›†ç¾¤æ¨¡å¼</strong>å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼ŒRabbitMQ æœ‰å¾ˆå¥½çš„ç®¡ç†æ§åˆ¶å°ï¼Œå°±æ˜¯åœ¨åå°æ–°å¢ä¸€ä¸ªç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥æ˜¯<strong>é•œåƒé›†ç¾¤æ¨¡å¼çš„ç­–ç•¥</strong>ï¼ŒæŒ‡å®šçš„æ—¶å€™æ˜¯å¯ä»¥è¦æ±‚æ•°æ®åŒæ­¥åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ï¼Œä¹Ÿå¯ä»¥è¦æ±‚åŒæ­¥åˆ°æŒ‡å®šæ•°é‡çš„èŠ‚ç‚¹ï¼Œå†æ¬¡åˆ›å»º queue çš„æ—¶å€™ï¼Œåº”ç”¨è¿™ä¸ªç­–ç•¥ï¼Œå°±ä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°å…¶ä»–çš„èŠ‚ç‚¹ä¸Šå»äº†ã€‚</p><p>è¿™æ ·çš„è¯ï¼Œå¥½å¤„åœ¨äºï¼Œä½ ä»»ä½•ä¸€ä¸ªæœºå™¨å®•æœºäº†ï¼Œæ²¡äº‹å„¿ï¼Œå…¶å®ƒæœºå™¨ï¼ˆèŠ‚ç‚¹ï¼‰è¿˜åŒ…å«äº†è¿™ä¸ª queue çš„å®Œæ•´æ•°æ®ï¼Œåˆ«çš„ consumer éƒ½å¯ä»¥åˆ°å…¶å®ƒèŠ‚ç‚¹ä¸Šå»æ¶ˆè´¹æ•°æ®ã€‚åå¤„åœ¨äºï¼Œç¬¬ä¸€ï¼Œè¿™ä¸ªæ€§èƒ½å¼€é”€ä¹Ÿå¤ªå¤§äº†å§ï¼Œæ¶ˆæ¯éœ€è¦åŒæ­¥åˆ°æ‰€æœ‰æœºå™¨ä¸Šï¼Œå¯¼è‡´ç½‘ç»œå¸¦å®½å‹åŠ›å’Œæ¶ˆè€—å¾ˆé‡ï¼ç¬¬äºŒï¼Œè¿™ä¹ˆç©å„¿ï¼Œä¸æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå°±<strong>æ²¡æœ‰æ‰©å±•æ€§å¯è¨€</strong>äº†ï¼Œå¦‚æœæŸä¸ª queue è´Ÿè½½å¾ˆé‡ï¼Œä½ åŠ æœºå™¨ï¼Œæ–°å¢çš„æœºå™¨ä¹ŸåŒ…å«äº†è¿™ä¸ª queue çš„æ‰€æœ‰æ•°æ®ï¼Œå¹¶<strong>æ²¡æœ‰åŠæ³•çº¿æ€§æ‰©å±•</strong>ä½ çš„ queueã€‚ä½ æƒ³ï¼Œå¦‚æœè¿™ä¸ª queue çš„æ•°æ®é‡å¾ˆå¤§ï¼Œå¤§åˆ°è¿™ä¸ªæœºå™¨ä¸Šçš„å®¹é‡æ— æ³•å®¹çº³äº†ï¼Œæ­¤æ—¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h3 id="RocketMQå…¥é—¨"><a href="#RocketMQå…¥é—¨" class="headerlink" title="RocketMQå…¥é—¨"></a>RocketMQå…¥é—¨</h3><p><a href="https://github.com/AobingJava/JavaFamily/blob/master/docs/mq/RocketMQ.md" target="_blank" rel="noopener">https://github.com/AobingJava/JavaFamily/blob/master/docs/mq/RocketMQ.md</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¶ˆæ¯é˜Ÿåˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¶ˆæ¯é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringæŠ€æœ¯æ€»ç»“</title>
      <link href="/2020/05/12/2.%20Spring/Spring%E6%80%BB%E7%BB%93/"/>
      <url>/2020/05/12/2.%20Spring/Spring%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢çš„è¯"><a href="#å†™åœ¨å‰é¢çš„è¯" class="headerlink" title="å†™åœ¨å‰é¢çš„è¯"></a>å†™åœ¨å‰é¢çš„è¯</h2><p>ç½‘ä¸ŠJavaçš„èµ„æ–™é›¶é›¶æ•£æ•£ï¼Œç”šè‡³æœ‰ä¸€äº›é”™è¯¯ï¼Œä½œè€…å¸Œæœ›èƒ½ç»“åˆè‡ªå·±çš„å®é™…å¼€å‘ç»éªŒå’Œé¢è¯•ç»éªŒï¼Œå¯¹SpringçŸ¥è¯†ä½“ç³»è¿›è¡Œç³»ç»Ÿæ¢³ç†ã€‚</p><p>æœ¬æ–‡å‚è€ƒä¸»è¦ã€å¼•ç”¨ã€‘ä¸­çš„å†…å®¹ï¼Œå¹¶ç»“åˆè‡ªå·±çš„æ—¥å¸¸ç§¯ç´¯ï¼Œæ¬¢è¿ç•™è¨€äº¤æµæŒ‡æ­£ã€‚</p><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><ul><li><p><strong>æ³¨ï¼šæœ¬æ–‡ä¸»è¦å‚è€ƒ</strong></p></li><li><p>é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/e1848e2aa7c3" target="_blank" rel="noopener">https://www.jianshu.com/p/e1848e2aa7c3</a></p></li></ul><h2 id="ä»€ä¹ˆæ˜¯-Spring-æ¡†æ¶"><a href="#ä»€ä¹ˆæ˜¯-Spring-æ¡†æ¶" class="headerlink" title="ä»€ä¹ˆæ˜¯ Spring æ¡†æ¶?"></a>ä»€ä¹ˆæ˜¯ Spring æ¡†æ¶?</h2><p>Spring æ˜¯ä¸€ç§è½»é‡çº§å¼€å‘æ¡†æ¶ï¼Œæ—¨åœ¨æé«˜å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡ä»¥åŠç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚Spring å®˜ç½‘ï¼š<a href="https://spring.io/ã€‚" target="_blank" rel="noopener">https://spring.io/ã€‚</a></p><p>æˆ‘ä»¬ä¸€èˆ¬è¯´ Spring æ¡†æ¶æŒ‡çš„éƒ½æ˜¯ Spring Frameworkï¼Œå®ƒæ˜¯å¾ˆå¤šæ¨¡å—çš„é›†åˆï¼Œä½¿ç”¨è¿™äº›æ¨¡å—å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ååŠ©æˆ‘ä»¬è¿›è¡Œå¼€å‘ã€‚è¿™äº›æ¨¡å—æ˜¯ï¼šæ ¸å¿ƒå®¹å™¨ã€æ•°æ®è®¿é—®/é›†æˆ,ã€Webã€AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ã€å·¥å…·ã€æ¶ˆæ¯å’Œæµ‹è¯•æ¨¡å—ã€‚æ¯”å¦‚ï¼šCore Container ä¸­çš„ Core ç»„ä»¶æ˜¯Spring æ‰€æœ‰ç»„ä»¶çš„æ ¸å¿ƒï¼ŒBeans ç»„ä»¶å’Œ Context ç»„ä»¶æ˜¯å®ç°IOCå’Œä¾èµ–æ³¨å…¥çš„åŸºç¡€ï¼ŒAOPç»„ä»¶ç”¨æ¥å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p><p>Springä¸»è¦ä¸¤ä¸ªæœ‰åŠŸèƒ½ä¸ºæˆ‘ä»¬çš„ä¸šåŠ¡å¯¹è±¡ç®¡ç†æä¾›äº†éå¸¸ä¾¿æ·çš„æ–¹æ³•ï¼š</p><ul><li>IOC/DIï¼ˆæ§åˆ¶åè½¬ï¼ŒDependency Injectionï¼Œä¾èµ–æ³¨å…¥ï¼‰</li><li>AOPï¼ˆAspect Oriented Programmingï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰</li></ul><h2 id="åˆ—ä¸¾ä¸€äº›é‡è¦çš„Springæ¨¡å—ï¼Ÿ"><a href="#åˆ—ä¸¾ä¸€äº›é‡è¦çš„Springæ¨¡å—ï¼Ÿ" class="headerlink" title="åˆ—ä¸¾ä¸€äº›é‡è¦çš„Springæ¨¡å—ï¼Ÿ"></a>åˆ—ä¸¾ä¸€äº›é‡è¦çš„Springæ¨¡å—ï¼Ÿ</h2><p>ä¸‹å›¾å¯¹åº”çš„æ˜¯ Spring4.x ç‰ˆæœ¬ã€‚ç›®å‰æœ€æ–°çš„5.xç‰ˆæœ¬ä¸­ Web æ¨¡å—çš„ Portlet ç»„ä»¶å·²ç»è¢«åºŸå¼ƒæ‰ï¼ŒåŒæ—¶å¢åŠ äº†ç”¨äºå¼‚æ­¥å“åº”å¼å¤„ç†çš„ WebFlux ç»„ä»¶ã€‚</p><p><img alt="image-20200512174528926" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gept5vphtlj30fe0b6tcu.jpg" class="lazyload"></p><ul><li><strong>Spring Coreï¼š</strong> åŸºç¡€,å¯ä»¥è¯´ Spring å…¶ä»–æ‰€æœ‰çš„åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–äºè¯¥ç±»åº“ã€‚ä¸»è¦æä¾› IOC ä¾èµ–æ³¨å…¥åŠŸèƒ½ã€‚</li><li><strong>Spring Aspects</strong> ï¼šè¯¥æ¨¡å—ä¸ºä¸AspectJçš„é›†æˆæä¾›æ”¯æŒã€‚</li><li><strong>Spring AOP</strong> ï¼šæä¾›äº†é¢å‘æ–¹é¢çš„ç¼–ç¨‹å®ç°ã€‚</li><li><strong>Spring JDBC</strong> : Javaæ•°æ®åº“è¿æ¥ã€‚</li><li><strong>Spring JMS</strong> ï¼šJavaæ¶ˆæ¯æœåŠ¡ã€‚</li><li><strong>Spring ORM</strong> : ç”¨äºæ”¯æŒHibernateç­‰ORMå·¥å…·ã€‚</li><li><strong>Spring Web</strong> : ä¸ºåˆ›å»ºWebåº”ç”¨ç¨‹åºæä¾›æ”¯æŒã€‚</li><li><strong>Spring Test</strong> : æä¾›äº†å¯¹ JUnit å’Œ TestNG æµ‹è¯•çš„æ”¯æŒã€‚</li></ul><h2 id="Spring-åˆ›å»ºå¯¹è±¡çš„ä¸‰ç§æ–¹å¼"><a href="#Spring-åˆ›å»ºå¯¹è±¡çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="Spring åˆ›å»ºå¯¹è±¡çš„ä¸‰ç§æ–¹å¼"></a>Spring åˆ›å»ºå¯¹è±¡çš„ä¸‰ç§æ–¹å¼</h2><h3 id="é€šè¿‡æ„é€ æ–¹æ³•åˆ›å»º"><a href="#é€šè¿‡æ„é€ æ–¹æ³•åˆ›å»º" class="headerlink" title="é€šè¿‡æ„é€ æ–¹æ³•åˆ›å»º"></a>é€šè¿‡æ„é€ æ–¹æ³•åˆ›å»º</h3><p>æ— å‚æ„é€ åˆ›å»º:é»˜è®¤æƒ…å†µ.</p><p>æœ‰å‚æ„é€ åˆ›å»º:éœ€è¦æ˜ç¡®é…ç½®</p><p>éœ€è¦åœ¨ç±»ä¸­æä¾›æœ‰å‚æ„é€ æ–¹æ³•</p><p>åœ¨ applicationContext.xml ä¸­è®¾ç½®è°ƒç”¨å“ªä¸ªæ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡</p><p>å¦‚æœè®¾å®šçš„æ¡ä»¶åŒ¹é…å¤šä¸ªæ„é€ æ–¹æ³•æ‰§è¡Œæœ€åçš„æ„é€ æ–¹æ³•</p><p> index : å‚æ•°çš„ç´¢å¼•,ä» 0 å¼€å§‹</p><p>name: å‚æ•°å</p><p>type:ç±»å‹(åŒºåˆ†å¼€å…³é”®å­—å’Œå°è£…ç±» int å’ŒInteger)</p><p><img alt="&lt;bean idâ€” &quot;peo&quot;  refi}l bean  String  value  &lt;constructor-arg index=&quot;O&quot; name= &quot;id&quot; type=&quot;int&quot;  value= &quot;123  &lt;constructor-arg &quot; name= &quot;name&quot;  type= &quot;java. lang.String &quot; value= &quot; " data-src="file:////Users/hepeitan/Library/Group%20Containers/UBF8T346G9.Office/TemporaryItems/msohtmlclip/1F1E534F-4653-F642-94E2-2161574E0DB5.png" class="lazyload"></p><h3 id="å®ä¾‹å·¥å‚"><a href="#å®ä¾‹å·¥å‚" class="headerlink" title="å®ä¾‹å·¥å‚"></a>å®ä¾‹å·¥å‚</h3><p>å·¥å‚è®¾è®¡æ¨¡å¼:å¸®åŠ©åˆ›å»ºç±»å¯¹è±¡.ä¸€ä¸ªå·¥å‚å¯ä»¥ç”Ÿäº§å¤šä¸ªå¯¹è±¡.</p><p>å®ä¾‹å·¥å‚:éœ€è¦å…ˆåˆ›å»ºå·¥å‚,æ‰èƒ½ç”Ÿäº§å¯¹è±¡</p><p>å®ç°æ­¥éª¤:å¿…é¡»è¦æœ‰ä¸€ä¸ªå®ä¾‹å·¥å‚</p><p><img alt="mau  aldoad 3!lqnd  } ,AucnoeFldoad ssep 3!lqnd " data-src="file:////Users/hepeitan/Library/Group%20Containers/UBF8T346G9.Office/TemporaryItems/msohtmlclip/A5CFC417-F152-684B-82FE-FF22186B2533.png" class="lazyload"></p><p>åœ¨ applicationContext.xml ä¸­é…ç½®å·¥å‚å¯¹è±¡å’Œéœ€è¦åˆ›å»ºçš„å¯¹è±¡</p><p><img alt="&lt; ea &quot;  class &quot;com.bjsxt.pojo.PeopLeFactory&quot;&gt;&lt;/â€”  &lt;bean  idâ€” &quot;peol &quot;  factory-bean  &quot;factory &quot;  factory- methodâ€” &quot;newrnstance &quot; bean &gt; " data-src="file:////Users/hepeitan/Library/Group%20Containers/UBF8T346G9.Office/TemporaryItems/msohtmlclip/029DC20C-769F-8D49-8739-3E4C68781972.png" class="lazyload"></p><h3 id="é™æ€å·¥å‚"><a href="#é™æ€å·¥å‚" class="headerlink" title="é™æ€å·¥å‚"></a>é™æ€å·¥å‚</h3><p>ä¸éœ€è¦åˆ›å»ºå·¥å‚,å¿«é€Ÿåˆ›å»ºå¯¹è±¡.</p><p>å®ç°æ­¥éª¤ï¼š</p><p>ç¼–å†™ä¸€ä¸ªé™æ€å·¥å‚(åœ¨æ–¹æ³•ä¸Šæ·»åŠ static)</p><p><img alt="mau  aldoad 311as 3!lqnd  } ,AucnoeFldoad ssep 3!lqnd " data-src="file:////Users/hepeitan/Library/Group%20Containers/UBF8T346G9.Office/TemporaryItems/msohtmlclip/853A1076-8F63-9E46-BEE5-618B18F86FBB.png" class="lazyload"></p><p>åœ¨applicationContext.xml ä¸­</p><pre><code class="xml">&lt;bean id=&quot;peo2&quot; class=&quot;com.bjsxt.pojo.PeopleFactory&quot; factory-method=&quot;newInstance&quot;&gt; &lt;/bean&gt; </code></pre><h2 id="è°ˆè°ˆè‡ªå·±å¯¹äº-Spring-IoC-å’Œ-AOP-çš„ç†è§£"><a href="#è°ˆè°ˆè‡ªå·±å¯¹äº-Spring-IoC-å’Œ-AOP-çš„ç†è§£" class="headerlink" title="è°ˆè°ˆè‡ªå·±å¯¹äº Spring IoC å’Œ AOP çš„ç†è§£"></a>è°ˆè°ˆè‡ªå·±å¯¹äº Spring IoC å’Œ AOP çš„ç†è§£</h2><h3 id="IoC"><a href="#IoC" class="headerlink" title="IoC"></a>IoC</h3><p>ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªç³»ç»Ÿä¸­å¯èƒ½ä¼šæœ‰æˆåƒä¸Šä¸‡ä¸ªå¯¹è±¡ã€‚å¦‚æœè¦æ‰‹å·¥ç»´æŠ¤å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œè¿™æ˜¯ä¸å¯æƒ³è±¡çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨Springçš„XMLæ–‡ä»¶æè¿°å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œç”±Springè‡ªåŠ¨æ¥æ³¨å…¥å®ƒä»¬â€”â€”æ¯”å¦‚Aç±»çš„å®ä¾‹éœ€è¦Bç±»çš„å®ä¾‹ä½œä¸ºå‚æ•°setè¿›å»ã€‚</p><p>IoC å®Œæˆçš„äº‹æƒ…åŸå…ˆç”±ç¨‹åºå‘˜ä¸»åŠ¨é€šè¿‡ new å®ä¾‹åŒ–å¯¹è±¡äº‹æƒ…,è½¬äº¤ç»™ Spring è´Ÿè´£. </p><p>IoC æœ€å¤§çš„ä½œç”¨:<code>è§£è€¦</code>. ç¨‹åºå‘˜ä¸éœ€è¦ç®¡ç†å¯¹è±¡.è§£é™¤äº†å¯¹è±¡ç®¡ç†å’Œç¨‹åºå‘˜ä¹‹é—´çš„è€¦åˆ.</p><p>DIï¼šå½“ä¸€ä¸ªç±»(A)ä¸­éœ€è¦ä¾èµ–å¦ä¸€ä¸ªç±»()å¯¹è±¡æ—¶,æŠŠ B èµ‹å€¼ç»™ A çš„è¿‡ç¨‹å°±å«åšä¾èµ–æ³¨å…¥. </p><p><strong>Spring IOCçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼š</strong> </p><p><img alt="image-20200512175046188" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1geptbathsuj30jo01gwek.jpg" class="lazyload"></p><h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><p>AOP(Aspect-Oriented Programming:é¢å‘åˆ‡é¢ç¼–ç¨‹)èƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œ<strong>å´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆä¾‹å¦‚äº‹åŠ¡å¤„ç†ã€æ—¥å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼‰å°è£…èµ·æ¥</strong>ï¼Œä¾¿äº<strong>å‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç </strong>ï¼Œ<strong>é™ä½æ¨¡å—é—´çš„è€¦åˆåº¦</strong>ï¼Œå¹¶<strong>æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§</strong>ã€‚</p><p><strong>Spring AOPå°±æ˜¯åŸºäºåŠ¨æ€ä»£ç†çš„</strong>ï¼Œå¦‚æœè¦ä»£ç†çš„å¯¹è±¡ï¼Œå®ç°äº†æŸä¸ªæ¥å£ï¼Œé‚£ä¹ˆSpring AOPä¼šä½¿ç”¨<strong>JDK Proxy</strong>ï¼Œå»åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè€Œå¯¹äºæ²¡æœ‰å®ç°æ¥å£çš„å¯¹è±¡ï¼Œå°±æ— æ³•ä½¿ç”¨ JDK Proxy å»è¿›è¡Œä»£ç†äº†ï¼Œè¿™æ—¶å€™Spring AOPä¼šä½¿ç”¨<strong>Cglib</strong> ï¼Œè¿™æ—¶å€™Spring AOPä¼šä½¿ç”¨ <strong>Cglib</strong> ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„å­ç±»æ¥ä½œä¸ºä»£ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img alt="image-20200512202505951" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gepxruoqm3j30jx09r76q.jpg" class="lazyload"></p><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ AspectJ ,Spring AOP å·²ç»é›†æˆäº†AspectJ ï¼ŒAspectJ åº”è¯¥ç®—çš„ä¸Šæ˜¯ Java ç”Ÿæ€ç³»ç»Ÿä¸­æœ€å®Œæ•´çš„ AOP æ¡†æ¶äº†ã€‚</p><p>ä½¿ç”¨ AOP ä¹‹åæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›é€šç”¨åŠŸèƒ½æŠ½è±¡å‡ºæ¥ï¼Œåœ¨éœ€è¦ç”¨åˆ°çš„åœ°æ–¹ç›´æ¥ä½¿ç”¨å³å¯ï¼Œè¿™æ ·å¤§å¤§ç®€åŒ–äº†ä»£ç é‡ã€‚æˆ‘ä»¬éœ€è¦å¢åŠ æ–°åŠŸèƒ½æ—¶ä¹Ÿæ–¹ä¾¿ï¼Œè¿™æ ·ä¹Ÿæé«˜äº†ç³»ç»Ÿæ‰©å±•æ€§ã€‚æ—¥å¿—åŠŸèƒ½ã€äº‹åŠ¡ç®¡ç†ç­‰ç­‰åœºæ™¯éƒ½ç”¨åˆ°äº† AOP ã€‚</p><h2 id="åŠ¨æ€ä»£ç†åŸç†"><a href="#åŠ¨æ€ä»£ç†åŸç†" class="headerlink" title="åŠ¨æ€ä»£ç†åŸç†"></a>åŠ¨æ€ä»£ç†åŸç†</h2><p>é™æ€ä»£ç†æ¨¡å¼æ˜¯é€šè¿‡ä½¿ç”¨å¼•ç”¨ä»£ç†å¯¹è±¡æ¥è®¿é—®çœŸå®å¯¹è±¡ï¼Œåœ¨è¿™é‡Œä»£ç†å¯¹è±¡å……å½“ç”¨äºè¿æ¥å®¢æˆ·ç«¯å’ŒçœŸå®å¯¹è±¡çš„ä¸­ä»‹è€…ã€‚</p><p>æ¯ä¸€ä¸ªç±»éƒ½éœ€è¦åˆ›å»ºä»£ç†å¯¹è±¡ä¼šå¾ˆéº»çƒ¦ï¼Œè€ŒåŠ¨æ€ä»£ç†å°±æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„æœºåˆ¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ç±»çš„åŸºç¡€ä¸ŠåŠ¨æ€ä¸ºé€šè¿‡è¯¥ç±»è·å–çš„å¯¹è±¡æ·»åŠ æ–¹æ³•ã€ä¿®æ”¹è¡Œä¸ºã€‚</p><h3 id="Java-SDKä»£ç†ä¸cglibä»£ç†æ¯”è¾ƒ"><a href="#Java-SDKä»£ç†ä¸cglibä»£ç†æ¯”è¾ƒ" class="headerlink" title="Java SDKä»£ç†ä¸cglibä»£ç†æ¯”è¾ƒ"></a>Java SDKä»£ç†ä¸cglibä»£ç†æ¯”è¾ƒ</h3><p><code>JDKä»£ç†</code>é¢å‘çš„æ˜¯ä¸€ç»„æ¥å£ï¼Œå®ƒä¸ºè¿™äº›æ¥å£åŠ¨æ€åˆ›å»ºäº†ä¸€ä¸ªå®ç°ç±»ã€‚</p><p><code>cglibä»£ç†</code>é¢å‘çš„æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œå®ƒåŠ¨æ€åˆ›å»ºäº†ä¸€ä¸ªæ–°ç±»ï¼Œç»§æ‰¿äº†è¯¥ç±»ï¼Œé‡å†™äº†å…¶æ–¹æ³•ã€‚</p><p><code>JDKä»£ç†</code>çš„æ˜¯å¯¹è±¡ï¼Œéœ€è¦å…ˆæœ‰ä¸€ä¸ªå®é™…å¯¹è±¡ï¼Œè‡ªå®šä¹‰çš„InvocationHandlerå¼•ç”¨è¯¥å¯¹è±¡ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªä»£ç†ç±»å’Œä»£ç†å¯¹è±¡ï¼Œå®¢æˆ·ç«¯è®¿é—®çš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡æœ€åå†è°ƒç”¨å®é™…å¯¹è±¡çš„æ–¹æ³•ã€‚</p><p><code>cglibä»£ç†</code>çš„æ˜¯ç±»ï¼Œåˆ›å»ºçš„å¯¹è±¡åªæœ‰ä¸€ä¸ªã€‚</p><p>å¦‚æœç›®çš„éƒ½æ˜¯ä¸ºä¸€ä¸ªç±»çš„æ–¹æ³•å¢å¼ºåŠŸèƒ½ï¼ŒJava SDKè¦æ±‚è¯¥ç±»å¿…é¡»æœ‰æ¥å£ï¼Œä¸”åªèƒ½å¤„ç†æ¥å£ä¸­çš„æ–¹æ³•ï¼Œcglibæ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚</p><h2 id="Spring-ä¸­çš„-bean-çš„ä½œç”¨åŸŸæœ‰å“ªäº›"><a href="#Spring-ä¸­çš„-bean-çš„ä½œç”¨åŸŸæœ‰å“ªäº›" class="headerlink" title="Spring ä¸­çš„ bean çš„ä½œç”¨åŸŸæœ‰å“ªäº›?"></a>Spring ä¸­çš„ bean çš„ä½œç”¨åŸŸæœ‰å“ªäº›?</h2><p>Springå®šä¹‰äº†å¤šç§Beanä½œç”¨åŸŸï¼Œå¯ä»¥åŸºäºè¿™äº›ä½œç”¨åŸŸåˆ›å»ºbeanï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><strong>å•ä¾‹</strong>ï¼ˆSingletonï¼‰ï¼šåœ¨æ•´ä¸ªåº”ç”¨ä¸­ï¼Œåªåˆ›å»ºbeançš„ä¸€ä¸ªå®ä¾‹ã€‚</li><li><strong>åŸå‹</strong>ï¼ˆPrototypeï¼‰ï¼šå¤šä¾‹,æ¯æ¬¡æ³¨å…¥æˆ–è€…é€šè¿‡Springåº”ç”¨ä¸Šä¸‹æ–‡è·å–çš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„beanå®ä¾‹ã€‚</li><li><strong>ä¼šè¯</strong>ï¼ˆSessionï¼‰ï¼šåœ¨Webåº”ç”¨ä¸­ï¼Œä¸ºæ¯ä¸ªä¼šè¯åˆ›å»ºä¸€ä¸ªbeanå®ä¾‹ã€‚</li><li><strong>è¯·æ±‚</strong>ï¼ˆRquestï¼‰ï¼šåœ¨Webåº”ç”¨ä¸­ï¼Œä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªbeanå®ä¾‹ã€‚</li></ul><p>åœ¨ä»£ç é‡Œçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class="java">@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)public class MyIsBean{...}</code></pre><p>XMLç‰ˆæœ¬ï¼š</p><pre><code class="xml"> &lt;bean id=&quot;BEANID&quot; class = &quot;net.itxm.beans&quot; scope=&quot;prototype&quot;&gt;</code></pre><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringåº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰beanéƒ½æ˜¯ä½œä¸ºä»¥<code>å•ä¾‹</code>ï¼ˆsingletonï¼‰çš„å½¢å¼åˆ›å»ºçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡ç»™å®šçš„ä¸€ä¸ªbeanè¢«æ³¨å…¥åˆ°å…¶ä»–beanå¤šå°‘æ¬¡ï¼Œæ¯æ¬¡æ‰€æ³¨å…¥çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå•ä¾‹beanæ˜¯å¾ˆç†æƒ³çš„æ–¹æ¡ˆã€‚åˆå§‹åŒ–å’Œåƒåœ¾å›æ”¶å¯¹è±¡å®ä¾‹æ‰€å¸¦æ¥çš„æˆæœ¬åªç•™ç»™ä¸€äº›å°è§„æ¨¡ä»»åŠ¡ï¼Œåœ¨è¿™äº›ä»»åŠ¡ä¸­ï¼Œè®©å¯¹è±¡ä¿æŒæ— çŠ¶æ€å¹¶ä¸”åœ¨åº”ç”¨ä¸­åå¤é‡ç”¨è¿™äº›å¯¹è±¡å¯èƒ½å¹¶ä¸åˆç†ã€‚</p><h5 id="scope-å±æ€§"><a href="#scope-å±æ€§" class="headerlink" title="scope å±æ€§"></a>scope å±æ€§</h5><ol><li><bean>çš„å±æ€§</bean></li><li>ä½œç”¨:æ§åˆ¶å¯¹è±¡æœ‰æ•ˆèŒƒå›´(å•ä¾‹,å¤šä¾‹ç­‰)</li><li><bean>æ ‡ç­¾å¯¹åº”çš„å¯¹è±¡é»˜è®¤æ˜¯å•ä¾‹çš„.æ— è®ºè·å–å¤šå°‘æ¬¡,éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡</bean></li><li>scope å¯å–å€¼</li></ol><ul><li>singleton é»˜è®¤å€¼,å•ä¾‹</li><li>prototype å¤šä¾‹,æ¯æ¬¡è·å–é‡æ–°å®ä¾‹åŒ–</li><li>request æ¯æ¬¡è¯·æ±‚é‡æ–°å®ä¾‹åŒ–</li><li>session      æ¯ä¸ªä¼šè¯å¯¹è±¡å†…,å¯¹è±¡æ˜¯å•ä¾‹çš„.</li><li>application      åœ¨application å¯¹è±¡å†…æ˜¯å•ä¾‹</li><li>global    session  springæ¨ å‡º çš„ , ä¾ èµ– äºspring-webmvc-portleç±»ä¼¼äºsession</li></ul><h2 id="Spring-ä¸­çš„å•ä¾‹-bean-çš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—ï¼Ÿ"><a href="#Spring-ä¸­çš„å•ä¾‹-bean-çš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—ï¼Ÿ" class="headerlink" title="Spring ä¸­çš„å•ä¾‹ bean çš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—ï¼Ÿ"></a>Spring ä¸­çš„å•ä¾‹ bean çš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—ï¼Ÿ</h2><p>å¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥å¾ˆå°‘æœ‰äººä¼šå…³æ³¨è¿™ä¸ªé—®é¢˜ã€‚å•ä¾‹ bean å­˜åœ¨çº¿ç¨‹é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºå½“å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è¿™ä¸ªå¯¹è±¡çš„éé™æ€æˆå‘˜å˜é‡çš„å†™æ“ä½œä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><ul><li>åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªThreadLocalæˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜æˆå‘˜å˜é‡ä¿å­˜åœ¨ ThreadLocal ä¸­ã€‚</li></ul><h2 id="Spring-ä¸­çš„-bean-ç”Ÿå‘½å‘¨æœŸï¼ˆiocåŠ è½½è¿‡ç¨‹ï¼‰"><a href="#Spring-ä¸­çš„-bean-ç”Ÿå‘½å‘¨æœŸï¼ˆiocåŠ è½½è¿‡ç¨‹ï¼‰" class="headerlink" title="Spring ä¸­çš„ bean ç”Ÿå‘½å‘¨æœŸï¼ˆiocåŠ è½½è¿‡ç¨‹ï¼‰?"></a>Spring ä¸­çš„ bean ç”Ÿå‘½å‘¨æœŸï¼ˆiocåŠ è½½è¿‡ç¨‹ï¼‰?</h2><p>1ã€æ‰«æSpringé…ç½®æ–‡ä»¶ï¼Œæ ¹æ®æ ‡ç­¾çš„è§£æç»“æœç”ŸæˆbeanDefinitionï¼Œå¹¶å°†æ‰€æœ‰çš„bdå­˜æ”¾åœ¨mapä¸­ã€‚</p><p>2ã€éå†mapï¼Œå¯¹beanDefinitionè¿›è¡Œvalidateæ ¡éªŒï¼ŒåŒ…æ‹¬beanä½œç”¨åŸŸã€æ˜¯ä¸æ˜¯æ‡’åŠ è½½çš„ã€‚</p><p>3ã€å¾—åˆ°beanæ‰€å¯¹åº”çš„classå¯¹è±¡ï¼Œæ¨æ–­æ„é€ æ–¹æ³•ã€‚</p><p>4ã€é€šè¿‡åå°„å®ä¾‹åŒ–è¿™ä¸ªå¯¹è±¡</p><p>5ã€æå‰æš´éœ²ä¸€ä¸ªBeanå·¥å‚å°†BeanFactoryå®¹å™¨å®ä¾‹ä¼ å…¥</p><p>6ã€å¡«å……å±æ€§â€“è‡ªåŠ¨æ³¨å…¥</p><p>7ã€Springä¼šæ£€æµ‹è¯¥å¯¹è±¡æ˜¯å¦å®ç°äº†xxxAwareæ¥å£ï¼Œå¹¶å°†ç›¸å…³çš„xxxAwareå®ä¾‹æ³¨å…¥ç»™bean</p><ul><li>å¦‚æœbeanå®ç°äº†<code>BeanNameAware</code>æ¥å£ï¼ŒSpringå°†beançš„IDä¼ é€’ç»™<strong>setBean-Name()</strong>æ–¹æ³•ï¼›</li><li>å¦‚æœbeanå®ç°äº†<code>BeanFactoryAware</code>æ¥å£ï¼ŒSpringå°†è°ƒç”¨<strong>setBeanFactory()</strong>æ–¹æ³•ï¼Œå°†BeanFactoryå®¹å™¨å®ä¾‹ä¼ å…¥ï¼›</li><li>å¦‚æœbeanå®ç°äº†<code>ApplicationContextAware</code>æ¥å£ï¼ŒSpringå°†è°ƒç”¨<strong>setApplicationContext()</strong>æ–¹æ³•ï¼Œå°†beanæ‰€åœ¨çš„åº”ç”¨ä¸Šä¸‹æ–‡çš„å¼•ç”¨ä¼ å…¥è¿›æ¥ï¼›</li></ul><p>8ã€BeanPostProcessorï¼šå‰ç½®æ–¹æ³•-aop</p><p>9ã€InitializingBeanå’Œinit-methodï¼šæ‰§è¡Œæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•</p><p>10ã€BeanPostProcessorï¼šåç½®æ–¹æ³•-aop</p><p>11ã€å°†Beanæ”¾åˆ°å•ä¾‹æ± ä¸­</p><p>12ã€ä½¿ç”¨</p><p>13ã€destroyï¼šbeançš„é”€æ¯</p><h2 id="Springå¾ªç¯ä¾èµ–èƒ½å¦å¯åŠ¨æˆåŠŸï¼Ÿ"><a href="#Springå¾ªç¯ä¾èµ–èƒ½å¦å¯åŠ¨æˆåŠŸï¼Ÿ" class="headerlink" title="Springå¾ªç¯ä¾èµ–èƒ½å¦å¯åŠ¨æˆåŠŸï¼Ÿ"></a>Springå¾ªç¯ä¾èµ–èƒ½å¦å¯åŠ¨æˆåŠŸï¼Ÿ</h2><h3 id="ä¸‰çº§ç¼“å­˜"><a href="#ä¸‰çº§ç¼“å­˜" class="headerlink" title="ä¸‰çº§ç¼“å­˜"></a><strong>ä¸‰çº§ç¼“å­˜</strong></h3><ul><li>Springèƒ½å¤Ÿè½»æ¾çš„è§£å†³å±æ€§çš„å¾ªç¯ä¾èµ–æ­£å¼ç”¨åˆ°äº†ä¸‰çº§ç¼“å­˜ï¼Œåœ¨AbstractBeanFactoryä¸­æœ‰è¯¦ç»†çš„æ³¨é‡Šã€‚</li></ul><pre><code class="java">    /**ä¸€çº§ç¼“å­˜ï¼Œç”¨äºå­˜æ”¾å®Œå…¨åˆå§‹åŒ–å¥½çš„ beanï¼Œä»è¯¥ç¼“å­˜ä¸­å–å‡ºçš„ bean å¯ä»¥ç›´æ¥ä½¿ç”¨*/    private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(256);    /**äºŒçº§ç¼“å­˜ å­˜æ”¾åŸå§‹çš„ bean å¯¹è±¡ï¼ˆå°šæœªå¡«å……å±æ€§ï¼‰ï¼Œç”¨äºè§£å†³å¾ªç¯ä¾èµ–*/    private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;&gt;(16);            /**ä¸‰çº§ç¼“å­˜ å­˜æ”¾ bean å·¥å‚å¯¹è±¡ï¼Œç”¨äºè§£å†³å¾ªç¯ä¾èµ–*/    private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;&gt;(16);</code></pre><ul><li>ä¸€çº§ç¼“å­˜ï¼šsingletonObjectsï¼Œå­˜æ”¾å®Œå…¨å®ä¾‹åŒ–å±æ€§èµ‹å€¼å®Œæˆçš„Beanï¼Œç›´æ¥å¯ä»¥ä½¿ç”¨ã€‚</li><li>äºŒçº§ç¼“å­˜ï¼šearlySingletonObjectsï¼Œå­˜æ”¾æ—©æœŸBeançš„å¼•ç”¨ï¼Œå°šæœªå±æ€§è£…é…çš„Bean</li><li>ä¸‰çº§ç¼“å­˜ï¼šsingletonFactoriesï¼Œä¸‰çº§ç¼“å­˜ï¼Œå­˜æ”¾å®ä¾‹åŒ–å®Œæˆçš„Beanå·¥å‚ã€‚</li><li>åˆ›å»ºbeançš„æ—¶å€™Springé¦–å…ˆä»ä¸€çº§ç¼“å­˜singletonObjectsä¸­è·å–ã€‚å¦‚æœè·å–ä¸åˆ°ï¼Œå¹¶ä¸”å¯¹è±¡æ­£åœ¨åˆ›å»ºä¸­ï¼Œå°±å†ä»äºŒçº§ç¼“å­˜earlySingletonObjectsä¸­è·å–ï¼Œå¦‚æœè¿˜æ˜¯è·å–ä¸åˆ°å°±ä»ä¸‰çº§ç¼“å­˜singletonFactoriesä¸­å–ï¼ˆBeanè°ƒç”¨æ„é€ å‡½æ•°è¿›è¡Œå®ä¾‹åŒ–åï¼Œå³ä½¿å±æ€§è¿˜æœªå¡«å……ï¼Œå°±å¯ä»¥é€šè¿‡ä¸‰çº§ç¼“å­˜å‘å¤–æå‰æš´éœ²ä¾èµ–çš„å¼•ç”¨å€¼ï¼ˆæå‰æ›å…‰ï¼‰ï¼Œæ ¹æ®å¯¹è±¡å¼•ç”¨èƒ½å®šä½åˆ°å †ä¸­çš„å¯¹è±¡ï¼Œå…¶åŸç†æ˜¯åŸºäºJavaçš„å¼•ç”¨ä¼ é€’ï¼‰ï¼Œå–åˆ°åä»ä¸‰çº§ç¼“å­˜ç§»åŠ¨åˆ°äº†äºŒçº§ç¼“å­˜å®Œå…¨åˆå§‹åŒ–ä¹‹åå°†è‡ªå·±æ”¾å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­ä¾›å…¶ä»–ä½¿ç”¨ã€‚</li></ul><h3 id="å•ä¾‹Bean"><a href="#å•ä¾‹Bean" class="headerlink" title="å•ä¾‹Bean"></a>å•ä¾‹Bean</h3><p>å¯ä»¥<strong>å¯åŠ¨æˆåŠŸ</strong>ï¼ŒSpringåˆ©ç”¨ä¸‰çº§ç¼“å­˜ï¼Œåœ¨å®ä¾‹åŒ–ä¸€ä¸ªbeançš„æ—¶å€™ï¼Œæ˜¯é¦–å…ˆé€’å½’çš„å®ä¾‹åŒ–å…¶æ‰€ä¾èµ–çš„æ‰€æœ‰beanï¼Œç›´åˆ°æŸä¸ªbeanæ²¡æœ‰ä¾èµ–å…¶ä»–beanï¼Œæ­¤æ—¶å°±ä¼šå°†è¯¥å®ä¾‹è¿”å›ï¼Œç„¶ååé€’å½’çš„å°†è·å–åˆ°çš„beanè®¾ç½®ä¸ºå„ä¸ªä¸Šå±‚beançš„å±æ€§ã€‚</p><h3 id="ä¸ºä»€ä¹ˆSpringä¸èƒ½è§£å†³æ„é€ å™¨çš„å¾ªç¯ä¾èµ–ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆSpringä¸èƒ½è§£å†³æ„é€ å™¨çš„å¾ªç¯ä¾èµ–ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆSpringä¸èƒ½è§£å†³æ„é€ å™¨çš„å¾ªç¯ä¾èµ–ï¼Ÿ"></a>ä¸ºä»€ä¹ˆSpringä¸èƒ½è§£å†³æ„é€ å™¨çš„å¾ªç¯ä¾èµ–ï¼Ÿ</h3><p>å› ä¸ºåŠ å…¥singletonFactoriesä¸‰çº§ç¼“å­˜çš„å‰ææ˜¯æ‰§è¡Œäº†æ„é€ å™¨ï¼Œåœ¨Beanè°ƒç”¨æ„é€ å™¨å®ä¾‹åŒ–ä¹‹å‰ï¼Œä¸€äºŒä¸‰çº§ç¼“å­˜å¹¶æ²¡æœ‰Beançš„ä»»ä½•ç›¸å…³ä¿¡æ¯ï¼Œåœ¨å®ä¾‹åŒ–ä¹‹åæ‰æ”¾å…¥ä¸‰çº§ç¼“å­˜ä¸­ï¼Œå› æ­¤å½“getBeançš„æ—¶å€™ç¼“å­˜å¹¶æ²¡æœ‰å‘½ä¸­ï¼Œè¿™æ ·å°±æŠ›å‡ºäº†å¾ªç¯ä¾èµ–çš„å¼‚å¸¸äº†ã€‚</p><p><code>æ„é€ å™¨å¾ªç¯ä¾èµ–è§£å†³åŠæ³•ï¼š</code>åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨@Lazyæ³¨è§£å»¶è¿ŸåŠ è½½ã€‚åœ¨æ³¨å…¥ä¾èµ–æ—¶ï¼Œå…ˆæ³¨å…¥ä»£ç†å¯¹è±¡ï¼Œå½“é¦–æ¬¡ä½¿ç”¨æ—¶å†åˆ›å»ºå¯¹è±¡è¯´æ˜ï¼šä¸€ç§äº’æ–¥çš„å…³ç³»è€Œéå±‚æ¬¡é€’è¿›çš„å…³ç³»ï¼Œæ•…ç§°ä¸ºä¸‰ä¸ªMapè€Œéä¸‰çº§ç¼“å­˜çš„ç¼˜ç”± å®Œæˆæ³¨å…¥ï¼›</p><h3 id="ä¸ºä»€ä¹ˆå¤šå®ä¾‹Beanä¸èƒ½è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå¤šå®ä¾‹Beanä¸èƒ½è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå¤šå®ä¾‹Beanä¸èƒ½è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ"></a>ä¸ºä»€ä¹ˆå¤šå®ä¾‹Beanä¸èƒ½è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ</h3><p>å¤šå®ä¾‹Beanæ˜¯æ¯æ¬¡åˆ›å»ºéƒ½ä¼šè°ƒç”¨doGetBeanæ–¹æ³•ï¼Œè€Œä¸æ˜¯å»ç¼“å­˜é‡Œé¢æ‰¾ï¼Œæ ¹æœ¬æ²¡æœ‰ä½¿ç”¨ä¸€äºŒä¸‰çº§ç¼“å­˜ï¼Œè‚¯å®šä¸èƒ½è§£å†³å¾ªç¯ä¾èµ–ã€‚</p><h2 id="Springå¯åŠ¨æ—¶ï¼Œå­˜åœ¨Idç›¸åŒï¼Œä½†ä¸åŒç±»çš„beanå¯ä»¥å¯åŠ¨æˆåŠŸå—ï¼Ÿ"><a href="#Springå¯åŠ¨æ—¶ï¼Œå­˜åœ¨Idç›¸åŒï¼Œä½†ä¸åŒç±»çš„beanå¯ä»¥å¯åŠ¨æˆåŠŸå—ï¼Ÿ" class="headerlink" title="Springå¯åŠ¨æ—¶ï¼Œå­˜åœ¨Idç›¸åŒï¼Œä½†ä¸åŒç±»çš„beanå¯ä»¥å¯åŠ¨æˆåŠŸå—ï¼Ÿ"></a>Springå¯åŠ¨æ—¶ï¼Œå­˜åœ¨Idç›¸åŒï¼Œä½†ä¸åŒç±»çš„beanå¯ä»¥å¯åŠ¨æˆåŠŸå—ï¼Ÿ</h2><p><a href="https://blog.csdn.net/zgmzyr/article/details/39380477" target="_blank" rel="noopener">https://blog.csdn.net/zgmzyr/article/details/39380477</a></p><p>springå¯åŠ¨æ—¶æœ‰idæˆ–nameä¼˜å…ˆæŒ‰idæˆ–nameè¿›è¡Œæ³¨å…¥ï¼Œæ²¡æœ‰æŒ‰classè¿›è¡Œæ³¨å…¥</p><p>springå¯¹<code>åŒä¸€é…ç½®æ–‡ä»¶</code>ä¸­ç›¸åŒ<strong>idæˆ–è€…name</strong>çš„ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„beanæ—¶ï¼Œåšç›´æ¥æŠ›å¼‚å¸¸çš„å¤„ç†ï¼Œè€Œå¯¹<code>ä¸åŒé…ç½®æ–‡ä»¶</code>ä¸­ç›¸åŒidæˆ–è€…åç§°çš„beanï¼Œåªä¼šåœ¨æ‰“å°æ—¥å¿—çº§åˆ«ä¸ºinfoçš„ä¿¡æ¯ï¼Œä¿¡æ¯å†…å®¹å¤§æ¦‚ä¸ºâ€Overriding bean definition for bean xxx : replacing xxx with beanDefinition â€œ.</p><p>é‚£ä¹ˆæœ€ç»ˆspringå®¹å™¨åªä¼šå®ä¾‹åŒ–åé¢çš„è¿™ä¸ªbeanï¼Œåè€…å°†å‰è€…è¦†ç›–äº†ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¦æ’æŸ¥é—®é¢˜å¾ˆå›°éš¾ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢?é ç¨‹åºå‘˜è‡ªå¾‹ï¼Ÿç»å¯¹ä¸å®šä¹‰é‡å¤åç§°çš„beanï¼Ÿæˆ‘è§‰å¾—è¿™ä¸ªæ˜¯éå¸¸ä¸é è°±çš„,å› ä¸ºé¡¹ç›®ä¾èµ–å¯èƒ½æ¯”è¾ƒå¤æ‚,å¼€å‘äººå‘˜ä¸å°½ç›¸åŒ.æ‰€ä»¥æˆ‘è®¤ä¸ºåªæœ‰é€šè¿‡åœ¨ç¨‹åºä¸­å¼•å…¥ä¸€ç§æŠ¥é”™æœºåˆ¶æ‰èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>ä¸Šæ¬¡åœ¨è°ƒè¯•springæºä»£ç æ—¶ï¼Œæ— æ„ä¸­å‘ç°DefaultListableBeanFactoryç±»æœ‰ä¸€ä¸ª<code>allowBeanDefinitionOverriding</code>å±æ€§,å…¶é»˜è®¤å€¼ä¸ºtrue.</p><p>æƒ³åˆ°åªè¦å°†å…¶å€¼æ›´æ”¹ä¸ºfalseæ—¶å°±å¯èƒ½å¯ä»¥è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œå³å­˜åœ¨idæˆ–è€…nameç›¸åŒçš„beanæ—¶ï¼Œä¸æ˜¯æ‰“å°å‡ºç›¸å…³ä¿¡æ¯ï¼Œè€Œæ˜¯ç›´æ¥æŠ›å¼‚å¸¸ï¼Œè¿™æ ·å°±å¯ä»¥è¿«ä½¿å¼€å‘äººå‘˜å¿…é¡»è§£å†³idæˆ–è€…nameé‡å¤çš„é—®é¢˜åæ‰èƒ½æˆåŠŸå¯åŠ¨å®¹å™¨ã€‚</p><h2 id="Spring-æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#Spring-æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="Spring æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>Spring æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</h2><p>å…³äºä¸‹é¢ä¸€äº›è®¾è®¡æ¨¡å¼çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹ç¬”ä¸»å‰æ®µæ—¶é—´çš„åŸåˆ›æ–‡ç« <a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485303&idx=1&sn=9e4626a1e3f001f9b0d84a6fa0cff04a&chksm=cea248bcf9d5c1aaf48b67cc52bac74eb29d6037848d6cf213b0e5466f2d1fda970db700ba41&token=255050878&lang=zh_CN&scene=21#wechat_redirect" target="_blank" rel="noopener">ã€Šé¢è¯•å®˜:â€œè°ˆè°ˆSpringä¸­éƒ½ç”¨åˆ°äº†é‚£äº›è®¾è®¡æ¨¡å¼?â€ã€‚ã€‹</a> ã€‚</p><ul><li><strong>å·¥å‚è®¾è®¡æ¨¡å¼</strong> : Springä½¿ç”¨å·¥å‚æ¨¡å¼é€šè¿‡ <code>BeanFactory</code>ã€<code>ApplicationContext</code> åˆ›å»º bean å¯¹è±¡ã€‚</li><li><strong>ä»£ç†è®¾è®¡æ¨¡å¼</strong> : Spring AOP åŠŸèƒ½çš„å®ç°ã€‚</li><li><strong>å•ä¾‹è®¾è®¡æ¨¡å¼</strong> : Spring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚</li><li><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong> : Spring ä¸­ <code>jdbcTemplate</code>ã€<code>hibernateTemplate</code> ç­‰</li><li><strong>è£…é¥°å™¨æ¨¡å¼</strong>ï¼š ä¾èµ–æ³¨å…¥å°±éœ€è¦ä½¿ç”¨BeanWrapperã€‚</li><li><strong>ç­–ç•¥æ¨¡å¼</strong>ï¼š Beançš„å®ä¾‹åŒ–çš„æ—¶å€™å†³å®šé‡‡ç”¨ä½•ç§æ–¹å¼åˆå§‹åŒ–beanå®ä¾‹</li><li><strong>é€‚é…å™¨æ¨¡å¼</strong> :Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥(Advice)ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€spring MVC ä¸­ä¹Ÿæ˜¯ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é…<code>Controller</code>ã€‚Adviceï¼ˆé€šçŸ¥ï¼‰çš„ç±»å‹æœ‰ï¼šBeforeAdviceã€AfterReturningAdviceã€ThrowSadvice ç­‰ã€‚æ¯ä¸ªç±»å‹ Adviceï¼ˆé€šçŸ¥ï¼‰éƒ½æœ‰å¯¹åº”çš„æ‹¦æˆªå™¨ï¼ŒMethodBeforeAdviceInterceptorã€AfterReturningAdviceInterceptorã€ThrowsAdviceInterceptorã€‚Spring éœ€è¦å°†æ¯ä¸ª Adviceï¼ˆé€šçŸ¥ï¼‰éƒ½å°è£…æˆå¯¹åº”çš„æ‹¦æˆªå™¨ç±»å‹ï¼Œè¿”å›ç»™å®¹å™¨ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å¯¹ Advice è¿›è¡Œè½¬æ¢ã€‚</li><li>â€¦â€¦</li></ul><h2 id="å°†ä¸€ä¸ªç±»å£°æ˜ä¸ºSpringçš„-bean-çš„æ³¨è§£æœ‰å“ªäº›"><a href="#å°†ä¸€ä¸ªç±»å£°æ˜ä¸ºSpringçš„-bean-çš„æ³¨è§£æœ‰å“ªäº›" class="headerlink" title="å°†ä¸€ä¸ªç±»å£°æ˜ä¸ºSpringçš„ bean çš„æ³¨è§£æœ‰å“ªäº›?"></a>å°†ä¸€ä¸ªç±»å£°æ˜ä¸ºSpringçš„ bean çš„æ³¨è§£æœ‰å“ªäº›?</h2><p>æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ <code>@Autowired</code> æ³¨è§£è‡ªåŠ¨è£…é… beanï¼Œè¦æƒ³æŠŠç±»æ ‡è¯†æˆå¯ç”¨äº <code>@Autowired</code>æ³¨è§£è‡ªåŠ¨è£…é…çš„ bean çš„ç±»,é‡‡ç”¨ä»¥ä¸‹æ³¨è§£å¯å®ç°ï¼š</p><ul><li><code>@Component</code> ï¼šé€šç”¨çš„æ³¨è§£ï¼Œå¯æ ‡æ³¨ä»»æ„ç±»ä¸º <code>Spring</code> ç»„ä»¶ã€‚å¦‚æœä¸€ä¸ªBeanä¸çŸ¥é“å±äºæ‹¿ä¸ªå±‚ï¼Œå¯ä»¥ä½¿ç”¨<code>@Component</code> æ³¨è§£æ ‡æ³¨ã€‚</li><li><code>@Repository</code> : å¯¹åº”æŒä¹…å±‚å³ Dao å±‚ï¼Œä¸»è¦ç”¨äºæ•°æ®åº“ç›¸å…³æ“ä½œã€‚</li><li><code>@Service</code> : å¯¹åº”æœåŠ¡å±‚ï¼Œä¸»è¦æ¶‰åŠä¸€äº›å¤æ‚çš„é€»è¾‘ï¼Œéœ€è¦ç”¨åˆ° Daoå±‚ã€‚</li><li><code>@Controller</code> : å¯¹åº” Spring MVC æ§åˆ¶å±‚ï¼Œä¸»è¦ç”¨æˆ·æ¥å—ç”¨æˆ·è¯·æ±‚å¹¶è°ƒç”¨ Service å±‚è¿”å›æ•°æ®ç»™å‰ç«¯é¡µé¢ã€‚</li></ul><h2 id="AOP-1"><a href="#AOP-1" class="headerlink" title="AOP"></a>AOP</h2><h3 id="AOP-ä¸»è¦åº”ç”¨åœºæ™¯æœ‰ï¼š"><a href="#AOP-ä¸»è¦åº”ç”¨åœºæ™¯æœ‰ï¼š" class="headerlink" title="AOP ä¸»è¦åº”ç”¨åœºæ™¯æœ‰ï¼š"></a><strong>AOP ä¸»è¦åº”ç”¨åœºæ™¯æœ‰ï¼š</strong></h3><ul><li>è®°å½•æ—¥å¿—</li><li>ç›‘æ§æ€§èƒ½</li><li>æƒé™æ§åˆ¶</li><li>äº‹åŠ¡ç®¡ç†</li></ul><h3 id="AOPä½¿ç”¨å“ªç§åŠ¨æ€ä»£ç†"><a href="#AOPä½¿ç”¨å“ªç§åŠ¨æ€ä»£ç†" class="headerlink" title="AOPä½¿ç”¨å“ªç§åŠ¨æ€ä»£ç†?"></a><strong>AOPä½¿ç”¨å“ªç§åŠ¨æ€ä»£ç†?</strong></h3><ul><li>å½“beançš„æ˜¯å®ç°ä¸­å­˜åœ¨æ¥å£æˆ–è€…æ˜¯Proxyçš„å­ç±»ï¼Œâ€”jdkåŠ¨æ€ä»£ç†ï¼›ä¸å­˜åœ¨æ¥å£ï¼Œspringä¼šé‡‡ç”¨CGLIBæ¥ç”Ÿæˆä»£ç†å¯¹è±¡ï¼›</li><li>JDK åŠ¨æ€ä»£ç†ä¸»è¦æ¶‰åŠåˆ° java.lang.reflect åŒ…ä¸­çš„ä¸¤ä¸ªç±»ï¼šProxy å’Œ InvocationHandlerã€‚</li><li>Proxy åˆ©ç”¨ InvocationHandlerï¼ˆå®šä¹‰æ¨ªåˆ‡é€»è¾‘ï¼‰ æ¥å£åŠ¨æ€åˆ›å»º ç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡ã€‚</li></ul><h3 id="jdkåŠ¨æ€ä»£ç†"><a href="#jdkåŠ¨æ€ä»£ç†" class="headerlink" title="jdkåŠ¨æ€ä»£ç†"></a><strong>jdkåŠ¨æ€ä»£ç†</strong></h3><ul><li>é€šè¿‡bindæ–¹æ³•å»ºç«‹ä»£ç†ä¸çœŸå®å¯¹è±¡å…³ç³»ï¼Œé€šè¿‡Proxy.newProxyInstanceï¼ˆtargetï¼‰ç”Ÿæˆä»£ç†å¯¹è±¡</li><li>ä»£ç†å¯¹è±¡é€šè¿‡åå°„invokeæ–¹æ³•å®ç°è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•</li></ul><h3 id="åŠ¨æ€ä»£ç†ä¸é™æ€ä»£ç†åŒºåˆ«"><a href="#åŠ¨æ€ä»£ç†ä¸é™æ€ä»£ç†åŒºåˆ«" class="headerlink" title="åŠ¨æ€ä»£ç†ä¸é™æ€ä»£ç†åŒºåˆ«"></a><strong>åŠ¨æ€ä»£ç†ä¸é™æ€ä»£ç†åŒºåˆ«</strong></h3><ul><li>é™æ€ä»£ç†ï¼Œç¨‹åºè¿è¡Œå‰ä»£ç†ç±»çš„.classæ–‡ä»¶å°±å­˜åœ¨äº†ï¼›</li><li>åŠ¨æ€ä»£ç†ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶åˆ©ç”¨åå°„åŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡&lt;å¤ç”¨æ€§ï¼Œæ˜“ç”¨æ€§ï¼Œæ›´åŠ é›†ä¸­éƒ½è°ƒç”¨invoke&gt;</li></ul><h3 id="CGLIBä¸JDKåŠ¨æ€ä»£ç†åŒºåˆ«"><a href="#CGLIBä¸JDKåŠ¨æ€ä»£ç†åŒºåˆ«" class="headerlink" title="CGLIBä¸JDKåŠ¨æ€ä»£ç†åŒºåˆ«"></a><strong>CGLIBä¸JDKåŠ¨æ€ä»£ç†åŒºåˆ«</strong></h3><ul><li>Jdkå¿…é¡»æä¾›æ¥å£æ‰èƒ½ä½¿ç”¨ï¼›</li><li>CGLIBä¸éœ€è¦ï¼Œåªè¦ä¸€ä¸ªéæŠ½è±¡ç±»å°±èƒ½å®ç°åŠ¨æ€ä»£ç†</li></ul><h2 id="SpringMVC-å·¥ä½œåŸç†äº†è§£å—"><a href="#SpringMVC-å·¥ä½œåŸç†äº†è§£å—" class="headerlink" title="SpringMVC å·¥ä½œåŸç†äº†è§£å—?"></a>SpringMVC å·¥ä½œåŸç†äº†è§£å—?</h2><h3 id="SpringMVCä¸­é‡è¦ç»„ä»¶"><a href="#SpringMVCä¸­é‡è¦ç»„ä»¶" class="headerlink" title="SpringMVCä¸­é‡è¦ç»„ä»¶"></a>SpringMVCä¸­é‡è¦ç»„ä»¶</h3><ol><li>DispatcherServlet : å‰ç«¯æ§åˆ¶å™¨,æ¥æ”¶æ‰€æœ‰è¯·æ±‚(å¦‚æœé…ç½®@WebServlte(â€œ/â€œ)     ä¸åŒ…å«jsp) </li><li>HandlerMapping:     è§£æè¯·æ±‚æ ¼å¼çš„.åˆ¤æ–­å¸Œæœ›è¦æ‰§è¡Œå“ªä¸ªå…·ä½“çš„æ–¹æ³•. </li><li>HandlerAdapter: è´Ÿè´£è°ƒç”¨å…·ä½“çš„æ–¹æ³•. </li><li>ViewResovler:è§†å›¾è§£æå™¨.è§£æç»“æœ,å‡†å¤‡è·³è½¬åˆ°å…·ä½“çš„ç‰©ç†è§†å›¾</li></ol><h3 id="SpringMVCè¯·æ±‚æµç¨‹"><a href="#SpringMVCè¯·æ±‚æµç¨‹" class="headerlink" title="SpringMVCè¯·æ±‚æµç¨‹"></a>SpringMVCè¯·æ±‚æµç¨‹</h3><p><img alt="image-20200512213852945" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gepzwm3m0sj30sf0bxaf4.jpg" class="lazyload"></p><p><img alt="0shrwj.png" data-src="https://s1.ax1x.com/2020/10/10/0shrwj.png" class="lazyload"> </p><p>å‚è€ƒï¼š </p><p><a href="https://www.cnblogs.com/sunniest/p/4555801.html" target="_blank" rel="noopener">https://www.cnblogs.com/sunniest/p/4555801.html</a></p><h2 id="ä»‹ç»ä¸€ä¸‹-SpringBootApplicationæ³¨è§£"><a href="#ä»‹ç»ä¸€ä¸‹-SpringBootApplicationæ³¨è§£" class="headerlink" title="ä»‹ç»ä¸€ä¸‹@SpringBootApplicationæ³¨è§£"></a>ä»‹ç»ä¸€ä¸‹@SpringBootApplicationæ³¨è§£</h2><pre><code>package org.springframework.boot.autoconfigure;@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@SpringBootConfiguration@EnableAutoConfiguration@ComponentScan(excludeFilters = {        @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),        @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })public @interface SpringBootApplication {   ......}package org.springframework.boot;@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Configurationpublic @interface SpringBootConfiguration {}</code></pre><p>å¯ä»¥çœ‹å‡ºå¤§æ¦‚å¯ä»¥æŠŠ <code>@SpringBootApplication</code>çœ‹ä½œæ˜¯ <code>@Configuration</code>ã€<code>@EnableAutoConfiguration</code>ã€<code>@ComponentScan</code>æ³¨è§£çš„é›†åˆã€‚æ ¹æ® SpringBootå®˜ç½‘ï¼Œè¿™ä¸‰ä¸ªæ³¨è§£çš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼š</p><ul><li><code>@EnableAutoConfiguration</code>ï¼šå¯ç”¨ SpringBoot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶</li><li><code>@ComponentScan</code>ï¼š æ‰«æè¢«<code>@Component</code> (<code>@Service</code>,<code>@Controller</code>)æ³¨è§£çš„beanï¼Œæ³¨è§£é»˜è®¤ä¼šæ‰«æè¯¥ç±»æ‰€åœ¨çš„åŒ…ä¸‹æ‰€æœ‰çš„ç±»ã€‚</li><li><code>@Configuration</code>ï¼šå…è®¸åœ¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œé¢å¤–çš„beanæˆ–å¯¼å…¥å…¶ä»–é…ç½®ç±»</li></ul><h2 id="SpringBoot-çš„è‡ªåŠ¨é…ç½®æ˜¯å¦‚ä½•å®ç°çš„"><a href="#SpringBoot-çš„è‡ªåŠ¨é…ç½®æ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="SpringBoot çš„è‡ªåŠ¨é…ç½®æ˜¯å¦‚ä½•å®ç°çš„?"></a>SpringBoot çš„è‡ªåŠ¨é…ç½®æ˜¯å¦‚ä½•å®ç°çš„?</h2><ul><li>@EnableAutoConfigurationæ‰¾åˆ°META-INF/spring.factoriesï¼ˆéœ€è¦åˆ›å»ºçš„beanåœ¨é‡Œé¢ï¼‰é…ç½®æ–‡ä»¶</li><li>è¯»å–æ¯ä¸ªstarterä¸­çš„spring.factoriesæ–‡ä»¶ï¼Œå°†é…ç½®çš„æ‰€æœ‰EnableAutoConï¬gurationçš„å€¼åŠ å…¥åˆ°äº†å®¹å™¨ä¸­ï¼›</li><li>æ ¹æ®Conditionæ³¨è§£åˆ¤æ–­å…¶ä¸­çš„ç±»æ˜¯å¦éœ€è¦åŠ è½½</li><li>å°†è¦åŠ è½½çš„ç±»é€šè¿‡Configrationè¿›è¡ŒåŠ è½½ï¼Œåˆ©ç”¨@ConfigerationPropertiesæ³¨è§£ï¼Œå°†é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯åŠ è½½è¿›æ¥ã€‚</li></ul><p><code>@EnableAutoConfiguration</code>æ˜¯å¯åŠ¨è‡ªåŠ¨é…ç½®çš„å…³é”®ï¼Œæºç å¦‚ä¸‹(å»ºè®®è‡ªå·±æ‰“æ–­ç‚¹è°ƒè¯•ï¼Œèµ°ä¸€éåŸºæœ¬çš„æµç¨‹)ï¼š</p><pre><code class="java">import java.lang.annotation.Documented;import java.lang.annotation.ElementType;import java.lang.annotation.Inherited;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;import org.springframework.context.annotation.Import;@Target({ElementType.TYPE})@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@AutoConfigurationPackage@Import({AutoConfigurationImportSelector.class})public @interface EnableAutoConfiguration {    String ENABLED_OVERRIDE_PROPERTY = &quot;spring.boot.enableautoconfiguration&quot;;    Class&lt;?&gt;[] exclude() default {};    String[] excludeName() default {};}</code></pre><p>ä»¥WebSecurityEnablerConfigurationä¸ºä¾‹ï¼š</p><pre><code class="java">@Configuration@ConditionalOnBean(WebSecurityConfigurerAdapter.class)@ConditionalOnMissingBean(name = BeanIds.SPRING_SECURITY_FILTER_CHAIN)@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)@EnableWebSecuritypublic class WebSecurityEnablerConfiguration {}</code></pre><p><code>WebSecurityEnablerConfiguration</code>ç±»ä¸­ä½¿ç”¨<code>@ConditionalOnBean</code>æŒ‡å®šäº†å®¹å™¨ä¸­å¿…é¡»è¿˜æœ‰<code>WebSecurityConfigurerAdapter</code> ç±»æˆ–å…¶å®ç°ç±»ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ Spring Security é…ç½®ç±»éƒ½ä¼šå»å®ç° <code>WebSecurityConfigurerAdapter</code>ï¼Œè¿™æ ·è‡ªåŠ¨å°†é…ç½®å°±å®Œæˆäº†ã€‚</p><p>æ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://sylvanassun.github.io/2018/01/08/2018-01-08-spring_boot_auto_configure/" target="_blank" rel="noopener">https://sylvanassun.github.io/2018/01/08/2018-01-08-spring_boot_auto_configure/</a></p><h2 id="SpringBootå¯åŠ¨æµç¨‹ï¼ˆæ•–ä¸™ï¼‰"><a href="#SpringBootå¯åŠ¨æµç¨‹ï¼ˆæ•–ä¸™ï¼‰" class="headerlink" title="SpringBootå¯åŠ¨æµç¨‹ï¼ˆæ•–ä¸™ï¼‰"></a>SpringBootå¯åŠ¨æµç¨‹ï¼ˆæ•–ä¸™ï¼‰</h2><ul><li><p>new springApplicationå¯¹è±¡ï¼Œåˆ©ç”¨spiæœºåˆ¶åŠ è½½applicationContextInitializerï¼Œ applicationListeræ¥å£å®ä¾‹ï¼ˆMETA-INF/spring.factoriesï¼‰ï¼›</p></li><li><p>è°ƒrunæ–¹æ³•å‡†å¤‡Environmentï¼ŒåŠ è½½åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆapplicationContextï¼‰ï¼Œå‘å¸ƒäº‹ä»¶ å¾ˆå¤šé€šè¿‡listerå®ç°</p></li><li><p>åˆ›å»ºspringå®¹å™¨ï¼Œ refreshContextï¼ˆï¼‰ ï¼Œå®ç°starterè‡ªåŠ¨åŒ–é…ç½®ï¼Œspring.factoriesæ–‡ä»¶åŠ è½½ï¼Œ beanå®ä¾‹åŒ–</p></li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li>ã€ŠSpring æŠ€æœ¯å†…å¹•ã€‹</li><li><a href="http://www.cnblogs.com/wmyskxz/p/8820371.html" target="_blank" rel="noopener">http://www.cnblogs.com/wmyskxz/p/8820371.html</a></li><li><a href="https://www.journaldev.com/2696/spring-interview-questions-and-answers" target="_blank" rel="noopener">https://www.journaldev.com/2696/spring-interview-questions-and-answers</a></li><li><a href="https://www.edureka.co/blog/interview-questions/spring-interview-questions/" target="_blank" rel="noopener">https://www.edureka.co/blog/interview-questions/spring-interview-questions/</a></li><li><a href="https://howtodoinjava.com/interview-questions/top-spring-interview-questions-with-answers/" target="_blank" rel="noopener">https://howtodoinjava.com/interview-questions/top-spring-interview-questions-with-answers/</a></li><li><a href="http://www.tomaszezula.com/2014/02/09/spring-series-part-5-component-vs-bean/" target="_blank" rel="noopener">http://www.tomaszezula.com/2014/02/09/spring-series-part-5-component-vs-bean/</a></li><li><a href="https://stackoverflow.com/questions/34172888/difference-between-bean-and-autowired" target="_blank" rel="noopener">https://stackoverflow.com/questions/34172888/difference-between-bean-and-autowired</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Synchronized</title>
      <link href="/2020/01/15/1.%20Java%E5%9F%BA%E7%A1%80/Synchronized%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/"/>
      <url>/2020/01/15/1.%20Java%E5%9F%BA%E7%A1%80/Synchronized%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="Synchronizedåº•å±‚å®ç°"><a href="#Synchronizedåº•å±‚å®ç°" class="headerlink" title="Synchronizedåº•å±‚å®ç°"></a>Synchronizedåº•å±‚å®ç°</h2><h2 id="JAVAçº¿ç¨‹é˜»å¡çš„ä»£ä»·"><a href="#JAVAçº¿ç¨‹é˜»å¡çš„ä»£ä»·" class="headerlink" title="JAVAçº¿ç¨‹é˜»å¡çš„ä»£ä»·"></a>JAVAçº¿ç¨‹é˜»å¡çš„ä»£ä»·</h2><p>java çš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°åŸç”Ÿæ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šçš„ï¼Œé˜»å¡å’Œå”¤é†’æ“ä½œç³»ç»Ÿéƒ½éœ€è¦æ“ä½œç³»ç»Ÿä»‹å…¥çš„ï¼Œéœ€è¦åœ¨ç”¨æˆ·æ€å’Œæ ¸å¿ƒæ€ä¹‹é—´è½¬æ¢ã€‚è¿™ç§åˆ‡æ¢ä¼šè€—è´¹å¤§é‡æ“ä½œç³»ç»Ÿèµ„æºï¼Œå› ä¸ºç”¨æˆ·æ€å’Œæ ¸å¿ƒæ€éƒ½æœ‰å„è‡ªä¸“ç”¨çš„å†…å­˜ç©ºé—´ã€å¯„å­˜å™¨ç­‰ã€‚ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€éœ€è¦ä¼ é€’è®¸å¤šå˜é‡ã€å‚æ•°ç»™å†…æ ¸ï¼Œå†…æ ¸ä¹Ÿéœ€è¦ä¿å­˜å¥½ç”¨æˆ·æ€åœ¨åˆ‡æ¢æ—¶çš„å¯„å­˜å™¨å€¼å’Œå˜é‡ã€‚</p><h2 id="markwordå¯¹è±¡å¤´æ ‡è¯†"><a href="#markwordå¯¹è±¡å¤´æ ‡è¯†" class="headerlink" title="markwordå¯¹è±¡å¤´æ ‡è¯†"></a>markwordå¯¹è±¡å¤´æ ‡è¯†</h2><p>markwordæ˜¯javaå¯¹è±¡æ•°æ®ç»“æ„ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä»–çš„æœ€å2bitæ˜¯é”çŠ¶æ€æ ‡è¯†ï¼Œç”¨æ¥æ ‡è®°å½“å‰å¯¹è±¡æ‰€å¤„çš„çŠ¶æ€ã€‚</p><ul><li>01ï¼šæœªé”å®šï¼ˆå¯¹è±¡çš„hashå€¼ã€å¯¹è±¡å¹´é¾„åˆ†ä»£ï¼‰</li><li>00ï¼šè½»é‡çº§é”ï¼ˆæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆï¼‰</li><li>10ï¼šé‡é‡çº§é”ï¼ˆæŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼‰</li><li>01ï¼šåå‘é”ï¼ˆåå‘çº¿ç¨‹IDã€åå‘æ—¶é—´ã€å¯¹è±¡å¹´é¾„ä»£ï¼‰</li></ul><h2 id="Synchronized-å®ç°åŸç†"><a href="#Synchronized-å®ç°åŸç†" class="headerlink" title="Synchronized å®ç°åŸç†"></a>Synchronized å®ç°åŸç†</h2><h2 id="é”å‡çº§"><a href="#é”å‡çº§" class="headerlink" title="é”å‡çº§"></a>é”å‡çº§</h2><p>é”çš„çŠ¶æ€ï¼šæ— é”çŠ¶æ€ã€åå‘é”ã€è½»é‡çº§é”çŠ¶æ€ã€é‡é‡çº§é”çŠ¶æ€ï¼ˆçº§åˆ«ç”±ä½åˆ°é«˜ï¼‰</p><h3 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h3><p>åå‘é”ä»–ä¼šåå‘ç¬¬ä¸€æ¬¡è®¿é—®çš„çº¿ç¨‹ï¼Œå½“çº¿ç¨‹è·å–é”å¯¹è±¡æ—¶ï¼Œä¼šåœ¨javaå¯¹è±¡å¤´markwordä¸­è®°å½•åå‘é”çš„threadIDï¼Œå¹¶ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚å½“åŒä¸€ä¸ªçº¿ç¨‹å†æ¬¡è·å–é”æ—¶ä¼šæ¯”è¾ƒå½“å‰çš„threadIDä¸å¯¹è±¡å¤´ä¸­çš„threadIDæ˜¯å¦ä¸€è‡´ã€‚å¦‚æœä¸€è‡´åˆ™ä¸éœ€è¦é€šè¿‡CASæ¥åŠ é”ã€è§£é”ã€‚å¦‚æœä¸ä¸€è‡´å¹¶ä¸”çº¿ç¨‹è¿˜éœ€è¦æŒç»­æŒæœ‰é”ï¼Œåˆ™æš‚åœå½“å‰çº¿ç¨‹æ’¤é”€åå‘é”ï¼Œå‡çº§ä¸ºè½»é‡çº§é”ã€‚å¦‚æœä¸åœ¨éœ€è¦æŒç»­æŒæœ‰é”åˆ™é”å¯¹è±¡å¤´è®¾ä¸ºæ— é”çŠ¶æ€ï¼Œé‡æ–°è®¾ç½®åå‘é”ã€‚</p><h3 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h3><p>è½»é‡çº§é”ç”±åå‘é”å‡çº§è€Œæ¥ï¼Œåå‘é”è¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹åŒæ­¥å—æ—¶ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹åŠ å…¥é”ç«äº‰çš„æ—¶å€™ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚</p><p>è½»é‡çº§é”è¿‡ç¨‹ï¼š</p><ol><li>çº¿ç¨‹ç”±åå‘é”å‡çº§ä¸ºè½»é‡çº§é”æ—¶ï¼Œä¼šå…ˆæŠŠé”çš„å¯¹è±¡å¤´MarkWordå¤åˆ¶ä¸€ä»½åˆ°çº¿ç¨‹çš„æ ˆå¸§ä¸­ï¼Œå»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ç©ºé—´ï¼ˆLock Recordï¼‰ï¼Œç”¨äºå­˜å‚¨å½“å‰Mark Wordçš„æ‹·è´ã€‚</li><li>è™šæ‹Ÿæœºä½¿ç”¨casæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark WordæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å¯¹è±¡çš„Mark Wordã€‚</li><li>å¦‚æœcasæ“ä½œæˆåŠŸï¼Œåˆ™è¯¥çº¿ç¨‹æ‹¥æœ‰äº†å¯¹è±¡çš„è½»é‡çº§é”ã€‚ç¬¬äºŒä¸ªçº¿ç¨‹casè‡ªé€‰é”ç­‰å¾…é”çº¿ç¨‹é‡Šæ”¾é”ã€‚</li><li>å¦‚æœå¤šä¸ªçº¿ç¨‹ç«äº‰é”ï¼Œè½»é‡çº§é”è¦è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼ŒMark Wordä¸­å­˜å‚¨çš„å°±æ˜¯æŒ‡å‘é‡é‡çº§é”ï¼ˆäº’æ–¥é‡ï¼‰çš„æŒ‡é’ˆã€‚å…¶ä»–ç­‰å¾…çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>synchronizedçš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p><ol><li>æ£€æµ‹Mark Wordé‡Œé¢æ˜¯ä¸æ˜¯å½“å‰çº¿ç¨‹çš„IDï¼Œå¦‚æœæ˜¯ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹å¤„äºåå‘é”</li><li>å¦‚æœä¸æ˜¯ï¼Œåˆ™ä½¿ç”¨CASå°†å½“å‰çº¿ç¨‹çš„IDæ›¿æ¢Mard Wordï¼Œå¦‚æœæˆåŠŸåˆ™è¡¨ç¤ºå½“å‰çº¿ç¨‹è·å¾—åå‘é”ï¼Œç½®åå‘æ ‡å¿—ä½1</li><li>å¦‚æœå¤±è´¥ï¼Œåˆ™è¯´æ˜å‘ç”Ÿç«äº‰ï¼Œæ’¤é”€åå‘é”ï¼Œè¿›è€Œå‡çº§ä¸ºè½»é‡çº§é”ã€‚</li><li>åœ¨çº¿ç¨‹çš„æ ˆå¸§ç”Ÿæˆä¸€æ¡é”è®°å½•ï¼Œå½“å‰çº¿ç¨‹ä½¿ç”¨CASå°†å¯¹è±¡å¤´çš„Mark Wordæ›¿æ¢ä¸ºé”è®°å½•æŒ‡é’ˆï¼Œå¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼ˆä¹Ÿå°±æ˜¯é‚£ä¸ªå¯¹è±¡æŒ‡å‘é”è®°å½•ï¼Œå“ªä¸ªå¯¹è±¡æŒæœ‰é”ï¼Œæ²¡æŒæœ‰å°±CASè‡ªæ—‹ï¼Œè‡ªæ—‹å¤±è´¥å°±å‡çº§ä¸ºé‡é‡çº§é”ï¼‰</li><li>å¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚</li><li>å¦‚æœè‡ªæ—‹æˆåŠŸåˆ™ä¾ç„¶å¤„äºè½»é‡çº§çŠ¶æ€ã€‚</li><li>å¦‚æœè‡ªæ—‹å¤±è´¥ï¼Œåˆ™å‡çº§ä¸ºé‡é‡çº§é”ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> JavaåŸºç¡€ </category>
          
          <category> å¤šçº¿ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼é™æµ</title>
      <link href="/2020/01/15/7.%20%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E9%99%90%E6%B5%81/"/>
      <url>/2020/01/15/7.%20%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E9%99%90%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<h2 id="é™æµç®—æ³•"><a href="#é™æµç®—æ³•" class="headerlink" title="é™æµç®—æ³•"></a>é™æµç®—æ³•</h2><p><strong>å›ºå®šçª—å£</strong></p><p>ï¼ˆ1ï¼‰åˆ’åˆ†æ—¶é—´ä¸ºå¤šä¸ªçª—å£ï¼šå›ºå®šä¸€ä¸ªæ—¶é—´å‘¨æœŸï¼Œå¦‚10ç§’æˆ–è€…30ç§’</p><p>ï¼ˆ2ï¼‰åœ¨æ¯ä¸ªçª—å£æœŸå†…ï¼Œæ¯æœ‰ä¸€ä¸ªè¯·æ±‚ï¼Œè®¡æ•°å™¨åŠ ä¸€</p><p>ï¼ˆ3ï¼‰å¦‚æœè®¡æ•°å™¨è¶…è¿‡äº†é™åˆ¶æ•°é‡ï¼Œåˆ™æœ¬çª—å£å†…æ‰€æœ‰çš„è¯·æ±‚éƒ½è¢«ä¸¢å¼ƒ</p><p>ï¼ˆ4ï¼‰ä¸‹ä¸€ä¸ªæ—¶é—´çª—å£æ—¶ï¼Œè®¡æ•°å™¨é‡ç½®</p><p><strong>æ»‘åŠ¨çª—å£</strong></p><p>æ»‘åŠ¨çª—å£å…¶å®å°±æ˜¯å¯¹å›ºå®šçª—å£åšäº†è¿›ä¸€æ­¥çš„ç»†åˆ†ï¼Œå°†åŸå…ˆçš„ç²’åº¦åˆ‡çš„æ›´ç»†ï¼Œæ¯”å¦‚1åˆ†é’Ÿçš„å›ºå®šçª—å£åˆ‡åˆ†ä¸º60ä¸ª1ç§’çš„æ»‘åŠ¨çª—å£ã€‚ç„¶åç»Ÿè®¡çš„æ—¶é—´èŒƒå›´éšç€æ—¶é—´çš„æ¨ç§»åŒæ­¥åç§»ã€‚</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/UtWdDgynLdb0rlYFa5SMHMlIvQHsKa1dTd6zEqfY056zWdQIEUz33TMDNZF6YlvOFtdHian8N6ib3eoJRtAa1XXg/640?wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºæ˜¯ï¼šå¦‚æœå›ºå®šçª—å£çš„ã€Œå›ºå®šå‘¨æœŸã€å·²ç»å¾ˆå°äº†ï¼Œé‚£ä¹ˆä½¿ç”¨æ»‘åŠ¨çª—å£çš„æ„ä¹‰ä¹Ÿå°±æ²¡æœ‰äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨çš„å›ºå®šçª—å£å‘¨æœŸå·²ç»æ˜¯1ç§’äº†ï¼Œå†åˆ‡åˆ†åˆ°æ¯«ç§’çº§åˆ«èƒ½åè€Œå¾—ä¸å¿å¤±ï¼Œä¼šå¸¦æ¥å·¨å¤§çš„æ€§èƒ½å’Œèµ„æºæŸè€—ã€‚</p><p><strong>æ¼æ¡¶</strong></p><p>ï¼ˆ1ï¼‰å°†æ¯ä¸ªè¯·æ±‚è§†ä¸ºâ€œæ°´æ»´â€æ”¾å…¥æ¼æ¡¶è¿›è¡Œå­˜å‚¨</p><p>ï¼ˆ2ï¼‰æ¼æ¡¶ä»¥å›ºå®šé€Ÿç‡æ¼å‡ºæ°´æ»´ï¼ˆå¤„ç†è¯·æ±‚ï¼‰</p><p>ï¼ˆ3ï¼‰æ¼æ¡¶æ»¡äº†ï¼Œå¤šä½™çš„æ°´æ»´å°±ä¸¢å¼ƒ</p><p><img alt="img" data-src="https://pics6.baidu.com/feed/5d6034a85edf8db1b7a7ce16ef076852574e74e6.jpeg?token=2ca827fd79b590587b7e58fa9d0e6f6f" class="lazyload"></p><p>ç®€å•è¯´æ¥å°±æ˜¯ï¼šå¦‚æœå½“å‰é€Ÿç‡å°äºé˜ˆå€¼åˆ™ç›´æ¥å¤„ç†è¯·æ±‚ï¼Œå¦åˆ™ä¸ç›´æ¥å¤„ç†è¯·æ±‚ï¼Œè¿›å…¥ç¼“å†²åŒºï¼Œå¹¶å¢åŠ å½“å‰æ°´ä½</p><p>æ¼æ¡¶ç®—æ³•å¤šä½¿ç”¨é˜Ÿåˆ—å®ç°ï¼ŒæœåŠ¡çš„è¯·æ±‚ä¼šå­˜åˆ°é˜Ÿåˆ—ä¸­ï¼ŒæœåŠ¡çš„æä¾›æ–¹åˆ™æŒ‰ç…§å›ºå®šçš„é€Ÿç‡ä»é˜Ÿåˆ—ä¸­å–å‡ºè¯·æ±‚å¹¶æ‰§è¡Œï¼Œè¿‡å¤šçš„è¯·æ±‚åˆ™æ”¾åœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿæˆ–ç›´æ¥æ‹’ç»ã€‚</p><p><code>æ¼æ¡¶ç®—æ³•çš„ç¼ºé™·</code>ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå½“çŸ­æ—¶é—´å†…æœ‰å¤§é‡çš„çªå‘è¯·æ±‚æ—¶ï¼Œå³ä¾¿æ­¤æ—¶æœåŠ¡å™¨æ²¡æœ‰ä»»ä½•è´Ÿè½½ï¼Œæ¯ä¸ªè¯·æ±‚ä¹Ÿéƒ½å¾—åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½è¢«å“åº”ã€‚</p><p><strong>ä»¤ç‰Œæ¡¶</strong></p><p>ï¼ˆ1ï¼‰ä»¤ç‰Œä»¥å›ºå®šé€Ÿç‡ç”Ÿæˆ</p><p>ï¼ˆ2ï¼‰ç”Ÿæˆçš„ä»¤ç‰Œæ”¾å…¥ä»¤ç‰Œæ¡¶ä¸­å­˜æ”¾ï¼Œå¦‚æœä»¤ç‰Œæ¡¶æ»¡äº†åˆ™å¤šä½™çš„ä»¤ç‰Œç›´æ¥ä¸¢å¼ƒï¼Œå½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œä¼šå°è¯•ä»ä»¤ç‰Œæ¡¶ä¸­å–ä»¤ç‰Œï¼Œå¾—åˆ°ä»¤ç‰Œçš„è¯·æ±‚å¯ä»¥æ‰§è¡Œ</p><p>ï¼ˆ3ï¼‰å¦‚æœæ¡¶ç©ºäº†ï¼Œåˆ™ä¸¢å¼ƒå–ä»¤ç‰Œçš„è¯·æ±‚</p><p><img alt="img" data-src="https://pics6.baidu.com/feed/ac4bd11373f082024f829b1baddf4eebab641ba8.jpeg?token=d12e747d4133b6b97c99dbdf8b35def9" class="lazyload"></p><p>ä»¤ç‰Œæ¡¶çš„å®¹é‡å¤§å°ç†è®ºä¸Šå°±æ˜¯ç¨‹åºéœ€è¦æ”¯æ’‘çš„æœ€å¤§å¹¶å‘æ•°ã€‚ä»¤ç‰Œæ¡¶ç®—æ³•æ—¢èƒ½å¤Ÿå°†æ‰€æœ‰çš„è¯·æ±‚å¹³å‡åˆ†å¸ƒåˆ°æ—¶é—´åŒºé—´å†…ï¼Œåˆèƒ½æ¥å—æœåŠ¡å™¨èƒ½å¤Ÿæ‰¿å—èŒƒå›´å†…çš„çªå‘è¯·æ±‚ï¼Œå› æ­¤æ˜¯ç›®å‰ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›çš„ä¸€ç§é™æµç®—æ³•ã€‚</p><p>å¯¹äºä»¤ç‰Œæ¡¶çš„ä»£ç å®ç°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨GuavaåŒ…ä¸­çš„RateLimiter</p><p><strong>åˆ†å¸ƒå¼åœºæ™¯</strong></p><p>å•èŠ‚ç‚¹æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨RateLimiterè¿›è¡Œé™æµä¸€ç‚¹é—®é¢˜éƒ½æ²¡æœ‰ã€‚ä½†çº¿ä¸Šæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¸ƒç½²äº†å¤šä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸”å¤šä¸ªèŠ‚ç‚¹æœ€ç»ˆè°ƒç”¨çš„æ˜¯åŒä¸€ä¸ªAPI/æœåŠ¡å•†æ¥å£ã€‚è™½ç„¶æˆ‘ä»¬å¯¹å•ä¸ªèŠ‚ç‚¹èƒ½åšåˆ°å°†QPSé™åˆ¶åœ¨N/sï¼Œä½†æ˜¯å¤šèŠ‚ç‚¹æ¡ä»¶ä¸‹ï¼Œå¦‚æœæ¯ä¸ªèŠ‚ç‚¹å‡æ˜¯N/sï¼Œé‚£ä¹ˆåˆ°æœåŠ¡å•†é‚£è¾¹çš„æ€»è¯·æ±‚å°±æ˜¯<strong>èŠ‚ç‚¹æ•°ä¹˜ä»¥N/s</strong>ï¼Œäºæ˜¯é™æµæ•ˆæœå¤±æ•ˆã€‚ä½¿ç”¨è¯¥æ–¹æ¡ˆå¯¹å•èŠ‚ç‚¹çš„é˜ˆå€¼æ§åˆ¶æ˜¯éš¾ä»¥é€‚åº”åˆ†å¸ƒå¼ç¯å¢ƒçš„ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æœ€ç®€å•çš„æµé‡æ¨¡å‹ï¼š</p><p><img alt="img" data-src="https://pics0.baidu.com/feed/242dd42a2834349beb938ae92fcea0c837d3bef5.jpeg?token=14431143680ac0280ac8006d485f1ef6" class="lazyload"></p><p>ç”¨æˆ·çš„è¯·æ±‚ä»ç½‘å…³è½¬å‘åˆ°åå°æœåŠ¡ï¼Œåå°æœåŠ¡æ‰¿æ¥æµé‡ï¼Œè°ƒç”¨ç¼“å­˜è·å–æ•°æ®ï¼Œç¼“å­˜ä¸­çš„æ•°æ®å’Œæ•°æ®åº“äº¤äº’ã€‚è¿™ä¸ªæ¨¡å‹å°±åƒä¸€ä¸ªæ¼æ–—ä¸€æ ·ï¼Œæµé‡è‡ªä¸Šè€Œä¸‹é€’å‡ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆä¸€ï¼šç½‘å…³é™æµ</strong></p><p>æœåŠ¡ç½‘å…³ï¼Œä½œä¸ºæ•´ä¸ªåˆ†å¸ƒå¼é“¾è·¯ä¸­çš„ç¬¬ä¸€å…³å¡ï¼Œæ‰¿æ¥äº†æ‰€æœ‰ç”¨æˆ·çš„è®¿é—®è¯·æ±‚ï¼Œæ‰€ä»¥ä»è¿™é‡Œé™æµè‚¯å®šæ˜¯å¤§å¤´ã€‚ç›®å‰ä¸»æµçš„ç½‘å…³å±‚æœ‰ä»¥è½¯ä»¶ä¸ºä»£è¡¨çš„Nginxï¼ŒSpring Cloudä¸­çš„Gatewayå’ŒZuulè¿™ç±»çš„ç»„ä»¶ï¼Œå½“ç„¶ä¹Ÿæœ‰ç¡¬ä»¶çš„ç½‘å…³é™æµã€‚</p><p>1.Nginxé™æµï¼šæ€æƒ³å°±æ˜¯æ¼æ¡¶ç®—æ³•ï¼Œå³èƒ½å¤Ÿå¼ºè¡Œä¿è¯è¯·æ±‚å®æ—¶å¤„ç†çš„é€Ÿåº¦ä¸ä¼šè¶…è¿‡è®¾ç½®çš„é˜ˆå€¼</p><p><strong>è§£å†³æ–¹æ¡ˆäºŒï¼šæœåŠ¡é™æµRedis çš„ RateLimiter</strong></p><p><a href="https://segmentfault.com/a/1190000012947169" target="_blank" rel="noopener">https://segmentfault.com/a/1190000012947169</a></p><pre><code class="java">@GetMapping(&quot;/&quot;)public void index(HttpServletResponse response) throws IOException {Jedis jedis = jedisPool.getResource();String token = RedisRateLimiter.acquireTokenFromBucket(jedis, LIMIT, TIMEOUT);if (token == null) {response.sendError(500);}else{//TODO ä½ çš„ä¸šåŠ¡é€»è¾‘}jedisPool.returnResource(jedis);}</code></pre>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç­–ç•¥è®¾è®¡å…¥é—¨</title>
      <link href="/2020/01/15/8.%20%E7%AE%97%E6%B3%95-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E5%85%A5%E9%97%A8/"/>
      <url>/2020/01/15/8.%20%E7%AE%97%E6%B3%95-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¨¡å¼å®šä¹‰"><a href="#æ¨¡å¼å®šä¹‰" class="headerlink" title="æ¨¡å¼å®šä¹‰"></a>æ¨¡å¼å®šä¹‰</h2><p> åœ¨å‰é¢ä¸­å¯¹ç­–ç•¥æ¨¡å¼åº”è¯¥æœ‰äº†ä¸€ä¸ªæœ€åˆæ­¥çš„è®¤è¯†ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯ç­–ç•¥æ¨¡å¼å‘¢ï¼Ÿæ‰€è°“ç­–ç•¥æ¨¡å¼å°±æ˜¯å®šä¹‰äº†ç®—æ³•æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©ä»–ä»¬ä¹‹å‰å¯ä»¥äº’ç›¸è½¬æ¢ï¼Œæ­¤æ¨¡å¼ç„¶è¯¥ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚</p><p> åœ¨è½¯ä»¶ç³»ç»Ÿä¸­æœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥å®ç°åŒä¸€ä¸ªåŠŸèƒ½ï¼Œæ¯”å¦‚æ’åºç®—æ³•å®ƒæœ‰å†’æ³¡æ’åºã€é€‰æ‹©æ’åºã€å¿«é€Ÿæ’åºã€æ’å…¥æ’åºç­‰ç­‰ã€‚è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€ç§ç¡¬ç¼–ç æ–¹æ³•ï¼Œå°±æ˜¯è®²æ‰€ä»¥çš„æ’åºç®—æ³•å…¨éƒ¨å†™åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œæ¯ä¸€ç§ç®—æ³•çš„å…·ä½“å®ç°å¯¹åº”ç€ä¸€ä¸ªæ–¹æ³•ï¼Œç„¶åå†™ä¸€ä¸ªæ€»æ–¹æ³•é€šè¿‡ifâ€¦elseâ€¦æ¥åˆ¤æ–­é€‰æ‹©å…·ä½“çš„æ’åºç®—æ³•ï¼Œä½†æ˜¯è¿™æ ·åšå­˜åœ¨å‡ ä¸ªé—®é¢˜ã€‚</p><p> ç¬¬ä¸€ï¼šå¦‚æœéœ€è¦å¢åŠ æ–°çš„ç®—æ³•ï¼Œåˆ™éœ€è¦ä¿®æ”¹æºä»£ç ã€‚</p><p> ç¬¬äºŒï¼šå¦‚æœæ›´æ–°äº†æ’åºç®—æ³•ï¼Œé‚£ä¹ˆéœ€è¦åœ¨å®¢æˆ·ç«¯ä¹Ÿéœ€è¦ä¿®æ”¹ä»£ç ï¼Œéº»çƒ¦ã€‚</p><p> ç¬¬ä¸‰ï¼šå……æ–¥ç€å¤§é‡çš„ifâ€¦elseâ€¦è¯­å¥ï¼Œä»£ç ç»´æŠ¤æ¯”è¾ƒå›°éš¾ã€‚</p><p> æ‰€ä»¥ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€äº›ç‹¬ç«‹çš„ç±»æ¥å°è£…ä¸åŒçš„ç®—æ³•ï¼Œæ¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»å¯¹åº”ç€ä¸€ä¸ªå…·ä½“çš„ç®—æ³•å®ç°ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°±å°†è¿™é‡Œæ¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»ç§°ä¹‹ä¸ºä¸€ä¸ªç­–ç•¥ã€‚</p><h2 id="æ¨¡å¼ç»“æ„"><a href="#æ¨¡å¼ç»“æ„" class="headerlink" title="æ¨¡å¼ç»“æ„"></a>æ¨¡å¼ç»“æ„</h2><p> ä¸‹å›¾ä¸ºç­–ç•¥æ¨¡å¼çš„ç»“æ„ï¼š</p><p><img alt="1111" data-src="http://static.iocoder.cn/2f52bd2dbe0d666260e08f76cbb9d1f7" class="lazyload"></p><p> è¿™ä¸ªUMLå›¾ä¸çŠ¶æ€æ¨¡å¼çš„å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼ŒçŠ¶æ€æ¨¡å¼æ˜¯é€šè¿‡æ”¹å˜å¯¹è±¡å†…éƒ¨çš„çŠ¶æ€æ¥å¸®åŠ©å¯¹è±¡æ§åˆ¶è‡ªå·±çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£çŠ¶æ€æ¨¡å¼å…¶å®æ˜¯å¯¹çŠ¶æ€è¿›è¡Œå°è£…ï¼Œå®ƒæ˜¯å°†åŠ¨ä½œåŠ¨ä½œçš„å®ç°å’Œè´£ä»»è¿›è¡Œåˆ†å‰²ï¼ŒæŠŠåŠ¨ä½œå§”æ‰˜åˆ°ä»£è¡¨å½“å‰çŠ¶æ€çš„å¯¹è±¡ã€‚è€Œç­–ç•¥æ¨¡å¼æ˜¯å¯¹ç®—æ³•è¿›è¡Œå°è£…ï¼ŒæŠŠç®—æ³•çš„è´£ä»»å’Œç®—æ³•æœ¬èº«è¿›è¡Œåˆ†å‰²å¼€æ¥ï¼ŒåŒæ—¶å§”æ´¾ç»™ä¸åŒçš„å¯¹è±¡è¿›è¡Œç®¡ç†ã€‚ç­–ç•¥æ¨¡å¼æ˜¯å°†ä¸€ä¸ªç³»åˆ—çš„ç®—æ³•å°è£…åˆ°ä¸€ç³»åˆ—çš„ç­–ç•¥é‡Œé¢ã€‚</p><p> å…¶å®å¯¹äºç®—æ³•çš„é€‰æ‹©ï¼Œç­–ç•¥æ¨¡å¼å¹¶ä¸å…³å¿ƒï¼Œå®ƒåªæ˜¯å¯¹ç®—æ³•è¿›è¡Œå°è£…ï¼Œè‡³äºç®—æ³•ä»€ä¹ˆæ—¶å€™ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨ä»€ä¹ˆç®—æ³•éƒ½æ˜¯å®¢æˆ·æ‰€å†³å®šçš„ï¼Œè¿™æ ·å°±æé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œä½†åŒæ—¶ä¹Ÿå¢åŠ äº†å®¢æˆ·çš„è´Ÿæ‹…ï¼Œå› ä¸ºå®¢æˆ·éœ€è¦æ¸…æ¥šçŸ¥é“é€‰æ‹©ä»€ä¹ˆæ ·çš„ç®—æ³•å¯¹è‡ªå·±æœ€æœ‰åˆ©ï¼Œè¿™å°±éœ€è¦å®¢æˆ·å¯¹æ¯ä¸€ä¸ªç®—æ³•éƒ½æ¸…æ¥šçŸ¥é“ä»–ä»¬çš„åŒºåˆ«ã€‚</p><h2 id="æ¨¡å¼å®ç°"><a href="#æ¨¡å¼å®ç°" class="headerlink" title="æ¨¡å¼å®ç°"></a>æ¨¡å¼å®ç°</h2><p> æˆ‘ä»¬éƒ½çŸ¥é“æ’åºç®—æ³•æœ‰å¾ˆå¤šç§ï¼Œä½†æ˜¯ä»€ä¹ˆæ—¶å€™é€‰æ‹©å†’æ³¡æ’åºï¼Œä»€ä¹ˆæ—¶å€™é€‰æ‹©é€‰æ‹©æ’åºï¼Œä»€ä¹ˆæ—¶å€™é€‰æ‹©æ’å…¥æ’åºï¼Œæ‰€ä»¥è¿™é‡Œç”¨æ’åºç®—æ³•æ¥æ¼”ç¤ºç­–ç•¥æ¨¡å¼çš„å®ç°ã€‚ é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åœ¨æ²¡æœ‰ä½¿ç”¨ç­–ç•¥æ¨¡å¼çš„æƒ…å†µã€‚</p><pre><code class="java">public void selectSort(String type){        if(&quot;type1&quot;.equals(type)){            //é€‰æ‹©å¿«é€Ÿæ’åº        }        else if(&quot;type2&quot;.equals(type)){            //é€‰æ‹©æ’å…¥æ’åº        }        else if(&quot;type3&quot;.equals(type)){            //é€‰æ‹©å†’æ³¡æ’åº        }        else if(&quot;type4&quot;.equals(type)){            //é€‰æ‹©é€‰æ‹©æ’åº        }        ......    }</code></pre><p> å¯¹äºè¿™æ ·çš„ä»£ç å®ç°ï¼Œé™¤äº†ä»£ç ä¸­å……æ–¥ç€å¤§é‡çš„ifâ€¦else ifâ€¦else,å¯¼è‡´ç¨‹åºå¯ç»´æŠ¤æ€§å¾ˆå·®ï¼Œè€Œä¸”ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ä¸å¥½ï¼Œå¦‚æœæŸä¸ªæ’åºæ¨¡å—è¿›è¡Œæ›´æ”¹äº†ï¼Œæœ‰å¯èƒ½éœ€è¦ä¿®æ”¹æºä»£ç ã€‚æ‰€ä»¥åœ¨å¯¹äºè¿™æ ·çš„æƒ…æ™¯æ˜¯éå¸¸åˆé€‚ä½¿ç”¨ç­–ç•¥æ¨¡å¼çš„ã€‚</p><p> é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨ç­–ç•¥æ¨¡å¼å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£æä¾›æ’åºç®—æ³•ï¼Œç„¶åå®šä¹‰æƒ³è¦çš„æ’åºç®—æ³•ï¼Œå®ç°ç»™æ¥å£å³å¯ã€‚å¦‚ä¸‹ï¼š</p><p><img alt="222" data-src="http://static.iocoder.cn/921d2248385b5cdcecf0d3fc1626cd5f" class="lazyload"></p><h3 id="å®šä¹‰æ¥å£ç±»"><a href="#å®šä¹‰æ¥å£ç±»" class="headerlink" title="å®šä¹‰æ¥å£ç±»"></a>å®šä¹‰æ¥å£ç±»</h3><p>é¦–å…ˆæ˜¯Sortæ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº†æ’åºç®—æ³•ï¼Œæ‰€æœ‰çš„æ’åºç®—æ³•éƒ½åº”è¯¥å®ç°è¯¥æ¥å£ã€‚</p><pre><code class="java">public interface Sort{    public abstract int[] sort(int arr[]);}</code></pre><h3 id="å…·ä½“å®ç°ç±»"><a href="#å…·ä½“å®ç°ç±»" class="headerlink" title="å…·ä½“å®ç°ç±»"></a>å…·ä½“å®ç°ç±»</h3><p>ç„¶åæ˜¯ä¸‰ä¸ªå…·ä½“çš„æ’åºç®—æ³•ï¼Œä»–ä»¬å®ç°Sortæ¥å£ã€‚</p><p> å†’æ³¡æ’åºï¼šBubbleSort.java</p><pre><code class="Java">public class BubbleSort implements Sort{    public int[] sort(int arr[]){       int len=arr.length;       for(int i=0;i&lt;len;i++){           for(int j=i+1;j&lt;len;j++){              int temp;              if(arr[i]&gt;arr[j]){                  temp=arr[j];                  arr[j]=arr[i];                  arr[i]=temp;              }           }        }        System.out.println(&quot;å†’æ³¡æ’åº&quot;);        return arr;    }}</code></pre><p> æ’å…¥æ’åºï¼šInsertionSort.java</p><pre><code>public class InsertionSort implements Sort {    public int[] sort(int arr[]) {        int len = arr.length;        for (int i = 1; i &lt; len; i++) {            int j;            int temp = arr[i];            for (j = i; j &gt; 0; j--) {                if (arr[j - 1] &gt; temp) {                    arr[j] = arr[j - 1];                } else                    break;            }            arr[j] = temp;        }        System.out.println(&quot;æ’å…¥æ’åº&quot;);        return arr;    }}</code></pre><p> é€‰æ‹©æ’åºï¼šSelectSort.java</p><pre><code>public class SelectionSort implements Sort {    public int[] sort(int arr[]) {        int len = arr.length;        int temp;        for (int i = 0; i &lt; len; i++) {            temp = arr[i];            int j;            int samllestLocation = i;            for (j = i + 1; j &lt; len; j++) {                if (arr[j] &lt; temp) {                    temp = arr[j];                    samllestLocation = j;                }            }            arr[samllestLocation] = arr[i];            arr[i] = temp;        }        System.out.println(&quot;Ñ¡ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½&quot;);        return arr;    }}</code></pre><h3 id="å®šä¹‰å¤„ç†å™¨"><a href="#å®šä¹‰å¤„ç†å™¨" class="headerlink" title="å®šä¹‰å¤„ç†å™¨"></a>å®šä¹‰å¤„ç†å™¨</h3><p>æœ€åå°±æ˜¯æµ‹è¯•ç±»å®¢æˆ·ç«¯äº†Client.java</p><pre><code class="java">public class ArrayHandler{    private Sort sortObj;    public int[] sort(int arr[])    {        sortObj.sort(arr);        return arr;    }    public void setSortObj(Sort sortObj) {        this.sortObj = sortObj;    }}</code></pre><h3 id="è°ƒç”¨è¿‡ç¨‹ï¼šç”±å¤„ç†å™¨æ ¹æ®éœ€è¦é€‰æ‹©å…·ä½“å®ç°"><a href="#è°ƒç”¨è¿‡ç¨‹ï¼šç”±å¤„ç†å™¨æ ¹æ®éœ€è¦é€‰æ‹©å…·ä½“å®ç°" class="headerlink" title="è°ƒç”¨è¿‡ç¨‹ï¼šç”±å¤„ç†å™¨æ ¹æ®éœ€è¦é€‰æ‹©å…·ä½“å®ç°"></a>è°ƒç”¨è¿‡ç¨‹ï¼šç”±å¤„ç†å™¨æ ¹æ®éœ€è¦é€‰æ‹©å…·ä½“å®ç°</h3><pre><code class="java">public class Client{    public static void main(String args[])    {       int arr[]={1,4,6,2,5,3,7,10,9};       int result[];       ArrayHandler ah=new ArrayHandler();       Sort sort = new SelectionSort();    //ä½¿ç”¨é€‰æ‹©æ’åº       ah.setSortObj(sort); //è®¾ç½®å…·ä½“ç­–ç•¥       result=ah.sort(arr);       for(int i=0;i&lt;result.length;i++)       {               System.out.print(result[i] + &quot;,&quot;);       }    }}</code></pre><p> è¿è¡Œç»“æœ</p><p> é¸æ“‡æ’åº 1,2,3,4,5,6,7,9,10,</p><h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p> 1ã€ç­–ç•¥æ¨¡å¼æä¾›äº†å¯¹â€œå¼€é—­åŸåˆ™â€çš„å®Œç¾æ”¯æŒï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ç³»ç»Ÿçš„åŸºç¡€ä¸Šé€‰æ‹©ç®—æ³•æˆ–è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥çµæ´»åœ°å¢åŠ æ–°çš„ç®—æ³•æˆ–è¡Œä¸ºã€‚ 2ã€ç­–ç•¥æ¨¡å¼æä¾›äº†å¯ä»¥æ›¿æ¢ç»§æ‰¿å…³ç³»çš„åŠæ³•ã€‚</p><p> 3ã€ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è½¬ç§»è¯­å¥ã€‚</p><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p> 1ã€å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚ 2ã€ç­–ç•¥æ¨¡å¼å°†é€ æˆäº§ç”Ÿå¾ˆå¤šç­–ç•¥ç±»ï¼Œ</p><h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><p> 1ã€å¦‚æœåœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œé¢æœ‰è®¸å¤šç±»ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä»…åœ¨äºå®ƒä»¬çš„è¡Œä¸ºï¼Œé‚£ä¹ˆä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°è®©ä¸€ä¸ªå¯¹è±¡åœ¨è®¸å¤šè¡Œä¸ºä¸­é€‰æ‹©ä¸€ç§è¡Œä¸ºã€‚ 2ã€ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç­–ç•¥è®¾è®¡æ¨¡å¼å¹²æ‰if else!</title>
      <link href="/2020/01/15/8.%20%E7%AE%97%E6%B3%95-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%BB%93%E5%90%88Spring%E6%9B%BF%E6%8D%A2ifelse/"/>
      <url>/2020/01/15/8.%20%E7%AE%97%E6%B3%95-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%BB%93%E5%90%88Spring%E6%9B%BF%E6%8D%A2ifelse/</url>
      
        <content type="html"><![CDATA[<h2 id="åœ¨-Spring-Boot-ä¸­ï¼Œå¦‚ä½•å¹²æ‰-if-elseï¼"><a href="#åœ¨-Spring-Boot-ä¸­ï¼Œå¦‚ä½•å¹²æ‰-if-elseï¼" class="headerlink" title="åœ¨ Spring Boot ä¸­ï¼Œå¦‚ä½•å¹²æ‰ if elseï¼"></a>åœ¨ Spring Boot ä¸­ï¼Œå¦‚ä½•å¹²æ‰ if elseï¼</h2><ul><li>éœ€æ±‚</li><li>ä¼ ç»Ÿå®ç°</li><li>ç­–ç•¥æ¨¡å¼å®ç°</li><li>ClassScannerï¼šæ‰«æå·¥å…·ç±»æºç </li><li>æ€»ç»“</li></ul><hr><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>è¿™é‡Œè™šæ‹Ÿä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼Œè®©å¤§å®¶å®¹æ˜“ç†è§£ã€‚å‡è®¾æœ‰ä¸€ä¸ªè®¢å•ç³»ç»Ÿï¼Œé‡Œé¢çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯æ ¹æ®è®¢å•çš„ä¸åŒç±»å‹ä½œå‡ºä¸åŒçš„å¤„ç†ã€‚</p><p>è®¢å•å®ä½“ï¼š</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6mychickmupXel0UdaMtVlVTibgclNpKJ3nRrlcicMHL9l2yciclelUU2Reswf6JErLXmxj94DjLGniaUibOM9Nvod9g/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>serviceæ¥å£ï¼š</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6mychickmupXel0UdaMtVlVTibgclNpKJ3zZMobPBmbDY28PeS8swV0xrVOMhLMicgZz1cGpn7h6icp1GbqiaW0TAIA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h2 id="ä¼ ç»Ÿå®ç°"><a href="#ä¼ ç»Ÿå®ç°" class="headerlink" title="ä¼ ç»Ÿå®ç°"></a>ä¼ ç»Ÿå®ç°</h2><p>æ ¹æ®è®¢å•ç±»å‹å†™ä¸€å †çš„if elseï¼š</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6mychickmupXel0UdaMtVlVTibgclNpKJ3dJfeLzgdGXtE1Z3QmSqW4yvVYFEMQF0YPFHpehoZxeEcJUrEPviaiamQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h2 id="ç­–ç•¥æ¨¡å¼å®ç°"><a href="#ç­–ç•¥æ¨¡å¼å®ç°" class="headerlink" title="ç­–ç•¥æ¨¡å¼å®ç°"></a>ç­–ç•¥æ¨¡å¼å®ç°</h2><h3 id="è°ƒç”¨ï¼šç”±æ§åˆ¶å™¨é€‰æ‹©å…·ä½“å®ç°"><a href="#è°ƒç”¨ï¼šç”±æ§åˆ¶å™¨é€‰æ‹©å…·ä½“å®ç°" class="headerlink" title="è°ƒç”¨ï¼šç”±æ§åˆ¶å™¨é€‰æ‹©å…·ä½“å®ç°"></a>è°ƒç”¨ï¼šç”±æ§åˆ¶å™¨é€‰æ‹©å…·ä½“å®ç°</h3><p>åˆ©ç”¨ç­–ç•¥æ¨¡å¼ï¼Œåªéœ€è¦ä¸¤è¡Œå³å¯å®ç°ä¸šåŠ¡é€»è¾‘ï¼š</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6mychickmupXel0UdaMtVlVTibgclNpKJ373vrSV8RkliaK66IJlegYc9Nv0vgSTmE8BcBQyFOkDStbG9sLL1Zbvg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„æ–¹æ³•ä¸­æ³¨å…¥äº†HandlerContextï¼Œè¿™æ˜¯ä¸€ä¸ªå¤„ç†å™¨ä¸Šä¸‹æ–‡ï¼Œç”¨æ¥ä¿å­˜ä¸åŒçš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œå…·ä½“åœ¨ä¸‹æ–‡ä¼šè®²è§£ã€‚æˆ‘ä»¬ä»ä¸­è·å–ä¸€ä¸ªæŠ½è±¡çš„å¤„ç†å™¨AbstractHandlerï¼Œè°ƒç”¨å…¶æ–¹æ³•å®ç°ä¸šåŠ¡é€»è¾‘ã€‚</p><p>ç°åœ¨å¯ä»¥äº†è§£åˆ°ï¼Œæˆ‘ä»¬ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘æ˜¯åœ¨å¤„ç†å™¨ä¸­å®ç°çš„ï¼Œå› æ­¤æœ‰å¤šå°‘ä¸ªè®¢å•ç±»å‹ï¼Œå°±å¯¹åº”æœ‰å¤šå°‘ä¸ªå¤„ç†å™¨ã€‚ä»¥åéœ€æ±‚å˜åŒ–ï¼Œå¢åŠ äº†è®¢å•ç±»å‹ï¼Œåªéœ€è¦æ·»åŠ ç›¸åº”çš„å¤„ç†å™¨å°±å¯ä»¥ï¼Œä¸Šè¿°OrderServiceV2Implå®Œå…¨ä¸éœ€æ”¹åŠ¨ã€‚</p><h3 id="å®ç°ç±»"><a href="#å®ç°ç±»" class="headerlink" title="å®ç°ç±»"></a>å®ç°ç±»</h3><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ä¸šåŠ¡å¤„ç†å™¨çš„å†™æ³•ï¼š</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6mychickmupXel0UdaMtVlVTibgclNpKJ3nXEV6MaJyiajbAQImbFXFFUzXQ82hF6z1TLjlcJSdmJm8ibIgqTEiay7A/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6mychickmupXel0UdaMtVlVTibgclNpKJ3ZBia9BYYXv8ypyqFibDvevDJhKpIX9w3ftuJMek4coZpuPxtAia5RCfxw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6mychickmupXel0UdaMtVlVTibgclNpKJ3YSzqaspTb5JKYYDEiblmHCKXTq2ibfZNpmjZVc3LFUYBNcB1uEsES0PA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>é¦–å…ˆæ¯ä¸ªå¤„ç†å™¨éƒ½å¿…é¡»æ·»åŠ åˆ°springå®¹å™¨ä¸­ï¼Œå› æ­¤éœ€è¦åŠ ä¸Š@Componentæ³¨è§£ï¼Œå…¶æ¬¡éœ€è¦åŠ ä¸Šä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£@HandlerTypeï¼Œç”¨äºæ ‡è¯†è¯¥å¤„ç†å™¨å¯¹åº”å“ªä¸ªè®¢å•ç±»å‹ï¼Œæœ€åå°±æ˜¯ç»§æ‰¿AbstractHandlerï¼Œå®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚</p><h3 id="è‡ªå®šä¹‰æ³¨è§£-HandlerType"><a href="#è‡ªå®šä¹‰æ³¨è§£-HandlerType" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£ @HandlerType"></a>è‡ªå®šä¹‰æ³¨è§£ @HandlerType</h3><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6mychickmupXel0UdaMtVlVTibgclNpKJ3Rp4ia6gfssmK3IgqlbkMTvI4pvoU6R3rGc0WkeAClDmbtCtdzIvS1Bg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h3 id="å®šä¹‰ï¼šæŠ½è±¡å¤„ç†å™¨-AbstractHandler"><a href="#å®šä¹‰ï¼šæŠ½è±¡å¤„ç†å™¨-AbstractHandler" class="headerlink" title="å®šä¹‰ï¼šæŠ½è±¡å¤„ç†å™¨ AbstractHandler"></a>å®šä¹‰ï¼šæŠ½è±¡å¤„ç†å™¨ AbstractHandler</h3><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6mychickmupXel0UdaMtVlVTibgclNpKJ3HJXjLDd151S3g9icwtJTzKOJM9SAaichozAaeke8DDiajFPgyJovhibMicg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h3 id="æ³¨å…¥åˆ°Springå®¹å™¨"><a href="#æ³¨å…¥åˆ°Springå®¹å™¨" class="headerlink" title="æ³¨å…¥åˆ°Springå®¹å™¨"></a>æ³¨å…¥åˆ°Springå®¹å™¨</h3><p>è‡ªå®šä¹‰æ³¨è§£å’ŒæŠ½è±¡å¤„ç†å™¨éƒ½å¾ˆç®€å•ï¼Œé‚£ä¹ˆå¦‚ä½•å°†å¤„ç†å™¨æ³¨å†Œåˆ°springå®¹å™¨ä¸­å‘¢ï¼Ÿ</p><p>å…·ä½“æ€è·¯æ˜¯ï¼š</p><p>1ã€æ‰«ææŒ‡å®šåŒ…ä¸­æ ‡æœ‰@HandlerTypeçš„ç±»ï¼›</p><p>2ã€å°†æ³¨è§£ä¸­çš„ç±»å‹å€¼ä½œä¸ºkeyï¼Œå¯¹åº”çš„ç±»ä½œä¸ºvalueï¼Œä¿å­˜åœ¨Mapä¸­ï¼›</p><p>3ã€ä»¥ä¸Šé¢çš„mapä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ï¼Œåˆå§‹åŒ–HandlerContextï¼Œå°†å…¶æ³¨å†Œåˆ°springå®¹å™¨ä¸­ï¼›</p><p>æˆ‘ä»¬å°†æ ¸å¿ƒçš„åŠŸèƒ½å°è£…åœ¨HandlerProcessorç±»ä¸­ï¼Œå®Œæˆä¸Šé¢çš„åŠŸèƒ½ã€‚</p><p><code>HandlerProcessorï¼š</code></p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6mychickmupXel0UdaMtVlVTibgclNpKJ3rxXoEPxFHNH8EVZbbtict0gZ4ibOxCVBAMkSW1G6TwOURxFAycG8xoeg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h2 id="ClassScannerï¼šæ‰«æå·¥å…·ç±»æºç "><a href="#ClassScannerï¼šæ‰«æå·¥å…·ç±»æºç " class="headerlink" title="ClassScannerï¼šæ‰«æå·¥å…·ç±»æºç "></a>ClassScannerï¼šæ‰«æå·¥å…·ç±»æºç </h2><p>HandlerProcessoréœ€è¦å®ç°BeanFactoryPostProcessorï¼Œåœ¨springå¤„ç†beanå‰ï¼Œå°†è‡ªå®šä¹‰çš„beanæ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚</p><p>æ ¸å¿ƒå·¥ä½œå·²ç»å®Œæˆï¼Œç°åœ¨çœ‹çœ‹HandlerContextå¦‚ä½•è·å–å¯¹åº”çš„å¤„ç†å™¨ï¼š</p><p>HandlerContextï¼š</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/6mychickmupXel0UdaMtVlVTibgclNpKJ30wjjwEgiaNx0XdVpZkTjrqibnaAMO806VBT0T2f52aI9PE2fcDj2wYSw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>BeanToolï¼šè·å–beanå·¥å…·ç±»</p><p><code>#getInstance</code> æ–¹æ³•æ ¹æ®ç±»å‹è·å–å¯¹åº”çš„classï¼Œç„¶åæ ¹æ®classç±»å‹è·å–æ³¨å†Œåˆ°springä¸­çš„beanã€‚</p><p>æœ€åè¯·æ³¨æ„ä¸€ç‚¹ï¼ŒHandlerProcessorå’ŒBeanToolå¿…é¡»èƒ½è¢«æ‰«æåˆ°ï¼Œæˆ–è€…é€šè¿‡@Beançš„æ–¹å¼æ˜¾å¼çš„æ³¨å†Œï¼Œæ‰èƒ½åœ¨é¡¹ç›®å¯åŠ¨æ—¶å‘æŒ¥ä½œç”¨ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ©ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥ç®€åŒ–ç¹æ‚çš„if elseä»£ç ï¼Œæ–¹ä¾¿ç»´æŠ¤ï¼Œè€Œåˆ©ç”¨è‡ªå®šä¹‰æ³¨è§£å’Œè‡ªæ³¨å†Œçš„æ–¹å¼ï¼Œå¯ä»¥æ–¹ä¾¿åº”å¯¹éœ€æ±‚çš„å˜æ›´ã€‚æœ¬æ–‡åªæ˜¯æä¾›ä¸€ä¸ªå¤§è‡´çš„æ€è·¯ï¼Œè¿˜æœ‰å¾ˆå¤šç»†èŠ‚å¯ä»¥çµæ´»å˜åŒ–ï¼Œä¾‹å¦‚ä½¿ç”¨æšä¸¾ç±»å‹ã€æˆ–è€…é™æ€å¸¸é‡ï¼Œä½œä¸ºè®¢å•çš„ç±»å‹ï¼Œç›¸ä¿¡ä½ èƒ½æƒ³åˆ°æ›´å¤šæ›´å¥½çš„æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RocketMQ å‰Šå³°å®æˆ˜ï¼</title>
      <link href="/2020/01/15/4.%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ%E5%89%8A%E5%B3%B0%E5%AE%9E%E6%88%98/"/>
      <url>/2020/01/15/4.%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ%E5%89%8A%E5%B3%B0%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<p>MQçš„ä¸»è¦ç‰¹ç‚¹ä¸º<strong>è§£è€¦</strong>ã€<strong>å¼‚æ­¥</strong>ã€<strong>å‰Šå³°</strong>ï¼Œè¯¥æ–‡ç« ä¸»è¦è®°å½•ä¸åˆ†äº«ä¸ªäººåœ¨å®é™…é¡¹ç›®ä¸­çš„RocketMQ<strong>å‰Šå³°</strong>ç”¨æ³•ï¼Œç”¨äºå‡å°‘æ•°æ®åº“å‹åŠ›çš„ä¸šåŠ¡åœºæ™¯ï¼Œå…¶ä¸­RocketMQçš„æ ¸å¿ƒç»„ä»¶æ¦‚å¿µå¦‚ä¸‹ï¼š</p><ul><li><p>Producerï¼šç”Ÿäº§å‘é€æ¶ˆæ¯</p></li><li><p>Brokerï¼šå­˜å‚¨Producerå‘é€è¿‡æ¥çš„æ¶ˆæ¯</p></li><li><p>Consumerï¼šä»Brokeræ‹‰å–æ¶ˆæ¯å¹¶è¿›è¡Œæ¶ˆè´¹</p></li><li><p>NameServerï¼šä¸ºProduceræˆ–Consumerè·¯ç”±åˆ°Broker</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz/N34tfh8WYkgiaf7EfnAEIBUr0BVSJF73iaa28IgRegPO4meKtDOEP6XfYOm14dIrdFicRlMEiaK06Sh0jV8PBQDPibg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p></li></ul><p>å…¶ä¸­æ¶ˆè´¹æµç¨‹æœ‰ä»¥ä¸‹å‡ ç‚¹æ˜¯å¿…é¡»æ³¨æ„çš„ï¼š</p><ul><li>RocketMQçš„Consumerè·å–æ¶ˆæ¯æ˜¯é€šè¿‡å‘Brokerå‘é€æ‹‰å–è¯·æ±‚è·å–çš„ï¼Œè€Œä¸æ˜¯ç”±Brokerå‘é€Consumeræ¥æ”¶çš„æ–¹å¼ã€‚</li><li>Consumeræ¯æ¬¡æ‹‰å–æ¶ˆæ¯æ—¶æ¶ˆæ¯éƒ½ä¼šè¢«å‡åŒ€åˆ†å‘åˆ°æ¶ˆæ¯é˜Ÿåˆ—å†è¿›è¡Œä¼ è¾“ï¼Œæ‰€ä»¥RocketMQä¸­çš„å¾ˆå¤šå‚æ•°éƒ½æ˜¯é’ˆå¯¹é˜Ÿåˆ—è€Œä¸æ˜¯Topicçš„(è¿™ä¸ªæ˜¯é‡ç‚¹ï¼Œé¡ºä¾¿åæ§½ä¸‹æºç çš„æ–‡æ¡£è®²çš„çœŸä¸æ¸…æ™°ï¼Œå¾ˆå¤šéƒ½éœ€è¦è‡ªå·±è¯•é”™ï¼Œä½†Dashboardåšå¾—å¾ˆå¥½)ï¼Œå…¶ä¸­æ¯ä¸ªBrokeræ¶ˆæ¯é˜Ÿåˆ—(ConsumeQueue)çš„æ•°é‡éƒ½å¯ä»¥é€šè¿‡RocketMQ DashBoardå®æ—¶æ›´æ”¹è°ƒæ•´ã€‚</li></ul><h2 id="rocketmq-spring-boot-starterç”¨æ³•ç®€ä»‹"><a href="#rocketmq-spring-boot-starterç”¨æ³•ç®€ä»‹" class="headerlink" title="rocketmq-spring-boot-starterç”¨æ³•ç®€ä»‹"></a>rocketmq-spring-boot-starterç”¨æ³•ç®€ä»‹</h2><p>å½“å¼€å‘ä¸­éœ€è¦å¿«é€Ÿé›†æˆRocketMQæ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨ rocketmq-spring-boot-starter æ­å»ºRocketMQçš„é›†æˆç¯å¢ƒï¼Œä½†è¯¥æ¡†æ¶å¹¶ä¸å®Œå…¨å…·å¤‡RocketMQæ‰€æœ‰çš„é…ç½®ç®€åŒ–ï¼Œå¦‚éœ€æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ä¾¿éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªDefaultMQPushConsumer beanå»æ¶ˆè´¹äº†ã€‚ä¸ªäººåœ¨å¼€å‘ä¸­å¸¸ç”¨çš„<code>rocketmq-spring-boot-starter</code>ç›¸å…³ç±»ï¼š</p><ul><li><p><code>RocketMQListener</code>æ¥å£ï¼šæ¶ˆè´¹è€…éƒ½éœ€å®ç°è¯¥æ¥å£çš„æ¶ˆè´¹æ–¹æ³•<code>onMessage(msg)</code>ã€‚</p></li><li><p><code>RocketMQPushConsumerLifecycleListener</code>æ¥å£ï¼šå½“<code>@RocketMQMessageListener</code>ä¸­çš„é…ç½®ä¸è¶³ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚æ—¶ï¼Œå¯ä»¥å®ç°è¯¥æ¥å£ç›´æ¥æ›´æ”¹æ¶ˆè´¹è€…ç±»<code>DefaultMQPushConsumer</code>é…ç½®</p></li><li><p><code>@RocketMQMessageListener</code>ï¼šè¢«è¯¥æ³¨è§£æ ‡æ³¨å¹¶å®ç°äº†æ¥å£<code>RocketMQListener</code>çš„beanä¸ºä¸€ä¸ªæ¶ˆè´¹è€…å¹¶ç›‘å¬æŒ‡å®štopicé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œè¯¥æ³¨è§£ä¸­åŒ…å«æ¶ˆè´¹è€…çš„ä¸€äº›å¸¸ç”¨é…ç½®(å¤§éƒ¨åˆ†æŒ‰é»˜è®¤å³å¯)ï¼Œä¸€èˆ¬åªéœ€æ›´æ”¹consumerGroup(æ¶ˆè´¹ç»„)ä¸topicã€‚<code>RocketMQMessageListener</code>ä¸­çš„å±æ€§é…ç½®æ˜¯å¯ä»¥ä½¿ç”¨Placeholder(å ä½ç¬¦)ä»é…ç½®æ–‡ä»¶æˆ–é…ç½®ä¸­å¿ƒè·å–çš„ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz/N34tfh8WYkgiaf7EfnAEIBUr0BVSJF73iavViajAjibzPDib8ppJIIicG4ONyeP67VFgjpjukPHiaPChm1zHT5syCV5icQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p></li></ul><h2 id="ä¸šåŠ¡æ¡ˆä¾‹"><a href="#ä¸šåŠ¡æ¡ˆä¾‹" class="headerlink" title="ä¸šåŠ¡æ¡ˆä¾‹"></a>ä¸šåŠ¡æ¡ˆä¾‹</h2><p>æœ‰ä¸€ä¸ªç‚¹èµä¸šåŠ¡ï¼Œä¸é™åˆ¶ç”¨æˆ·çš„ç‚¹èµæ•°åªéœ€è¿›è¡Œè®°å½•(äº§å“éœ€æ±‚ï¼Œå¼€å‘æè®®æ— æ•ˆ)ï¼Œå½“æ¯ä¸ªç”¨æˆ·éƒ½è¿›è¡Œxè¿å‡»äº«å—æ•°é‡çŒ›å¢çš„å¿«æ„Ÿæ—¶å¦‚æœæ•°æ®åº“éƒ½éœ€è¦è¿›è¡Œxä¸ªç‚¹èµæ•°æ®çš„æ’å…¥ï¼Œæ•°æ®åº“æ¯«æ— ç–‘é—®ä¼šå¡æ­»å¯¼è‡´å´©æºƒã€‚äºæ˜¯æƒ³åˆ°å¯ä»¥å°è¯•ä¸‹MQå‰Šå³°ï¼Œæ¯”å¦‚æ¯ç§’æ¥äº†5000æ¶ˆæ¯ä½†æ•°æ®åº“åªèƒ½æ‰¿å—2000ï¼Œé‚£æˆ‘æ¶ˆè´¹æ—¶æ¯æ¬¡åªæ‹‰å–æ¶ˆè´¹1600å°±å¥½äº†ï¼Œå‰©ä¸‹çš„æ”¾åœ¨Brokerå †ç§¯æ…¢æ…¢æ¶ˆè´¹å°±å¥½ã€‚ç”±äºä¹‹å‰çš„æ¶ˆæ¯ä¸­å¿ƒä¹Ÿåœ¨ç”¨RocketMQï¼Œäºæ˜¯ç¡®è®¤ä½¿ç”¨RocketMQæ¥è¿›è¡Œå‰Šå³°ã€‚</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz/N34tfh8WYkgiaf7EfnAEIBUr0BVSJF73ia32Z6gAzObiar941SWfEDBjFq3j9Qibq8ZDkIibt5DIJuibt1rpmSPuz9mQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><blockquote><p>æ–‡ç« ä¾‹å­ç¯å¢ƒï¼š1NameServer + 2Broker + 1Consumer</p></blockquote><h3 id="æ·»åŠ mavenä¾èµ–"><a href="#æ·»åŠ mavenä¾èµ–" class="headerlink" title="æ·»åŠ mavenä¾èµ–"></a>æ·»åŠ mavenä¾èµ–</h3><pre><code>&lt;dependency&gt;    &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;    &lt;artifactId&gt;rocketmq-spring-boot-starter&lt;/artifactId&gt;&lt;/dependency&gt;å¤åˆ¶ä»£ç </code></pre><h3 id="application-ymlé…ç½®"><a href="#application-ymlé…ç½®" class="headerlink" title="application.ymlé…ç½®"></a>application.ymlé…ç½®</h3><pre><code class="properties">rocketmq:  name-server: 127.0.0.1:9876  producer:    group: praise-groupserver:  port: 10000spring:  datasource:    driver-class-name: com.mysql.cj.jdbc.Driver    username: root    password: tiger    url: jdbc:mysql://localhost:3306/wilsonswagger:  docket:    base-package: io.rocket.consumer.controllerå¤åˆ¶ä»£ç </code></pre><h2 id="ç‚¹èµæ¥å£"><a href="#ç‚¹èµæ¥å£" class="headerlink" title="ç‚¹èµæ¥å£"></a>ç‚¹èµæ¥å£</h2><p><strong>PraiseRecord(ç‚¹èµè®°å½•):</strong></p><pre><code class="java">@Datapublic class PraiseRecord implements Serializable {    private Long id;    private Long uid;    private Long liveId;    private LocalDateTime createTime;}å¤åˆ¶ä»£ç </code></pre><p><strong>MessageController(ç®€å•çš„æµ‹è¯•æ¥å£):</strong></p><pre><code class="java">@RestController@RequestMapping(&quot;/message&quot;)public class MessageController {    @Resource    private RocketMQTemplate rocketMQTemplate;    @PostMapping(&quot;/praise&quot;)    public ServerResponse praise(@RequestBody PraiseRecordVO vo) {        rocketMQTemplate.sendOneWay(RocketConstant.Topic.PRAISE_TOPIC, MessageBuilder.withPayload(vo).build());        return ServerResponse.success();    }    // ......}å¤åˆ¶ä»£ç </code></pre><p>ç”±äºç”¨æˆ·å¯ä»¥è¿ç»­ç‚¹èµï¼Œæ‰€ä»¥è€ƒè™‘å¯ä»¥åœ¨ç‚¹èµæ¶ˆæ¯çš„å¤„ç†ä¸Šå®½æ¾ä¸€ç‚¹(å®¹è®¸æ¶ˆæ¯ä¸¢å¤±)ä»¥è¿½æ±‚æ›´é«˜çš„æ€§èƒ½ï¼Œå› æ­¤é€‰æ‹©ä½¿ç”¨<code>sendOneyWay()</code>è¿›è¡Œæ¶ˆæ¯å‘é€ã€‚</p><blockquote><p>RocketMQçš„æ¶ˆæ¯å‘é€æ–¹å¼ä¸»è¦å«syncSend()åŒæ­¥å‘é€ã€asyncSend()å¼‚æ­¥å‘é€ã€sendOneWay()ä¸‰ç§æ–¹å¼ï¼ŒsendOneWay()ä¹Ÿæ˜¯å¼‚æ­¥å‘é€ï¼ŒåŒºåˆ«åœ¨äºä¸éœ€ç­‰å¾…Brokerè¿”å›ç¡®è®¤ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå­˜åœ¨ä¿¡æ¯ä¸¢å¤±çš„çŠ¶å†µï¼Œä½†ååé‡æ›´é«˜ï¼Œå…·ä½“éœ€æ ¹æ®ä¸šåŠ¡æƒ…å†µé€‰ç”¨ã€‚</p><p>æ€§èƒ½ï¼šsendOneWay &gt; asyncSend &gt; syncSend RocketMQTemplateçš„send()æ–¹æ³•é»˜è®¤æ˜¯åŒæ­¥(syncSend)çš„,æ›´å¤šå¯çœ‹æºç å®ç°ã€‚</p></blockquote><h2 id="PraiseListenerï¼šç‚¹èµæ¶ˆæ¯æ¶ˆè´¹è€…"><a href="#PraiseListenerï¼šç‚¹èµæ¶ˆæ¯æ¶ˆè´¹è€…" class="headerlink" title="PraiseListenerï¼šç‚¹èµæ¶ˆæ¯æ¶ˆè´¹è€…"></a>PraiseListenerï¼šç‚¹èµæ¶ˆæ¯æ¶ˆè´¹è€…</h2><pre><code class="java">@Service@RocketMQMessageListener(topic = RocketConstant.Topic.PRAISE_TOPIC, consumerGroup = RocketConstant.ConsumerGroup.PRAISE_CONSUMER)@Slf4jpublic class PraiseListener implements RocketMQListener&lt;PraiseRecordVO&gt;, RocketMQPushConsumerLifecycleListener {    @Resource    private PraiseRecordService praiseRecordService;    @Override    public void onMessage(PraiseRecordVO vo) {        praiseRecordService.insert(vo.copyProperties(PraiseRecord::new));    }    @Override    public void prepareStart(DefaultMQPushConsumer consumer) {        // æ¯æ¬¡æ‹‰å–çš„é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’        consumer.setPullInterval(2000);        // è®¾ç½®æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­æ‹‰å–çš„æ¶ˆæ¯æ•°ä¸º16        consumer.setPullBatchSize(16);    }}</code></pre><p>å•æ¬¡pullæ¶ˆæ¯çš„æœ€å¤§æ•°ç›®å—brokerå­˜å‚¨çš„<code>MessageStoreConfig.maxTransferCountOnMessageInMemory</code>(é»˜è®¤ä¸º32)å€¼é™åˆ¶ï¼Œå³è‹¥æƒ³è¦æ¶ˆè´¹è€…ä»é˜Ÿåˆ—æ‹‰å–çš„æ¶ˆæ¯æ•°å¤§äº32æœ‰æ•ˆ(pullBatchSize&gt;32)åˆ™éœ€æ›´æ”¹Brokerçš„å¯åŠ¨å‚æ•°<code>maxTransferCountOnMessageInMemory</code>å€¼ã€‚åœ¨MQå‰Šå³°çš„é…ç½®å‚æ•°é‡Œï¼Œä»¥ä¸‹å‡ ä¸ª<code>DefaultMQPushConsumer</code>çš„å‚æ•°æ˜¯éœ€è¦æ³¨æ„ä¸€ä¸‹çš„ï¼š</p><ul><li><code>pullInterval</code>ï¼šæ¯æ¬¡ä»Brokeræ‹‰å–æ¶ˆæ¯çš„é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’</li><li><code>pullBatchSize</code>ï¼šæ¯æ¬¡ä»Brokeré˜Ÿåˆ—æ‹‰å–åˆ°çš„æ¶ˆæ¯æ•°ï¼Œè¯¥å‚æ•°å¾ˆå®¹æ˜“è®©äººè¯¯è§£ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯æ¯æ¬¡æ‹‰å–çš„æ¶ˆæ¯æ€»æ•°ï¼Œä½†æµ‹è¯•è¿‡å‡ æ¬¡åç¡®è®¤äº†å®è´¨ä¸Šæ˜¯ä»æ¯ä¸ªé˜Ÿåˆ—çš„æ‹‰å–æ•°(æºç ä¸Šçš„æ³¨é‡Šæ–‡æ¡£çœŸçš„å¾ˆå·®ï¼Œè·Ÿæ²¡æœ‰ä¸€æ ·)ï¼Œå³Consumeæ¯æ¬¡æ‹‰å–çš„æ¶ˆæ¯æ€»æ•°å¦‚ä¸‹ï¼š<code>EachPullTotal=æ‰€æœ‰Brokerä¸Šçš„å†™é˜Ÿåˆ—æ•°å’Œ(writeQueueNums=readQueueNums) * pullBatchSize</code></li><li><code>consumeMessageBatchMaxSize</code>ï¼šæ¯æ¬¡æ¶ˆè´¹(å³å°†å¤šæ¡æ¶ˆæ¯åˆå¹¶ä¸ºListæ¶ˆè´¹)çš„æœ€å¤§æ¶ˆæ¯æ•°ç›®ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œrocketmq-spring-boot-starter ç›®å‰ä¸æ”¯æŒæ‰¹é‡æ¶ˆè´¹(2.1.0ç‰ˆæœ¬)</li></ul><p>åœ¨æ¶ˆè´¹è€…å¼€å§‹æ¶ˆæ¯æ¶ˆè´¹æ—¶ä¼šå…ˆä»å„é˜Ÿåˆ—ä¸­æ‹‰å–ä¸€æ¡æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œæ¶ˆè´¹æˆåŠŸåå†ä»¥æ¯æ¬¡pullBatchSizeçš„æ•°ç›®è¿›è¡Œæ‹‰å–ã€‚</p><p>PraiseListenerä¸­è®¾ç½®äº†æ¯æ¬¡æ‹‰å–çš„é—´éš”ä¸º2sï¼Œæ¯æ¬¡ä»é˜Ÿåˆ—æ‹‰å–çš„æ¶ˆæ¯æ•°ä¸º16ï¼Œåœ¨æ­å»ºäº†2master brokerä¸”brokerä¸ŠwriteQueueNums=readQueueNums=4çš„ç¯å¢ƒä¸‹æ¯æ¬¡æ‹‰å–çš„æ¶ˆæ¯ç†è®ºæ•°å€¼ä¸º16 * 2 * 4 = 128ï¼Œåœ¨ç¬¬ä¸€æ¬¡ä»å„é˜Ÿåˆ—æ‹‰å–1æ¡æ¶ˆæ¯(å³å…±8æ¡)åæ¶ˆè´¹æˆåŠŸåä¼šæ¯æ¬¡å°±ä¼šæ‹‰å–æœ€å¤š128æ¡æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œæƒ³éªŒè¯ä¸‹çš„å¯ä»¥æŠŠonMessage()çš„insert()æ”¹ä¸ºlog.info(â€œ1â€)ç„¶åç»Ÿè®¡å•ä½ç§’å†…æ‰“å°çš„æ—¥å¿—æ•°æ˜¯å¦ä¸º128ã€‚</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz/N34tfh8WYkgiaf7EfnAEIBUr0BVSJF73iawLe4M03xcD1uRveATZrh7wRYLhFLjk1dicK6QKrydpaj8ZM8s5U1wEg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>æ ¹æ®ä»¥ä¸Šé…ç½®å•Conumeræƒ…å†µä¸‹æ¯2sç†è®ºæ¶ˆè´¹ä¸º128ï¼Œå³æ¯2ç§’æ•°æ®åº“æ–°å¢çš„ç‚¹èµæ•°æ®å¤§æ¦‚ä¸º128æ¡å·¦å³ï¼Œæœ‰20%åå·®éƒ½åœ¨ä¸ªäººå¯æ¥å—èŒƒå›´å†…ï¼Œç„¶åå¯¹ç‚¹èµæ¥å£è¿›è¡Œç®€å•å‹æµ‹1s 2000è¯·æ±‚æ ¡éªŒMQæ•ˆæœï¼Œæ ¹æ®æ¶ˆè´¹é…ç½®ç†è®ºä¸Šéœ€è¦16æ¬¡æ‹‰å–å³éœ€32sæ‰èƒ½æ¶ˆè´¹å®Œï¼Œå‹æµ‹åæŸ¥çœ‹æ•°æ®åº“æ ¡éªŒæ•ˆæœï¼š</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/N34tfh8WYkgiaf7EfnAEIBUr0BVSJF73iau94rVMpJHMZrNmR9jtmzOqQx0aFTTSkPfiaNzOP3MQmVvELIg3ZZayg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz/N34tfh8WYkgiaf7EfnAEIBUr0BVSJF73iatHQtHJyBNdYjD46XwkrKquSdumLt8dQSDtTgUBMEyI1mItiay2jPPlA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºé™¤ç¬¬ä¸€æ¬¡2så’Œæœ€åä¸€æ¬¡2så¤–æ•°æ®åº“æ¯2sçš„æ’å…¥æ•°æ®æ•°å’Œä¸€èˆ¬éƒ½åœ¨128é™„è¿‘æ³¢åŠ¨ï¼Œä¹Ÿç”¨äº†34s(å› ç¬¬ä¸€æ¬¡æ‹‰å–æ•°è¾ƒå°‘æ‰€ä»¥æ¯”ç†è®ºå¤šèŠ±è´¹ä¸€æ¬¡æ‹‰å–)æ¶ˆè´¹çš„åå·®å¤§å°å¯èƒ½ä¼šå—æ¯æ¬¡æ‹‰å–æ•°pullBatchSizeã€Brokerä¸Šçš„æ¶ˆæ¯é˜Ÿåˆ—æ•°ã€ç½‘ç»œæ³¢åŠ¨ç­‰æƒ…å†µå½±å“ï¼Œä½†éœ€è¦çš„ç›®çš„å·²ç»è¾¾åˆ°äº†ï¼Œæˆ‘åªæƒ³æŠŠå•ä½æ—¶é—´å†…è¿‡å¤šçš„æ•°æ®åº“æ“ä½œäº¤ç»™MQåšåˆ†éš”æˆå¤šä¸ªå•ä½æ—¶é—´å†…çš„å°æ‰¹é‡æ“ä½œï¼Œæ¶ˆæ¯è¿‡å¤šå°±å †ç§¯ï¼Œå½“è¯·æ±‚å³°å€¼è¿‡äº†åç›´åˆ°MQå †ç§¯çš„æ¶ˆæ¯æ¶ˆè´¹å®Œå‰æ•°æ®åº“çš„æ’å…¥æ•°ä¾æ—§ä¼šä¸å³°å€¼æœŸçš„æ’å…¥æ•°ç›¸å·®ä¸å¤§ï¼Œè¾¾åˆ°äº†MQå‰Šå³°å¡«è°·çš„æ•ˆæœã€‚</p><h3 id="ä¸Šçº¿äº†ä½†æ¶ˆè´¹æ•ˆç‡é¢„ä¼°å¤±è¯¯å¦‚ä½•åŠ¨æ€æ›´æ”¹æ¶ˆè´¹æ•ˆç‡-ï¼Ÿ"><a href="#ä¸Šçº¿äº†ä½†æ¶ˆè´¹æ•ˆç‡é¢„ä¼°å¤±è¯¯å¦‚ä½•åŠ¨æ€æ›´æ”¹æ¶ˆè´¹æ•ˆç‡-ï¼Ÿ" class="headerlink" title="ä¸Šçº¿äº†ä½†æ¶ˆè´¹æ•ˆç‡é¢„ä¼°å¤±è¯¯å¦‚ä½•åŠ¨æ€æ›´æ”¹æ¶ˆè´¹æ•ˆç‡ ï¼Ÿ"></a>ä¸Šçº¿äº†ä½†æ¶ˆè´¹æ•ˆç‡é¢„ä¼°å¤±è¯¯å¦‚ä½•åŠ¨æ€æ›´æ”¹æ¶ˆè´¹æ•ˆç‡ ï¼Ÿ</h3><p>å½“æŠŠæ‹‰å–æ•°pullBatchSizeè®¾ç½®Brokerçš„é»˜è®¤æœ€å¤§ä¼ è¾“å€¼32äº†ï¼Œçº¿ä¸Šåˆä¸æƒ³é‡å¯Brokeræ›´æ”¹maxTransferCountOnMessageInMemoryå‚æ•°ï¼Œå¦‚æœ‰2ä¸ªBrokerä¸”queueéƒ½ä¸º4ï¼Œé‚£ä¹ˆæ‹‰å–æ¶ˆè´¹æ•ˆç‡æ‰ä¸º32 * 2 * 4 = 256ï¼Œå¦‚æœæƒ³è¦åŠ¨æ€è°ƒæ•´ï¼Œå¯ä»¥ä»Brokeræ•°æˆ–Brokeré˜Ÿåˆ—æ•°ä¸‹æ‰‹ï¼Œå¯ä»¥å°†Brokerçš„writeQueueNumsã€readQueueNumså¢å¤§ï¼Œå¦‚éƒ½æ”¹ä¸º8ï¼Œé‚£ä¹ˆæ•ˆç‡å°±æˆäº†32 * 2 * 8 = 512ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯æ›´æ”¹å®Œqueuesåå¿…é¡»å»Dashboardçš„Topicä¸‹çš„CONSUMER MANAGERæŸ¥çœ‹æ–°å¢çš„é˜Ÿåˆ—ä¸Šæ˜¯å¦éƒ½æœ‰ConsumeræˆåŠŸæ³¨å†Œä¸Šå»äº†ï¼Œå› ä¸ºé‡åˆ°äº†åœ¨æµ‹è¯•ä¸ç”Ÿäº§ä¸Šä½¿ç”¨rocketmq-spring-boot-starter @RocketMQListeneræ ‡æ³¨æ¶ˆè´¹è€…ä¸ä¼šè‡ªåŠ¨æ³¨å†Œåˆ°æ–°é˜Ÿåˆ—ä¸Šçš„æƒ…å†µï¼Œä½†æ²¡æ’é™¤æ˜¯ä¸æ˜¯RocketMQç‰ˆæœ¬çš„åŸå› (ä¸ªäººæœ¬åœ°çš„ç‰ˆæœ¬æ¯”ç¯å¢ƒä¸Šçš„é«˜äº†ä¸€ä¸ªå°ç‰ˆæœ¬0.0.1ï¼Œæœ¬åœ°æ²¡å‡ºç°æ²¡æ¶ˆè´¹è€…æ³¨å†Œåˆ°æ–°é˜Ÿåˆ—ä¸Šçš„é—®é¢˜)ï¼Œè€Œæ˜¯ä½¿ç”¨äº†è‡ªå®šä¹‰DefaultMQPushConsumer bean(åŸç”Ÿçš„æ–¹å¼éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„)çš„å¤‡ç”¨æ–¹æ¡ˆã€‚å½“å†å¯åŠ¨æ–°çš„æ¶ˆè´¹è€…åº”ç”¨æ—¶CONSUMER MANAGER(ä¸‹å›¾)ä¸­å°±ä¼šå‡ºç° æ–°Consumeræ•° * å„Brokeré˜Ÿåˆ—æ•°å’Œçš„é˜Ÿåˆ—è¡Œã€‚</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz/N34tfh8WYkgiaf7EfnAEIBUr0BVSJF73iaET9VzXjeHy4TsnErsUB4wrgaw7OibAPxtz1hHUncu3GMYezWvLRI9Tw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h3 id="å¦‚ä½•ä½¿ç”¨RocketMQæ‰¹é‡æ¶ˆè´¹-ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨RocketMQæ‰¹é‡æ¶ˆè´¹-ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨RocketMQæ‰¹é‡æ¶ˆè´¹ ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨RocketMQæ‰¹é‡æ¶ˆè´¹ ï¼Ÿ</h3><p>è™½ç„¶ç‚¹èµä¸šåŠ¡ä½¿ç”¨MQå•æ¡æ’å…¥åTPSå·²ç»è¾¾åˆ°å½“å‰ä¸šåŠ¡æŒ‡æ ‡è¦æ±‚äº†ï¼Œä½†è€ƒè™‘åˆ°å¦‚æœåç»­è¦æ±‚åœ¨ä¸æ·»åŠ æœºå™¨æ•°çš„æƒ…å†µä¸‹å¢åŠ TPSï¼Œä¸”æ•°æ®é‡è¿˜æ²¡åˆ°åˆ†åº“åˆ†è¡¨çš„ç¨‹åº¦ï¼Œä¸ªäººå°±æ‰“ç®—ä»æ‰¹é‡æ¶ˆè´¹ä¸‹æ‰‹ï¼Œç”±ä¸€æ¬¡æ’å…¥ä¸€æ¡ç‚¹èµè®°å½•æ”¹ä¸ºä¸€æ¬¡æ€§æ’å…¥å¤šæ¡(insertBatch)ã€‚å½“ç„¶èƒ½æ»¡è¶³ç°æœ‰éœ€æ±‚èƒ½ä¸åšè‚¯å®šä¸åšçš„ï¼Œè¿‡åº¦ä¼˜åŒ–è¿‡åˆ†ç¢äº‹ï¼Œä½†æƒ³å¤šç‚¹æ–¹æ¡ˆä¸ä¼šåäº‹ã€‚</p><p>rocketmq-spring-boot-starterå¹¶æ²¡æœ‰æä¾›æ‰¹é‡æ¶ˆè´¹çš„åŠŸèƒ½ï¼Œæ‰€ä»¥è¦æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯éœ€è¦è‡ªå®šä¹‰<code>DefaultMQPushConsumer</code>å¹¶é…ç½®å…¶<code>consumeMessageBatchMaxSize</code>å±æ€§ã€‚<code>consumeMessageBatchMaxSize</code>å±æ€§é»˜è®¤å€¼ä¸º1ï¼Œå³æ¯æ¬¡åªæ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¯¥å±æ€§ä¹Ÿä¼šå—<code>pullBatchSize</code>å½±å“ï¼Œå¦‚æœ<code>consumeMessageBatchMaxSize</code>ä¸º32ä½†<code>pullBatchSize</code>åªä¸º12ï¼Œé‚£ä¹ˆæ¯æ¬¡æ‰¹é‡æ¶ˆè´¹çš„æœ€å¤§æ¶ˆæ¯æ•°ä¹Ÿå°±åªæœ‰12ã€‚å¦‚ä¸‹ä¸ºä¸ªäººæµ‹è¯•æ‰¹é‡æ¶ˆè´¹Consumerçš„æµ‹è¯•beanï¼š</p><pre><code>@Beanpublic DefaultMQPushConsumer userMQPushConsumer() throws MQClientException {    DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(RocketConstant.ConsumerGroup.SPRING_BOOT_USER_CONSUMER);    consumer.setNamesrvAddr(nameServer);    consumer.subscribe(RocketConstant.Topic.SPRING_BOOT_USER_TOPIC, &quot;*&quot;);    // è®¾ç½®æ¯æ¬¡æ¶ˆæ¯æ‹‰å–çš„æ—¶é—´é—´éš”ï¼Œå•ä½æ¯«ç§’    consumer.setPullInterval(1000);    // è®¾ç½®æ¯ä¸ªé˜Ÿåˆ—æ¯æ¬¡æ‹‰å–çš„æœ€å¤§æ¶ˆæ¯æ•°    consumer.setPullBatchSize(24);    // è®¾ç½®æ¶ˆè´¹è€…å•æ¬¡æ‰¹é‡æ¶ˆè´¹çš„æ¶ˆæ¯æ•°ç›®ä¸Šé™    consumer.setConsumeMessageBatchMaxSize(12);    consumer.registerMessageListener((MessageListenerConcurrently) (msgs, context)            -&gt; {        List&lt;UserInfo&gt; userInfos = new ArrayList&lt;&gt;(msgs.size());        Map&lt;Integer, Integer&gt; queueMsgMap = new HashMap&lt;&gt;(8);        msgs.forEach(msg -&gt; {            userInfos.add(JSONObject.parseObject(msg.getBody(), UserInfo.class));            queueMsgMap.compute(msg.getQueueId(), (key, val) -&gt; val == null ? 1 : ++val);        });        log.info(&quot;userInfo size: {}, content: {}&quot;, userInfos.size(), userInfos);        /*          å¤„ç†æ‰¹é‡æ¶ˆæ¯ï¼Œå¦‚æ‰¹é‡æ’å…¥ï¼šuserInfoMapper.insertBatch(userInfos);         */        return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;    });    consumer.start();    return consumer;}</code></pre><p>å¦‚æœé»˜è®¤é…ç½®æƒ…å†µä¸‹logæ‰“å°å‡ºçš„userInfo sizeæ’ä¸º1ï¼Œä½†ç”±äºè®¾ç½®äº†<code>consumeMessageBatchMaxSize</code>ä¸<code>pullBatchSize</code>ï¼Œä¸”<code>pullBatchSize</code>è¾ƒå°ï¼Œæ‰€ä»¥æ¯æ¬¡æ¶ˆè´¹çš„æ¶ˆæ¯æ•°æœ€å¤§å€¼ä¸º12ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz/N34tfh8WYkgiaf7EfnAEIBUr0BVSJF73iaRwnskMlQlgN22rjUQfwibpJI59WAXL8HiavSqSXAx5hRVMIGRWRGQUYw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h1 id="é™„æœ¬æ–‡ç›¸å…³ä¿¡æ¯"><a href="#é™„æœ¬æ–‡ç›¸å…³ä¿¡æ¯" class="headerlink" title="é™„æœ¬æ–‡ç›¸å…³ä¿¡æ¯"></a>é™„æœ¬æ–‡ç›¸å…³ä¿¡æ¯</h1><ul><li><p>ç¡®ä¿mqnamesrvä¸mqbrokerå·²å¯åŠ¨æˆåŠŸï¼Œå¦‚è¯¥æ–‡ç« ç¯å¢ƒçš„å¯åŠ¨ï¼š</p><pre><code>mqnamesrv -n 127.0.0.1:9876mqbroker -c E:\RocketMQ\rocketmq-all-4.5.2-bin-release\bin\2m-noslave\broker-a.propertiesmqbroker -c E:\RocketMQ\rocketmq-all-4.5.2-bin-release\bin\2m-noslave\broker-b.properties</code></pre></li><li><p>RocketMQ DashBoardå¯åŠ¨æµç¨‹å¯å‚è€ƒå®˜æ–¹githubæ–‡æ¡£æˆ–åˆ°æˆ‘çš„èµ„æºé‡Œä¸‹è½½jaråŒ…è¿è¡Œ</p></li><li><p>æºç åœ°å€ï¼ˆ<a href="https://github.com/Wilson-He/spring-boot-series/tree/master/spring-rocketmqï¼‰ï¼Œ2m-noslaveç›®å½•æ˜¯è¯¥æ–‡ç« ä¸­ä¾‹å­ä¸­çš„2master" target="_blank" rel="noopener">https://github.com/Wilson-He/spring-boot-series/tree/master/spring-rocketmqï¼‰ï¼Œ2m-noslaveç›®å½•æ˜¯è¯¥æ–‡ç« ä¸­ä¾‹å­ä¸­çš„2master</a> brokeré…ç½®ä¸å¯åŠ¨è„šæœ¬ï¼Œspring-boot-consumer-peakç›®å½•ä¸ºåŒ…å«è¯¥æ–‡ç« ç›¸å…³ä»£ç çš„å®é™…ä¾‹å­</p></li></ul><p><strong>END</strong></p>]]></content>
      
      
      <categories>
          
          <category> æ¶ˆæ¯é˜Ÿåˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¶ˆæ¯é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“ä¼˜åŒ–</title>
      <link href="/2020/01/15/5.%20%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E9%87%8F%E5%BE%88%E5%A4%A7%EF%BC%8C%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%BE%88%E6%85%A2%EF%BC%8C%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%EF%BC%9F/"/>
      <url>/2020/01/15/5.%20%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E9%87%8F%E5%BE%88%E5%A4%A7%EF%BC%8C%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%BE%88%E6%85%A2%EF%BC%8C%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<ul><li>å‡†å¤‡å·¥ä½œ</li><li>ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢</li><li>ä½¿ç”¨å­æŸ¥è¯¢ä¼˜åŒ–</li><li>ä½¿ç”¨ id é™å®šä¼˜åŒ–</li><li>ä½¿ç”¨ä¸´æ—¶è¡¨ä¼˜åŒ–</li><li>å…³äºæ•°æ®è¡¨çš„idè¯´æ˜</li></ul><hr><p>å½“éœ€è¦ä»æ•°æ®åº“æŸ¥è¯¢çš„è¡¨æœ‰ä¸Šä¸‡æ¡è®°å½•çš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§æŸ¥è¯¢æ‰€æœ‰ç»“æœä¼šå˜å¾—å¾ˆæ…¢ï¼Œç‰¹åˆ«æ˜¯éšç€æ•°æ®é‡çš„å¢åŠ ç‰¹åˆ«æ˜æ˜¾ï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢ã€‚å¯¹äºæ•°æ®åº“åˆ†é¡µæŸ¥è¯¢ï¼Œä¹Ÿæœ‰å¾ˆå¤šç§æ–¹æ³•å’Œä¼˜åŒ–çš„ç‚¹ã€‚ä¸‹é¢ç®€å•è¯´ä¸€ä¸‹æˆ‘çŸ¥é“çš„ä¸€äº›æ–¹æ³•ã€‚</p><h1 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h1><p>ä¸ºäº†å¯¹ä¸‹é¢åˆ—ä¸¾çš„ä¸€äº›ä¼˜åŒ–è¿›è¡Œæµ‹è¯•ï¼Œä¸‹é¢é’ˆå¯¹å·²æœ‰çš„ä¸€å¼ è¡¨è¿›è¡Œè¯´æ˜ã€‚</p><ul><li>è¡¨åï¼šorder_history</li><li>æè¿°ï¼šæŸä¸ªä¸šåŠ¡çš„è®¢å•å†å²è¡¨</li><li>ä¸»è¦å­—æ®µï¼šunsigned int idï¼Œtinyint(4) int type</li><li>å­—æ®µæƒ…å†µï¼šè¯¥è¡¨ä¸€å…±37ä¸ªå­—æ®µï¼Œä¸åŒ…å«textç­‰å¤§å‹æ•°æ®ï¼Œæœ€å¤§ä¸ºvarchar(500)ï¼Œidå­—æ®µä¸ºç´¢å¼•ï¼Œä¸”ä¸ºé€’å¢ã€‚</li><li>æ•°æ®é‡ï¼š5709294</li><li>MySQLç‰ˆæœ¬ï¼š5.7.16 çº¿ä¸‹æ‰¾ä¸€å¼ ç™¾ä¸‡çº§çš„æµ‹è¯•è¡¨å¯ä¸å®¹æ˜“ï¼Œå¦‚æœéœ€è¦è‡ªå·±æµ‹è¯•çš„è¯ï¼Œå¯ä»¥å†™shellè„šæœ¬ä»€ä¹ˆçš„æ’å…¥æ•°æ®è¿›è¡Œæµ‹è¯•ã€‚ä»¥ä¸‹çš„ sql æ‰€æœ‰è¯­å¥æ‰§è¡Œçš„ç¯å¢ƒæ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œä¸‹é¢æ˜¯åŸºæœ¬æµ‹è¯•ç»“æœï¼š</li></ul><pre><code>select count(*) from orders_history;</code></pre><p>è¿”å›ç»“æœï¼š5709294</p><p>ä¸‰æ¬¡æŸ¥è¯¢æ—¶é—´åˆ†åˆ«ä¸ºï¼š</p><ul><li>8903 ms</li><li>8323 ms</li><li>8401 ms</li></ul><h1 id="ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢"><a href="#ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢"></a>ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢</h1><p>ä¸€èˆ¬çš„åˆ†é¡µæŸ¥è¯¢ä½¿ç”¨ç®€å•çš„ limit å­å¥å°±å¯ä»¥å®ç°ã€‚limit å­å¥å£°æ˜å¦‚ä¸‹ï¼š</p><pre><code>SELECT * FROM table LIMIT [offset,] rows | rows OFFSET offset</code></pre><p>LIMIT å­å¥å¯ä»¥è¢«ç”¨äºæŒ‡å®š SELECT è¯­å¥è¿”å›çš„è®°å½•æ•°ã€‚éœ€æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šç¬¬ä¸€ä¸ªè¿”å›è®°å½•è¡Œçš„åç§»é‡ï¼Œæ³¨æ„ä»<code>0</code>å¼€å§‹</li><li>ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šè¿”å›è®°å½•è¡Œçš„æœ€å¤§æ•°ç›®</li><li>å¦‚æœåªç»™å®šä¸€ä¸ªå‚æ•°ï¼šå®ƒè¡¨ç¤ºè¿”å›æœ€å¤§çš„è®°å½•è¡Œæ•°ç›®</li><li>ç¬¬äºŒä¸ªå‚æ•°ä¸º -1 è¡¨ç¤ºæ£€ç´¢ä»æŸä¸€ä¸ªåç§»é‡åˆ°è®°å½•é›†çš„ç»“æŸæ‰€æœ‰çš„è®°å½•è¡Œ</li><li>åˆå§‹è®°å½•è¡Œçš„åç§»é‡æ˜¯ 0(è€Œä¸æ˜¯ 1)</li></ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåº”ç”¨å®ä¾‹ï¼š</p><pre><code>select * from orders_history where type=8 limit 1000,10;</code></pre><p>è¯¥æ¡è¯­å¥å°†ä¼šä»è¡¨ orders_history ä¸­æŸ¥è¯¢<code>offset: 1000</code>å¼€å§‹ä¹‹åçš„10æ¡æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ç¬¬1001æ¡åˆ°ç¬¬1010æ¡æ•°æ®ï¼ˆ<code>1001 &lt;= id &lt;= 1010</code>ï¼‰ã€‚</p><p>æ•°æ®è¡¨ä¸­çš„è®°å½•é»˜è®¤ä½¿ç”¨ä¸»é”®ï¼ˆä¸€èˆ¬ä¸ºidï¼‰æ’åºï¼Œä¸Šé¢çš„ç»“æœç›¸å½“äºï¼š</p><pre><code>select * from orders_history where type=8 order by id limit 10000,10;</code></pre><p>ä¸‰æ¬¡æŸ¥è¯¢æ—¶é—´åˆ†åˆ«ä¸ºï¼š</p><ul><li>3040 ms</li><li>3063 ms</li><li>3018 ms</li></ul><p>é’ˆå¯¹è¿™ç§æŸ¥è¯¢æ–¹å¼ï¼Œä¸‹é¢æµ‹è¯•æŸ¥è¯¢è®°å½•é‡å¯¹æ—¶é—´çš„å½±å“ï¼š</p><pre><code>select * from orders_history where type=8 limit 10000,1;select * from orders_history where type=8 limit 10000,10;select * from orders_history where type=8 limit 10000,100;select * from orders_history where type=8 limit 10000,1000;select * from orders_history where type=8 limit 10000,10000;</code></pre><p>ä¸‰æ¬¡æŸ¥è¯¢æ—¶é—´å¦‚ä¸‹ï¼š</p><ul><li>æŸ¥è¯¢1æ¡è®°å½•ï¼š3072ms 3092ms 3002ms</li><li>æŸ¥è¯¢10æ¡è®°å½•ï¼š3081ms 3077ms 3032ms</li><li>æŸ¥è¯¢100æ¡è®°å½•ï¼š3118ms 3200ms 3128ms</li><li>æŸ¥è¯¢1000æ¡è®°å½•ï¼š3412ms 3468ms 3394ms</li><li>æŸ¥è¯¢10000æ¡è®°å½•ï¼š3749ms 3802ms 3696ms</li></ul><p>å¦å¤–æˆ‘è¿˜åšäº†åæ¥æ¬¡æŸ¥è¯¢ï¼Œä»æŸ¥è¯¢æ—¶é—´æ¥çœ‹ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šï¼Œåœ¨æŸ¥è¯¢è®°å½•é‡ä½äº100æ—¶ï¼ŒæŸ¥è¯¢æ—¶é—´åŸºæœ¬æ²¡æœ‰å·®è·ï¼Œéšç€æŸ¥è¯¢è®°å½•é‡è¶Šæ¥è¶Šå¤§ï¼Œæ‰€èŠ±è´¹çš„æ—¶é—´ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šã€‚</p><p>é’ˆå¯¹æŸ¥è¯¢åç§»é‡çš„æµ‹è¯•ï¼š</p><pre><code>select * from orders_history where type=8 limit 100,100;select * from orders_history where type=8 limit 1000,100;select * from orders_history where type=8 limit 10000,100;select * from orders_history where type=8 limit 100000,100;select * from orders_history where type=8 limit 1000000,100;</code></pre><p>ä¸‰æ¬¡æŸ¥è¯¢æ—¶é—´å¦‚ä¸‹ï¼š</p><ul><li>æŸ¥è¯¢100åç§»ï¼š25ms 24ms 24ms</li><li>æŸ¥è¯¢1000åç§»ï¼š78ms 76ms 77ms</li><li>æŸ¥è¯¢10000åç§»ï¼š3092ms 3212ms 3128ms</li><li>æŸ¥è¯¢100000åç§»ï¼š3878ms 3812ms 3798ms</li><li>æŸ¥è¯¢1000000åç§»ï¼š14608ms 14062ms 14700ms</li></ul><p>éšç€æŸ¥è¯¢åç§»çš„å¢å¤§ï¼Œå°¤å…¶æŸ¥è¯¢åç§»å¤§äº10ä¸‡ä»¥åï¼ŒæŸ¥è¯¢æ—¶é—´æ€¥å‰§å¢åŠ ã€‚</p><p><strong>è¿™ç§åˆ†é¡µæŸ¥è¯¢æ–¹å¼ä¼šä»æ•°æ®åº“ç¬¬ä¸€æ¡è®°å½•å¼€å§‹æ‰«æï¼Œæ‰€ä»¥è¶Šå¾€åï¼ŒæŸ¥è¯¢é€Ÿåº¦è¶Šæ…¢ï¼Œè€Œä¸”æŸ¥è¯¢çš„æ•°æ®è¶Šå¤šï¼Œä¹Ÿä¼šæ‹–æ…¢æ€»æŸ¥è¯¢é€Ÿåº¦ã€‚</strong></p><h1 id="ä½¿ç”¨å­æŸ¥è¯¢ä¼˜åŒ–"><a href="#ä½¿ç”¨å­æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="ä½¿ç”¨å­æŸ¥è¯¢ä¼˜åŒ–"></a>ä½¿ç”¨å­æŸ¥è¯¢ä¼˜åŒ–</h1><p>è¿™ç§æ–¹å¼å…ˆå®šä½åç§»ä½ç½®çš„ idï¼Œç„¶åå¾€åæŸ¥è¯¢ï¼Œè¿™ç§æ–¹å¼é€‚ç”¨äº id é€’å¢çš„æƒ…å†µã€‚</p><pre><code>select * from orders_history where type=8 limit 100000,1;select id from orders_history where type=8 limit 100000,1;select * from orders_history where type=8 andid&gt;=(select id from orders_history where type=8 limit 100000,1)limit 100;select * from orders_history where type=8 limit 100000,100;</code></pre><p>4æ¡è¯­å¥çš„æŸ¥è¯¢æ—¶é—´å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬1æ¡è¯­å¥ï¼š3674ms</li><li>ç¬¬2æ¡è¯­å¥ï¼š1315ms</li><li>ç¬¬3æ¡è¯­å¥ï¼š1327ms</li><li>ç¬¬4æ¡è¯­å¥ï¼š3710ms</li></ul><p>é’ˆå¯¹ä¸Šé¢çš„æŸ¥è¯¢éœ€è¦æ³¨æ„ï¼š</p><ul><li>æ¯”è¾ƒç¬¬1æ¡è¯­å¥å’Œç¬¬2æ¡è¯­å¥ï¼šä½¿ç”¨ select id ä»£æ›¿ select * é€Ÿåº¦å¢åŠ äº†3å€</li><li>æ¯”è¾ƒç¬¬2æ¡è¯­å¥å’Œç¬¬3æ¡è¯­å¥ï¼šé€Ÿåº¦ç›¸å·®å‡ åæ¯«ç§’</li><li>æ¯”è¾ƒç¬¬3æ¡è¯­å¥å’Œç¬¬4æ¡è¯­å¥ï¼šå¾—ç›Šäº select id é€Ÿåº¦å¢åŠ ï¼Œç¬¬3æ¡è¯­å¥æŸ¥è¯¢é€Ÿåº¦å¢åŠ äº†3å€</li></ul><p>è¿™ç§æ–¹å¼ç›¸è¾ƒäºåŸå§‹ä¸€èˆ¬çš„æŸ¥è¯¢æ–¹æ³•ï¼Œå°†ä¼šå¢å¿«æ•°å€ã€‚</p><h1 id="ä½¿ç”¨-id-é™å®šä¼˜åŒ–"><a href="#ä½¿ç”¨-id-é™å®šä¼˜åŒ–" class="headerlink" title="ä½¿ç”¨ id é™å®šä¼˜åŒ–"></a>ä½¿ç”¨ id é™å®šä¼˜åŒ–</h1><p>è¿™ç§æ–¹å¼å‡è®¾æ•°æ®è¡¨çš„idæ˜¯<strong>è¿ç»­é€’å¢</strong>çš„ï¼Œåˆ™æˆ‘ä»¬æ ¹æ®æŸ¥è¯¢çš„é¡µæ•°å’ŒæŸ¥è¯¢çš„è®°å½•æ•°å¯ä»¥ç®—å‡ºæŸ¥è¯¢çš„idçš„èŒƒå›´ï¼Œå¯ä»¥ä½¿ç”¨ id between and æ¥æŸ¥è¯¢ï¼š</p><pre><code>select * from orders_history where type=2and id between 1000000 and 1000100 limit 100;</code></pre><p>æŸ¥è¯¢æ—¶é—´ï¼š15ms 12ms 9ms</p><p>è¿™ç§æŸ¥è¯¢æ–¹å¼èƒ½å¤Ÿæå¤§åœ°ä¼˜åŒ–æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŸºæœ¬èƒ½å¤Ÿåœ¨å‡ åæ¯«ç§’ä¹‹å†…å®Œæˆã€‚é™åˆ¶æ˜¯åªèƒ½ä½¿ç”¨äºæ˜ç¡®çŸ¥é“idçš„æƒ…å†µï¼Œä¸è¿‡ä¸€èˆ¬å»ºç«‹è¡¨çš„æ—¶å€™ï¼Œéƒ½ä¼šæ·»åŠ åŸºæœ¬çš„idå­—æ®µï¼Œè¿™ä¸ºåˆ†é¡µæŸ¥è¯¢å¸¦æ¥å¾ˆå¤šä¾¿åˆ©ã€‚</p><p>è¿˜å¯ä»¥æœ‰å¦å¤–ä¸€ç§å†™æ³•ï¼š</p><pre><code>select * from orders_history where id &gt;= 1000001 limit 100;</code></pre><p>å½“ç„¶è¿˜å¯ä»¥ä½¿ç”¨ in çš„æ–¹å¼æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™ç§æ–¹å¼ç»å¸¸ç”¨åœ¨å¤šè¡¨å…³è”çš„æ—¶å€™è¿›è¡ŒæŸ¥è¯¢ï¼Œä½¿ç”¨å…¶ä»–è¡¨æŸ¥è¯¢çš„idé›†åˆï¼Œæ¥è¿›è¡ŒæŸ¥è¯¢ï¼š</p><pre><code>select * from orders_history where id in(select order_id from trade_2 where goods = &#39;pen&#39;)limit 100;</code></pre><p>è¿™ç§ in æŸ¥è¯¢çš„æ–¹å¼è¦æ³¨æ„ï¼šæŸäº› mysql ç‰ˆæœ¬ä¸æ”¯æŒåœ¨ in å­å¥ä¸­ä½¿ç”¨ limitã€‚</p><h1 id="ä½¿ç”¨ä¸´æ—¶è¡¨ä¼˜åŒ–"><a href="#ä½¿ç”¨ä¸´æ—¶è¡¨ä¼˜åŒ–" class="headerlink" title="ä½¿ç”¨ä¸´æ—¶è¡¨ä¼˜åŒ–"></a>ä½¿ç”¨ä¸´æ—¶è¡¨ä¼˜åŒ–</h1><p>è¿™ç§æ–¹å¼å·²ç»ä¸å±äºæŸ¥è¯¢ä¼˜åŒ–ï¼Œè¿™å„¿é™„å¸¦æä¸€ä¸‹ã€‚</p><p>å¯¹äºä½¿ç”¨ id é™å®šä¼˜åŒ–ä¸­çš„é—®é¢˜ï¼Œéœ€è¦ id æ˜¯è¿ç»­é€’å¢çš„ï¼Œä½†æ˜¯åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚ä½¿ç”¨å†å²è¡¨çš„æ—¶å€™ï¼Œæˆ–è€…å‡ºç°è¿‡æ•°æ®ç¼ºå¤±é—®é¢˜æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸´æ—¶å­˜å‚¨çš„è¡¨æ¥è®°å½•åˆ†é¡µçš„idï¼Œä½¿ç”¨åˆ†é¡µçš„idæ¥è¿›è¡Œ in æŸ¥è¯¢ã€‚è¿™æ ·èƒ½å¤Ÿæå¤§çš„æé«˜ä¼ ç»Ÿçš„åˆ†é¡µæŸ¥è¯¢é€Ÿåº¦ï¼Œå°¤å…¶æ˜¯æ•°æ®é‡ä¸Šåƒä¸‡çš„æ—¶å€™ã€‚</p><h1 id="å…³äºæ•°æ®è¡¨çš„idè¯´æ˜"><a href="#å…³äºæ•°æ®è¡¨çš„idè¯´æ˜" class="headerlink" title="å…³äºæ•°æ®è¡¨çš„idè¯´æ˜"></a>å…³äºæ•°æ®è¡¨çš„idè¯´æ˜</h1><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨æ•°æ®åº“ä¸­å»ºç«‹è¡¨çš„æ—¶å€™ï¼Œå¼ºåˆ¶ä¸ºæ¯ä¸€å¼ è¡¨æ·»åŠ  id é€’å¢å­—æ®µï¼Œè¿™æ ·æ–¹ä¾¿æŸ¥è¯¢ã€‚</p><p>å¦‚æœåƒæ˜¯è®¢å•åº“ç­‰æ•°æ®é‡éå¸¸åºå¤§ï¼Œä¸€èˆ¬ä¼šè¿›è¡Œåˆ†åº“åˆ†è¡¨ã€‚è¿™ä¸ªæ—¶å€™ä¸å»ºè®®ä½¿ç”¨æ•°æ®åº“çš„ id ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œè€Œåº”è¯¥ä½¿ç”¨åˆ†å¸ƒå¼çš„é«˜å¹¶å‘å”¯ä¸€ id ç”Ÿæˆå™¨æ¥ç”Ÿæˆï¼Œå¹¶åœ¨æ•°æ®è¡¨ä¸­ä½¿ç”¨å¦å¤–çš„å­—æ®µæ¥å­˜å‚¨è¿™ä¸ªå”¯ä¸€æ ‡è¯†ã€‚</p><p>ä½¿ç”¨å…ˆä½¿ç”¨èŒƒå›´æŸ¥è¯¢å®šä½ id ï¼ˆæˆ–è€…ç´¢å¼•ï¼‰ï¼Œç„¶åå†ä½¿ç”¨ç´¢å¼•è¿›è¡Œå®šä½æ•°æ®ï¼Œèƒ½å¤Ÿæé«˜å¥½å‡ å€æŸ¥è¯¢é€Ÿåº¦ã€‚å³å…ˆ select idï¼Œç„¶åå† select *ï¼›</p><p>æœ¬äººæ‰ç–å­¦æµ…ï¼Œéš¾å…çŠ¯é”™ï¼Œè‹¥å‘ç°æ–‡ä¸­æœ‰é”™è¯¯é—æ¼ï¼Œæœ›ä¸åèµæ•™ã€‚</p><p>END</p><pre><code>ç¨‹åºæ±ªå¾€æœŸç²¾å½©æ–‡ç« åŒ…å«ç­”æ¡ˆç¨‹åºæ±ªæœ€è¿‘æ•´ç†çš„BATå¤§å°å‚é¢è¯•é¢˜(é¢è¯•é¢˜ç›®å½•æ¨è)ç›®å½•ï¼šæˆ‘æŠŠç²¾åæ–‡ç« éƒ½æ•´ç†å‡ºæ¥äº†ç¨‹åºå‘˜æ–°äººåˆšè¿›å…¬å¸å¾ˆæ‡µé€¼ï¼Œç¨‹åºæ±ªç»™5ä¸ªå»ºè®®ç¨‹åºæ±ªç²‰ä¸æ‹¿ä¸‹è…¾è®¯è§†é¢‘å­—èŠ‚è·³åŠ¨offer22Ké¢ç»åˆ†äº«ç¨‹åºæ±ªæœ¬ç§‘åº”å±Šç²‰ä¸22Kæ‹¿ä¸‹å­—èŠ‚è·³åŠ¨å’Œé¡ºä¸°offeræºç åˆ†äº« ä¸€ä¸ªåŸºäºspring bootçš„JAVAå¼€æºå•†åŸç³»ç»Ÿæ¨è3ä¸ªå¿«é€Ÿå¼€å‘å¹³å° é¡¹ç›®ç»éªŒåˆæœ‰ç€è½äº†Githubä¸Š10ä¸ªè¶…å¥½çœ‹ å¯è§†åŒ–é¢æ¿ï¼Œåå°ç®¡ç†é¡µé¢æœ‰ç€è½äº†çœŸå®æ¡ˆä¾‹:6å¹´18Kçš„androidå¼€å‘è½¬8Kçš„Javaç«Ÿç„¶æ²¡æ‰¾åˆ°å·¥ä½œé“ç²‰ï¼šæ±ªå“¥æ˜¥æ‹›æˆ‘ä¸Šå²¸çš„å…¬å¸æœ‰å­—èŠ‚è…¾è®¯shappeeddç­‰å·¥èµ„éƒ½ä¸ä½äº30Wæ¨è3ä¸ªå¼€æºç”µå•†ç³»ç»Ÿï¼Œåº”è¯¥æ¯”èŠ±2ä¸‡åŸ¹è®­çš„ç”µå•†æœ‰æŠ€æœ¯å«é‡å¤šäº† æœ‰æºç æä¾›æ‹›è˜ä¿¡æ¯ä¸Šæ˜¯8-13KJavaç ”å‘å²—,é¢è¯•é€šè¿‡å HRï¼š7Kèƒ½æ¥å—çš„è¯å¯ä»¥æ¥è¿™é‡Œé”»ç‚¼ä¸€ä¸‹</code></pre><p>é˜…è¯» 2008</p><p>èµ5åœ¨çœ‹7</p><p><img alt="img" data-src="http://wx.qlogo.cn/mmopen/TTQibyKjrickz94hTichQZM8ToKxp28icWD6rkNjRPmrdNIibjHJy6dQgVUoDEGx3O6WwckZL4oY5Sn3O9kFSjQAbnakZxEGR1aWE/132" class="lazyload"></p><p>å†™ä¸‹ä½ çš„ç•™è¨€</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMé—®é¢˜æ’æŸ¥</title>
      <link href="/2020/01/15/6.%20JVM/JVM%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"/>
      <url>/2020/01/15/6.%20JVM/JVM%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="Java-åº”ç”¨çº¿ä¸Šé—®é¢˜æ’æŸ¥æ€è·¯ã€å·¥å…·å°ç»“"><a href="#Java-åº”ç”¨çº¿ä¸Šé—®é¢˜æ’æŸ¥æ€è·¯ã€å·¥å…·å°ç»“" class="headerlink" title="Java åº”ç”¨çº¿ä¸Šé—®é¢˜æ’æŸ¥æ€è·¯ã€å·¥å…·å°ç»“"></a>Java åº”ç”¨çº¿ä¸Šé—®é¢˜æ’æŸ¥æ€è·¯ã€å·¥å…·å°ç»“</h2><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><h2 id="ä¸€ã€CPU-åˆ©ç”¨ç‡é«˜-é£™å‡"><a href="#ä¸€ã€CPU-åˆ©ç”¨ç‡é«˜-é£™å‡" class="headerlink" title="ä¸€ã€CPU åˆ©ç”¨ç‡é«˜/é£™å‡"></a>ä¸€ã€CPU åˆ©ç”¨ç‡é«˜/é£™å‡</h2><blockquote><p>â</p><p>æ³¨ï¼šCPUä½¿ç”¨ç‡æ˜¯è¡¡é‡ç³»ç»Ÿç¹å¿™ç¨‹åº¦çš„é‡è¦æŒ‡æ ‡ã€‚ä½†æ˜¯ã€ŒCPUä½¿ç”¨ç‡çš„å®‰å…¨é˜ˆå€¼æ˜¯ç›¸å¯¹çš„ï¼Œå–å†³äºä½ çš„ç³»ç»Ÿçš„IOå¯†é›†å‹è¿˜æ˜¯è®¡ç®—å¯†é›†å‹ã€ã€‚ä¸€èˆ¬è®¡ç®—å¯†é›†å‹åº”ç”¨CPUä½¿ç”¨ç‡åé«˜loadåä½ï¼ŒIOå¯†é›†å‹ç›¸åã€‚</p><p>â</p></blockquote><p><strong>ã€Œå¸¸è§åŸå› ï¼šã€</strong></p><ul><li>é¢‘ç¹ gc</li><li>æ­»å¾ªç¯ã€çº¿ç¨‹é˜»å¡ã€io waitâ€¦etc</li></ul><h3 id="æ¨¡æ‹Ÿ"><a href="#æ¨¡æ‹Ÿ" class="headerlink" title="æ¨¡æ‹Ÿ"></a>æ¨¡æ‹Ÿ</h3><p>è¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œç”¨ä¸€ä¸ªæœ€ç®€å•çš„æ­»å¾ªç¯æ¥æ¨¡æ‹ŸCPUé£™å‡çš„åœºæ™¯ï¼Œä¸‹é¢æ˜¯æ¨¡æ‹Ÿä»£ç ï¼Œ</p><p>åœ¨ä¸€ä¸ªæœ€ç®€å•çš„SpringBoot Web é¡¹ç›®ä¸­å¢åŠ <code>CpuReaper</code>è¿™ä¸ªç±»ï¼Œ</p><pre><code>/** * æ¨¡æ‹Ÿ cpu é£™å‡åœºæ™¯ * @author Richard_yyf */@Componentpublic class CpuReaper {    @PostConstruct    public void cpuReaper() {        int num = 0;        long start = System.currentTimeMillis() / 1000;        while (true) {            num = num + 1;            if (num == Integer.MAX_VALUE) {                System.out.println(&quot;reset&quot;);                num = 0;            }            if ((System.currentTimeMillis() / 1000) - start &gt; 1000) {                return;            }        }    }}</code></pre><p>æ‰“åŒ…æˆjarä¹‹åï¼Œåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚<code>java -jar cpu-reaper.jar &amp;</code></p><h3 id="ç¬¬ä¸€æ­¥ï¼šå®šä½å‡ºé—®é¢˜çš„çº¿ç¨‹"><a href="#ç¬¬ä¸€æ­¥ï¼šå®šä½å‡ºé—®é¢˜çš„çº¿ç¨‹" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå®šä½å‡ºé—®é¢˜çš„çº¿ç¨‹"></a>ç¬¬ä¸€æ­¥ï¼šå®šä½å‡ºé—®é¢˜çš„çº¿ç¨‹</h3><h4 id="æ–¹æ³•-a-ä¼ ç»Ÿçš„æ–¹æ³•"><a href="#æ–¹æ³•-a-ä¼ ç»Ÿçš„æ–¹æ³•" class="headerlink" title="æ–¹æ³• a: ä¼ ç»Ÿçš„æ–¹æ³•"></a>æ–¹æ³• a: ä¼ ç»Ÿçš„æ–¹æ³•</h4><ol><li><code>top</code> å®šä½CPU æœ€é«˜çš„è¿›ç¨‹<br>æ‰§è¡Œ<code>top</code>å‘½ä»¤ï¼ŒæŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹å ç³»ç»ŸCPUçš„æ’åºï¼Œå®šä½æ˜¯å“ªä¸ªè¿›ç¨‹æçš„é¬¼ã€‚åœ¨æœ¬ä¾‹ä¸­å°±æ˜¯å’±ä»¬çš„javaè¿›ç¨‹ã€‚PIDé‚£ä¸€åˆ—å°±æ˜¯è¿›ç¨‹å·ã€‚(å¯¹æŒ‡ç¤ºç¬¦å«ä¹‰ä¸æ¸…æ¥šçš„è§ã€é™„å½•ã€‘)</li></ol><p><img alt="img" data-src="https://cdn.nlark.com/yuque/0/2020/jpeg/1729662/1594799735359-fdd23910-83f0-4ca8-a375-78448ec5175d.jpeg" class="lazyload"></p><ol><li><code>top -Hp pid</code> å®šä½ä½¿ç”¨ CPU æœ€é«˜çš„çº¿ç¨‹</li></ol><p><img alt="img" data-src="https://cdn.nlark.com/yuque/0/2020/jpeg/1729662/1594799735358-b1c929e5-adaf-490a-8bcc-4035129a0a3b.jpeg" class="lazyload"></p><ol><li><code>printf &#39;0x%x&#39; tid</code> çº¿ç¨‹ id è½¬åŒ– 16 è¿›åˆ¶</li></ol><pre><code>&gt; printf &#39;0x%x&#39; 12817   &gt; 0x3211</code></pre><ol><li><code>jstack pid | grep tid</code> æ‰¾åˆ°çº¿ç¨‹å †æ ˆ</li></ol><pre><code>&gt; jstack 12816 | grep 0x3211 -A 30</code></pre><p><img alt="img" data-src="https://cdn.nlark.com/yuque/0/2020/jpeg/1729662/1594799735377-cab7fdab-fcec-4bcf-a1bb-3441989c2568.jpeg" class="lazyload"></p><h4 id="æ–¹æ³•-b-show-busy-java-threads"><a href="#æ–¹æ³•-b-show-busy-java-threads" class="headerlink" title="æ–¹æ³• b: show-busy-java-threads"></a>æ–¹æ³• b: show-busy-java-threads</h4><p>è¿™ä¸ªè„šæœ¬æ¥è‡ªäºgithubä¸Šä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œé¡¹ç›®æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„è„šæœ¬ï¼Œ<code>show-busy-java-threads</code>å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ªã€‚ä½¿ç”¨è¿™ä¸ªè„šæœ¬ï¼Œå¯ä»¥ç›´æ¥ç®€åŒ–æ–¹æ³•Aä¸­çš„ç¹çæ­¥éª¤ã€‚å¦‚ä¸‹ï¼Œ</p><pre><code>&gt; wget --no-check-certificate https://raw.github.com/oldratlee/useful-scripts/release-2.x/bin/show-busy-java-threads&gt; chmod +x show-busy-java-threads&gt; ./show-busy-java-threads</code></pre><p><img alt="img" data-src="https://cdn.nlark.com/yuque/0/2020/jpeg/1729662/1594799735395-15f42225-a5d7-4539-9ec3-3628f8557bd1.jpeg" class="lazyload">image.png</p><pre><code>show-busy-java-threads# ä»æ‰€æœ‰è¿è¡Œçš„Javaè¿›ç¨‹ä¸­æ‰¾å‡ºæœ€æ¶ˆè€—CPUçš„çº¿ç¨‹ï¼ˆç¼ºçœ5ä¸ªï¼‰ï¼Œæ‰“å°å‡ºå…¶çº¿ç¨‹æ ˆ# ç¼ºçœä¼šè‡ªåŠ¨ä»æ‰€æœ‰çš„Javaè¿›ç¨‹ä¸­æ‰¾å‡ºæœ€æ¶ˆè€—CPUçš„çº¿ç¨‹ï¼Œè¿™æ ·ç”¨æ›´æ–¹ä¾¿# å½“ç„¶ä½ å¯ä»¥æ‰‹åŠ¨æŒ‡å®šè¦åˆ†æçš„Javaè¿›ç¨‹Idï¼Œä»¥ä¿è¯åªä¼šæ˜¾ç¤ºä½ å…³å¿ƒçš„é‚£ä¸ªJavaè¿›ç¨‹çš„ä¿¡æ¯show-busy-java-threads -p &lt;æŒ‡å®šçš„Javaè¿›ç¨‹Id&gt;show-busy-java-threads -c &lt;è¦æ˜¾ç¤ºçš„çº¿ç¨‹æ ˆæ•°&gt;</code></pre><h4 id="æ–¹æ³•-c-arthas-thread"><a href="#æ–¹æ³•-c-arthas-thread" class="headerlink" title="æ–¹æ³• c: arthas thread"></a>æ–¹æ³• c: arthas <code>thread</code></h4><p>é˜¿é‡Œå¼€æºçš„arthasç°åœ¨å·²ç»å‡ ä¹åŒ…æ½äº†æˆ‘ä»¬çº¿ä¸Šæ’æŸ¥é—®é¢˜çš„å·¥ä½œï¼Œæä¾›äº†ä¸€ä¸ªå¾ˆå®Œæ•´çš„å·¥å…·é›†ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œä¹Ÿåªéœ€è¦ä¸€ä¸ª<code>thread -n</code>å‘½ä»¤å³å¯ã€‚</p><pre><code>&gt; curl -O https://arthas.gitee.io/arthas-boot.jar # ä¸‹è½½</code></pre><p><img alt="img" data-src="https://cdn.nlark.com/yuque/0/2020/jpeg/1729662/1594799735374-b6c7f168-c904-4bcc-a541-b92c7e614160.jpeg" class="lazyload">image.png</p><blockquote><p>â</p><p>è¦æ³¨æ„çš„æ˜¯ï¼Œarthasçš„cpuå æ¯”ï¼Œå’Œå‰é¢ä¸¤ç§cpuå æ¯”ç»Ÿè®¡æ–¹å¼ä¸åŒã€‚å‰é¢ä¸¤ç§é’ˆå¯¹çš„æ˜¯Javaè¿›ç¨‹å¯åŠ¨å¼€å§‹åˆ°ç°åœ¨çš„cpuå æ¯”æƒ…å†µï¼Œarthasè¿™ç§æ˜¯ä¸€æ®µé‡‡æ ·é—´éš”å†…ï¼Œå½“å‰JVMé‡Œå„ä¸ªçº¿ç¨‹æ‰€å ç”¨çš„cpuæ—¶é—´å æ€»cpuæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚</p><p>å…·ä½“è§å®˜ç½‘ï¼š<a href="https://alibaba.github.io/arthas/thread.html" target="_blank" rel="noopener">https://alibaba.github.io/arthas/thread.html</a></p><p>â</p></blockquote><h3 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h3><p>é€šè¿‡ç¬¬ä¸€æ­¥ï¼Œæ‰¾å‡ºæœ‰é—®é¢˜çš„ä»£ç ä¹‹åï¼Œè§‚å¯Ÿåˆ°çº¿ç¨‹æ ˆä¹‹åã€‚æˆ‘ä»¬ã€Œå°±è¦æ ¹æ®å…·ä½“é—®é¢˜æ¥å…·ä½“åˆ†æã€ã€‚è¿™é‡Œä¸¾å‡ ä¸ªä¾‹å­ã€‚</p><h4 id="æƒ…å†µä¸€ï¼šå‘ç°ä½¿ç”¨CPUæœ€é«˜çš„éƒ½æ˜¯GC-çº¿ç¨‹ã€‚"><a href="#æƒ…å†µä¸€ï¼šå‘ç°ä½¿ç”¨CPUæœ€é«˜çš„éƒ½æ˜¯GC-çº¿ç¨‹ã€‚" class="headerlink" title="æƒ…å†µä¸€ï¼šå‘ç°ä½¿ç”¨CPUæœ€é«˜çš„éƒ½æ˜¯GC çº¿ç¨‹ã€‚"></a>æƒ…å†µä¸€ï¼šå‘ç°ä½¿ç”¨CPUæœ€é«˜çš„éƒ½æ˜¯GC çº¿ç¨‹ã€‚</h4><pre><code>GC task thread#0 (ParallelGC)&quot; os_prio=0 tid=0x00007fd99001f800 nid=0x779 runnableGC task thread#1 (ParallelGC)&quot; os_prio=0 tid=0x00007fd990021800 nid=0x77a runnableGC task thread#2 (ParallelGC)&quot; os_prio=0 tid=0x00007fd990023000 nid=0x77b runnableGC task thread#3 (ParallelGC)&quot; os_prio=0 tid=0x00007fd990025000 nid=0x77c runnablå¤åˆ¶ä»£ç </code></pre><p>gc æ’æŸ¥çš„å†…å®¹è¾ƒå¤šï¼Œæ‰€ä»¥æˆ‘å†³å®šåœ¨åé¢å•ç‹¬åˆ—ä¸€èŠ‚è®²è¿°ã€‚</p><h4 id="æƒ…å†µäºŒï¼šå‘ç°ä½¿ç”¨CPUæœ€é«˜çš„æ˜¯ä¸šåŠ¡çº¿ç¨‹"><a href="#æƒ…å†µäºŒï¼šå‘ç°ä½¿ç”¨CPUæœ€é«˜çš„æ˜¯ä¸šåŠ¡çº¿ç¨‹" class="headerlink" title="æƒ…å†µäºŒï¼šå‘ç°ä½¿ç”¨CPUæœ€é«˜çš„æ˜¯ä¸šåŠ¡çº¿ç¨‹"></a>æƒ…å†µäºŒï¼šå‘ç°ä½¿ç”¨CPUæœ€é«˜çš„æ˜¯ä¸šåŠ¡çº¿ç¨‹</h4><ul><li><p>io wait</p></li><li><ul><li>æ¯”å¦‚æ­¤ä¾‹ä¸­ï¼Œå°±æ˜¯å› ä¸ºç£ç›˜ç©ºé—´ä¸å¤Ÿå¯¼è‡´çš„ioé˜»å¡</li></ul></li><li><p>ç­‰å¾…å†…æ ¸æ€é”ï¼Œå¦‚ synchronized</p></li><li><ul><li><code>jstack -l pid | grep BLOCKED</code> æŸ¥çœ‹é˜»å¡æ€çº¿ç¨‹å †æ ˆ</li><li>dump çº¿ç¨‹æ ˆï¼Œåˆ†æçº¿ç¨‹æŒé”æƒ…å†µã€‚</li><li>arthasæä¾›äº†<code>thread -b</code>ï¼Œå¯ä»¥æ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹ã€‚é’ˆå¯¹ synchronized æƒ…å†µ</li></ul></li></ul><h2 id="äºŒã€é¢‘ç¹-GC"><a href="#äºŒã€é¢‘ç¹-GC" class="headerlink" title="äºŒã€é¢‘ç¹ GC"></a>äºŒã€é¢‘ç¹ GC</h2><h3 id="1-å›é¡¾GCæµç¨‹"><a href="#1-å›é¡¾GCæµç¨‹" class="headerlink" title="1. å›é¡¾GCæµç¨‹"></a>1. å›é¡¾GCæµç¨‹</h3><p>åœ¨äº†è§£ä¸‹é¢å†…å®¹ä¹‹å‰ï¼Œè¯·å…ˆèŠ±ç‚¹æ—¶é—´å›é¡¾ä¸€ä¸‹GCçš„æ•´ä¸ªæµç¨‹ã€‚</p><p><img alt="img" data-src="https://cdn.nlark.com/yuque/0/2020/jpeg/1729662/1594799735415-ccfa296f-6a89-483d-80a0-b62ec7ab5774.jpeg" class="lazyload">image.png</p><p>æ¥å‰é¢çš„å†…å®¹ï¼Œè¿™ä¸ªæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è‡ªç„¶è€Œç„¶æƒ³åˆ°å»æŸ¥çœ‹gc çš„å…·ä½“æƒ…å†µã€‚</p><ul><li>æ–¹æ³•a : æŸ¥çœ‹gc æ—¥å¿—</li><li>æ–¹æ³•b : <code>jstat -gcutil è¿›ç¨‹å· ç»Ÿè®¡é—´éš”æ¯«ç§’ ç»Ÿè®¡æ¬¡æ•°ï¼ˆç¼ºçœä»£è¡¨ä¸€è‡´ç»Ÿè®¡</code></li><li>æ–¹æ³•c : å¦‚æœæ‰€åœ¨å…¬å¸æœ‰å¯¹åº”ç”¨è¿›è¡Œç›‘æ§çš„ç»„ä»¶å½“ç„¶æ›´æ–¹ä¾¿ï¼ˆæ¯”å¦‚Prometheus + Grafanaï¼‰</li></ul><p>è¿™é‡Œå¯¹å¼€å¯ gc log è¿›è¡Œè¡¥å……è¯´æ˜ã€‚ä¸€ä¸ªå¸¸å¸¸è¢«è®¨è®ºçš„é—®é¢˜ï¼ˆæƒ¯æ€§æ€ç»´ï¼‰æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­GCæ—¥å¿—æ˜¯å¦åº”è¯¥å¼€å¯ã€‚å› ä¸ºå®ƒæ‰€äº§ç”Ÿçš„å¼€é”€é€šå¸¸éƒ½éå¸¸æœ‰é™ï¼Œå› æ­¤æˆ‘çš„ç­”æ¡ˆæ˜¯éœ€è¦<strong>ã€Œå¼€å¯ã€</strong>ã€‚ä½†å¹¶ä¸ä¸€å®šåœ¨å¯åŠ¨JVMæ—¶å°±å¿…é¡»æŒ‡å®šGCæ—¥å¿—å‚æ•°ã€‚</p><blockquote><p>â</p><p>HotSpot JVMæœ‰ä¸€ç±»ç‰¹åˆ«çš„å‚æ•°å«åšå¯ç®¡ç†çš„å‚æ•°ã€‚å¯¹äºè¿™äº›å‚æ•°ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹ä»–ä»¬çš„å€¼ã€‚æˆ‘ä»¬è¿™é‡Œæ‰€è®¨è®ºçš„æ‰€æœ‰å‚æ•°ä»¥åŠä»¥â€œPrintGCâ€å¼€å¤´çš„å‚æ•°éƒ½æ˜¯å¯ç®¡ç†çš„å‚æ•°ã€‚è¿™æ ·åœ¨ä»»ä½•æ—¶å€™æˆ‘ä»¬éƒ½å¯ä»¥å¼€å¯æˆ–æ˜¯å…³é—­GCæ—¥å¿—ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨JDKè‡ªå¸¦çš„jinfoå·¥å…·æ¥è®¾ç½®è¿™äº›å‚æ•°ï¼Œæˆ–è€…æ˜¯é€šè¿‡JMXå®¢æˆ·ç«¯è°ƒç”¨<code>HotSpotDiagnostic MXBeançš„</code>setVMOptionæ–¹æ³•æ¥è®¾ç½®è¿™äº›å‚æ•°ã€‚</p><p>è¿™é‡Œå†æ¬¡å¤§èµarthasâ¤ï¸ï¼Œå®ƒæä¾›çš„<code>vmoption</code>å‘½ä»¤å¯ä»¥ç›´æ¥æŸ¥çœ‹ï¼Œæ›´æ–°VMè¯Šæ–­ç›¸å…³çš„å‚æ•°ã€‚</p><p>â</p></blockquote><p>è·å–åˆ°gcæ—¥å¿—ä¹‹åï¼Œå¯ä»¥ä¸Šä¼ åˆ°GC easyå¸®åŠ©åˆ†æï¼Œå¾—åˆ°å¯è§†åŒ–çš„å›¾è¡¨åˆ†æç»“æœã€‚</p><p><img alt="img" data-src="https://cdn.nlark.com/yuque/0/2020/jpeg/1729662/1594799735400-1bb857d8-ef45-4c66-9584-07f6b6e626c0.jpeg" class="lazyload">)image.png<img alt="img" data-src="https://cdn.nlark.com/yuque/0/2020/jpeg/1729662/1594799735428-988e30ff-7e86-4eda-9c20-94c9bde82175.jpeg" class="lazyload">image.png</p><h3 id="2-GC-åŸå› åŠå®šä½"><a href="#2-GC-åŸå› åŠå®šä½" class="headerlink" title="2. GC åŸå› åŠå®šä½"></a>2. GC åŸå› åŠå®šä½</h3><p><strong>ã€Œprommotion failedã€</strong></p><p>ä»SåŒºæ™‹å‡çš„å¯¹è±¡åœ¨è€å¹´ä»£ä¹Ÿæ”¾ä¸ä¸‹å¯¼è‡´ FullGCï¼ˆfgc å›æ”¶æ— æ•ˆåˆ™æŠ› OOMï¼‰ã€‚</p><p>å¯èƒ½åŸå› ï¼š</p><ul><li><strong>ã€Œsurvivor åŒºå¤ªå°ï¼Œå¯¹è±¡è¿‡æ—©è¿›å…¥è€å¹´ä»£ã€</strong><br>æŸ¥çœ‹ SurvivorRatio å‚æ•°</li><li><strong>ã€Œå¤§å¯¹è±¡åˆ†é…ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ã€</strong><br>dump å †ï¼Œprofiler/MAT åˆ†æå¯¹è±¡å ç”¨æƒ…å†µ</li><li><strong>ã€Œold åŒºå­˜åœ¨å¤§é‡å¯¹è±¡ã€</strong><br>dump å †ï¼Œprofiler/MAT åˆ†æå¯¹è±¡å ç”¨æƒ…å†µ</li></ul><p>ä½ ä¹Ÿå¯ä»¥ä»full GC çš„æ•ˆæœæ¥æ¨æ–­é—®é¢˜ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€æ¬¡full GCåº”è¯¥ä¼šå›æ”¶å¤§é‡å†…å­˜ï¼Œæ‰€ä»¥ <strong>ã€Œæ­£å¸¸çš„å †å†…å­˜æ›²çº¿åº”è¯¥æ˜¯å‘ˆé”¯é½¿å½¢ã€</strong>ã€‚å¦‚æœä½ å‘ç°full gc ä¹‹åå †å†…å­˜å‡ ä¹æ²¡æœ‰ä¸‹é™ï¼Œé‚£ä¹ˆå¯ä»¥æ¨æ–­ï¼š<strong>ã€Œå †ä¸­æœ‰å¤§é‡ä¸èƒ½å›æ”¶çš„å¯¹è±¡ä¸”åœ¨ä¸åœè†¨èƒ€ï¼Œä½¿å †çš„ä½¿ç”¨å æ¯”è¶…è¿‡full GCçš„è§¦å‘é˜ˆå€¼ï¼Œä½†åˆå›æ”¶ä¸æ‰ï¼Œå¯¼è‡´full GCä¸€ç›´æ‰§è¡Œã€‚</strong>ã€Œæ¢å¥è¯æ¥è¯´ï¼Œå¯èƒ½æ˜¯ã€<strong>å†…å­˜æ³„éœ²ã€</strong>äº†ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼ŒGCç›¸å…³çš„å¼‚å¸¸æ¨æ–­éƒ½éœ€è¦æ¶‰åŠåˆ°<strong>ã€Œå†…å­˜åˆ†æã€</strong>ï¼Œä½¿ç”¨<code>jmap</code>ä¹‹ç±»çš„å·¥å…·dumpå‡ºå†…å­˜å¿«ç…§ï¼ˆæˆ–è€… Arthasçš„<code>heapdump</code>ï¼‰å‘½ä»¤ï¼Œç„¶åä½¿ç”¨MATã€JProfilerã€JVisualVMç­‰å¯è§†åŒ–å†…å­˜åˆ†æå·¥å…·ã€‚</p><p>è‡³äºå†…å­˜åˆ†æä¹‹åçš„æ­¥éª¤ï¼Œå°±éœ€è¦å°ä¼™ä¼´ä»¬æ ¹æ®å…·ä½“é—®é¢˜å…·ä½“åˆ†æå•¦ã€‚</p><h2 id="ä¸‰ã€çº¿ç¨‹æ± å¼‚å¸¸"><a href="#ä¸‰ã€çº¿ç¨‹æ± å¼‚å¸¸" class="headerlink" title="ä¸‰ã€çº¿ç¨‹æ± å¼‚å¸¸"></a>ä¸‰ã€çº¿ç¨‹æ± å¼‚å¸¸</h2><p>Java çº¿ç¨‹æ± ä»¥æœ‰ç•Œé˜Ÿåˆ—çš„çº¿ç¨‹æ± ä¸ºä¾‹ï¼Œå½“æ–°ä»»åŠ¡æäº¤æ—¶ï¼Œå¦‚æœè¿è¡Œçš„çº¿ç¨‹å°‘äº corePoolSizeï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°ç­‰äº corePoolSize æ—¶ï¼Œåˆ™æ–°ä»»åŠ¡è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°é˜Ÿåˆ—æ»¡ã€‚å½“é˜Ÿåˆ—æ»¡äº†åï¼Œä¼šç»§ç»­å¼€è¾Ÿæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œä½†ä¸è¶…è¿‡ maximumPoolSizeã€‚å½“ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†å¹¶ä¸”å·²å¼€è¾Ÿäº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ­¤æ—¶åˆæ¥äº†æ–°ä»»åŠ¡ï¼ŒThreadPoolExecutor ä¼šæ‹’ç»æœåŠ¡ã€‚</p><h3 id="å¸¸è§é—®é¢˜å’ŒåŸå› "><a href="#å¸¸è§é—®é¢˜å’ŒåŸå› " class="headerlink" title="å¸¸è§é—®é¢˜å’ŒåŸå› "></a>å¸¸è§é—®é¢˜å’ŒåŸå› </h3><p>è¿™ç§çº¿ç¨‹æ± å¼‚å¸¸ï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§åŸå› ï¼š</p><ol><li><strong>ã€Œä¸‹æ¸¸æœåŠ¡ å“åº”æ—¶é—´ï¼ˆRTï¼‰è¿‡é•¿ã€</strong><br>è¿™ç§æƒ…å†µæœ‰å¯èƒ½æ˜¯å› ä¸ºä¸‹æ¸¸æœåŠ¡å¼‚å¸¸å¯¼è‡´çš„ï¼Œä½œä¸ºæ¶ˆè´¹è€…æˆ‘ä»¬è¦è®¾ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´å’Œç†”æ–­é™çº§æœºåˆ¶ã€‚<br>å¦å¤–é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬éƒ½è¦æœ‰å¯¹åº”çš„ç›‘æ§æœºåˆ¶ï¼šæ¯”å¦‚æ—¥å¿—ç›‘æ§ã€metricsç›‘æ§å‘Šè­¦ç­‰ï¼Œä¸è¦ç­‰åˆ°ç›®æ ‡ç”¨æˆ·æ„Ÿè§‰åˆ°å¼‚å¸¸ï¼Œä»å¤–éƒ¨åæ˜ è¿›æ¥é—®é¢˜æ‰å»çœ‹æ—¥å¿—æŸ¥ã€‚</li><li><strong>ã€Œæ•°æ®åº“æ…¢ sql æˆ–è€…æ•°æ®åº“æ­»é”ã€</strong></li></ol><p>æŸ¥çœ‹æ—¥å¿—å…³é”®è¯</p><ol><li><strong>ã€ŒJava ä»£ç æ­»é”ã€</strong><br><code>jstack â€“l pid | grep -i â€“E &#39;BLOCKED | deadlock&#39;</code></li></ol><p>ä¸Šè¿°å‰ä¸¤ç§é—®é¢˜çš„æ’æŸ¥åŠæ³•ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡æŸ¥çœ‹æ—¥å¿—æˆ–è€…ä¸€äº›ç›‘æ§ç»„ä»¶ã€‚</p><h2 id="å››ã€å¸¸è§é—®é¢˜æ¢å¤"><a href="#å››ã€å¸¸è§é—®é¢˜æ¢å¤" class="headerlink" title="å››ã€å¸¸è§é—®é¢˜æ¢å¤"></a>å››ã€å¸¸è§é—®é¢˜æ¢å¤</h2><blockquote><p>â</p><p>è¿™ä¸€éƒ¨åˆ†å†…å®¹å‚è€ƒè‡ªæ­¤ç¯‡æ–‡ç« </p><p>â</p></blockquote><p><img alt="img" data-src="https://cdn.nlark.com/yuque/0/2020/jpeg/1729662/1594799735404-55b9d465-ad5f-4e08-aafb-793b511922ea.jpeg" class="lazyload">image.png</p><h2 id="äº”ã€Arthas"><a href="#äº”ã€Arthas" class="headerlink" title="äº”ã€Arthas"></a>äº”ã€Arthas</h2><p>è¿™é‡Œè¿˜æ˜¯æƒ³å•ç‹¬ç”¨ä¸€èŠ‚å®‰åˆ©ä¸€ä¸‹Arthasè¿™ä¸ªå·¥å…·ã€‚</p><p>Arthas æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„Java è¯Šæ–­å·¥å…·ï¼ŒåŸºäº Java Agent æ–¹å¼ï¼Œä½¿ç”¨ Instrumentation æ–¹å¼ä¿®æ”¹å­—èŠ‚ç æ–¹å¼è¿›è¡Œ Java åº”ç”¨è¯Šæ–­ã€‚</p><ul><li>dashboard ï¼šç³»ç»Ÿå®æ—¶æ•°æ®é¢æ¿, å¯æŸ¥çœ‹çº¿ç¨‹ï¼Œå†…å­˜ï¼Œgc ç­‰ä¿¡æ¯</li><li>thread ï¼šæŸ¥çœ‹å½“å‰çº¿ç¨‹ä¿¡æ¯ï¼ŒæŸ¥çœ‹çº¿ç¨‹çš„å †æ ˆï¼Œå¦‚æŸ¥çœ‹æœ€ç¹å¿™çš„å‰ n çº¿ç¨‹</li><li>getstaticï¼šè·å–é™æ€å±æ€§å€¼ï¼Œå¦‚ <code>getstatic className attrName</code> å¯ç”¨äºæŸ¥çœ‹çº¿ä¸Šå¼€å…³çœŸå®å€¼</li><li>scï¼šæŸ¥çœ‹ jvm å·²åŠ è½½ç±»ä¿¡æ¯ï¼Œå¯ç”¨äºæ’æŸ¥ jar åŒ…å†²çª</li><li>smï¼šæŸ¥çœ‹ jvm å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯</li><li>jadï¼šåç¼–è¯‘ jvm åŠ è½½ç±»ä¿¡æ¯,æ’æŸ¥ä»£ç é€»è¾‘æ²¡æ‰§è¡ŒåŸå› </li><li>loggerï¼šæŸ¥çœ‹loggerä¿¡æ¯ï¼Œæ›´æ–°logger level</li><li>watchï¼šè§‚æµ‹æ–¹æ³•æ‰§è¡Œæ•°æ®ï¼ŒåŒ…å«å‡ºå‚ã€å…¥å‚ã€å¼‚å¸¸ç­‰</li><li>traceï¼šæ–¹æ³•å†…éƒ¨è°ƒç”¨æ—¶é•¿ï¼Œå¹¶è¾“å‡ºæ¯ä¸ªèŠ‚ç‚¹çš„è€—æ—¶ï¼Œç”¨äºæ€§èƒ½åˆ†æ</li><li>ttï¼šç”¨äºè®°å½•æ–¹æ³•ï¼Œå¹¶åšå›æ”¾</li></ul><blockquote><p>â</p><p>ä»¥ä¸Šå†…å®¹èŠ‚é€‰è‡ªArthaså®˜æ–¹æ–‡æ¡£ã€‚</p><p>â</p></blockquote><p>å¦å¤–ï¼Œ<em>Arthas*é‡Œçš„ è¿˜é›†æˆäº† *ognl</em> è¿™ä¸ªè½»é‡çº§çš„è¡¨è¾¾å¼å¼•æ“ï¼Œé€šè¿‡ognlï¼Œä½ å¯ä»¥ç”¨arthas å®ç°å¾ˆå¤šçš„â€œéªšâ€æ“ä½œã€‚</p><p>å…¶ä»–çš„è¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹çœ‹arthasçš„å®˜æ–¹æ–‡æ¡£ã€github issueã€‚</p><h2 id="å…­ã€æ¶‰åŠå·¥å…·"><a href="#å…­ã€æ¶‰åŠå·¥å…·" class="headerlink" title="å…­ã€æ¶‰åŠå·¥å…·"></a>å…­ã€æ¶‰åŠå·¥å…·</h2><p>å†è¯´ä¸‹ä¸€äº›å·¥å…·ã€‚</p><ul><li>Arthasï¼ˆè¶…çº§æ¨èâ¤ï¸â¤ï¸ï¼‰</li><li>useful-scripts</li><li>GC easy</li><li>Smart Java thread dump analyzer - thread dump analysis in seconds</li><li>PerfMa - Javaè™šæ‹Ÿæœºå‚æ•°/çº¿ç¨‹dump/å†…å­˜dumpåˆ†æ</li><li>Linux å‘½ä»¤</li><li>Java N æ¿æ–§</li><li>MATã€JProfilerâ€¦ç­‰å¯è§†åŒ–å†…å­˜åˆ†æå·¥å…·</li></ul><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æˆ‘çŸ¥é“æˆ‘è¿™ç¯‡æ–‡ç« å¯¹äºçº¿ä¸Šå¼‚å¸¸çš„å½’çº³å¹¶ä¸å…¨é¢ï¼Œè¿˜æœ‰<strong>ã€Œç½‘ç»œï¼ˆè¶…æ—¶ã€TCPé˜Ÿåˆ—æº¢å‡ºâ€¦ï¼‰ã€</strong>ã€å †å¤–å†…å­˜ç­‰å¾ˆå¤šçš„å¼‚å¸¸åœºæ™¯æ²¡æœ‰æ¶‰åŠã€‚ä¸»è¦æ˜¯å› ä¸ºè‡ªå·±æ¥è§¦å¾ˆå°‘ï¼Œæ²¡æœ‰æ·±åˆ»ä½“ä¼šç ”ç©¶è¿‡ï¼Œå¼ºè¡Œå†™å‡ºæ¥å…ä¸å¾—ä¼šå·®ç‚¹æ„æ€ï¼Œæ›´æ€•çš„æ˜¯è¯¯äº†åˆ«äººğŸ˜…ã€‚</p><p>è¿˜æœ‰æƒ³è¯´çš„å°±æ˜¯ï¼ŒJava åº”ç”¨çº¿ä¸Šæ’æŸ¥å®é™…éå¸¸è€ƒç©¶ä¸€ä¸ªäººåŸºç¡€æ˜¯å¦æ‰å®ã€è§£å†³é—®é¢˜èƒ½åŠ›æ˜¯å¦è¿‡å…³ã€‚æ¯”å¦‚çº¿ç¨‹æ± è¿è¡Œæœºåˆ¶ã€gcåˆ†æã€Java å†…å­˜åˆ†æç­‰ç­‰ï¼Œå¦‚æœåŸºç¡€ä¸æ‰å®ï¼Œçœ‹äº†æ›´å¤šçš„æ˜¯ä¸€å¤´é›¾æ°´ã€‚å¦å¤–å°±æ˜¯ï¼Œå¤šçœ‹çœ‹ç½‘ä¸Šä¸€äº›å¥½çš„å…³äºå¼‚å¸¸æ’æŸ¥çš„ç»éªŒæ–‡ç« ï¼Œè¿™æ ·å³ä½¿è‡ªå·±æš‚æ—¶é‡ä¸åˆ°ï¼Œä½†æ˜¯ä¼šåœ¨è„‘æµ·é‡Œé¢æ…¢æ…¢æ€»ç»“å‡ºä¸€å¥—è§£å†³ç±»ä¼¼é—®é¢˜çš„ç»“æ„æ¡†æ¶ï¼Œåˆ°æ—¶å€™çœŸçš„é‡åˆ°äº†ï¼Œä¹Ÿå°±æ˜¯è§¦ç±»æ—é€šçš„äº‹æƒ…ç½¢äº†ã€‚</p><blockquote><p>â</p><p>å¦‚æœæœ¬æ–‡æœ‰å¸®åŠ©åˆ°ä½ ï¼Œå¸Œæœ›èƒ½ç‚¹ä¸ªèµï¼Œè¿™æ˜¯å¯¹æˆ‘çš„æœ€å¤§åŠ¨åŠ›ğŸ¤ğŸ¤ğŸ¤—ğŸ¤—ã€‚</p><p>â</p></blockquote><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://developer.aliyun.com/article/757655" target="_blank" rel="noopener">https://developer.aliyun.com/article/757655</a></li><li>Arthas 3.2.0 æ–‡æ¡£</li><li>ã€Šåˆ†å¸ƒå¼æœåŠ¡æ¶æ„ï¼šåŸç†ã€è®¾è®¡ä¸å®æˆ˜ã€‹</li></ul><h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><h3 id="top-å‘½ä»¤æ˜¾ç¤ºçš„æŒ‡ç¤ºç¬¦çš„å«ä¹‰"><a href="#top-å‘½ä»¤æ˜¾ç¤ºçš„æŒ‡ç¤ºç¬¦çš„å«ä¹‰" class="headerlink" title="top å‘½ä»¤æ˜¾ç¤ºçš„æŒ‡ç¤ºç¬¦çš„å«ä¹‰"></a>top å‘½ä»¤æ˜¾ç¤ºçš„æŒ‡ç¤ºç¬¦çš„å«ä¹‰</h3><table><thead><tr><th>æŒ‡ç¤ºç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>PID</td><td>è¿›ç¨‹id</td></tr><tr><td>USER</td><td>è¿›ç¨‹æ‰€æœ‰è€…</td></tr><tr><td>PR</td><td>è¿›ç¨‹ä¼˜å…ˆçº§</td></tr><tr><td>NI</td><td>niceå€¼ã€‚è´Ÿå€¼è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼è¡¨ç¤ºä½ä¼˜å…ˆçº§</td></tr><tr><td>VIRT</td><td>è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œå•ä½kbã€‚VIRT=SWAP+RES</td></tr><tr><td>RES</td><td>è¿›ç¨‹ä½¿ç”¨çš„ã€æœªè¢«æ¢å‡ºçš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚RES=CODE+DATA</td></tr><tr><td>SHR</td><td>å…±äº«å†…å­˜å¤§å°ï¼Œå•ä½kb</td></tr><tr><td>S</td><td>è¿›ç¨‹çŠ¶æ€ã€‚D=ä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ R=è¿è¡Œ S=ç¡çœ  T=è·Ÿè¸ª/åœæ­¢ Z=åƒµå°¸è¿›ç¨‹</td></tr><tr><td>%CPU</td><td>ä¸Šæ¬¡æ›´æ–°åˆ°ç°åœ¨çš„CPUæ—¶é—´å ç”¨ç™¾åˆ†æ¯”</td></tr><tr><td>%MEM</td><td>è¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”</td></tr><tr><td>TIME+</td><td>è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½1/100ç§’</td></tr><tr><td>COMMAND</td><td>è¿›ç¨‹åç§°ï¼ˆå‘½ä»¤å/å‘½ä»¤è¡Œï¼‰</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>aopå®ç°è¯»å†™åˆ†ç¦»</title>
      <link href="/2020/01/15/5.%20%E6%95%B0%E6%8D%AE%E5%BA%93/aop%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E5%AE%9E%E6%88%98/"/>
      <url>/2020/01/15/5.%20%E6%95%B0%E6%8D%AE%E5%BA%93/aop%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<h2 id="è¯»å†™åˆ†ç¦»å¾ˆéš¾å—ï¼ŸSpringBootç»“åˆaopç®€å•å°±å®ç°äº†"><a href="#è¯»å†™åˆ†ç¦»å¾ˆéš¾å—ï¼ŸSpringBootç»“åˆaopç®€å•å°±å®ç°äº†" class="headerlink" title="è¯»å†™åˆ†ç¦»å¾ˆéš¾å—ï¼ŸSpringBootç»“åˆaopç®€å•å°±å®ç°äº†"></a>è¯»å†™åˆ†ç¦»å¾ˆéš¾å—ï¼ŸSpringBootç»“åˆaopç®€å•å°±å®ç°äº†</h2><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…¥èŒæ–°å…¬å¸åˆ°ç°åœ¨ä¹Ÿæœ‰ä¸€ä¸ªæœˆäº†ï¼Œå®Œæˆäº†æ‰‹å¤´çš„å·¥ä½œï¼Œå‰å‡ å¤©ç»ˆäºæœ‰æ—¶é—´ç ”ç©¶ä¸‹å…¬å¸æ—§é¡¹ç›®çš„ä»£ç ã€‚åœ¨ç ”ç©¶ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°é¡¹ç›®é‡Œç”¨åˆ°äº†Spring Aopæ¥å®ç°æ•°æ®åº“çš„è¯»å†™åˆ†ç¦»ï¼Œæœ¬ç€è‡ªå·±çˆ±å­¦ä¹ (æˆ‘è‡ªå·±éƒ½ä¸ä¿¡â€¦)çš„æ€§æ ¼ï¼Œå†³å®šå†™ä¸ªå®ä¾‹å·¥ç¨‹æ¥å®ç°spring aopè¯»å†™åˆ†ç¦»çš„æ•ˆæœã€‚</p><h2 id="ç¯å¢ƒéƒ¨ç½²"><a href="#ç¯å¢ƒéƒ¨ç½²" class="headerlink" title="ç¯å¢ƒéƒ¨ç½²"></a>ç¯å¢ƒéƒ¨ç½²</h2><ul><li>æ•°æ®åº“ï¼šMySql</li><li>åº“æ•°é‡ï¼š2ä¸ªï¼Œä¸€ä¸»ä¸€ä»</li></ul><p>å…³äºmysqlçš„ä¸»ä»ç¯å¢ƒéƒ¨ç½²ï¼Œå¯ä»¥å‚è€ƒï¼š</p><blockquote><p><a href="https://juejin.im/post/5dd13778e51d453da86c0e6f" target="_blank" rel="noopener">https://juejin.im/post/5dd13778e51d453da86c0e6f</a></p></blockquote><h2 id="å¼€å§‹é¡¹ç›®"><a href="#å¼€å§‹é¡¹ç›®" class="headerlink" title="å¼€å§‹é¡¹ç›®"></a>å¼€å§‹é¡¹ç›®</h2><p>é¦–å…ˆï¼Œæ¯«æ— ç–‘é—®ï¼Œå…ˆå¼€å§‹æ­å»ºä¸€ä¸ªSpringBootå·¥ç¨‹ï¼Œç„¶ååœ¨pomæ–‡ä»¶ä¸­å¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š</p><pre><code class="java">&lt;dependencies&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;            &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;            &lt;version&gt;1.1.10&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;            &lt;version&gt;1.3.2&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;            &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;            &lt;version&gt;2.1.5&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;mysql&lt;/groupId&gt;            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;            &lt;version&gt;8.0.16&lt;/version&gt;        &lt;/dependency&gt;        &lt;!-- åŠ¨æ€æ•°æ®æº æ‰€éœ€ä¾èµ– ### start--&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;            &lt;scope&gt;provided&lt;/scope&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;            &lt;scope&gt;provided&lt;/scope&gt;        &lt;/dependency&gt;        &lt;!-- åŠ¨æ€æ•°æ®æº æ‰€éœ€ä¾èµ– ### end--&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;            &lt;artifactId&gt;lombok&lt;/artifactId&gt;            &lt;optional&gt;true&lt;/optional&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;            &lt;version&gt;1.2.4&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;            &lt;scope&gt;test&lt;/scope&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;</code></pre><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>å¼•å…¥åŸºæœ¬çš„ä¾èµ–åï¼Œæ•´ç†ä¸€ä¸‹ç›®å½•ç»“æ„ï¼Œå®Œæˆåçš„é¡¹ç›®éª¨æ¶å¤§è‡´å¦‚ä¸‹ï¼š</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz/eQPyBffYbufnsEwkXGcz440NmMSSxL4ticvssaN6jwJrIPOdMMpdgCF7Sw9tQKEnjhQFxnZm6FCwEPYXzcD4b9Q/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h3 id="å»ºè¡¨"><a href="#å»ºè¡¨" class="headerlink" title="å»ºè¡¨"></a>å»ºè¡¨</h3><p>åˆ›å»ºä¸€å¼ è¡¨userï¼Œåœ¨ä¸»åº“æ‰§è¡Œsqlè¯­å¥åŒæ—¶åœ¨ä»åº“ç”Ÿæˆå¯¹åº”çš„è¡¨æ•°æ®</p><pre><code>DROP TABLE IF EXISTS `user`;CREATE TABLE `user` (  `user_id` bigint(20) NOT NULL COMMENT &#39;ç”¨æˆ·id&#39;,  `user_name` varchar(255) DEFAULT &#39;&#39; COMMENT &#39;ç”¨æˆ·åç§°&#39;,  `user_phone` varchar(50) DEFAULT &#39;&#39; COMMENT &#39;ç”¨æˆ·æ‰‹æœº&#39;,  `address` varchar(255) DEFAULT &#39;&#39; COMMENT &#39;ä½å€&#39;,  `weight` int(3) NOT NULL DEFAULT &#39;1&#39; COMMENT &#39;æƒé‡ï¼Œå¤§è€…ä¼˜å…ˆ&#39;,  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#39;æ›´æ–°æ—¶é—´&#39;,  PRIMARY KEY (`user_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;INSERT INTO `user` VALUES (&#39;1196978513958141952&#39;, &#39;æµ‹è¯•1&#39;, &#39;18826334748&#39;, &#39;å¹¿å·å¸‚æµ·ç åŒº&#39;, &#39;1&#39;, &#39;2019-11-20 10:28:51&#39;, &#39;2019-11-22 14:28:26&#39;);INSERT INTO `user` VALUES (&#39;1196978513958141953&#39;, &#39;æµ‹è¯•2&#39;, &#39;18826274230&#39;, &#39;å¹¿å·å¸‚å¤©æ²³åŒº&#39;, &#39;2&#39;, &#39;2019-11-20 10:29:37&#39;, &#39;2019-11-22 14:28:14&#39;);INSERT INTO `user` VALUES (&#39;1196978513958141954&#39;, &#39;æµ‹è¯•3&#39;, &#39;18826273900&#39;, &#39;å¹¿å·å¸‚å¤©æ²³åŒº&#39;, &#39;1&#39;, &#39;2019-11-20 10:30:19&#39;, &#39;2019-11-22 14:28:30&#39;);</code></pre><h3 id="ä¸»ä»æ•°æ®æºé…ç½®"><a href="#ä¸»ä»æ•°æ®æºé…ç½®" class="headerlink" title="ä¸»ä»æ•°æ®æºé…ç½®"></a>ä¸»ä»æ•°æ®æºé…ç½®</h3><p>application.ymlï¼Œä¸»è¦ä¿¡æ¯æ˜¯ä¸»ä»åº“çš„æ•°æ®æºé…ç½®</p><pre><code>server:  port: 8001spring:  jackson:      date-format: yyyy-MM-dd HH:mm:ss      time-zone: GMT+8  datasource:    type: com.alibaba.druid.pool.DruidDataSource    driver-class-name: com.mysql.cj.jdbc.Driver    master:      url: jdbc:mysql://127.0.0.1:3307/user?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;failOverReadOnly=false&amp;useSSL=false&amp;zeroDateTimeBehavior=convertToNull&amp;allowMultiQueries=true      username: root      password:    slave:      url: jdbc:mysql://127.0.0.1:3308/user?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;failOverReadOnly=false&amp;useSSL=false&amp;zeroDateTimeBehavior=convertToNull&amp;allowMultiQueries=true      username: root      password:</code></pre><p>å› ä¸ºæœ‰ä¸€ä¸»ä¸€ä»ä¸¤ä¸ªæ•°æ®æºï¼Œæˆ‘ä»¬ç”¨æšä¸¾ç±»æ¥ä»£æ›¿ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨æ—¶èƒ½å¯¹åº”</p><pre><code>@Getterpublic enum DynamicDataSourceEnum {    MASTER(&quot;master&quot;),    SLAVE(&quot;slave&quot;);    private String dataSourceName;    DynamicDataSourceEnum(String dataSourceName) {        this.dataSourceName = dataSourceName;    }}</code></pre><p>æ•°æ®æºé…ç½®ä¿¡æ¯ç±» DataSourceConfigï¼Œè¿™é‡Œé…ç½®äº†ä¸¤ä¸ªæ•°æ®æºï¼ŒmasterDbå’ŒslaveDb</p><pre><code>@Configuration@MapperScan(basePackages = &quot;com.xjt.proxy.mapper&quot;, sqlSessionTemplateRef = &quot;sqlTemplate&quot;)public class DataSourceConfig {     // ä¸»åº“      @Bean      @ConfigurationProperties(prefix = &quot;spring.datasource.master&quot;)      public DataSource masterDb() {  return DruidDataSourceBuilder.create().build();      }    /**     * ä»åº“     */    @Bean    @ConditionalOnProperty(prefix = &quot;spring.datasource&quot;, name = &quot;slave&quot;, matchIfMissing = true)    @ConfigurationProperties(prefix = &quot;spring.datasource.slave&quot;)    public DataSource slaveDb() {        return DruidDataSourceBuilder.create().build();    }    /**     * ä¸»ä»åŠ¨æ€é…ç½®     */    @Bean    public DynamicDataSource dynamicDb(@Qualifier(&quot;masterDb&quot;) DataSource masterDataSource,        @Autowired(required = false) @Qualifier(&quot;slaveDb&quot;) DataSource slaveDataSource) {        DynamicDataSource dynamicDataSource = new DynamicDataSource();        Map&lt;Object, Object&gt; targetDataSources = new HashMap&lt;&gt;();        targetDataSources.put(DynamicDataSourceEnum.MASTER.getDataSourceName(), masterDataSource);        if (slaveDataSource != null) {            targetDataSources.put(DynamicDataSourceEnum.SLAVE.getDataSourceName(), slaveDataSource);        }        dynamicDataSource.setTargetDataSources(targetDataSources);        dynamicDataSource.setDefaultTargetDataSource(masterDataSource);        return dynamicDataSource;    }    @Bean    public SqlSessionFactory sessionFactory(@Qualifier(&quot;dynamicDb&quot;) DataSource dynamicDataSource) throws Exception {        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();        bean.setMapperLocations(            new PathMatchingResourcePatternResolver().getResources(&quot;classpath*:mapper/*Mapper.xml&quot;));        bean.setDataSource(dynamicDataSource);        return bean.getObject();    }    @Bean    public SqlSessionTemplate sqlTemplate(@Qualifier(&quot;sessionFactory&quot;) SqlSessionFactory sqlSessionFactory) {        return new SqlSessionTemplate(sqlSessionFactory);    }    @Bean(name = &quot;dataSourceTx&quot;)    public DataSourceTransactionManager dataSourceTx(@Qualifier(&quot;dynamicDb&quot;) DataSource dynamicDataSource) {        DataSourceTransactionManager dataSourceTransactionManager = new DataSourceTransactionManager();        dataSourceTransactionManager.setDataSource(dynamicDataSource);        return dataSourceTransactionManager;    }}</code></pre><h3 id="è®¾ç½®è·¯ç”±"><a href="#è®¾ç½®è·¯ç”±" class="headerlink" title="è®¾ç½®è·¯ç”±"></a>è®¾ç½®è·¯ç”±</h3><p>è®¾ç½®è·¯ç”±çš„ç›®çš„ä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®æºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ThreadLocalä¿å­˜æ•°æ®æºçš„ä¿¡æ¯åˆ°æ¯ä¸ªçº¿ç¨‹ä¸­ï¼Œæ–¹ä¾¿æˆ‘ä»¬éœ€è¦æ—¶è·å–</p><pre><code>public class DataSourceContextHolder {    private static final ThreadLocal&lt;String&gt; DYNAMIC_DATASOURCE_CONTEXT = new ThreadLocal&lt;&gt;();    public static void set(String datasourceType) {        DYNAMIC_DATASOURCE_CONTEXT.set(datasourceType);    }    public static String get() {        return DYNAMIC_DATASOURCE_CONTEXT.get();    }    public static void clear() {        DYNAMIC_DATASOURCE_CONTEXT.remove();    }}</code></pre><p>è·å–è·¯ç”±</p><pre><code>public class DynamicDataSource extends AbstractRoutingDataSource {    @Override    protected Object determineCurrentLookupKey() {        return DataSourceContextHolder.get();    }}</code></pre><p>AbstractRoutingDataSourceçš„ä½œç”¨æ˜¯åŸºäºæŸ¥æ‰¾keyè·¯ç”±åˆ°å¯¹åº”çš„æ•°æ®æºï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ç»„ç›®æ ‡æ•°æ®æºï¼Œå¹¶ä¸”åšäº†è·¯ç”±keyä¸ç›®æ ‡æ•°æ®æºä¹‹é—´çš„æ˜ å°„ï¼Œæä¾›åŸºäºkeyæŸ¥æ‰¾æ•°æ®æºçš„æ–¹æ³•ã€‚æ›´å¤šspringbootæ–‡ç« </p><h3 id="æ•°æ®æºçš„æ³¨è§£"><a href="#æ•°æ®æºçš„æ³¨è§£" class="headerlink" title="æ•°æ®æºçš„æ³¨è§£"></a>æ•°æ®æºçš„æ³¨è§£</h3><p>ä¸ºäº†å¯ä»¥æ–¹ä¾¿åˆ‡æ¢æ•°æ®æºï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªæ³¨è§£ï¼Œæ³¨è§£ä¸­åŒ…å«æ•°æ®æºå¯¹åº”çš„æšä¸¾å€¼ï¼Œé»˜è®¤æ˜¯ä¸»åº“ï¼Œ</p><pre><code>@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.METHOD)@Documentedpublic @interface DataSourceSelector {    DynamicDataSourceEnum value() default DynamicDataSourceEnum.MASTER;    boolean clear() default true;}</code></pre><h3 id="aopåˆ‡æ¢æ•°æ®æº"><a href="#aopåˆ‡æ¢æ•°æ®æº" class="headerlink" title="aopåˆ‡æ¢æ•°æ®æº"></a>aopåˆ‡æ¢æ•°æ®æº</h3><p>åˆ°è¿™é‡Œï¼Œaopç»ˆäºå¯ä»¥ç°èº«å‡ºåœºäº†ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªaopç±»ï¼Œå¯¹æœ‰æ³¨è§£çš„æ–¹æ³•åšåˆ‡æ¢æ•°æ®æºçš„æ“ä½œï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>@Slf4j@Aspect@Order(value = 1)@Componentpublic class DataSourceContextAop { @Around(&quot;@annotation(com.xjt.proxy.dynamicdatasource.DataSourceSelector)&quot;)    public Object setDynamicDataSource(ProceedingJoinPoint pjp) throws Throwable {        boolean clear = true;        try {            Method method = this.getMethod(pjp);            DataSourceSelector dataSourceImport = method.getAnnotation(DataSourceSelector.class);            clear = dataSourceImport.clear();            DataSourceContextHolder.set(dataSourceImport.value().getDataSourceName());            log.info(&quot;========æ•°æ®æºåˆ‡æ¢è‡³ï¼š{}&quot;, dataSourceImport.value().getDataSourceName());            return pjp.proceed();        } finally {            if (clear) {                DataSourceContextHolder.clear();            }        }    }    private Method getMethod(JoinPoint pjp) {        MethodSignature signature = (MethodSignature)pjp.getSignature();        return signature.getMethod();    }}</code></pre><p>åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬çš„å‡†å¤‡é…ç½®å·¥ä½œå°±å®Œæˆäº†ï¼Œä¸‹é¢å¼€å§‹æµ‹è¯•æ•ˆæœã€‚</p><p>å…ˆå†™å¥½Serviceæ–‡ä»¶ï¼ŒåŒ…å«è¯»å–å’Œæ›´æ–°ä¸¤ä¸ªæ–¹æ³•ï¼Œ</p><pre><code>@Servicepublic class UserService {    @Autowired    private UserMapper userMapper;    @DataSourceSelector(value = DynamicDataSourceEnum.SLAVE)    public List&lt;User&gt; listUser() {        List&lt;User&gt; users = userMapper.selectAll();        return users;    }    @DataSourceSelector(value = DynamicDataSourceEnum.MASTER)    public int update() {        User user = new User();        user.setUserId(Long.parseLong(&quot;1196978513958141952&quot;));        user.setUserName(&quot;ä¿®æ”¹åçš„åå­—2&quot;);        return userMapper.updateByPrimaryKeySelective(user);    }    @DataSourceSelector(value = DynamicDataSourceEnum.SLAVE)    public User find() {        User user = new User();        user.setUserId(Long.parseLong(&quot;1196978513958141952&quot;));        return userMapper.selectByPrimaryKey(user);    }}</code></pre><p>æ ¹æ®æ–¹æ³•ä¸Šçš„æ³¨è§£å¯ä»¥çœ‹å‡ºï¼Œè¯»çš„æ–¹æ³•èµ°ä»åº“ï¼Œæ›´æ–°çš„æ–¹æ³•èµ°ä¸»åº“ï¼Œæ›´æ–°çš„å¯¹è±¡æ˜¯userIdä¸º1196978513958141953 çš„æ•°æ®ï¼Œ</p><p>ç„¶åæˆ‘ä»¬å†™ä¸ªæµ‹è¯•ç±»æµ‹è¯•ä¸‹æ˜¯å¦èƒ½è¾¾åˆ°æ•ˆæœï¼Œ</p><pre><code>@RunWith(SpringRunner.class)@SpringBootTestclass UserServiceTest {    @Autowired    UserService userService;    @Test    void listUser() {        List&lt;User&gt; users = userService.listUser();        for (User user : users) {            System.out.println(user.getUserId());            System.out.println(user.getUserName());            System.out.println(user.getUserPhone());        }    }    @Test    void update() {        userService.update();        User user = userService.find();        System.out.println(user.getUserName());    }}</code></pre><h3 id="æµ‹è¯•ç»“æœï¼š"><a href="#æµ‹è¯•ç»“æœï¼š" class="headerlink" title="æµ‹è¯•ç»“æœï¼š"></a>æµ‹è¯•ç»“æœï¼š</h3><p>1ã€è¯»å–æ–¹æ³•</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz/eQPyBffYbufnsEwkXGcz440NmMSSxL4teDwguTvMEY7BKHMickI2PPoO856CibdLp9kQRR2JHdFaEJugr28IMICg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>2ã€æ›´æ–°æ–¹æ³•</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz/eQPyBffYbufnsEwkXGcz440NmMSSxL4tkEl81S9ncE0fuhz4wBGTtibM62u6oGib9MRnpTmUlcoblB7qQrzeQQfQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>æ‰§è¡Œä¹‹åï¼Œæ¯”å¯¹æ•°æ®åº“å°±å¯ä»¥å‘ç°ä¸»ä»åº“éƒ½ä¿®æ”¹äº†æ•°æ®ï¼Œè¯´æ˜æˆ‘ä»¬çš„è¯»å†™åˆ†ç¦»æ˜¯æˆåŠŸçš„ã€‚å½“ç„¶ï¼Œæ›´æ–°æ–¹æ³•å¯ä»¥æŒ‡å‘ä»åº“ï¼Œè¿™æ ·ä¸€æ¥å°±åªä¼šä¿®æ”¹åˆ°ä»åº“çš„æ•°æ®ï¼Œè€Œä¸ä¼šæ¶‰åŠåˆ°ä¸»åº“ã€‚</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>ä¸Šé¢æµ‹è¯•çš„ä¾‹å­è™½ç„¶æ¯”è¾ƒç®€å•ï¼Œä½†ä¹Ÿç¬¦åˆå¸¸è§„çš„è¯»å†™åˆ†ç¦»é…ç½®ã€‚å€¼å¾—è¯´æ˜çš„æ˜¯ï¼Œè¯»å†™åˆ†ç¦»çš„ä½œç”¨æ˜¯ä¸ºäº†ç¼“è§£å†™åº“ï¼Œä¹Ÿå°±æ˜¯ä¸»åº“çš„å‹åŠ›ï¼Œä½†ä¸€å®šè¦åŸºäºæ•°æ®ä¸€è‡´æ€§çš„åŸåˆ™ï¼Œå°±æ˜¯ä¿è¯ä¸»ä»åº“ä¹‹é—´çš„æ•°æ®ä¸€å®šè¦ä¸€è‡´ã€‚å¦‚æœä¸€ä¸ªæ–¹æ³•æ¶‰åŠåˆ°å†™çš„é€»è¾‘ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•é‡Œæ‰€æœ‰çš„æ•°æ®åº“æ“ä½œéƒ½è¦èµ°ä¸»åº“ã€‚</p><p>å‡è®¾å†™çš„æ“ä½œæ‰§è¡Œå®Œåæ•°æ®æœ‰å¯èƒ½è¿˜æ²¡åŒæ­¥åˆ°ä»åº“ï¼Œç„¶åè¯»çš„æ“ä½œä¹Ÿå¼€å§‹æ‰§è¡Œäº†ï¼Œå¦‚æœè¿™ä¸ªè¯»å–çš„ç¨‹åºèµ°çš„ä¾ç„¶æ˜¯ä»åº“çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡äº†ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸å…è®¸çš„ã€‚<br>æœ€åå‘ä¸€ä¸‹é¡¹ç›®çš„githubåœ°å€ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ä¸‹ï¼š</p><blockquote><p><a href="https://github.com/Taoxj/mysql-proxy" target="_blank" rel="noopener">https://github.com/Taoxj/mysql-proxy</a></p></blockquote><h3 id="åƒè€ƒï¼š"><a href="#åƒè€ƒï¼š" class="headerlink" title="åƒè€ƒï¼š"></a>åƒè€ƒï¼š</h3><blockquote><p><a href="https://www.cnblogs.com/cjsblog/p/9712457.html" target="_blank" rel="noopener">https://www.cnblogs.com/cjsblog/p/9712457.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼Id</title>
      <link href="/2020/01/15/7.%20%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8FId/"/>
      <url>/2020/01/15/7.%20%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8FId/</url>
      
        <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>IDæ˜¯æ•°æ®çš„å”¯ä¸€æ ‡è¯†ï¼Œä¼ ç»Ÿçš„åšæ³•æ˜¯åˆ©ç”¨UUIDå’Œæ•°æ®åº“çš„è‡ªå¢IDï¼Œåœ¨äº’è”ç½‘ä¼ä¸šä¸­ï¼Œå¤§éƒ¨åˆ†å…¬å¸ä½¿ç”¨çš„éƒ½æ˜¯Mysqlï¼Œå¹¶ä¸”å› ä¸ºéœ€è¦äº‹åŠ¡æ”¯æŒï¼Œæ‰€ä»¥é€šå¸¸ä¼šä½¿ç”¨Innodbå­˜å‚¨å¼•æ“ï¼ŒUUIDå¤ªé•¿ä»¥åŠæ— åºï¼Œæ‰€ä»¥å¹¶ä¸é€‚åˆåœ¨Innodbä¸­æ¥ä½œä¸ºä¸»é”®ï¼Œè‡ªå¢IDæ¯”è¾ƒåˆé€‚ï¼Œä½†æ˜¯éšç€å…¬å¸çš„ä¸šåŠ¡å‘å±•ï¼Œæ•°æ®é‡å°†è¶Šæ¥è¶Šå¤§ï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡Œåˆ†è¡¨ï¼Œè€Œåˆ†è¡¨åï¼Œæ¯ä¸ªè¡¨ä¸­çš„æ•°æ®éƒ½ä¼šæŒ‰è‡ªå·±çš„èŠ‚å¥è¿›è¡Œè‡ªå¢ï¼Œå¾ˆæœ‰å¯èƒ½å‡ºç°IDå†²çªã€‚è¿™æ—¶å°±éœ€è¦ä¸€ä¸ªå•ç‹¬çš„æœºåˆ¶æ¥è´Ÿè´£ç”Ÿæˆå”¯ä¸€IDï¼Œç”Ÿæˆå‡ºæ¥çš„IDä¹Ÿå¯ä»¥å«åš<strong>åˆ†å¸ƒå¼ID</strong>ï¼Œæˆ–<strong>å…¨å±€ID</strong>ã€‚ä¸‹é¢æ¥åˆ†æå„ä¸ªç”Ÿæˆåˆ†å¸ƒå¼IDçš„æœºåˆ¶ã€‚</p><h2 id="å¸¸è§åˆ†å¸ƒå¼IDæ–¹æ¡ˆ"><a href="#å¸¸è§åˆ†å¸ƒå¼IDæ–¹æ¡ˆ" class="headerlink" title="å¸¸è§åˆ†å¸ƒå¼IDæ–¹æ¡ˆ"></a>å¸¸è§åˆ†å¸ƒå¼IDæ–¹æ¡ˆ</h2><p><img alt="å¸¸ç”¨åˆ†å¸ƒå¼idæ–¹æ¡ˆ" data-src="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-7/%E5%88%86%E5%B8%83%E5%BC%8Fid%E6%96%B9%E6%A1%88.jpeg" class="lazyload"></p><h2 id="æ•°æ®åº“è‡ªå¢ID"><a href="#æ•°æ®åº“è‡ªå¢ID" class="headerlink" title="æ•°æ®åº“è‡ªå¢ID"></a>æ•°æ®åº“è‡ªå¢ID</h2><p>ç¬¬ä¸€ç§æ–¹æ¡ˆä»ç„¶è¿˜æ˜¯åŸºäºæ•°æ®åº“çš„è‡ªå¢IDï¼Œéœ€è¦å•ç‹¬ä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“å®ä¾‹ï¼Œåœ¨è¿™ä¸ªå®ä¾‹ä¸­æ–°å»ºä¸€ä¸ªå•ç‹¬çš„è¡¨ï¼š</p><p>è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code class="sql">CREATE DATABASE `SEQID`;CREATE TABLE SEQID.SEQUENCE_ID (    id bigint(20) unsigned NOT NULL auto_increment,     stub char(10) NOT NULL default &#39;&#39;,    PRIMARY KEY (id),    UNIQUE KEY stub (stub)) ENGINE=MyISAM;</code></pre><p>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­å¥ç”Ÿæˆå¹¶è·å–åˆ°ä¸€ä¸ªè‡ªå¢ID</p><pre><code class="sql">begin;replace into SEQUENCE_ID (stub) VALUES (&#39;anyword&#39;);select last_insert_id();commit;</code></pre><p>stubå­—æ®µåœ¨è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æ„ä¹‰ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿çš„å»æ’å…¥æ•°æ®ï¼Œåªæœ‰èƒ½æ’å…¥æ•°æ®æ‰èƒ½äº§ç”Ÿè‡ªå¢idã€‚è€Œå¯¹äºæ’å…¥æˆ‘ä»¬ç”¨çš„æ˜¯replaceï¼Œreplaceä¼šå…ˆçœ‹æ˜¯å¦å­˜åœ¨stubæŒ‡å®šå€¼ä¸€æ ·çš„æ•°æ®ï¼Œå¦‚æœå­˜åœ¨åˆ™å…ˆdeleteå†insertï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç›´æ¥insertã€‚</p><p>è¿™ç§ç”Ÿæˆåˆ†å¸ƒå¼IDçš„æœºåˆ¶ï¼Œéœ€è¦ä¸€ä¸ªå•ç‹¬çš„Mysqlå®ä¾‹ï¼Œè™½ç„¶å¯è¡Œï¼Œä½†æ˜¯åŸºäºæ€§èƒ½ä¸å¯é æ€§æ¥è€ƒè™‘çš„è¯éƒ½ä¸å¤Ÿï¼Œ<strong>ä¸šåŠ¡ç³»ç»Ÿæ¯æ¬¡éœ€è¦ä¸€ä¸ªIDæ—¶ï¼Œéƒ½éœ€è¦è¯·æ±‚æ•°æ®åº“è·å–ï¼Œæ€§èƒ½ä½ï¼Œå¹¶ä¸”å¦‚æœæ­¤æ•°æ®åº“å®ä¾‹ä¸‹çº¿äº†ï¼Œé‚£ä¹ˆå°†å½±å“æ‰€æœ‰çš„ä¸šåŠ¡ç³»ç»Ÿã€‚</strong></p><p>ä¸ºäº†è§£å†³æ•°æ®åº“å¯é æ€§é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬äºŒç§åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆã€‚</p><h2 id="æ•°æ®åº“å¤šä¸»æ¨¡å¼"><a href="#æ•°æ®åº“å¤šä¸»æ¨¡å¼" class="headerlink" title="æ•°æ®åº“å¤šä¸»æ¨¡å¼"></a>æ•°æ®åº“å¤šä¸»æ¨¡å¼</h2><p>å¦‚æœæˆ‘ä»¬ä¸¤ä¸ªæ•°æ®åº“ç»„æˆä¸€ä¸ª<strong>ä¸»ä»æ¨¡å¼</strong>é›†ç¾¤ï¼Œæ­£å¸¸æƒ…å†µä¸‹å¯ä»¥è§£å†³æ•°æ®åº“å¯é æ€§é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä¸»åº“æŒ‚æ‰åï¼Œæ•°æ®æ²¡æœ‰åŠæ—¶åŒæ­¥åˆ°ä»åº“ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå‡ºç°IDé‡å¤çš„ç°è±¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>åŒä¸»æ¨¡å¼</strong>é›†ç¾¤ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªMysqlå®ä¾‹éƒ½èƒ½å•ç‹¬çš„ç”Ÿäº§è‡ªå¢IDï¼Œè¿™æ ·èƒ½å¤Ÿæé«˜æ•ˆç‡ï¼Œä½†æ˜¯å¦‚æœä¸ç»è¿‡å…¶ä»–æ”¹é€ çš„è¯ï¼Œè¿™ä¸¤ä¸ªMysqlå®ä¾‹å¾ˆå¯èƒ½ä¼šç”ŸæˆåŒæ ·çš„IDã€‚éœ€è¦å•ç‹¬ç»™æ¯ä¸ªMysqlå®ä¾‹é…ç½®ä¸åŒçš„èµ·å§‹å€¼å’Œè‡ªå¢æ­¥é•¿ã€‚</p><p>ç¬¬ä¸€å°Mysqlå®ä¾‹é…ç½®ï¼š</p><pre><code class="sql">set @@auto_increment_offset = 1;     -- èµ·å§‹å€¼set @@auto_increment_increment = 2;  -- æ­¥é•¿</code></pre><p>ç¬¬äºŒå°Mysqlå®ä¾‹é…ç½®ï¼š</p><pre><code class="sql">set @@auto_increment_offset = 2;     -- èµ·å§‹å€¼set @@auto_increment_increment = 2;  -- æ­¥é•¿</code></pre><p>ç»è¿‡ä¸Šé¢çš„é…ç½®åï¼Œè¿™ä¸¤ä¸ªMysqlå®ä¾‹ç”Ÿæˆçš„idåºåˆ—å¦‚ä¸‹ï¼š mysql1,èµ·å§‹å€¼ä¸º1,æ­¥é•¿ä¸º2,IDç”Ÿæˆçš„åºåˆ—ä¸ºï¼š1,3,5,7,9,â€¦ mysql2,èµ·å§‹å€¼ä¸º2,æ­¥é•¿ä¸º2,IDç”Ÿæˆçš„åºåˆ—ä¸ºï¼š2,4,6,8,10,â€¦</p><p>å¯¹äºè¿™ç§ç”Ÿæˆåˆ†å¸ƒå¼IDçš„æ–¹æ¡ˆï¼Œéœ€è¦å•ç‹¬æ–°å¢ä¸€ä¸ªç”Ÿæˆåˆ†å¸ƒå¼IDåº”ç”¨ï¼Œæ¯”å¦‚DistributIdServiceï¼Œè¯¥åº”ç”¨æä¾›ä¸€ä¸ªæ¥å£ä¾›ä¸šåŠ¡åº”ç”¨è·å–IDï¼Œä¸šåŠ¡åº”ç”¨éœ€è¦ä¸€ä¸ªIDæ—¶ï¼Œé€šè¿‡rpcçš„æ–¹å¼è¯·æ±‚DistributIdServiceï¼ŒDistributIdServiceéšæœºå»ä¸Šé¢çš„ä¸¤ä¸ªMysqlå®ä¾‹ä¸­å»è·å–IDã€‚</p><p>å®è¡Œè¿™ç§æ–¹æ¡ˆåï¼Œå°±ç®—å…¶ä¸­æŸä¸€å°Mysqlå®ä¾‹ä¸‹çº¿äº†ï¼Œä¹Ÿä¸ä¼šå½±å“DistributIdServiceï¼ŒDistributIdServiceä»ç„¶å¯ä»¥åˆ©ç”¨å¦å¤–ä¸€å°Mysqlæ¥ç”ŸæˆIDã€‚</p><p>ä½†æ˜¯è¿™ç§æ–¹æ¡ˆçš„æ‰©å±•æ€§ä¸å¤ªå¥½ï¼Œå¦‚æœä¸¤å°Mysqlå®ä¾‹ä¸å¤Ÿç”¨ï¼Œéœ€è¦æ–°å¢Mysqlå®ä¾‹æ¥æé«˜æ€§èƒ½æ—¶ï¼Œè¿™æ—¶å°±ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚</p><p>ç°åœ¨å¦‚æœè¦æ–°å¢ä¸€ä¸ªå®ä¾‹mysql3ï¼Œè¦æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ ç¬¬ä¸€ï¼Œmysql1ã€mysql2çš„æ­¥é•¿è‚¯å®šéƒ½è¦ä¿®æ”¹ä¸º3ï¼Œè€Œä¸”åªèƒ½æ˜¯äººå·¥å»ä¿®æ”¹ï¼Œè¿™æ˜¯éœ€è¦æ—¶é—´çš„ã€‚ ç¬¬äºŒï¼Œå› ä¸ºmysql1å’Œmysql2æ˜¯ä¸åœåœ¨è‡ªå¢çš„ï¼Œå¯¹äºmysql3çš„èµ·å§‹å€¼æˆ‘ä»¬å¯èƒ½è¦å®šå¾—å¤§ä¸€ç‚¹ï¼Œä»¥ç»™å……åˆ†çš„æ—¶é—´å»ä¿®æ”¹mysql1ï¼Œmysql2çš„æ­¥é•¿ã€‚ ç¬¬ä¸‰ï¼Œåœ¨ä¿®æ”¹æ­¥é•¿çš„æ—¶å€™å¾ˆå¯èƒ½ä¼šå‡ºç°é‡å¤IDï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½éœ€è¦åœæœºæ‰è¡Œã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œä»¥åŠèƒ½å¤Ÿè¿›ä¸€æ­¥æé«˜DistributIdServiceçš„æ€§èƒ½ï¼Œå¦‚æœä½¿ç”¨ç¬¬ä¸‰ç§ç”Ÿæˆåˆ†å¸ƒå¼IDæœºåˆ¶ã€‚</p><h2 id="å·æ®µæ¨¡å¼"><a href="#å·æ®µæ¨¡å¼" class="headerlink" title="å·æ®µæ¨¡å¼"></a>å·æ®µæ¨¡å¼</h2><p>æ€»ç»“:</p><p>ç»´æŠ¤ä¸€å¼ idè¡¨,å¢åŠ ä¸€ä¸ªæœåŠ¡DistributIdServiceæ¯æ¬¡å¯ä»¥å–1000ä¸ªid,ç„¶åæ”¾åˆ°æœ¬åœ°å»ç”¨.è‹¥æ˜¯åŒä¸»æ¨¡å¼, mysql1å°†ç”Ÿæˆå·æ®µï¼ˆ1,1001]ï¼Œè‡ªå¢çš„æ—¶å€™åºåˆ—ä¸º1ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ7â€¦. mysql2å°†ç”Ÿæˆå·æ®µï¼ˆ2,1002]ï¼Œè‡ªå¢çš„æ—¶å€™åºåˆ—ä¸º2ï¼Œ4ï¼Œ6ï¼Œ8ï¼Œ10â€¦</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·æ®µçš„æ–¹å¼æ¥è·å–è‡ªå¢IDï¼Œå·æ®µå¯ä»¥ç†è§£æˆæ‰¹é‡è·å–ï¼Œæ¯”å¦‚DistributIdServiceä»æ•°æ®åº“è·å–IDæ—¶ï¼Œå¦‚æœèƒ½æ‰¹é‡è·å–å¤šä¸ªIDå¹¶ç¼“å­˜åœ¨æœ¬åœ°çš„è¯ï¼Œé‚£æ ·å°†å¤§å¤§æä¾›ä¸šåŠ¡åº”ç”¨è·å–IDçš„æ•ˆç‡ã€‚</p><p>æ¯”å¦‚DistributIdServiceæ¯æ¬¡ä»æ•°æ®åº“è·å–IDæ—¶ï¼Œå°±è·å–ä¸€ä¸ªå·æ®µï¼Œæ¯”å¦‚(1,1000]ï¼Œè¿™ä¸ªèŒƒå›´è¡¨ç¤ºäº†1000ä¸ªIDï¼Œä¸šåŠ¡åº”ç”¨åœ¨è¯·æ±‚DistributIdServiceæä¾›IDæ—¶ï¼ŒDistributIdServiceåªéœ€è¦åœ¨æœ¬åœ°ä»1å¼€å§‹è‡ªå¢å¹¶è¿”å›å³å¯ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½è¯·æ±‚æ•°æ®åº“ï¼Œä¸€ç›´åˆ°æœ¬åœ°è‡ªå¢åˆ°1000æ—¶ï¼Œä¹Ÿå°±æ˜¯å½“å‰å·æ®µå·²ç»è¢«ç”¨å®Œæ—¶ï¼Œæ‰å»æ•°æ®åº“é‡æ–°è·å–ä¸‹ä¸€å·æ®µã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®åº“è¡¨è¿›è¡Œæ”¹åŠ¨ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class="sql">CREATE TABLE id_generator (  id int(10) NOT NULL,  current_max_id bigint(20) NOT NULL COMMENT &#39;å½“å‰æœ€å¤§id&#39;,  increment_step int(10) NOT NULL COMMENT &#39;å·æ®µçš„é•¿åº¦&#39;,  PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><p>è¿™ä¸ªæ•°æ®åº“è¡¨ç”¨æ¥è®°å½•è‡ªå¢æ­¥é•¿ä»¥åŠå½“å‰è‡ªå¢IDçš„æœ€å¤§å€¼ï¼ˆä¹Ÿå°±æ˜¯å½“å‰å·²ç»è¢«ç”³è¯·çš„å·æ®µçš„æœ€åä¸€ä¸ªå€¼ï¼‰ï¼Œå› ä¸ºè‡ªå¢é€»è¾‘è¢«ç§»åˆ°DistributIdServiceä¸­å»äº†ï¼Œæ‰€ä»¥æ•°æ®åº“ä¸éœ€è¦è¿™éƒ¨åˆ†é€»è¾‘äº†ã€‚</p><p>è¿™ç§æ–¹æ¡ˆä¸å†å¼ºä¾èµ–æ•°æ®åº“ï¼Œå°±ç®—æ•°æ®åº“ä¸å¯ç”¨ï¼Œé‚£ä¹ˆDistributIdServiceä¹Ÿèƒ½ç»§ç»­æ”¯æ’‘ä¸€æ®µæ—¶é—´ã€‚ä½†æ˜¯å¦‚æœDistributIdServiceé‡å¯ï¼Œä¼šä¸¢å¤±ä¸€æ®µIDï¼Œå¯¼è‡´IDç©ºæ´ã€‚</p><p>ä¸ºäº†æé«˜DistributIdServiceçš„é«˜å¯ç”¨ï¼Œéœ€è¦åšä¸€ä¸ªé›†ç¾¤ï¼Œä¸šåŠ¡åœ¨è¯·æ±‚DistributIdServiceé›†ç¾¤è·å–IDæ—¶ï¼Œä¼šéšæœºçš„é€‰æ‹©æŸä¸€ä¸ªDistributIdServiceèŠ‚ç‚¹è¿›è¡Œè·å–ï¼Œå¯¹æ¯ä¸€ä¸ªDistributIdServiceèŠ‚ç‚¹æ¥è¯´ï¼Œæ•°æ®åº“è¿æ¥çš„æ˜¯åŒä¸€ä¸ªæ•°æ®åº“ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šäº§ç”Ÿå¤šä¸ªDistributIdServiceèŠ‚ç‚¹åŒæ—¶è¯·æ±‚æ•°æ®åº“è·å–å·æ®µï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™éœ€è¦åˆ©ç”¨ä¹è§‚é”æ¥è¿›è¡Œæ§åˆ¶ï¼Œæ¯”å¦‚åœ¨æ•°æ®åº“è¡¨ä¸­å¢åŠ ä¸€ä¸ªversionå­—æ®µï¼Œåœ¨è·å–å·æ®µæ—¶ä½¿ç”¨å¦‚ä¸‹SQLï¼š</p><pre><code class="sql">update id_generator set current_max_id=#{newMaxId}, version=version+1 where version = #{version}</code></pre><p>å› ä¸ºnewMaxIdæ˜¯DistributIdServiceä¸­æ ¹æ®oldMaxId+æ­¥é•¿ç®—å‡ºæ¥çš„ï¼Œåªè¦ä¸Šé¢çš„updateæ›´æ–°æˆåŠŸäº†å°±è¡¨ç¤ºå·æ®µè·å–æˆåŠŸäº†ã€‚</p><p>ä¸ºäº†æä¾›æ•°æ®åº“å±‚çš„é«˜å¯ç”¨ï¼Œéœ€è¦å¯¹æ•°æ®åº“ä½¿ç”¨å¤šä¸»æ¨¡å¼è¿›è¡Œéƒ¨ç½²ï¼Œå¯¹äºæ¯ä¸ªæ•°æ®åº“æ¥è¯´è¦ä¿è¯ç”Ÿæˆçš„å·æ®µä¸é‡å¤ï¼Œè¿™å°±éœ€è¦åˆ©ç”¨æœ€å¼€å§‹çš„æ€è·¯ï¼Œå†åœ¨åˆšåˆšçš„æ•°æ®åº“è¡¨ä¸­å¢åŠ èµ·å§‹å€¼å’Œæ­¥é•¿ï¼Œæ¯”å¦‚å¦‚æœç°åœ¨æ˜¯ä¸¤å°Mysqlï¼Œé‚£ä¹ˆ mysql1å°†ç”Ÿæˆå·æ®µï¼ˆ1,1001]ï¼Œè‡ªå¢çš„æ—¶å€™åºåˆ—ä¸º1ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ7â€¦. mysql2å°†ç”Ÿæˆå·æ®µï¼ˆ2,1002]ï¼Œè‡ªå¢çš„æ—¶å€™åºåˆ—ä¸º2ï¼Œ4ï¼Œ6ï¼Œ8ï¼Œ10â€¦</p><p>æ›´è¯¦ç»†çš„å¯ä»¥å‚è€ƒæ»´æ»´å¼€æºçš„TinyIdï¼š<a href="https://github.com/didi/tinyid/wiki/tinyidåŸç†ä»‹ç»" target="_blank" rel="noopener">github.com/didi/tinyidâ€¦</a></p><p>åœ¨TinyIdä¸­è¿˜å¢åŠ äº†ä¸€æ­¥æ¥æé«˜æ•ˆç‡ï¼Œåœ¨ä¸Šé¢çš„å®ç°ä¸­ï¼ŒIDè‡ªå¢çš„é€»è¾‘æ˜¯åœ¨DistributIdServiceä¸­å®ç°çš„ï¼Œè€Œå®é™…ä¸Šå¯ä»¥æŠŠè‡ªå¢çš„é€»è¾‘è½¬ç§»åˆ°ä¸šåŠ¡åº”ç”¨æœ¬åœ°ï¼Œè¿™æ ·å¯¹äºä¸šåŠ¡åº”ç”¨æ¥è¯´åªéœ€è¦è·å–å·æ®µï¼Œæ¯æ¬¡è‡ªå¢æ—¶ä¸å†éœ€è¦è¯·æ±‚è°ƒç”¨DistributIdServiceäº†ã€‚</p><h2 id="é›ªèŠ±ç®—æ³•"><a href="#é›ªèŠ±ç®—æ³•" class="headerlink" title="é›ªèŠ±ç®—æ³•"></a>é›ªèŠ±ç®—æ³•</h2><p>ä¸Šé¢çš„ä¸‰ç§æ–¹æ³•æ€»çš„æ¥è¯´æ˜¯åŸºäºè‡ªå¢æ€æƒ³çš„ï¼Œè€Œæ¥ä¸‹æ¥å°±ä»‹ç»æ¯”è¾ƒè‘—åçš„é›ªèŠ±ç®—æ³•-snowflakeã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ¢ä¸ªè§’åº¦æ¥å¯¹åˆ†å¸ƒå¼IDè¿›è¡Œæ€è€ƒï¼Œåªè¦èƒ½è®©è´Ÿè´£ç”Ÿæˆåˆ†å¸ƒå¼IDçš„æ¯å°æœºå™¨åœ¨æ¯æ¯«ç§’å†…ç”Ÿæˆä¸ä¸€æ ·çš„IDå°±è¡Œäº†ã€‚</p><p>snowflakeæ˜¯twitterå¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œæ˜¯ä¸€ç§ç®—æ³•ï¼Œæ‰€ä»¥å®ƒå’Œä¸Šé¢çš„ä¸‰ç§ç”Ÿæˆåˆ†å¸ƒå¼IDæœºåˆ¶ä¸å¤ªä¸€æ ·ï¼Œå®ƒä¸ä¾èµ–æ•°æ®åº“ã€‚</p><p>æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåˆ†å¸ƒå¼IDå›ºå®šæ˜¯ä¸€ä¸ªlongå‹çš„æ•°å­—ï¼Œä¸€ä¸ªlongå‹å 8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯64ä¸ªbitï¼ŒåŸå§‹snowflakeç®—æ³•ä¸­å¯¹äºbitçš„åˆ†é…å¦‚ä¸‹å›¾ï¼š</p><p><img alt="é›ªèŠ±ç®—æ³•" data-src="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-7/%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95.png" class="lazyload"></p><ul><li>ç¬¬ä¸€ä¸ªbitä½æ˜¯æ ‡è¯†éƒ¨åˆ†ï¼Œåœ¨javaä¸­ç”±äºlongçš„æœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯0ï¼Œè´Ÿæ•°æ˜¯1ï¼Œä¸€èˆ¬ç”Ÿæˆçš„IDä¸ºæ­£æ•°ï¼Œæ‰€ä»¥å›ºå®šä¸º0ã€‚</li><li>æ—¶é—´æˆ³éƒ¨åˆ†å 41bitï¼Œè¿™ä¸ªæ˜¯æ¯«ç§’çº§çš„æ—¶é—´ï¼Œä¸€èˆ¬å®ç°ä¸Šä¸ä¼šå­˜å‚¨å½“å‰çš„æ—¶é—´æˆ³ï¼Œè€Œæ˜¯æ—¶é—´æˆ³çš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´-å›ºå®šçš„å¼€å§‹æ—¶é—´ï¼‰ï¼Œè¿™æ ·å¯ä»¥ä½¿äº§ç”Ÿçš„IDä»æ›´å°å€¼å¼€å§‹ï¼›41ä½çš„æ—¶é—´æˆ³å¯ä»¥ä½¿ç”¨69å¹´ï¼Œ(1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69å¹´</li><li>å·¥ä½œæœºå™¨idå 10bitï¼Œè¿™é‡Œæ¯”è¾ƒçµæ´»ï¼Œæ¯”å¦‚ï¼Œå¯ä»¥ä½¿ç”¨å‰5ä½ä½œä¸ºæ•°æ®ä¸­å¿ƒæœºæˆ¿æ ‡è¯†ï¼Œå5ä½ä½œä¸ºå•æœºæˆ¿æœºå™¨æ ‡è¯†ï¼Œå¯ä»¥éƒ¨ç½²1024ä¸ªèŠ‚ç‚¹ã€‚</li><li>åºåˆ—å·éƒ¨åˆ†å 12bitï¼Œæ”¯æŒåŒä¸€æ¯«ç§’å†…åŒä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥ç”Ÿæˆ4096ä¸ªID</li></ul><p>æ ¹æ®è¿™ä¸ªç®—æ³•çš„é€»è¾‘ï¼Œåªéœ€è¦å°†è¿™ä¸ªç®—æ³•ç”¨Javaè¯­è¨€å®ç°å‡ºæ¥ï¼Œå°è£…ä¸ºä¸€ä¸ªå·¥å…·æ–¹æ³•ï¼Œé‚£ä¹ˆå„ä¸ªä¸šåŠ¡åº”ç”¨å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å·¥å…·æ–¹æ³•æ¥è·å–åˆ†å¸ƒå¼IDï¼Œåªéœ€ä¿è¯æ¯ä¸ªä¸šåŠ¡åº”ç”¨æœ‰è‡ªå·±çš„å·¥ä½œæœºå™¨idå³å¯ï¼Œè€Œä¸éœ€è¦å•ç‹¬å»æ­å»ºä¸€ä¸ªè·å–åˆ†å¸ƒå¼IDçš„åº”ç”¨ã€‚</p><p>snowflakeç®—æ³•å®ç°èµ·æ¥å¹¶ä¸éš¾ï¼Œæä¾›ä¸€ä¸ªgithubä¸Šç”¨javaå®ç°çš„ï¼š<a href="https://github.com/beyondfengyu/SnowFlake" target="_blank" rel="noopener">github.com/beyondfengyâ€¦</a></p><p><code>åœ¨å¤§å‚é‡Œï¼Œå…¶å®å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨snowflakeï¼Œè€Œæ˜¯è¿›è¡Œäº†æ”¹é€ </code>ï¼Œå› ä¸ºsnowflakeç®—æ³•ä¸­æœ€éš¾å®è·µçš„å°±æ˜¯å·¥ä½œæœºå™¨idï¼ŒåŸå§‹çš„snowflakeç®—æ³•éœ€è¦äººå·¥å»ä¸ºæ¯å°æœºå™¨å»æŒ‡å®šä¸€ä¸ªæœºå™¨idï¼Œå¹¶é…ç½®åœ¨æŸä¸ªåœ°æ–¹ä»è€Œè®©snowflakeä»æ­¤å¤„è·å–æœºå™¨idã€‚</p><p>ä½†æ˜¯åœ¨å¤§å‚é‡Œï¼Œæœºå™¨æ˜¯å¾ˆå¤šçš„ï¼ŒäººåŠ›æˆæœ¬å¤ªå¤§ä¸”å®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥å¤§å‚å¯¹snowflakeè¿›è¡Œäº†æ”¹é€ ã€‚</p><h3 id="ç™¾åº¦ï¼ˆuid-generatorï¼‰"><a href="#ç™¾åº¦ï¼ˆuid-generatorï¼‰" class="headerlink" title="ç™¾åº¦ï¼ˆuid-generatorï¼‰"></a>ç™¾åº¦ï¼ˆuid-generatorï¼‰</h3><p>githubåœ°å€ï¼š<a href="https://github.com/baidu/uid-generator" target="_blank" rel="noopener">uid-generator</a></p><p>uid-generatorä½¿ç”¨çš„å°±æ˜¯snowflakeï¼Œåªæ˜¯åœ¨ç”Ÿäº§æœºå™¨idï¼Œä¹Ÿå«åšworkIdæ—¶æœ‰æ‰€ä¸åŒã€‚</p><p>uid-generatorä¸­çš„workIdæ˜¯ç”±uid-generatorè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°äº†åº”ç”¨éƒ¨ç½²åœ¨dockerä¸Šçš„æƒ…å†µï¼Œåœ¨uid-generatorä¸­ç”¨æˆ·å¯ä»¥è‡ªå·±å»å®šä¹‰workIdçš„ç”Ÿæˆç­–ç•¥ï¼Œé»˜è®¤æä¾›çš„ç­–ç•¥æ˜¯ï¼šåº”ç”¨å¯åŠ¨æ—¶ç”±æ•°æ®åº“åˆ†é…ã€‚è¯´çš„ç®€å•ä¸€ç‚¹å°±æ˜¯ï¼šåº”ç”¨åœ¨å¯åŠ¨æ—¶ä¼šå¾€æ•°æ®åº“è¡¨(uid-generatoréœ€è¦æ–°å¢ä¸€ä¸ªWORKER_NODEè¡¨)ä¸­å»æ’å…¥ä¸€æ¡æ•°æ®ï¼Œæ•°æ®æ’å…¥æˆåŠŸåè¿”å›çš„è¯¥æ•°æ®å¯¹åº”çš„è‡ªå¢å”¯ä¸€idå°±æ˜¯è¯¥æœºå™¨çš„workIdï¼Œè€Œæ•°æ®ç”±hostï¼Œportç»„æˆã€‚</p><p>å¯¹äºuid-generatorä¸­çš„workIdï¼Œå ç”¨äº†22ä¸ªbitä½ï¼Œæ—¶é—´å ç”¨äº†28ä¸ªbitä½ï¼Œåºåˆ—åŒ–å ç”¨äº†13ä¸ªbitä½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå’ŒåŸå§‹çš„snowflakeä¸å¤ªä¸€æ ·ï¼Œæ—¶é—´çš„å•ä½æ˜¯ç§’ï¼Œè€Œä¸æ˜¯æ¯«ç§’ï¼ŒworkIdä¹Ÿä¸ä¸€æ ·ï¼ŒåŒä¸€ä¸ªåº”ç”¨æ¯é‡å¯ä¸€æ¬¡å°±ä¼šæ¶ˆè´¹ä¸€ä¸ªworkIdã€‚</p><p>å…·ä½“å¯å‚è€ƒ<a href="https://github.com/baidu/uid-generator/blob/master/README.zh_cn.md" target="_blank" rel="noopener">github.com/baidu/uid-gâ€¦</a></p><h3 id="ç¾å›¢ï¼ˆLeafï¼‰"><a href="#ç¾å›¢ï¼ˆLeafï¼‰" class="headerlink" title="ç¾å›¢ï¼ˆLeafï¼‰"></a>ç¾å›¢ï¼ˆLeafï¼‰</h3><p>githubåœ°å€ï¼š<a href="https://github.com/Meituan-Dianping/Leaf" target="_blank" rel="noopener">Leaf</a></p><p>ç¾å›¢çš„Leafä¹Ÿæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼IDç”Ÿæˆæ¡†æ¶ã€‚å®ƒéå¸¸å…¨é¢ï¼Œå³æ”¯æŒå·æ®µæ¨¡å¼ï¼Œä¹Ÿæ”¯æŒsnowflakeæ¨¡å¼ã€‚å·æ®µæ¨¡å¼è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œå’Œä¸Šé¢çš„åˆ†æç±»ä¼¼ã€‚</p><p>Leafä¸­çš„snowflakeæ¨¡å¼å’ŒåŸå§‹snowflakeç®—æ³•çš„ä¸åŒç‚¹ï¼Œä¹Ÿä¸»è¦åœ¨workIdçš„ç”Ÿæˆï¼ŒLeafä¸­workIdæ˜¯åŸºäºZooKeeperçš„é¡ºåºIdæ¥ç”Ÿæˆçš„ï¼Œæ¯ä¸ªåº”ç”¨åœ¨ä½¿ç”¨Leaf-snowflakeæ—¶ï¼Œåœ¨å¯åŠ¨æ—¶éƒ½ä¼šéƒ½åœ¨Zookeeperä¸­ç”Ÿæˆä¸€ä¸ªé¡ºåºIdï¼Œç›¸å½“äºä¸€å°æœºå™¨å¯¹åº”ä¸€ä¸ªé¡ºåºèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªworkIdã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€»å¾—æ¥è¯´ï¼Œä¸Šé¢ä¸¤ç§éƒ½æ˜¯è‡ªåŠ¨ç”ŸæˆworkIdï¼Œä»¥è®©ç³»ç»Ÿæ›´åŠ ç¨³å®šä»¥åŠå‡å°‘äººå·¥æˆåŠŸã€‚</p><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>è¿™é‡Œé¢å¤–å†ä»‹ç»ä¸€ä¸‹ä½¿ç”¨Redisæ¥ç”Ÿæˆåˆ†å¸ƒå¼IDï¼Œå…¶å®å’Œåˆ©ç”¨Mysqlè‡ªå¢IDç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨Redisä¸­çš„incrå‘½ä»¤æ¥å®ç°åŸå­æ€§çš„è‡ªå¢ä¸è¿”å›ï¼Œæ¯”å¦‚ï¼š</p><pre><code class="shell">127.0.0.1:6379&gt; set seq_id 1     // åˆå§‹åŒ–è‡ªå¢IDä¸º1OK127.0.0.1:6379&gt; incr seq_id      // å¢åŠ 1ï¼Œå¹¶è¿”å›(integer) 2127.0.0.1:6379&gt; incr seq_id      // å¢åŠ 1ï¼Œå¹¶è¿”å›(integer) 3</code></pre><p>ä½¿ç”¨redisçš„æ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼Œä½†æ˜¯è¦è€ƒè™‘æŒä¹…åŒ–çš„é—®é¢˜ã€‚Redisæ”¯æŒRDBå’ŒAOFä¸¤ç§æŒä¹…åŒ–çš„æ–¹å¼ã€‚</p><p>RDBæŒä¹…åŒ–ç›¸å½“äºå®šæ—¶æ‰“ä¸€ä¸ªå¿«ç…§è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¦‚æœæ‰“å®Œå¿«ç…§åï¼Œè¿ç»­è‡ªå¢äº†å‡ æ¬¡ï¼Œè¿˜æ²¡æ¥å¾—åŠåšä¸‹ä¸€æ¬¡å¿«ç…§æŒä¹…åŒ–ï¼Œè¿™ä¸ªæ—¶å€™RedisæŒ‚æ‰äº†ï¼Œé‡å¯Redisåä¼šå‡ºç°IDé‡å¤ã€‚</p><p>AOFæŒä¹…åŒ–ç›¸å½“äºå¯¹æ¯æ¡å†™å‘½ä»¤è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¦‚æœRedisæŒ‚æ‰äº†ï¼Œä¸ä¼šå‡ºç°IDé‡å¤çš„ç°è±¡ï¼Œä½†æ˜¯ä¼šç”±äºincrå‘½ä»¤è¿‡å¤šï¼Œå¯¼è‡´é‡å¯æ¢å¤æ•°æ®æ—¶é—´è¿‡é•¿ã€‚</p><h2 id="å°è£…ä¸€ä¸ªæµæ°´å·IDç”Ÿæˆå™¨ï¼šid-spring-boot-starter"><a href="#å°è£…ä¸€ä¸ªæµæ°´å·IDç”Ÿæˆå™¨ï¼šid-spring-boot-starter" class="headerlink" title="å°è£…ä¸€ä¸ªæµæ°´å·IDç”Ÿæˆå™¨ï¼šid-spring-boot-starter"></a>å°è£…ä¸€ä¸ªæµæ°´å·IDç”Ÿæˆå™¨ï¼šid-spring-boot-starter</h2><p><a href="https://www.codesheep.cn/2019/09/04/id-springbt-starter/" target="_blank" rel="noopener">https://www.codesheep.cn/2019/09/04/id-springbt-starter/</a></p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼Session</title>
      <link href="/2020/01/15/7.%20%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8FSession/"/>
      <url>/2020/01/15/7.%20%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8FSession/</url>
      
        <content type="html"><![CDATA[<h2 id="æ€»ä½“ä»‹ç»"><a href="#æ€»ä½“ä»‹ç»" class="headerlink" title="æ€»ä½“ä»‹ç»"></a>æ€»ä½“ä»‹ç»</h2><p>æœåŠ¡å™¨ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªä¼šè¯ï¼Œå­˜å‚¨ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿å¤šæ¬¡è¯·æ±‚èƒ½å¤Ÿå®šä½åˆ°åŒä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„ Web é¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨ Session å¯¹è±¡ä¸­çš„å˜é‡å°†ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªç”¨æˆ·ä¼šè¯ä¸­ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚å½“ç”¨æˆ·è¯·æ±‚æ¥è‡ªåº”ç”¨ç¨‹åºçš„ Web é¡µæ—¶ï¼Œå¦‚æœè¯¥ç”¨æˆ·è¿˜æ²¡æœ‰ä¼šè¯ï¼Œåˆ™ Web æœåŠ¡å™¨å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Session å¯¹è±¡ã€‚å½“ä¼šè¯è¿‡æœŸæˆ–è¢«æ”¾å¼ƒåï¼ŒæœåŠ¡å™¨å°†ç»ˆæ­¢è¯¥ä¼šè¯ã€‚</p><p>Webå¼€å‘ä¸­ï¼Œweb-serverå¯ä»¥è‡ªåŠ¨ä¸ºåŒä¸€ä¸ªæµè§ˆå™¨çš„è®¿é—®ç”¨æˆ·è‡ªåŠ¨åˆ›å»ºsessionï¼Œæä¾›æ•°æ®å­˜å‚¨åŠŸèƒ½ã€‚æœ€å¸¸è§çš„ï¼Œä¼šæŠŠç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨sessionä¸­ï¼Œä»¥ä¿æŒç™»å½•çŠ¶æ€ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯sessionä¸€è‡´æ€§é—®é¢˜ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯sessionä¸€è‡´æ€§é—®é¢˜ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯sessionä¸€è‡´æ€§é—®é¢˜ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯sessionä¸€è‡´æ€§é—®é¢˜ï¼Ÿ</h2><p>åªè¦ç”¨æˆ·ä¸é‡å¯æµè§ˆå™¨ï¼Œæ¯æ¬¡httpçŸ­è¿æ¥è¯·æ±‚ï¼Œç†è®ºä¸ŠæœåŠ¡ç«¯éƒ½èƒ½å®šä½åˆ°sessionï¼Œä¿æŒä¼šè¯ã€‚</p><h2 id="åˆ†å¸ƒå¼session"><a href="#åˆ†å¸ƒå¼session" class="headerlink" title="åˆ†å¸ƒå¼session"></a>åˆ†å¸ƒå¼session</h2><p>å•æœåŠ¡å™¨webåº”ç”¨ä¸­ï¼Œsessionä¿¡æ¯åªéœ€å­˜åœ¨è¯¥æœåŠ¡å™¨ä¸­ï¼Œè¿™æ˜¯æˆ‘ä»¬å‰å‡ å¹´æœ€å¸¸æ¥è§¦çš„æ–¹å¼ï¼Œä½†æ˜¯è¿‘å‡ å¹´éšç€åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµè¡Œï¼Œå•ç³»ç»Ÿå·²ç»ä¸èƒ½æ»¡è¶³æ—¥ç›Šå¢é•¿çš„ç™¾ä¸‡çº§ç”¨æˆ·çš„éœ€æ±‚ï¼Œé›†ç¾¤æ–¹å¼éƒ¨ç½²æœåŠ¡å™¨å·²åœ¨å¾ˆå¤šå…¬å¸è¿ç”¨èµ·æ¥ï¼Œå½“é«˜å¹¶å‘é‡çš„è¯·æ±‚åˆ°è¾¾æœåŠ¡ç«¯çš„æ—¶å€™é€šè¿‡è´Ÿè½½å‡è¡¡çš„æ–¹å¼åˆ†å‘åˆ°é›†ç¾¤ä¸­çš„æŸä¸ªæœåŠ¡å™¨ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å¯¼è‡´åŒä¸€ä¸ªç”¨æˆ·çš„å¤šæ¬¡è¯·æ±‚è¢«åˆ†å‘åˆ°é›†ç¾¤çš„ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œå°±ä¼šå‡ºç°å–ä¸åˆ°sessionæ•°æ®çš„æƒ…å†µï¼Œäºæ˜¯sessionçš„å…±äº«å°±æˆäº†ä¸€ä¸ªé—®é¢˜ã€‚</p><p><img alt="img" data-src="https://images2017.cnblogs.com/blog/926638/201711/926638-20171117190525546-1072349257.png" class="lazyload"></p><p>å¦‚ä¸Šå›¾ï¼Œå‡è®¾ç”¨æˆ·åŒ…å«ç™»å½•ä¿¡æ¯çš„sessionéƒ½è®°å½•åœ¨ç¬¬ä¸€å°web-serverä¸Šï¼Œåå‘ä»£ç†å¦‚æœå°†è¯·æ±‚è·¯ç”±åˆ°å¦ä¸€å°web-serverä¸Šï¼Œå¯èƒ½å°±æ‰¾ä¸åˆ°ç›¸å…³ä¿¡æ¯ï¼Œè€Œå¯¼è‡´ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•ã€‚</p><h2 id="Sessionä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ"><a href="#Sessionä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Sessionä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ"></a>Sessionä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-sessionå¤åˆ¶ï¼ˆåŒæ­¥ï¼‰"><a href="#1-sessionå¤åˆ¶ï¼ˆåŒæ­¥ï¼‰" class="headerlink" title="1.sessionå¤åˆ¶ï¼ˆåŒæ­¥ï¼‰"></a>1.sessionå¤åˆ¶ï¼ˆåŒæ­¥ï¼‰</h3><p> <img alt="img" data-src="https://images2017.cnblogs.com/blog/926638/201711/926638-20171117190609421-1278140860.png" class="lazyload"></p><p><strong>æ€è·¯</strong>ï¼šå¤šä¸ªweb-serverä¹‹é—´ç›¸äº’åŒæ­¥sessionï¼Œè¿™æ ·æ¯ä¸ªweb-serverä¹‹é—´éƒ½åŒ…å«å…¨éƒ¨çš„session</p><p><strong>ä¼˜ç‚¹</strong>ï¼šweb-serveræ”¯æŒçš„åŠŸèƒ½ï¼Œåº”ç”¨ç¨‹åºä¸éœ€è¦ä¿®æ”¹ä»£ç </p><p><strong>ä¸è¶³</strong>ï¼š</p><ul><li>sessionçš„åŒæ­¥éœ€è¦æ•°æ®ä¼ è¾“ï¼Œå <strong>å†…ç½‘å¸¦å®½</strong>ï¼Œæœ‰æ—¶å»¶</li><li>æ‰€æœ‰web-serveréƒ½åŒ…å«æ‰€æœ‰sessionæ•°æ®ï¼Œæ•°æ®é‡å—å†…å­˜é™åˆ¶ï¼Œæ— æ³•æ°´å¹³æ‰©å±•</li><li>æœ‰æ›´å¤šweb-serveræ—¶è¦æ­‡èœ</li></ul><p><strong>æ“ä½œ:</strong></p><p>1ã€ä¿®æ”¹tomcatä¸‹server.xmlæ–‡ä»¶,å¼€å¯å¦‚ä¸‹é…ç½®</p><pre><code class="java">&lt;Cluster className=&quot;org.apache.catalina.ha.tcp.SimpleTcpCluster&quot;/&gt;</code></pre><p>2ã€æœ¬åœ°é¡¹ç›®web.xmlå¢åŠ å¦‚ä¸‹é…ç½®:</p><pre><code class="xml">&lt;!--tomcat Sessionå¤åˆ¶å¿…é¡»å¼€å¯--&gt;&lt;distributable /&gt;</code></pre><h3 id="å®¢æˆ·ç«¯å­˜å‚¨æ³•"><a href="#å®¢æˆ·ç«¯å­˜å‚¨æ³•" class="headerlink" title="å®¢æˆ·ç«¯å­˜å‚¨æ³•"></a>å®¢æˆ·ç«¯å­˜å‚¨æ³•</h3><p><img alt="img" data-src="https://images2017.cnblogs.com/blog/926638/201711/926638-20171117191245265-301978953.png" class="lazyload"></p><p><strong>æ€è·¯</strong>ï¼šæœåŠ¡ç«¯å­˜å‚¨æ‰€æœ‰ç”¨æˆ·çš„sessionï¼Œå†…å­˜å ç”¨è¾ƒå¤§ï¼Œå¯ä»¥å°†sessionå­˜å‚¨åˆ°æµè§ˆå™¨cookieä¸­ï¼Œæ¯ä¸ªç«¯åªè¦å­˜å‚¨ä¸€ä¸ªç”¨æˆ·çš„æ•°æ®äº†</p><p><strong>ä¼˜ç‚¹</strong>ï¼šæœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨</p><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>æ¯æ¬¡httpè¯·æ±‚éƒ½æºå¸¦sessionï¼Œå <strong>å¤–ç½‘å¸¦å®½</strong></li><li>æ•°æ®å­˜å‚¨åœ¨ç«¯ä¸Šï¼Œå¹¶åœ¨ç½‘ç»œä¼ è¾“ï¼Œå­˜åœ¨æ³„æ¼ã€ç¯¡æ”¹ã€çªƒå–ç­‰å®‰å…¨éšæ‚£</li><li>sessionå­˜å‚¨çš„æ•°æ®å¤§å°å—cookieé™åˆ¶</li></ul><p>â€œç«¯å­˜å‚¨â€çš„æ–¹æ¡ˆè™½ç„¶ä¸å¸¸ç”¨ï¼Œä½†ç¡®å®æ˜¯ä¸€ç§æ€è·¯ã€‚</p><h3 id="åå‘ä»£ç†hashä¸€è‡´æ€§"><a href="#åå‘ä»£ç†hashä¸€è‡´æ€§" class="headerlink" title="åå‘ä»£ç†hashä¸€è‡´æ€§"></a>åå‘ä»£ç†hashä¸€è‡´æ€§</h3><p> <strong>æ€è·¯</strong>ï¼šweb-serverä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œæœ‰å¤šå°å†—ä½™ï¼Œåå‘ä»£ç†å±‚èƒ½ä¸èƒ½åšä¸€äº›äº‹æƒ…ï¼Œè®©åŒä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ä¿è¯è½åœ¨ä¸€å°web-serverä¸Šå‘¢ï¼Ÿ</p><p> <img alt="img" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf6598f853j30k80bsaci.jpg" class="lazyload"></p><h4 id="æ–¹æ¡ˆä¸€ï¼šå››å±‚ä»£ç†hash"><a href="#æ–¹æ¡ˆä¸€ï¼šå››å±‚ä»£ç†hash" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šå››å±‚ä»£ç†hash"></a><strong>æ–¹æ¡ˆä¸€ï¼šå››å±‚ä»£ç†hash</strong></h4><p>åå‘ä»£ç†å±‚ä½¿ç”¨ç”¨æˆ·ipæ¥åšhashï¼Œä»¥ä¿è¯åŒä¸€ä¸ªipçš„è¯·æ±‚è½åœ¨åŒä¸€ä¸ªweb-serverä¸Š</p><p><img alt="img" data-src="https://images2017.cnblogs.com/blog/926638/201711/926638-20171117190819921-1868250278.png" class="lazyload"></p><h4 id="æ–¹æ¡ˆäºŒï¼šä¸ƒå±‚ä»£ç†hash"><a href="#æ–¹æ¡ˆäºŒï¼šä¸ƒå±‚ä»£ç†hash" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šä¸ƒå±‚ä»£ç†hash"></a><strong>æ–¹æ¡ˆäºŒï¼šä¸ƒå±‚ä»£ç†hash</strong></h4><p>åå‘ä»£ç†ä½¿ç”¨httpåè®®ä¸­çš„æŸäº›ä¸šåŠ¡å±æ€§æ¥åšhashï¼Œä¾‹å¦‚sidï¼Œcity_idï¼Œuser_idç­‰ï¼Œèƒ½å¤Ÿæ›´åŠ çµæ´»çš„å®æ–½hashç­–ç•¥ï¼Œä»¥ä¿è¯åŒä¸€ä¸ªæµè§ˆå™¨ç”¨æˆ·çš„è¯·æ±‚è½åœ¨åŒä¸€ä¸ªweb-serverä¸Š</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>åªéœ€è¦æ”¹nginxé…ç½®ï¼Œä¸éœ€è¦ä¿®æ”¹åº”ç”¨ä»£ç </li><li>è´Ÿè½½å‡è¡¡ï¼Œåªè¦hashå±æ€§æ˜¯å‡åŒ€çš„ï¼Œå¤šå°web-serverçš„è´Ÿè½½æ˜¯å‡è¡¡çš„</li><li>å¯ä»¥æ”¯æŒweb-serveræ°´å¹³æ‰©å±•ï¼ˆsessionåŒæ­¥æ³•æ˜¯ä¸è¡Œçš„ï¼Œå—å†…å­˜é™åˆ¶ï¼‰</li></ul><p><strong>ä¸è¶³</strong>ï¼š</p><ul><li>å¦‚æœweb-serveré‡å¯ï¼Œä¸€éƒ¨åˆ†sessionä¼šä¸¢å¤±ï¼Œäº§ç”Ÿä¸šåŠ¡å½±å“ï¼Œä¾‹å¦‚éƒ¨åˆ†ç”¨æˆ·é‡æ–°ç™»å½•</li><li>å¦‚æœweb-serveræ°´å¹³æ‰©å±•ï¼Œrehashåsessioné‡æ–°åˆ†å¸ƒï¼Œä¹Ÿä¼šæœ‰ä¸€éƒ¨åˆ†ç”¨æˆ·è·¯ç”±ä¸åˆ°æ­£ç¡®çš„session</li></ul><p>sessionä¸€èˆ¬æ˜¯æœ‰æœ‰æ•ˆæœŸçš„ï¼Œæ‰€æœ‰ä¸è¶³ä¸­çš„ä¸¤ç‚¹ï¼Œå¯ä»¥è®¤ä¸ºç­‰åŒäºéƒ¨åˆ†sessionå¤±æ•ˆï¼Œä¸€èˆ¬é—®é¢˜ä¸å¤§ã€‚</p><p>å¯¹äºå››å±‚hashè¿˜æ˜¯ä¸ƒå±‚hashï¼Œä¸ªäººæ¨èå‰è€…ï¼š<strong>è®©ä¸“ä¸šçš„è½¯ä»¶åšä¸“ä¸šçš„äº‹æƒ…</strong>ï¼Œåå‘ä»£ç†å°±è´Ÿè´£è½¬å‘ï¼Œå°½é‡ä¸è¦å¼•å…¥åº”ç”¨å±‚ä¸šåŠ¡å±æ€§ï¼Œé™¤éä¸å¾—ä¸è¿™ä¹ˆåšï¼ˆä¾‹å¦‚ï¼Œæœ‰æ—¶å€™å¤šæœºæˆ¿å¤šæ´»éœ€è¦æŒ‰ç…§ä¸šåŠ¡å±æ€§è·¯ç”±åˆ°ä¸åŒæœºæˆ¿çš„web-serverï¼‰ã€‚</p><h3 id="åç«¯ç»Ÿä¸€é›†ä¸­å­˜å‚¨"><a href="#åç«¯ç»Ÿä¸€é›†ä¸­å­˜å‚¨" class="headerlink" title="åç«¯ç»Ÿä¸€é›†ä¸­å­˜å‚¨"></a>åç«¯ç»Ÿä¸€é›†ä¸­å­˜å‚¨</h3><p> <img alt="img" data-src="https://images2017.cnblogs.com/blog/926638/201711/926638-20171117190914734-312299182.png" class="lazyload"></p><p><strong>æ€è·¯</strong>ï¼šå°†sessionå­˜å‚¨åœ¨web-serveråç«¯çš„å­˜å‚¨å±‚ï¼Œæ•°æ®åº“æˆ–è€…ç¼“å­˜</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æ²¡æœ‰å®‰å…¨éšæ‚£</li><li>å¯ä»¥æ°´å¹³æ‰©å±•ï¼Œæ•°æ®åº“/ç¼“å­˜æ°´å¹³åˆ‡åˆ†å³å¯</li><li>web-serveré‡å¯æˆ–è€…æ‰©å®¹éƒ½ä¸ä¼šæœ‰sessionä¸¢å¤±</li></ul><p><strong>ä¸è¶³</strong>ï¼šå¢åŠ äº†ä¸€æ¬¡ç½‘ç»œè°ƒç”¨ï¼Œå¹¶ä¸”éœ€è¦ä¿®æ”¹åº”ç”¨ä»£ç </p><h4 id="HttpSession"><a href="#HttpSession" class="headerlink" title="HttpSession"></a>HttpSession</h4><p>1ã€pomæ–‡ä»¶å¼•å…¥</p><pre><code class="xml">&lt;dependencies&gt;  &lt;dependency&gt;    &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;    &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt;  &lt;/dependency&gt;&lt;/dependencies&gt;</code></pre><p>2ã€é…ç½®ç±»</p><pre><code class="java">@Configuration@EnableRedisHttpSession //(maxInactiveIntervalInSeconds = 604800)//sessionè¶…æ—¶public class HttpSessionConfig {}</code></pre><p>3ã€å½“æˆæœ¬åœ°çš„Sessionæ­£å¸¸ä½¿ç”¨å³å¯.</p><p>å…·ä½“å¯å‚è€ƒ:</p><p>[<a href="https://sunweiguo.github.io/2019/01/23/miscellany/06Spring%20Session/]" target="_blank" rel="noopener">https://sunweiguo.github.io/2019/01/23/miscellany/06Spring%20Session/]</a>(<a href="https://sunweiguo.github.io/2019/01/23/miscellany/06Spring" target="_blank" rel="noopener">https://sunweiguo.github.io/2019/01/23/miscellany/06Spring</a> Session/)</p><p><code>åŸç†</code>: å°±æ˜¯é€šè¿‡è¿‡æ»¤å™¨å¯¹HttpRequestä¸­çš„Sessionè¿›è¡Œäº†ä¸€æ¬¡å°è£….</p><p><img alt="image-20200526210333685" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf65keqq7sj30mk0dlwky.jpg" class="lazyload"></p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•ä¾‹è®¾è®¡æ¨¡å¼</title>
      <link href="/2020/01/15/8.%20%E7%AE%97%E6%B3%95-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/01/15/8.%20%E7%AE%97%E6%B3%95-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆè¦ç”¨å•ä¾‹æ¨¡å¼-æ‰‹å†™å‡ ç§çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨å•ä¾‹æ¨¡å¼-æ‰‹å†™å‡ ç§çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨å•ä¾‹æ¨¡å¼?æ‰‹å†™å‡ ç§çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼?"></a>ä¸ºä»€ä¹ˆè¦ç”¨å•ä¾‹æ¨¡å¼?æ‰‹å†™å‡ ç§çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼?</h2><p><strong>ç®€å•æ¥è¯´ä½¿ç”¨å•ä¾‹æ¨¡å¼å¯ä»¥å¸¦æ¥ä¸‹é¢å‡ ä¸ªå¥½å¤„:</strong></p><ul><li>å¯¹äºé¢‘ç¹ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¯ä»¥çœç•¥åˆ›å»ºå¯¹è±¡æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œè¿™å¯¹äºé‚£äº›é‡é‡çº§å¯¹è±¡è€Œè¨€ï¼Œæ˜¯éå¸¸å¯è§‚çš„ä¸€ç¬”ç³»ç»Ÿå¼€é”€ï¼›</li><li>ç”±äº new æ“ä½œçš„æ¬¡æ•°å‡å°‘ï¼Œå› è€Œå¯¹ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨é¢‘ç‡ä¹Ÿä¼šé™ä½ï¼Œè¿™å°†å‡è½» GC å‹åŠ›ï¼Œç¼©çŸ­ GC åœé¡¿æ—¶é—´ã€‚</li></ul><p><strong>å•ä¾‹æ¨¡å¼æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œä½†æ˜¯ï¼Œæœ‰ä¸‰ä¸ªç›¸åŒçš„ç‰¹ç‚¹ï¼š</strong></p><ul><li>æ„é€ å™¨ç§æœ‰ï¼›</li><li>å«æŒæœ‰è‡ªå·±ç±»å‹çš„å±æ€§ï¼›</li><li>å¯¹å¤–æä¾›è·å–å®ä¾‹çš„é™æ€æ–¹æ³•ï¼›</li></ul><p><strong>æ‡’æ±‰å¼(åŒé‡æ£€æŸ¥åŠ é”ç‰ˆæœ¬)</strong></p><pre><code class="Java">public class Singleton {    //é€šè¿‡å°†instanceå£°æ˜ä¸ºvolatileå‹æ¥é˜²æ­¢new Instance()çš„é‡æ’åº    private volatile static Singleton uniqueInstance;    private Singleton() {    }    public static Singleton getInstance() {       //æ£€æŸ¥å®ä¾‹ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±è¿›å…¥åŒæ­¥ä»£ç å—        if (uniqueInstance == null) {            //åªæœ‰ç¬¬ä¸€æ¬¡æ‰å½»åº•æ‰§è¡Œè¿™é‡Œçš„ä»£ç             synchronized(Singleton.class) {               //è¿›å…¥åŒæ­¥ä»£ç å—åï¼Œå†æ£€æŸ¥ä¸€æ¬¡ï¼Œå¦‚æœä»æ˜¯nullï¼Œæ‰åˆ›å»ºå®ä¾‹                if (uniqueInstance == null) {                    uniqueInstance = new Singleton();                }            }        }        return uniqueInstance;    }}</code></pre><p><strong>é™æ€å†…éƒ¨ç±»æ–¹å¼</strong></p><p>é™æ€å†…éƒ¨å®ç°çš„å•ä¾‹æ˜¯æ‡’åŠ è½½çš„ä¸”çº¿ç¨‹å®‰å…¨ã€‚</p><p>åªæœ‰é€šè¿‡æ˜¾å¼è°ƒç”¨ getInstance æ–¹æ³•æ—¶ï¼Œæ‰ä¼šæ˜¾å¼è£…è½½ SingletonHolder ç±»ï¼Œä»è€Œå®ä¾‹åŒ– instanceï¼ˆåªæœ‰ç¬¬ä¸€æ¬¡ä½¿ç”¨è¿™ä¸ªå•ä¾‹çš„å®ä¾‹çš„æ—¶å€™æ‰åŠ è½½ï¼ŒåŒæ—¶ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼‰ã€‚</p><pre><code class="Java">public class Singleton {    private static class SingletonHolder {    private static final Singleton INSTANCE = new Singleton();    }    private Singleton (){}    public static final Singleton getInstance() {    return SingletonHolder.INSTANCE;    }}</code></pre><p>[exocr@iz8vb85pir06gf268taw08z bin]$ ./zkServer.sh start<br>JMX enabled by default<br>Using config: /home/exocr/zookeeper-3.4.6/bin/../conf/zoo.cfg<br>Starting zookeeper â€¦ /bin/echo: å†™å…¥é”™è¯¯: è®¾å¤‡ä¸Šæ²¡æœ‰ç©ºé—´<br>FAILED TO WRITE PID</p><p>&gt; zookeeper.out</p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äº‹åŠ¡å…¨çŸ¥é“</title>
      <link href="/2020/01/15/1.%20Java%E5%9F%BA%E7%A1%80/%E4%BA%8B%E5%8A%A1%E5%85%A8%E7%9F%A5%E9%81%93/"/>
      <url>/2020/01/15/1.%20Java%E5%9F%BA%E7%A1%80/%E4%BA%8B%E5%8A%A1%E5%85%A8%E7%9F%A5%E9%81%93/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ</h2><p><strong>äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</strong></p><p><em>Guide å“¥ï¼šå¤§å®¶åº”è¯¥éƒ½èƒ½èƒŒä¸Šé¢è¿™å¥è¯äº†ï¼Œä¸‹é¢æˆ‘ç»“åˆæˆ‘ä»¬æ—¥å¸¸çš„çœŸå®å¼€å‘æ¥è°ˆä¸€è°ˆã€‚</em></p><p>æˆ‘ä»¬ç³»ç»Ÿçš„æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯èƒ½åŒ…æ‹¬äº†å¤šä¸ªåŸå­æ€§çš„æ•°æ®åº“æ“ä½œï¼Œæ¯”å¦‚ä¸‹é¢çš„ <code>savePerson()</code>æ–¹æ³•ä¸­å°±æœ‰ä¸¤ä¸ªåŸå­æ€§çš„æ•°æ®åº“æ“ä½œã€‚è¿™äº›åŸå­æ€§çš„æ•°æ®åº“æ“ä½œæ˜¯æœ‰ä¾èµ–çš„ï¼Œå®ƒä»¬è¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¸å°±éƒ½ä¸æ‰§è¡Œã€‚</p><pre><code> public void savePerson() {  personDao.save(person);  personDetailDao.save(personDetail); }</code></pre><p>å¦å¤–ï¼Œéœ€è¦æ ¼å¤–æ³¨æ„çš„æ˜¯ï¼š<strong>äº‹åŠ¡èƒ½å¦ç”Ÿæ•ˆæ•°æ®åº“å¼•æ“æ˜¯å¦æ”¯æŒäº‹åŠ¡æ˜¯å…³é”®ã€‚æ¯”å¦‚å¸¸ç”¨çš„ MySQL æ•°æ®åº“é»˜è®¤ä½¿ç”¨æ”¯æŒäº‹åŠ¡çš„<code>innodb</code>å¼•æ“ã€‚ä½†æ˜¯ï¼Œå¦‚æœæŠŠæ•°æ®åº“å¼•æ“å˜ä¸º <code>myisam</code>ï¼Œé‚£ä¹ˆç¨‹åºä¹Ÿå°±ä¸å†æ”¯æŒäº‹åŠ¡äº†ï¼</strong></p><p>äº‹åŠ¡æœ€ç»å…¸ä¹Ÿç»å¸¸è¢«æ‹¿å‡ºæ¥è¯´ä¾‹å­å°±æ˜¯è½¬è´¦äº†ã€‚å‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦ 1000 å…ƒï¼Œè¿™ä¸ªè½¬è´¦ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œå°±æ˜¯ï¼š</p><ol><li>å°†å°æ˜çš„ä½™é¢å‡å°‘ 1000 å…ƒ</li><li>å°†å°çº¢çš„ä½™é¢å¢åŠ  1000 å…ƒã€‚</li></ol><p>ä¸‡ä¸€åœ¨è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´çªç„¶å‡ºç°é”™è¯¯æ¯”å¦‚é“¶è¡Œç³»ç»Ÿå´©æºƒæˆ–è€…ç½‘ç»œæ•…éšœï¼Œå¯¼è‡´å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢çš„ä½™é¢æ²¡æœ‰å¢åŠ ï¼Œè¿™æ ·å°±ä¸å¯¹äº†ã€‚äº‹åŠ¡å°±æ˜¯ä¿è¯è¿™ä¸¤ä¸ªå…³é”®æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½è¦å¤±è´¥ã€‚</p><pre><code class="java">public class OrdersService { private AccountDao accountDao; public void setOrdersDao(AccountDao accountDao) {  this.accountDao = accountDao; }  @Transactional(propagation = Propagation.REQUIRED,                isolation = Isolation.DEFAULT, readOnly = false, timeout = -1) public void accountMoney() {    //å°çº¢è´¦æˆ·å¤š1000  accountDao.addMoney(1000,xiaohong);  //æ¨¡æ‹Ÿçªç„¶å‡ºç°çš„å¼‚å¸¸ï¼Œæ¯”å¦‚é“¶è¡Œä¸­å¯èƒ½ä¸ºçªç„¶åœç”µç­‰ç­‰    //å¦‚æœæ²¡æœ‰é…ç½®äº‹åŠ¡ç®¡ç†çš„è¯ä¼šé€ æˆï¼Œå°çº¢è´¦æˆ·å¤šäº†1000è€Œå°æ˜è´¦æˆ·æ²¡æœ‰å°‘é’±  int i = 10 / 0;  //å°ç‹è´¦æˆ·å°‘1000  accountDao.reduceMoney(1000,xiaoming); }}</code></pre><p>å¦å¤–ï¼Œæ•°æ®åº“äº‹åŠ¡çš„ ACID å››å¤§ç‰¹æ€§æ˜¯äº‹åŠ¡çš„åŸºç¡€ï¼Œä¸‹é¢ç®€å•æ¥äº†è§£ä¸€ä¸‹ã€‚</p><h2 id="äº‹ç‰©çš„ç‰¹æ€§ï¼ˆACIDï¼‰äº†è§£ä¹ˆ"><a href="#äº‹ç‰©çš„ç‰¹æ€§ï¼ˆACIDï¼‰äº†è§£ä¹ˆ" class="headerlink" title="äº‹ç‰©çš„ç‰¹æ€§ï¼ˆACIDï¼‰äº†è§£ä¹ˆ?"></a>äº‹ç‰©çš„ç‰¹æ€§ï¼ˆACIDï¼‰äº†è§£ä¹ˆ?</h2><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TxIvneY939LqG6hdevkph67hKSibNrTR1R9db2OPlDVyTgojcMO33PSRRx9kOeHViaVDsqbia2LnZ5mw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><ul><li><strong>åŸå­æ€§ï¼š</strong> äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›</li><li><strong>ä¸€è‡´æ€§ï¼š</strong> æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼›</li><li><strong>éš”ç¦»æ€§ï¼š</strong> å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹ç‰©ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ä¹Ÿå°±æ˜¯è¯´å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”å½±å“å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œï¼›</li><li><strong>æŒä¹…æ€§:</strong> ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</li></ul><p>â€‹        ==äº‹åŠ¡çš„ACIDæ˜¯é€šè¿‡InnoDBæ—¥å¿—å’Œé”æ¥ä¿è¯ã€‚äº‹åŠ¡çš„<strong>éš”ç¦»æ€§</strong>æ˜¯é€šè¿‡<u>æ•°æ®åº“é”</u>çš„æœºåˆ¶å®ç°çš„ï¼Œ<strong>æŒä¹…æ€§</strong>é€šè¿‡<u>redo log</u>ï¼ˆé‡åšæ—¥å¿—ï¼‰æ¥å®ç°ï¼Œ<strong>åŸå­æ€§å’Œä¸€è‡´æ€§</strong>é€šè¿‡å›æ»šæ—¥å¿—<u>Undo log</u>æ¥å®ç°ã€‚==</p><p>â€‹        <code>UndoLogçš„åŸç†</code>å¾ˆç®€å•ï¼Œä¸ºäº†æ»¡è¶³äº‹åŠ¡çš„åŸå­æ€§ï¼Œåœ¨æ“ä½œä»»ä½•æ•°æ®ä¹‹å‰ï¼Œé¦–å…ˆå°†æ•°æ®å¤‡ä»½åˆ°ä¸€ä¸ªåœ°æ–¹ï¼ˆè¿™ä¸ªå­˜å‚¨æ•°æ®å¤‡ä»½çš„åœ°æ–¹ç§°ä¸ºUndoLogï¼‰ã€‚ç„¶åè¿›è¡Œæ•°æ®çš„ä¿®æ”¹ã€‚å¦‚æœå‡ºç°äº†é”™è¯¯æˆ–è€…ç”¨æˆ·æ‰§è¡Œäº†ROLLBACKè¯­å¥ï¼Œç³»ç»Ÿå¯ä»¥åˆ©ç”¨Undo Logä¸­çš„å¤‡ä»½å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚ å’ŒUndo Logç›¸åï¼Œ<code>RedoLogè®°å½•</code>çš„æ˜¯æ–°æ•°æ®çš„å¤‡ä»½ã€‚åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªè¦å°†RedoLogæŒä¹…åŒ–å³å¯ï¼Œä¸éœ€è¦å°†æ•°æ®æŒä¹…åŒ–ã€‚å½“ç³»ç»Ÿå´©æºƒæ—¶ï¼Œè™½ç„¶æ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œä½†æ˜¯RedoLogå·²ç»æŒä¹…åŒ–ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®RedoLogçš„å†…å®¹ï¼Œå°†æ‰€æœ‰æ•°æ®æ¢å¤åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚ </p><h2 id="äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆisolationï¼‰"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆisolationï¼‰" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆisolationï¼‰"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆisolationï¼‰</h2><p>  åœ¨å¤šçº¿ç¨‹æˆ–å¹¶å‘è®¿é—®ä¸‹å¦‚ä½•ä¿è¯è®¿é—®åˆ°çš„æ•°æ®å…·æœ‰å®Œæ•´æ€§çš„ï¼Ÿ</p><p>  Aï¼‰è„è¯»: ä¿®æ”¹æ—¶å…è®¸è¯»å–</p><p>  B)  ä¸å¯é‡å¤è¯»: è¯»å–æ—¶å…è®¸ä¿®æ”¹,ä¸€æ¬¡äº‹åŠ¡è¯»å–ä¸ä¸€è‡´</p><p>  C)  å¹»è¯»: è¯»å–æ—¶å…è®¸æ’å…¥</p><ul><li><p><code>DEFAULT</code>:     é»˜è®¤å€¼,ç”±åº•å±‚æ•°æ®åº“è‡ªåŠ¨åˆ¤æ–­åº”è¯¥ä½¿ç”¨ä»€ä¹ˆéš”ç¦»ç•Œåˆ«ã€‚</p></li><li><p><code>READ_UNCOMMITTED</code>:     å¯ä»¥è¯»å–æœªæäº¤æ•°æ®,å¯èƒ½å‡ºç°è„è¯»,ä¸é‡å¤è¯»,å¹»è¯».</p></li><li><p><code>READ_COMMITTED</code>:åªèƒ½è¯»å–å…¶ä»–äº‹åŠ¡å·²æäº¤æ•°æ®.å¯ä»¥é˜²æ­¢è„è¯»,å¯èƒ½å‡ºç°ä¸å¯é‡å¤è¯»å’Œå¹»è¯».</p></li><li><p><code>REPEATABLE_READ</code>: è¯»å–çš„æ•°æ®æ·»åŠ é”,åŸºäºmvccå¿«ç…§æœºåˆ¶å®ç°ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹æ­¤æ•°æ®,ä¿è¯ä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°ç›¸åŒçš„æ•°æ®ï¼Œå¯ä»¥é˜²æ­¢ä¸å¯é‡å¤è¯».è„è¯»,å¯èƒ½å‡ºç°å¹»è¯».<strong>mysqlå’Œäº’è”ç½‘åœºæ™¯ä¸‹é»˜è®¤çš„éš”ç¦»çº§åˆ«</strong></p></li><li><p><code>SERIALIZABLE</code>:     æ’é˜Ÿæ“ä½œ,å¯¹æ•´ä¸ªè¡¨æ·»åŠ é”.ä¸€ä¸ªäº‹åŠ¡åœ¨æ“ä½œæ•°æ®æ—¶,å¦ä¸€ä¸ªäº‹åŠ¡ç­‰å¾…äº‹åŠ¡æ“ä½œå®Œæˆåæ‰èƒ½æ“ä½œè¿™ä¸ªè¡¨.</p><p><code>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</code>ä¸ SQL æ ‡å‡†ä¸åŒçš„åœ°æ–¹åœ¨äº InnoDB å­˜å‚¨å¼•æ“åœ¨ <strong><code>REPEATABLE-READ</code>ï¼ˆå¯é‡è¯»ï¼‰</strong> äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ä½¿ç”¨çš„æ˜¯ é—´éš™é”ï¼ˆNext-Keyç®—æ³•)ï¼Œå› æ­¤å¯ä»¥é¿å…å¹»è¯»çš„äº§ç”Ÿï¼Œè¿™ä¸å…¶ä»–æ•°æ®åº“ç³»ç»Ÿ(å¦‚ SQL Server)æ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥è¯´ InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ <strong><code>REPEATABLE-READ</code>ï¼ˆå¯é‡è¯»ï¼‰</strong> å·²ç»å¯ä»¥å®Œå…¨ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§è¦æ±‚ï¼Œå³è¾¾åˆ°äº† SQL æ ‡å‡†çš„ <strong><code>SERIALIZABLE</code>(å¯ä¸²è¡ŒåŒ–)</strong> éš”ç¦»çº§åˆ«ã€‚</p></li></ul><h3 id="é—´éš™é”ï¼ˆNext-Keyé”ï¼‰"><a href="#é—´éš™é”ï¼ˆNext-Keyé”ï¼‰" class="headerlink" title="é—´éš™é”ï¼ˆNext-Keyé”ï¼‰"></a>é—´éš™é”ï¼ˆNext-Keyé”ï¼‰</h3><p>  å½“æˆ‘ä»¬ç”¨èŒƒå›´æ¡ä»¶è€Œä¸æ˜¯ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®çš„ç´¢å¼•é¡¹åŠ é”ï¼›å¯¹äºé”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•ï¼Œå«åšâ€œé—´éš™(GAP)â€ï¼ŒInnoDBä¹Ÿä¼šå¯¹è¿™ä¸ªâ€œé—´éš™â€åŠ é”ï¼Œè¿™ç§é”æœºåˆ¶ä¸æ˜¯æ‰€è°“çš„é—´éš™é”ï¼ˆNext-Keyé”ï¼‰ã€‚</p><p>  ä¸¾ä¾‹æ¥è¯´ï¼Œå‡å¦‚empè¡¨ä¸­åªæœ‰101æ¡è®°å½•ï¼Œå…¶empidçš„å€¼åˆ†åˆ«æ˜¯1,2,â€¦,100,101ï¼Œä¸‹é¢çš„SQLï¼š</p><pre><code class="sql">SELECT * FROM emp WHERE empid &gt; 100 FOR UPDATE</code></pre><p>  æ˜¯ä¸€ä¸ªèŒƒå›´æ¡ä»¶çš„æ£€ç´¢ï¼ŒInnoDBä¸ä»…ä¼šå¯¹ç¬¦åˆæ¡ä»¶çš„empidå€¼ä¸º101çš„è®°å½•åŠ é”ï¼Œä¹Ÿä¼šå¯¹empidå¤§äº101ï¼ˆè¿™äº›è®°å½•å¹¶ä¸å­˜åœ¨ï¼‰çš„â€œé—´éš™â€åŠ é”ã€‚</p><p>  InnoDBä½¿ç”¨é—´éš™é”çš„ç›®çš„ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†é˜²æ­¢å¹»è¯»ï¼Œä»¥æ»¡è¶³ç›¸å…³éš”ç¦»çº§åˆ«çš„è¦æ±‚ï¼Œå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œè¦æ˜¯ä¸ä½¿ç”¨é—´éš™é”ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡æ’å…¥äº†empidå¤§äº100çš„ä»»ä½•è®°å½•ï¼Œé‚£ä¹ˆæœ¬äº‹åŠ¡å¦‚æœå†æ¬¡æ‰§è¡Œä¸Šè¿°è¯­å¥ï¼Œå°±ä¼šå‘ç”Ÿå¹»è¯»ï¼›å¦ä¸€æ–¹é¢ï¼Œæ˜¯ä¸ºäº†æ»¡è¶³å…¶æ¢å¤å’Œå¤åˆ¶çš„éœ€è¦ã€‚æœ‰å…³å…¶æ¢å¤å’Œå¤åˆ¶å¯¹æœºåˆ¶çš„å½±å“ï¼Œä»¥åŠä¸åŒéš”ç¦»çº§åˆ«ä¸‹InnoDBä½¿ç”¨é—´éš™é”çš„æƒ…å†µã€‚</p><p>  å¾ˆæ˜¾ç„¶ï¼Œåœ¨ä½¿ç”¨èŒƒå›´æ¡ä»¶æ£€ç´¢å¹¶é”å®šè®°å½•æ—¶ï¼ŒInnoDBè¿™ç§åŠ é”æœºåˆ¶ä¼šé˜»å¡ç¬¦åˆæ¡ä»¶èŒƒå›´å†…é”®å€¼çš„å¹¶å‘æ’å…¥ï¼Œè¿™å¾€å¾€ä¼šé€ æˆä¸¥é‡çš„é”ç­‰å¾…ã€‚å› æ­¤ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œå°¤å…¶æ˜¯å¹¶å‘æ’å…¥æ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œæˆ‘ä»¬è¦å°½é‡ä¼˜åŒ–ä¸šåŠ¡é€»è¾‘ï¼Œå°½é‡ä½¿ç”¨ç›¸ç­‰æ¡ä»¶æ¥è®¿é—®æ›´æ–°æ•°æ®ï¼Œé¿å…ä½¿ç”¨èŒƒå›´æ¡ä»¶ã€‚</p><h2 id="äº‹åŠ¡ä¼ æ’­å±æ€§"><a href="#äº‹åŠ¡ä¼ æ’­å±æ€§" class="headerlink" title="äº‹åŠ¡ä¼ æ’­å±æ€§"></a>äº‹åŠ¡ä¼ æ’­å±æ€§</h2><p><code>REQUIRED</code>ï¼šéœ€è¦ã€‚æœ‰äº‹åŠ¡ï¼Œæˆ‘è·Ÿä½ æ··ï¼›æ²¡äº‹åŠ¡æˆ‘æ–°å»ºä¸ªï¼›</p><p><code>SUPPORTS</code>ï¼šæ”¯æŒã€‚æœ‰äº‹åŠ¡ï¼Œæˆ‘æ”¯æŒï¼›æ²¡æœ‰äº‹åŠ¡æˆ‘ä¹Ÿä¸æ–°å»ºï¼›</p><p><code>REQUIRES_NEW</code>ï¼šéœ€è¦è‡ªå·±Newä¸ªã€‚æ²¡æœ‰ï¼Œæˆ‘æ–°å»ºä¸ªï¼›æœ‰æˆ‘ä¹Ÿä¸æ­ç†ä½ ï¼Œæˆ‘è‡ªå·±å»ºä¸ªï¼Œç‹¬ç«‹å›æ»šã€‚</p><p>å¿…é¡»æœ‰äº‹åŠ¡ï¼š<code>MANDATORY</code>æ²¡æœ‰å°±æŠ¥é”™ï¼Œ<code>NESTED</code>æ²¡æœ‰æˆ‘æ–°å»ºä¸ªï¼Œæœ‰æˆ‘åµŒå¥—ä¸€ä¸ªã€‚</p><p>å¿…é¡»æ²¡äº‹åŠ¡ï¼š<code>NEVER</code>æœ‰å°±æŠ¥é”™ï¼Œ<code>NOT_SUPPORTED</code>æœ‰æˆ‘ä¹Ÿä¸æ­ç†ä½ ã€‚</p><h3 id="è¯¦ç»†è¯´æ˜"><a href="#è¯¦ç»†è¯´æ˜" class="headerlink" title="è¯¦ç»†è¯´æ˜"></a>è¯¦ç»†è¯´æ˜</h3><p>ä¸‹é¢ï¼Œç”¨ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šä¸‹å„ä¸ªä¼ æ’­å±æ€§çš„ä¸åŒï¼š<br>åœ¨æ•°æ®åº“ä¸­æ–°å»ºäº†ä¸€å¼ äº§å“è¡¨ï¼Œä¸¤æ¡æ•°æ®ï¼Œä¸€æ¡äº§å“idä¸º1ï¼Œäº§å“åç§°ä¸ºIPhone6Sï¼Œå¦ä¸€æ¡äº§å“idä¸º2ï¼Œäº§å“åç§°ä¸ºMAC PROã€‚</p><p>ä¸¤ä¸ªæœåŠ¡serviceAå’ŒserviceBï¼ŒserviceAçš„methodAæ–¹æ³•å…ˆå‡IPhone6Sçš„åº“å­˜ï¼Œç„¶åè°ƒç”¨serviceBä¸­methodBæ–¹æ³•æ‰£å‡MAC Proåº“å­˜ï¼Œä¸ºäº†è§‚å¯Ÿï¼ŒmethodAæœ€åæ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæ¨¡æ‹Ÿå›æ»šåœºæ™¯ã€‚</p><h4 id="REQUIRED-é»˜è®¤å€¼"><a href="#REQUIRED-é»˜è®¤å€¼" class="headerlink" title="REQUIRED(é»˜è®¤å€¼)"></a>REQUIRED(é»˜è®¤å€¼)</h4><p>å¦‚æœå½“å‰æœ‰äº‹åŠ¡,å°±åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ,å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡,æ–°å»ºä¸€ä¸ªäº‹åŠ¡.</p><p>==éœ€è¦ä¸ªäº‹åŠ¡==ï¼šä½ æœ‰æˆ‘è·Ÿç€ä½ æ··ï¼Œä½ æ²¡æœ‰æˆ‘è‡ªå·±åˆ›å»ºä¸ªã€‚</p><ul><li><p>å¤–éƒ¨æœ‰äº‹åŠ¡æ—¶ï¼Œå†…éƒ¨ç»§æ‰¿å¤–éƒ¨äº‹åŠ¡ï¼Œå¼‚å¸¸æ—¶ï¼Œå…±åŒå›æ»šã€‚</p></li><li><p>å¤–éƒ¨æ— äº‹åŠ¡æ—¶ï¼Œå†…éƒ¨æ–°å»ºäº‹åŠ¡ï¼Œç‹¬ç«‹å›æ»šã€‚</p></li></ul><p>  åœ¨ä¼ æ’­å±æ€§ä¸ºPROPAGATION_REQUIREDæ—¶ï¼Œäº‹åŠ¡åŠ å…¥æ–¹ä¼šä½¿ç”¨å½“å‰äº‹åŠ¡ï¼ŒmethodAä»£ç ä¸º</p><pre><code class="java">    public void methodA() {          TransactionTemplate transactionTemplate = new TransactionTemplate(transactionManager);          try {              transactionTemplate.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);              transactionTemplate.execute(status -&gt; {                  OrdProduct product = ordProductMapper.selectForUpdate(1);                  System.out.println(&quot;before update &quot; + product.getProductName() + &quot;, inventory is: &quot; + product.getInventory());                  product.setInventory(product.getInventory() - 1);                  int result = ordProductMapper.updateInventoryByProductId(1, product.getInventory());                  serviceB.methodB();                  if (result == 1) {                       throw new RuntimeException(&quot;test&quot;);                   }                  return result;              });          } finally {              OrdProduct product1 = ordProductMapper.selectForUpdate(1);              OrdProduct product2 = ordProductMapper.selectForUpdate(2);              System.out.println(&quot;after update &quot; + product1.getProductName() + &quot;, inventory is: &quot; + product1.getInventory());              System.out.println(&quot;after update &quot; + product2.getProductName() + &quot;, inventory is: &quot; + product2.getInventory());          }      }</code></pre><p>  methodBçš„ä»£ç ä¸ºï¼š</p><pre><code class="java">   public void methodB(){          TransactionTemplate transactionTemplate = new TransactionTemplate(transactionManager);          transactionTemplate.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);          transactionTemplate.execute(transactionStatus -&gt; {              OrdProduct product = ordProductMapper.selectForUpdate(2);              System.out.println(&quot;before update &quot; + product.getProductName() +  &quot;, inventory is: &quot; + product.getInventory());              product.setInventory(product.getInventory() -1 );              int result = ordProductMapper.updateInventoryByProductId(2, product.getInventory());              /*if (result == 1) {                  throw new RuntimeException(&quot;test&quot;);              }*/              return result;          });      }</code></pre><p>  methodAåœ¨å®Œæˆ6sçš„å‡åº“å­˜æ“ä½œåï¼Œè°ƒç”¨methodBï¼ŒmethodBçš„ä¼ æ’­å±æ€§æ˜¯PROPAGATION_REQUIREDï¼Œæ­¤æ—¶methodAå·²ç»èµ·äº†äº‹åŠ¡ï¼ŒmethodBä¼šä½¿ç”¨ç°å­˜çš„äº‹åŠ¡ï¼Œåœ¨methodAæŠ›å‡ºå¼‚å¸¸åï¼Œä¸¤ä¸ªæ–¹æ³•çš„å‡åº“å­˜æ“ä½œéƒ½ä¼šå›æ»šã€‚</p><ul><li><p><strong>å½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ–°å»ºä¸€ä¸ªäº‹åŠ¡</strong><br>methodAä»£ç é€»è¾‘ä¸ç”¨transactionTemplate.execute()æ–¹å¼æ‰§è¡Œï¼ŒmethodBæ–¹æ³•å»é™¤æ³¨é‡ŠæŠ›å‡ºå¼‚å¸¸ï¼ŒmethodBä¼šæ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰§è¡ŒåmethodBä¼šå›æ»šï¼ŒmethodAä¸ä¼šï¼Œå³macåº“å­˜ä¸å˜ï¼Œ6såº“å­˜å‡1ï¼›</p><h4 id="REQUIRES-NEW"><a href="#REQUIRES-NEW" class="headerlink" title="REQUIRES_NEW"></a>REQUIRES_NEW</h4></li><li><p>å¿…é¡»åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ,å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡,æ–°å»ºäº‹åŠ¡,å¦‚æœå½“å‰æœ‰äº‹åŠ¡,æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·.</p></li><li><p>å†…éƒ¨äº‹åŠ¡å’Œå¤–éƒ¨äº‹åŠ¡åˆ†ç¦»å¼€ï¼Œç‹¬ç«‹å›æ»šã€‚</p><h4 id="SUPPORTS"><a href="#SUPPORTS" class="headerlink" title="SUPPORTS"></a>SUPPORTS</h4><p>å¦‚æœå½“å‰æœ‰äº‹åŠ¡å°±åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ,å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡,å°±åœ¨éäº‹åŠ¡çŠ¶æ€ä¸‹æ‰§è¡Œ.</p></li><li><ul><li><strong>æ”¯æŒå½“å‰äº‹åŠ¡*</strong>å’ŒREQUIREDè¡Œä¸ºç›¸åŒï¼›</li><li><strong>æ²¡æœ‰å½“å‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œ**</strong>ï¼ˆæŠ¥é”™åå‡ä¸è¿›è¡Œå›æ»š)</li></ul><p>methodAä»£ç é€»è¾‘ä¸ç”¨transactionTemplate.execute()æ–¹å¼æ‰§è¡Œï¼ŒmethodBæ–¹æ³•å»é™¤æ³¨é‡ŠæŠ›å‡ºå¼‚å¸¸ï¼ŒmethodBä¸ä¼šæ–°å»ºäº‹åŠ¡ï¼Œæ‰§è¡Œåä¸¤ä¸ªæ–¹æ³•éƒ½ä¸ä¼šå›æ»šï¼Œä¸¤ä¸ªäº§å“çš„åº“å­˜å‡å‡1.</p><h4 id="MANDATORY"><a href="#MANDATORY" class="headerlink" title="MANDATORY"></a>MANDATORY</h4><p>å¿…é¡»åœ¨äº‹åŠ¡å†…éƒ¨æ‰§è¡Œ,å¦‚æœå½“å‰æœ‰äº‹åŠ¡,å°±åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ,å¦‚æœ<strong>æ²¡æœ‰äº‹åŠ¡æŠ¥é”™</strong>.</p></li><li><p>==å¿…é¡»æœ‰äº‹åŠ¡==ï¼šæ²¡æœ‰æˆ‘å°±æŠ¥é”™ã€‚</p></li><li><p>methodAä»£ç é€»è¾‘ä¸ç”¨transactionTemplate.execute()æ–¹å¼æ‰§è¡Œï¼Œæ‰§è¡Œæ—¶åˆ™ä¼šæŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸.</p></li><li><pre><code class="dart">org.springframework.transaction.IllegalTransactionStateException: No existing transaction found for transaction marked with propagation &#39;mandatory&#39;</code></pre><h4 id="NOT-SUPPORTED"><a href="#NOT-SUPPORTED" class="headerlink" title="NOT_SUPPORTED"></a>NOT_SUPPORTED</h4></li><li><p><strong>å¿…é¡»åœ¨éäº‹åŠ¡ä¸‹æ‰§è¡Œ</strong>,å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡,æ­£å¸¸æ‰§è¡Œ,å¦‚æœå½“å‰æœ‰äº‹åŠ¡,æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·.</p></li><li><p>==å¿…é¡»æ²¡æœ‰äº‹åŠ¡==ï¼šæœ‰æˆ‘ä¹Ÿä¸æ­ç†ä½ ã€‚</p><h4 id="NEVER"><a href="#NEVER" class="headerlink" title="NEVER"></a>NEVER</h4></li><li><p><strong>å¿…é¡»åœ¨éäº‹åŠ¡çŠ¶æ€ä¸‹æ‰§è¡Œ</strong>,å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡,æ­£å¸¸æ‰§è¡Œ,å¦‚æœå½“å‰æœ‰äº‹åŠ¡,æŠ¥é”™.</p><p>==å¿…é¡»æ²¡æœ‰äº‹åŠ¡==ï¼šæœ‰æˆ‘å°±æŠ¥é”™ã€‚</p><h4 id="NESTED"><a href="#NESTED" class="headerlink" title="NESTED"></a>NESTED</h4></li><li><p>å¿…é¡»åœ¨äº‹åŠ¡çŠ¶æ€ä¸‹æ‰§è¡Œ**.å¦‚æœæ²¡æœ‰äº‹åŠ¡,æ–°å»ºäº‹åŠ¡,å¦‚æœå½“å‰æœ‰äº‹åŠ¡,åˆ›å»ºä¸€ä¸ªåµŒå¥—äº‹åŠ¡.</p><p>==å¿…é¡»æœ‰äº‹åŠ¡==ï¼šæ²¡æœ‰æˆ‘æ–°å»ºä¸ªï¼Œæœ‰æˆ‘åµŒå¥—ä¸€ä¸ªã€‚</p></li></ul><h2 id="Springå£°æ˜å¼äº‹åŠ¡"><a href="#Springå£°æ˜å¼äº‹åŠ¡" class="headerlink" title="Springå£°æ˜å¼äº‹åŠ¡"></a>Springå£°æ˜å¼äº‹åŠ¡</h2><p><code>ç¼–ç¨‹å¼äº‹åŠ¡:</code></p><p>â€‹    ç”±ç¨‹åºå‘˜ç¼–ç¨‹äº‹åŠ¡æ§åˆ¶ä»£ç .ï¼ˆä¾‹å¦‚ï¼šcommitï¼Œrollbackï¼‰</p><p>â€‹    é€šè¿‡ <code>TransactionTemplate</code>æˆ–è€…<code>TransactionManager</code>æ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ï¼Œå®é™…åº”ç”¨ä¸­å¾ˆå°‘ä½¿ç”¨ï¼Œä½†æ˜¯å¯¹äºä½ ç†è§£ Spring äº‹åŠ¡ç®¡ç†åŸç†æœ‰å¸®åŠ©ã€‚</p><p>ä½¿ç”¨<code>TransactionTemplate</code> è¿›è¡Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="java">@Autowiredprivate TransactionTemplate transactionTemplate;public void testTransaction() {        transactionTemplate.execute(new TransactionCallbackWithoutResult() {            @Override            protected void doInTransactionWithoutResult(TransactionStatus transactionStatus) {                try {                    // ....  ä¸šåŠ¡ä»£ç                 } catch (Exception e){                    //å›æ»š                    transactionStatus.setRollbackOnly();                }            }        });}</code></pre><p><code>å£°æ˜å¼äº‹åŠ¡:</code></p><ol><li>äº‹åŠ¡æ§åˆ¶ä»£ç å·²ç»ç”±springå†™å¥½.</li><li>ç¨‹åºå‘˜åªéœ€è¦å£°æ˜å‡º<strong>å“ªäº›æ–¹æ³•</strong>éœ€è¦è¿›è¡Œäº‹åŠ¡æ§åˆ¶å’Œ<strong>å¦‚ä½•è¿›è¡Œ</strong>äº‹åŠ¡æ§åˆ¶.</li><li>å£°æ˜å¼äº‹åŠ¡éƒ½æ˜¯é’ˆå¯¹äº<strong>ServiceImplç±»</strong>ä¸‹æ–¹æ³•çš„. </li><li>äº‹åŠ¡ç®¡ç†å™¨åŸºäºé€šçŸ¥(advice)çš„.</li><li>åœ¨springé…ç½®æ–‡ä»¶ä¸­é…ç½®å£°æ˜å¼äº‹åŠ¡ï¼Œé…ç½®äº‹åŠ¡çš„<code>ä¼ æ’­è¡Œä¸º</code>ã€<code>åªè¯»å±æ€§</code>ã€<code>éš”ç¦»çº§åˆ«</code>ã€<code>ä½•æ—¶å›æ»š</code>ï¼ˆrollback-forï¼‰</li></ol><h3 id="ä¸¤ç§å®ç°æ–¹å¼"><a href="#ä¸¤ç§å®ç°æ–¹å¼" class="headerlink" title="ä¸¤ç§å®ç°æ–¹å¼"></a>ä¸¤ç§å®ç°æ–¹å¼</h3><h4 id="æ³¨è§£æ–¹å¼"><a href="#æ³¨è§£æ–¹å¼" class="headerlink" title="æ³¨è§£æ–¹å¼"></a>æ³¨è§£æ–¹å¼</h4><h5 id="Transactional-çš„ä½œç”¨èŒƒå›´"><a href="#Transactional-çš„ä½œç”¨èŒƒå›´" class="headerlink" title="@Transactional çš„ä½œç”¨èŒƒå›´"></a><code>@Transactional</code> çš„ä½œç”¨èŒƒå›´</h5><ol><li><strong>æ–¹æ³•</strong> ï¼šæ¨èå°†æ³¨è§£ä½¿ç”¨äºæ–¹æ³•ä¸Šï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>è¯¥æ³¨è§£åªèƒ½åº”ç”¨åˆ° public æ–¹æ³•ä¸Šï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆã€‚</strong></li><li><strong>ç±»</strong> ï¼šå¦‚æœè¿™ä¸ªæ³¨è§£ä½¿ç”¨åœ¨ç±»ä¸Šçš„è¯ï¼Œè¡¨æ˜è¯¥æ³¨è§£å¯¹è¯¥ç±»ä¸­æ‰€æœ‰çš„ public æ–¹æ³•éƒ½ç”Ÿæ•ˆã€‚</li><li><strong>æ¥å£</strong> ï¼šä¸æ¨èåœ¨æ¥å£ä¸Šä½¿ç”¨ã€‚</li></ol><h5 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h5><p>ä½¿ç”¨ <code>@Transactional</code>æ³¨è§£è¿›è¡Œäº‹åŠ¡ç®¡ç†çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="Java">@Transactional(propagation=propagation.PROPAGATION_REQUIRED)public void aMethod {  //do something  B b = new B();  C c = new C();  b.bMethod();  c.cMethod();}@Test@Transactionalpublic void test01() {    Customer dbCustomer = customerService.getCustomerById(2060);    User user = userMapper.selectByPrimaryKey(93);    dbCustomer.setRealName(&quot;b&quot;);    user.setName(&quot;b&quot;);    customerMapper.updateByPrimaryKey(dbCustomer);    userMapper.updateByPrimaryKey(user);    throw new NullPointerException();}</code></pre><h5 id="äº‹åŠ¡ç®¡ç†æ¥å£ä»‹ç»"><a href="#äº‹åŠ¡ç®¡ç†æ¥å£ä»‹ç»" class="headerlink" title="äº‹åŠ¡ç®¡ç†æ¥å£ä»‹ç»"></a>äº‹åŠ¡ç®¡ç†æ¥å£ä»‹ç»</h5><p>Spring æ¡†æ¶ä¸­ï¼Œäº‹åŠ¡ç®¡ç†ç›¸å…³æœ€é‡è¦çš„ 3 ä¸ªæ¥å£å¦‚ä¸‹ï¼š</p><ul><li><code>PlatformTransactionManager</code>ï¼š ï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨ï¼ŒSpring äº‹åŠ¡ç­–ç•¥çš„æ ¸å¿ƒã€‚</li><li><code>TransactionDefinition</code>ï¼š äº‹åŠ¡å®šä¹‰ä¿¡æ¯(äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›æ»šè§„åˆ™)ã€‚</li><li><code>TransactionStatus</code>ï¼š äº‹åŠ¡è¿è¡ŒçŠ¶æ€ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥æŠŠ <code>PlatformTransactionManager</code> æ¥å£å¯ä»¥è¢«çœ‹ä½œæ˜¯äº‹åŠ¡ä¸Šå±‚çš„ç®¡ç†è€…ï¼Œè€Œ <strong><code>TransactionDefinition</code></strong> å’Œ <code>TransactionStatus</code> è¿™ä¸¤ä¸ªæ¥å£å¯ä»¥çœ‹ä½œæ˜¯äº‹ç‰©çš„æè¿°ã€‚</p><p><code>PlatformTransactionManager</code> ä¼šæ ¹æ® <code>TransactionDefinition</code> çš„å®šä¹‰æ¯”å¦‚äº‹åŠ¡è¶…æ—¶æ—¶é—´ã€éš”ç¦»ç•Œåˆ«ã€ä¼ æ’­è¡Œä¸ºç­‰æ¥è¿›è¡Œäº‹åŠ¡ç®¡ç† ï¼Œè€Œ <code>TransactionStatus</code> æ¥å£åˆ™æä¾›äº†ä¸€äº›æ–¹æ³•æ¥è·å–äº‹åŠ¡ç›¸åº”çš„çŠ¶æ€æ¯”å¦‚æ˜¯å¦æ–°äº‹åŠ¡ã€æ˜¯å¦å¯ä»¥å›æ»šç­‰ç­‰ã€‚</p><h4 id="é…ç½®æ–‡ä»¶æ–¹å¼"><a href="#é…ç½®æ–‡ä»¶æ–¹å¼" class="headerlink" title="é…ç½®æ–‡ä»¶æ–¹å¼"></a>é…ç½®æ–‡ä»¶æ–¹å¼</h4><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans &gt;    &lt;!-- äº‹åŠ¡ç®¡ç†å™¨ --&gt;    &lt;bean id=&quot;transactionManager&quot;        class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;        &lt;!-- æ•°æ®æº --&gt;        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;    &lt;/bean&gt;    &lt;!-- é€šçŸ¥ --&gt;    &lt;!--é…ç½®äº‹åŠ¡å¢å¼ºï¼Œäº‹åŠ¡å¦‚ä½•åˆ‡å…¥ --&gt;    &lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;        &lt;tx:attributes&gt;            &lt;!-- ä¼ æ’­è¡Œä¸º --&gt;            &lt;tx:method name=&quot;save*&quot; propagation=&quot;REQUIRED&quot; /&gt;            &lt;tx:method name=&quot;insert*&quot; propagation=&quot;REQUIRED&quot; /&gt;            &lt;tx:method name=&quot;add*&quot; propagation=&quot;REQUIRED&quot; /&gt;            &lt;tx:method name=&quot;create*&quot; propagation=&quot;REQUIRED&quot; /&gt;            &lt;tx:method name=&quot;delete*&quot; propagation=&quot;REQUIRED&quot; /&gt;            &lt;tx:method name=&quot;remove*&quot; propagation=&quot;REQUIRED&quot; /&gt;            &lt;tx:method name=&quot;update*&quot; propagation=&quot;REQUIRED&quot; /&gt;            &lt;tx:method name=&quot;find*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot; /&gt;            &lt;tx:method name=&quot;select*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot; /&gt;            &lt;tx:method name=&quot;get*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot; /&gt;        &lt;/tx:attributes&gt;    &lt;/tx:advice&gt;    &lt;!-- åˆ‡é¢ --&gt;    &lt;aop:config&gt;        &lt;!-- é…ç½®äº‹åŠ¡å¢å¼ºä»¥åŠåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ --&gt;        &lt;aop:advisor advice-ref=&quot;txAdvice&quot;            pointcut=&quot;execution(* com.exocr.service..*.*(..))&quot; /&gt;    &lt;/aop:config&gt;&lt;/beans&gt;</code></pre><h3 id="å£°æ˜å¼äº‹åŠ¡ä¸­çš„å±æ€§"><a href="#å£°æ˜å¼äº‹åŠ¡ä¸­çš„å±æ€§" class="headerlink" title="å£°æ˜å¼äº‹åŠ¡ä¸­çš„å±æ€§"></a>å£°æ˜å¼äº‹åŠ¡ä¸­çš„å±æ€§</h3><p><img alt="img" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf95xljabwj309q08pjsu.jpg" class="lazyload"></p><ul><li><p><strong>name=</strong>â€â€ å“ªäº›æ–¹æ³•éœ€è¦æœ‰äº‹åŠ¡æ§åˆ¶ï¼Œæ”¯æŒ*é€šé…ç¬¦</p></li><li><p><strong>readonly=</strong>â€booleanâ€ æ˜¯å¦æ˜¯åªè¯»äº‹åŠ¡.</p><ul><li>å¦‚æœä¸º true,å‘Šè¯‰æ•°æ®åº“æ­¤äº‹åŠ¡ä¸ºåªè¯»äº‹åŠ¡.æ•°æ®åº“ä¼˜åŒ–,ä¼šå¯¹æ€§èƒ½æœ‰ä¸€å®šæå‡,æ‰€ä»¥åªè¦æ˜¯æŸ¥è¯¢çš„æ–¹æ³•,å»ºè®®ä½¿ç”¨ã€‚</li><li>å¦‚æœä¸º false(é»˜è®¤å€¼),äº‹åŠ¡éœ€è¦æäº¤çš„äº‹åŠ¡.å»ºè®®æ–°å¢,åˆ é™¤,ä¿®æ”¹.</li></ul></li><li><p><strong>propagation</strong> æ§åˆ¶äº‹åŠ¡ä¼ æ’­è¡Œä¸º.</p></li><li><p><strong>isolation=</strong>â€â€ äº‹åŠ¡éš”ç¦»çº§åˆ«</p></li><li><p><strong>rollback</strong>-for=â€å¼‚å¸¸ç±»å‹å…¨é™å®šè·¯å¾„â€:å½“å‡ºç°ä»€ä¹ˆå¼‚å¸¸æ—¶éœ€è¦è¿›è¡Œå›æ»š</p></li></ul><p>  ä¸šåŠ¡ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼šè¿›è¡Œæ’å…¥æ“ä½œè·å–è¿”å›å€¼ï¼Œå½“å…¨éƒ¨æˆåŠŸåè®¤ä¸ºæ–°å¢æˆåŠŸï¼Œå¦åˆ™å¤±è´¥ã€‚ç”±Springè¿›è¡Œäº‹åŠ¡å›æ»šã€‚</p><pre><code class="java">  public int insTbItemDesc(TbItem tbItem, TbItemDesc desc,TbItemParamItem paramItem) throws Exception {          int index =0;          try {              index= tbItemMapper.insertSelective(tbItem);              index+= tbItemDescMapper.insertSelective(desc);              index+=tbItemParamItemMapper.insertSelective(paramItem);          } catch (Exception e) {              e.printStackTrace();          }          if(index==3){              return 1;          }else{              throw new Exception(&quot;æ–°å¢å¤±è´¥,æ•°æ®è¿˜åŸ&quot;);          }      }</code></pre><p>  XA å°±æ˜¯ X/Open DTP å®šä¹‰çš„äº¤æ˜“ä¸­é—´ä»¶ä¸æ•°æ®åº“ä¹‹é—´çš„æ¥å£è§„èŒƒï¼ˆå³æ¥å£å‡½æ•°ï¼‰ï¼Œäº¤æ˜“ä¸­é—´ä»¶ç”¨å®ƒæ¥é€šçŸ¥æ•°æ®åº“äº‹åŠ¡çš„å¼€å§‹ã€ç»“æŸä»¥åŠæäº¤ã€å›æ»šç­‰ã€‚ XA æ¥å£å‡½æ•°ç”±æ•°æ®åº“å‚å•†æä¾›ã€‚</p><h2 id><a href="#" class="headerlink" title></a></h2><h3 id="Transactional-äº‹åŠ¡æ³¨è§£åŸç†"><a href="#Transactional-äº‹åŠ¡æ³¨è§£åŸç†" class="headerlink" title="@Transactional äº‹åŠ¡æ³¨è§£åŸç†"></a><code>@Transactional</code> äº‹åŠ¡æ³¨è§£åŸç†</h3><p>  é¢è¯•ä¸­åœ¨é—® AOP çš„æ—¶å€™å¯èƒ½ä¼šè¢«é—®åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚ç®€å•è¯´ä¸‹å§ï¼</p><p>  æˆ‘ä»¬çŸ¥é“ï¼Œ<code>@Transactional</code> çš„å·¥ä½œæœºåˆ¶æ˜¯åŸºäº AOP å®ç°çš„ï¼ŒAOP åˆæ˜¯ä½¿ç”¨<strong>åŠ¨æ€ä»£ç†</strong>å®ç°çš„ã€‚å¦‚æœç›®æ ‡å¯¹è±¡<strong>å®ç°äº†æ¥å£</strong>ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šé‡‡ç”¨ <strong>JDK çš„åŠ¨æ€ä»£ç†</strong>ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°äº†æ¥å£,ä¼šä½¿ç”¨ <strong>CGLIB åŠ¨æ€ä»£ç†</strong>ã€‚</p><p>  å¤šæä¸€å˜´ï¼š<code>createAopProxy()</code> æ–¹æ³• å†³å®šäº†æ˜¯ä½¿ç”¨ JDK è¿˜æ˜¯ Cglib æ¥åšåŠ¨æ€ä»£ç†ï¼Œæºç å¦‚ä¸‹ï¼š</p><pre><code class="java">  public class DefaultAopProxyFactory implements AopProxyFactory, Serializable {   @Override   public AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException {    if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) {     Class&lt;?&gt; targetClass = config.getTargetClass();     if (targetClass == null) {      throw new AopConfigException(&quot;TargetSource cannot determine target class: &quot; +        &quot;Either an interface or a target is required for proxy creation.&quot;);     }     if (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) {      return new JdkDynamicAopProxy(config);     }     return new ObjenesisCglibAopProxy(config);    }    else {     return new JdkDynamicAopProxy(config);    }   }    .......  }</code></pre><p>  å¦‚æœä¸€ä¸ªç±»æˆ–è€…ä¸€ä¸ªç±»ä¸­çš„ public æ–¹æ³•ä¸Šè¢«æ ‡æ³¨<code>@Transactional</code> æ³¨è§£çš„è¯ï¼ŒSpring å®¹å™¨å°±ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™ä¸ºå…¶åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œåœ¨è°ƒç”¨è¢«<code>@Transactional</code> æ³¨è§£çš„ public æ–¹æ³•çš„æ—¶å€™ï¼Œå®é™…è°ƒç”¨çš„æ˜¯ï¼Œ<code>TransactionInterceptor</code> ç±»ä¸­çš„ <code>invoke()</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°å¼‚å¸¸çš„æ—¶å€™å›æ»šäº‹åŠ¡ï¼Œæ–¹æ³•è°ƒç”¨å®Œæˆä¹‹åæäº¤äº‹åŠ¡ã€‚</p><h4 id="Spring-AOP-è‡ªè°ƒç”¨é—®é¢˜"><a href="#Spring-AOP-è‡ªè°ƒç”¨é—®é¢˜" class="headerlink" title="Spring AOP è‡ªè°ƒç”¨é—®é¢˜"></a>Spring AOP è‡ªè°ƒç”¨é—®é¢˜</h4><p>  è‹¥åŒä¸€ç±»ä¸­çš„å…¶ä»–æ²¡æœ‰ <code>@Transactional</code> æ³¨è§£çš„æ–¹æ³•å†…éƒ¨è°ƒç”¨æœ‰ <code>@Transactional</code> æ³¨è§£çš„æ–¹æ³•ï¼Œæœ‰<code>@Transactional</code> æ³¨è§£çš„æ–¹æ³•çš„äº‹åŠ¡ä¼šå¤±æ•ˆã€‚</p><p>  è¿™æ˜¯ç”±äº<code>Spring AOP</code>ä»£ç†çš„åŸå› é€ æˆçš„ï¼Œå› ä¸ºåªæœ‰å½“ <code>@Transactional</code> æ³¨è§£çš„æ–¹æ³•åœ¨==ç±»ä»¥å¤–è¢«è°ƒç”¨çš„æ—¶å€™ï¼ŒSpring äº‹åŠ¡ç®¡ç†æ‰ç”Ÿæ•ˆã€‚==</p><p>  <code>MyService</code> ç±»ä¸­çš„<code>method1()</code>è°ƒç”¨<code>method2()</code>å°±ä¼šå¯¼è‡´<code>method2()</code>çš„äº‹åŠ¡å¤±æ•ˆã€‚</p><pre><code class="java">  @Service  public class MyService {  private void method1() {       method2();       //......  }  @Transactional   public void method2() {       //......    }  }</code></pre><p>  è§£å†³åŠæ³•å°±æ˜¯é¿å…åŒä¸€ç±»ä¸­è‡ªè°ƒç”¨æˆ–è€…ä½¿ç”¨ AspectJ å–ä»£ Spring AOP ä»£ç†ã€‚</p><h4 id="Transactional-çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“"><a href="#Transactional-çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“" class="headerlink" title="@Transactional çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“"></a><code>@Transactional</code> çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“</h4><pre><code>1. `@Transactional` æ³¨è§£åªæœ‰ä½œç”¨åˆ° public æ–¹æ³•ä¸Šäº‹åŠ¡æ‰ç”Ÿæ•ˆï¼Œä¸æ¨èåœ¨æ¥å£ä¸Šä½¿ç”¨ï¼›2. é¿å…åŒä¸€ä¸ªç±»ä¸­è°ƒç”¨ `@Transactional` æ³¨è§£çš„æ–¹æ³•ï¼Œè¿™æ ·ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼›3. æ­£ç¡®çš„è®¾ç½® `@Transactional` çš„ rollbackFor å’Œ propagation å±æ€§ï¼Œå¦åˆ™äº‹åŠ¡å¯èƒ½ä¼šå›æ»šå¤±è´¥4. ......</code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> JavaåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äº‹åŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼äº‹åŠ¡</title>
      <link href="/2020/01/15/7.%20%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
      <url>/2020/01/15/7.%20%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h2><h2 id="é¢è¯•å®˜é—®ï¼šä½ è®²è®²åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„å‡ ç§æ–¹æ¡ˆï¼Ÿ"><a href="#é¢è¯•å®˜é—®ï¼šä½ è®²è®²åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„å‡ ç§æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="é¢è¯•å®˜é—®ï¼šä½ è®²è®²åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„å‡ ç§æ–¹æ¡ˆï¼Ÿ"></a>é¢è¯•å®˜é—®ï¼šä½ è®²è®²åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„å‡ ç§æ–¹æ¡ˆï¼Ÿ</h2><ul><li>ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ/XAæ–¹æ¡ˆ</li><li>TCC æ–¹æ¡ˆ</li><li>æœ¬åœ°æ¶ˆæ¯è¡¨</li><li>å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ</li><li>æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ</li><li>ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Ÿ</li></ul><h2 id="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ•°æ®åº“èƒ½å®ç°æœ¬åœ°äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œä½ å¯ä»¥å…è®¸ä¸€ç»„æ“ä½œè¦ä¹ˆå…¨éƒ½æ­£ç¡®æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œã€‚</p><p><strong>æœ¬åœ°äº‹åŠ¡</strong>ï¼šä¹Ÿå°±æ˜¯ç›®å‰çš„æ•°æ®åº“åªèƒ½æ”¯æŒåŒä¸€ä¸ªæ•°æ®åº“ä¸­çš„äº‹åŠ¡ã€‚</p><p><strong>åˆ†å¸ƒå¼äº‹åŠ¡ï¼š</strong>ä½†ç°åœ¨çš„ç³»ç»Ÿå¾€å¾€é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œä¸šåŠ¡ç³»ç»Ÿæ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œå› æ­¤å°±å‡ºç°äº†<strong><code>è·¨å¤šä¸ªæ•°æ®åº“</code>çš„äº‹åŠ¡éœ€æ±‚</strong>ï¼Œè¿™ç§äº‹åŠ¡å³ä¸ºâ€œåˆ†å¸ƒå¼äº‹åŠ¡â€ã€‚é‚£ä¹ˆåœ¨ç›®å‰æ•°æ®åº“ä¸æ”¯æŒè·¨åº“äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡å‘¢ï¼Ÿ</p><p>æ¯”å¦‚ç”¨æˆ·ä¸‹å•è¿‡ç¨‹ã€‚å½“æˆ‘ä»¬çš„ç³»ç»Ÿé‡‡ç”¨äº†å¾®æœåŠ¡æ¶æ„åï¼Œä¸€ä¸ªç”µå•†ç³»ç»Ÿå¾€å¾€è¢«æ‹†åˆ†æˆå¦‚ä¸‹å‡ ä¸ªå­ç³»ç»Ÿï¼šå•†å“ç³»ç»Ÿã€è®¢å•ç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿã€ç§¯åˆ†ç³»ç»Ÿç­‰ã€‚æ•´ä¸ªä¸‹å•çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç”¨æˆ·é€šè¿‡å•†å“ç³»ç»Ÿæµè§ˆå•†å“ï¼Œä»–çœ‹ä¸­äº†æŸä¸€é¡¹å•†å“ï¼Œä¾¿ç‚¹å‡»ä¸‹å•</li><li>æ­¤æ—¶è®¢å•ç³»ç»Ÿä¼šç”Ÿæˆä¸€æ¡è®¢å•</li><li>è®¢å•åˆ›å»ºæˆåŠŸåï¼Œæ”¯ä»˜ç³»ç»Ÿæä¾›æ”¯ä»˜åŠŸèƒ½</li><li>å½“æ”¯ä»˜å®Œæˆåï¼Œç”±ç§¯åˆ†ç³»ç»Ÿä¸ºè¯¥ç”¨æˆ·å¢åŠ ç§¯åˆ†</li></ul><p>ä¸Šè¿°æ­¥éª¤2ã€3ã€4éœ€è¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å®Œæˆã€‚å¯¹äºä¼ ç»Ÿå•ä½“åº”ç”¨è€Œè¨€ï¼Œå®ç°äº‹åŠ¡éå¸¸ç®€å•ï¼Œåªéœ€å°†è¿™ä¸‰ä¸ªæ­¥éª¤æ”¾åœ¨ä¸€ä¸ªæ–¹æ³•Aä¸­ï¼Œå†ç”¨Springçš„<code>@Transactional</code>æ³¨è§£æ ‡è¯†è¯¥æ–¹æ³•å³å¯ã€‚Springé€šè¿‡æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼Œä¿è¯è¿™äº›æ­¥éª¤è¦ä¹ˆå…¨éƒ½æ‰§è¡Œå®Œæˆï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œã€‚ä½†åœ¨è¿™ä¸ªå¾®æœåŠ¡æ¶æ„ä¸­ï¼Œè¿™ä¸‰ä¸ªæ­¥éª¤æ¶‰åŠä¸‰ä¸ªç³»ç»Ÿï¼Œæ¶‰åŠä¸‰ä¸ªæ•°æ®åº“ï¼Œæ­¤æ—¶æˆ‘ä»¬å¿…é¡»åœ¨æ•°æ®åº“å’Œåº”ç”¨ç³»ç»Ÿä¹‹é—´ï¼Œé€šè¿‡æŸé¡¹é»‘ç§‘æŠ€ï¼Œå®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„æ”¯æŒã€‚</p><p>â€‹        è¿˜æœ‰ä¸€ç§,åˆ†å¸ƒå¼é¡¹ç›®ä¸­,ä¾‹å¦‚ä½¿ç”¨Dubboå®ç°çš„åˆ†å¸ƒå¼é¡¹ç›®,æ¯ä¸€ä¸ªå¾®æœåŠ¡è°ƒç”¨æ•°æ®åº“æ—¶,å•ç‹¬å ç”¨ä¸€æ¡æ•°æ®åº“è¿æ¥Connection(é‡Œé¢åŒ…å«commitã€rollbackç­‰æ–¹æ³•),æ•°æ®åº“çš„äº‹åŠ¡å°±æ˜¯åŸºäºConnectionå®ç°çš„.æ‰€ä»¥ä¹Ÿä¼šå‡ºç°åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜.</p><h2 id="5ç§å®ç°æ–¹æ¡ˆï¼š"><a href="#5ç§å®ç°æ–¹æ¡ˆï¼š" class="headerlink" title="5ç§å®ç°æ–¹æ¡ˆï¼š"></a>5ç§å®ç°æ–¹æ¡ˆï¼š</h2><ul><li>2PC/XA æ–¹æ¡ˆ</li><li>TCC æ–¹æ¡ˆ</li><li>æœ¬åœ°æ¶ˆæ¯è¡¨</li><li>å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ</li><li>æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ</li></ul><h3 id="2PC-XA"><a href="#2PC-XA" class="headerlink" title="2PC/XA"></a>2PC/XA</h3><p>XA å°±æ˜¯ X/Open DTP å®šä¹‰çš„<code>äº¤æ˜“ä¸­é—´ä»¶ä¸æ•°æ®åº“ä¹‹é—´çš„æ¥å£è§„èŒƒ</code>ï¼ˆå³æ¥å£å‡½æ•°ï¼‰ï¼Œäº¤æ˜“ä¸­é—´ä»¶ç”¨å®ƒæ¥é€šçŸ¥æ•°æ®åº“äº‹åŠ¡çš„å¼€å§‹ã€ç»“æŸä»¥åŠæäº¤ã€å›æ»šç­‰ã€‚ XA æ¥å£å‡½æ•°ç”±æ•°æ®åº“å‚å•†æä¾›ã€‚ </p><p><strong>äºŒé˜¶æäº¤åè®®</strong>å’Œ<strong>ä¸‰é˜¶æäº¤åè®®</strong>å°±æ˜¯æ ¹æ®è¿™ä¸€æ€æƒ³è¡ç”Ÿå‡ºæ¥çš„ã€‚å¯ä»¥è¯´äºŒé˜¶æ®µæäº¤å…¶å®å°±æ˜¯å®ç°<strong>XAåˆ†å¸ƒå¼äº‹åŠ¡</strong>çš„å…³é”®(ç¡®åˆ‡åœ°è¯´ï¼šä¸¤é˜¶æ®µæäº¤ä¸»è¦ä¿è¯äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„åŸå­æ€§ï¼šå³æ‰€æœ‰ç»“ç‚¹è¦ä¹ˆå…¨åšè¦ä¹ˆå…¨ä¸åš)</p><p><img alt="image-20200529144413095" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9bgnzcztj30x50i7n5d.jpg" class="lazyload"></p><h4 id="ä¸¤é˜¶æ®µ"><a href="#ä¸¤é˜¶æ®µ" class="headerlink" title="ä¸¤é˜¶æ®µ"></a>ä¸¤é˜¶æ®µ</h4><p>ç¬¬ä¸€é˜¶æ®µï¼šäº‹åŠ¡ç®¡ç†å™¨è¦æ±‚æ¯ä¸ªæ¶‰åŠåˆ°äº‹åŠ¡çš„æ•°æ®åº“é¢„æäº¤(precommit)æ­¤æ“ä½œï¼Œå¹¶åæ˜ æ˜¯å¦å¯ä»¥æäº¤.</p><p>ç¬¬äºŒé˜¶æ®µï¼šäº‹åŠ¡åè°ƒå™¨è¦æ±‚æ¯ä¸ªæ•°æ®åº“æäº¤æ•°æ®ï¼Œæˆ–è€…å›æ»šæ•°æ®ã€‚</p><h4 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h4><p>å°½é‡ä¿è¯äº†æ•°æ®çš„å¼ºä¸€è‡´ï¼Œå®ç°æˆæœ¬è¾ƒä½ï¼Œåœ¨å„å¤§ä¸»æµæ•°æ®åº“éƒ½æœ‰è‡ªå·±å®ç°ï¼Œå¯¹äºMySQLæ˜¯ä»5.5å¼€å§‹æ”¯æŒã€‚</p><h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹:"></a>ç¼ºç‚¹:</h4><ul><li>å•ç‚¹é—®é¢˜:äº‹åŠ¡ç®¡ç†å™¨åœ¨æ•´ä¸ªæµç¨‹ä¸­æ‰®æ¼”çš„è§’è‰²å¾ˆå…³é”®ï¼Œå¦‚æœå…¶å®•æœºï¼Œæ¯”å¦‚åœ¨ç¬¬ä¸€é˜¶æ®µå·²ç»å®Œæˆï¼Œåœ¨ç¬¬äºŒé˜¶æ®µæ­£å‡†å¤‡æäº¤çš„æ—¶å€™äº‹åŠ¡ç®¡ç†å™¨å®•æœºï¼Œèµ„æºç®¡ç†å™¨å°±ä¼šä¸€ç›´é˜»å¡ï¼Œå¯¼è‡´æ•°æ®åº“æ— æ³•ä½¿ç”¨ã€‚</li><li>åŒæ­¥é˜»å¡:åœ¨å‡†å¤‡å°±ç»ªä¹‹åï¼Œèµ„æºç®¡ç†å™¨ä¸­çš„èµ„æºä¸€ç›´å¤„äºé˜»å¡ï¼Œç›´åˆ°æäº¤å®Œæˆï¼Œé‡Šæ”¾èµ„æºã€‚</li><li>æ•°æ®ä¸ä¸€è‡´:ä¸¤é˜¶æ®µæäº¤åè®®è™½ç„¶ä¸ºåˆ†å¸ƒå¼æ•°æ®å¼ºä¸€è‡´æ€§æ‰€è®¾è®¡ï¼Œä½†ä»ç„¶å­˜åœ¨æ•°æ®ä¸ä¸€è‡´æ€§çš„å¯èƒ½ï¼Œæ¯”å¦‚åœ¨ç¬¬äºŒé˜¶æ®µä¸­ï¼Œå‡è®¾åè°ƒè€…å‘å‡ºäº†äº‹åŠ¡commitçš„é€šçŸ¥ï¼Œä½†æ˜¯å› ä¸ºç½‘ç»œé—®é¢˜è¯¥é€šçŸ¥ä»…è¢«ä¸€éƒ¨åˆ†å‚ä¸è€…æ‰€æ”¶åˆ°å¹¶æ‰§è¡Œäº†commitæ“ä½œï¼Œå…¶ä½™çš„å‚ä¸è€…åˆ™å› ä¸ºæ²¡æœ‰æ”¶åˆ°é€šçŸ¥ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œè¿™æ—¶å€™å°±äº§ç”Ÿäº†æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒXAåè®®æ¯”è¾ƒç®€å•ï¼Œæˆæœ¬è¾ƒä½ï¼Œä½†æ˜¯å…¶å•ç‚¹é—®é¢˜ï¼Œä»¥åŠä¸èƒ½æ”¯æŒé«˜å¹¶å‘(ç”±äºåŒæ­¥é˜»å¡)ä¾ç„¶æ˜¯å…¶æœ€å¤§çš„å¼±ç‚¹ã€‚</p><h3 id="ATæ¨¡å¼ï¼ˆæ— ä¾µå…¥ï¼‰"><a href="#ATæ¨¡å¼ï¼ˆæ— ä¾µå…¥ï¼‰" class="headerlink" title="ATæ¨¡å¼ï¼ˆæ— ä¾µå…¥ï¼‰"></a>ATæ¨¡å¼ï¼ˆæ— ä¾µå…¥ï¼‰</h3><p>æœ‰ä¸€ä¸ª<strong>äº‹åŠ¡ç®¡ç†å™¨</strong>çš„æ¦‚å¿µï¼Œè´Ÿè´£åè°ƒå¤šä¸ªæ•°æ®åº“ï¼ˆèµ„æºç®¡ç†å™¨ï¼‰çš„äº‹åŠ¡ï¼Œäº‹åŠ¡ç®¡ç†å™¨å…ˆé—®é—®å„ä¸ªæ•°æ®åº“ä½ å‡†å¤‡å¥½äº†å—ï¼Ÿå¦‚æœæ¯ä¸ªæ•°æ®åº“éƒ½å›å¤ okï¼Œé‚£ä¹ˆå°±æ­£å¼æäº¤äº‹åŠ¡ï¼Œåœ¨å„ä¸ªæ•°æ®åº“ä¸Šæ‰§è¡Œæ“ä½œï¼›å¦‚æœä»»ä½•å…¶ä¸­ä¸€ä¸ªæ•°æ®åº“å›ç­”ä¸ okï¼Œé‚£ä¹ˆå°±å›æ»šäº‹åŠ¡ã€‚ã€‚å®ƒè§„å®šäº†è¦å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œéœ€è¦ä¸‰ç§è§’è‰²ï¼š</p><ul><li><p>APï¼šApplication åº”ç”¨ç³»ç»Ÿ å®ƒå°±æ˜¯æˆ‘ä»¬å¼€å‘çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œåœ¨æˆ‘ä»¬å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨èµ„æºç®¡ç†å™¨æä¾›çš„äº‹åŠ¡æ¥å£æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p></li><li><p>TMï¼šTransaction Manager äº‹åŠ¡ç®¡ç†å™¨</p><ul><li>åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°ç”±äº‹åŠ¡ç®¡ç†å™¨æ¥å®Œæˆï¼Œå®ƒä¼šæä¾›åˆ†å¸ƒå¼äº‹åŠ¡çš„æ“ä½œæ¥å£ä¾›æˆ‘ä»¬çš„ä¸šåŠ¡ç³»ç»Ÿè°ƒç”¨ã€‚è¿™äº›æ¥å£ç§°ä¸ºTXæ¥å£ã€‚</li><li>äº‹åŠ¡ç®¡ç†å™¨è¿˜ç®¡ç†ç€æ‰€æœ‰çš„èµ„æºç®¡ç†å™¨ï¼Œé€šè¿‡å®ƒä»¬æä¾›çš„XAæ¥å£æ¥åŒä¸€è°ƒåº¦è¿™äº›èµ„æºç®¡ç†å™¨ï¼Œä»¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</li><li>DTPåªæ˜¯ä¸€å¥—å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„è§„èŒƒï¼Œå¹¶æ²¡æœ‰å®šä¹‰å…·ä½“å¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒTMå¯ä»¥é‡‡ç”¨2PCã€3PCã€Paxosç­‰åè®®å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</li></ul></li><li><p>RMï¼šResource Manager èµ„æºç®¡ç†å™¨</p><ul><li>èƒ½å¤Ÿæä¾›æ•°æ®æœåŠ¡çš„å¯¹è±¡éƒ½å¯ä»¥æ˜¯èµ„æºç®¡ç†å™¨ï¼Œæ¯”å¦‚ï¼šæ•°æ®åº“ã€æ¶ˆæ¯ä¸­é—´ä»¶ã€ç¼“å­˜ç­‰ã€‚å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ï¼Œæ•°æ®åº“å³ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„èµ„æºç®¡ç†å™¨ã€‚</li><li>èµ„æºç®¡ç†å™¨èƒ½å¤Ÿæä¾›å•æ•°æ®åº“çš„äº‹åŠ¡èƒ½åŠ›ï¼Œå®ƒä»¬é€šè¿‡XAæ¥å£ï¼Œå°†æœ¬æ•°æ®åº“çš„æäº¤ã€å›æ»šç­‰èƒ½åŠ›æä¾›ç»™äº‹åŠ¡ç®¡ç†å™¨è°ƒç”¨ï¼Œä»¥å¸®åŠ©äº‹åŠ¡ç®¡ç†å™¨å®ç°åˆ†å¸ƒå¼çš„äº‹åŠ¡ç®¡ç†ã€‚</li><li>XAæ˜¯DTPæ¨¡å‹å®šä¹‰çš„æ¥å£ï¼Œç”¨äºå‘äº‹åŠ¡ç®¡ç†å™¨æä¾›è¯¥èµ„æºç®¡ç†å™¨(è¯¥æ•°æ®åº“)çš„æäº¤ã€å›æ»šç­‰èƒ½åŠ›ã€‚</li><li>DTPåªæ˜¯ä¸€å¥—å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„è§„èŒƒï¼ŒRMå…·ä½“çš„å®ç°æ˜¯ç”±æ•°æ®åº“å‚å•†æ¥å®Œæˆçš„ã€‚</li></ul></li></ul><p>å…¸å‹å®ç°å°±æ˜¯Seateä¸­çš„ATæ–¹æ¡ˆ</p><h4 id="AT-æ¨¡å¼å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥-ï¼š"><a href="#AT-æ¨¡å¼å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥-ï¼š" class="headerlink" title="AT æ¨¡å¼å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥ ï¼š"></a>AT æ¨¡å¼å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥ ï¼š</h4><ul><li>ä¸€é˜¶æ®µï¼š</li></ul><p>åœ¨ä¸€é˜¶æ®µï¼ŒSeata ä¼šæ‹¦æˆªâ€œä¸šåŠ¡ SQLâ€ï¼Œé¦–å…ˆè§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œä¸šåŠ¡ SQLâ€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€œbefore imageâ€ï¼Œç„¶åæ‰§è¡Œâ€œä¸šåŠ¡ SQLâ€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹åï¼Œå†å°†å…¶ä¿å­˜æˆâ€œafter imageâ€ï¼Œæœ€åç”Ÿæˆè¡Œé”ã€‚ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§ã€‚</p><p><img alt="image-20200529164409862" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9exhkt2jj30je08qn0p.jpg" class="lazyload"></p><ul><li>äºŒé˜¶æ®µæäº¤ï¼š</li></ul><p>äºŒé˜¶æ®µå¦‚æœæ˜¯æäº¤çš„è¯ï¼Œå› ä¸ºâ€œä¸šåŠ¡ SQLâ€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œ æ‰€ä»¥ Seata æ¡†æ¶åªéœ€å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯ã€‚</p><p><img alt="image-20200529164527232" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9eytr45jj30v80h30xl.jpg" class="lazyload"></p><ul><li>äºŒé˜¶æ®µå›æ»šï¼š</li></ul><p>äºŒé˜¶æ®µå¦‚æœæ˜¯å›æ»šçš„è¯ï¼ŒSeata å°±éœ€è¦å›æ»šä¸€é˜¶æ®µå·²ç»æ‰§è¡Œçš„â€œä¸šåŠ¡ SQLâ€ï¼Œè¿˜åŸä¸šåŠ¡æ•°æ®ã€‚å›æ»šæ–¹å¼ä¾¿æ˜¯ç”¨â€œbefore imageâ€è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œ â€œafter imageâ€ï¼Œå¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰è„å†™ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†ã€‚</p><p><img alt="image-20200529164543181" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9ez31qn4j30zb0fxad8.jpg" class="lazyload"></p><p>AT æ¨¡å¼çš„ä¸€é˜¶æ®µã€äºŒé˜¶æ®µæäº¤å’Œå›æ»šå‡ç”± Seata æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆï¼Œç”¨æˆ·åªéœ€ç¼–å†™â€œä¸šåŠ¡ SQLâ€ï¼Œä¾¿èƒ½è½»æ¾æ¥å…¥åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒAT æ¨¡å¼æ˜¯ä¸€ç§å¯¹ä¸šåŠ¡æ— ä»»ä½•ä¾µå…¥çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="TCC"><a href="#TCC" class="headerlink" title="TCC"></a>TCC</h3><p>ï¼ˆ<strong>ä¸šåŠ¡æ¨¡å‹åˆ† 2 é˜¶æ®µè®¾è®¡</strong>ï¼‰</p><p>ç”¨æˆ·æ¥å…¥ TCC ï¼Œæœ€é‡è¦çš„æ˜¯è€ƒè™‘å¦‚ä½•å°†è‡ªå·±çš„ä¸šåŠ¡æ¨¡å‹æ‹†æˆä¸¤é˜¶æ®µæ¥å®ç°ã€‚</p><p>ä»¥â€œæ‰£é’±â€åœºæ™¯ä¸ºä¾‹ï¼Œåœ¨æ¥å…¥ TCC å‰ï¼Œå¯¹ A è´¦æˆ·çš„æ‰£é’±ï¼Œåªéœ€ä¸€æ¡æ›´æ–°è´¦æˆ·ä½™é¢çš„ SQL ä¾¿èƒ½å®Œæˆï¼›ä½†æ˜¯åœ¨æ¥å…¥ TCC ä¹‹åï¼Œç”¨æˆ·å°±éœ€è¦è€ƒè™‘å¦‚ä½•å°†åŸæ¥ä¸€æ­¥å°±èƒ½å®Œæˆçš„æ‰£é’±æ“ä½œï¼Œæ‹†æˆä¸¤é˜¶æ®µï¼Œå®ç°æˆä¸‰ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”ä¿è¯ä¸€é˜¶æ®µ Try æˆåŠŸçš„è¯ äºŒé˜¶æ®µ Confirm ä¸€å®šèƒ½æˆåŠŸã€‚</p><p><img alt="image-20200529180821216" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9hd0u26lj30ic08ot9z.jpg" class="lazyload"></p><h4 id="å®ç°è¿‡ç¨‹"><a href="#å®ç°è¿‡ç¨‹" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h4><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒTry æ–¹æ³•ä½œä¸ºä¸€é˜¶æ®µå‡†å¤‡æ–¹æ³•ï¼Œéœ€è¦åšèµ„æºçš„æ£€æŸ¥å’Œé¢„ç•™ã€‚åœ¨æ‰£é’±åœºæ™¯ä¸‹ï¼ŒTry è¦åšçš„äº‹æƒ…æ˜¯å°±æ˜¯æ£€æŸ¥è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³ï¼Œé¢„ç•™è½¬è´¦èµ„é‡‘ï¼Œé¢„ç•™çš„æ–¹å¼å°±æ˜¯å†»ç»“ A è´¦æˆ·çš„ è½¬è´¦èµ„é‡‘ã€‚Try æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œè´¦å· A ä½™é¢è™½ç„¶è¿˜æ˜¯ 100ï¼Œä½†æ˜¯å…¶ä¸­ 30 å…ƒå·²ç»è¢«å†»ç»“äº†ï¼Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡ä½¿ç”¨ã€‚</p><p>äºŒé˜¶æ®µ Confirm æ–¹æ³•æ‰§è¡ŒçœŸæ­£çš„æ‰£é’±æ“ä½œã€‚Confirm ä¼šä½¿ç”¨ Try é˜¶æ®µå†»ç»“çš„èµ„é‡‘ï¼Œæ‰§è¡Œè´¦å·æ‰£æ¬¾ã€‚Confirm æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œè´¦å· A åœ¨ä¸€é˜¶æ®µä¸­å†»ç»“çš„ 30 å…ƒå·²ç»è¢«æ‰£é™¤ï¼Œè´¦å· A ä½™é¢å˜æˆ 70 å…ƒ ã€‚</p><p>å¦‚æœäºŒé˜¶æ®µæ˜¯å›æ»šçš„è¯ï¼Œå°±éœ€è¦åœ¨ Cancel æ–¹æ³•å†…é‡Šæ”¾ä¸€é˜¶æ®µ Try å†»ç»“çš„ 30 å…ƒï¼Œä½¿è´¦å· A çš„å›åˆ°åˆå§‹çŠ¶æ€ï¼Œ100 å…ƒå…¨éƒ¨å¯ç”¨ã€‚</p><p>ç”¨æˆ·æ¥å…¥ TCC æ¨¡å¼ï¼Œæœ€é‡è¦çš„äº‹æƒ…å°±æ˜¯è€ƒè™‘å¦‚ä½•å°†ä¸šåŠ¡æ¨¡å‹æ‹†æˆ 2 é˜¶æ®µï¼Œå®ç°æˆ TCC çš„ 3 ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”ä¿è¯ Try æˆåŠŸ Confirm ä¸€å®šèƒ½æˆåŠŸã€‚ç›¸å¯¹äº AT æ¨¡å¼ï¼ŒTCC æ¨¡å¼å¯¹ä¸šåŠ¡ä»£ç æœ‰ä¸€å®šçš„ä¾µå…¥æ€§ï¼Œä½†æ˜¯ TCC æ¨¡å¼æ—  AT æ¨¡å¼çš„å…¨å±€è¡Œé”ï¼ŒTCC æ€§èƒ½ä¼šæ¯” AT æ¨¡å¼é«˜å¾ˆå¤šã€‚</p><p><strong>2 TCC è®¾è®¡ - å…è®¸ç©ºå›æ»šï¼š</strong></p><p><img alt="image-20200529180726482" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9hc2vfeej310j0k211t.jpg" class="lazyload"></p><p>Cancel æ¥å£è®¾è®¡æ—¶éœ€è¦å…è®¸ç©ºå›æ»šã€‚åœ¨ Try æ¥å£å› ä¸ºä¸¢åŒ…æ—¶æ²¡æœ‰æ”¶åˆ°ï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¼šè§¦å‘å›æ»šï¼Œè¿™æ—¶ä¼šè§¦å‘ Cancel æ¥å£ï¼Œè¿™æ—¶ ==Cancel æ‰§è¡Œæ—¶å‘ç°æ²¡æœ‰å¯¹åº”çš„äº‹åŠ¡ xid æˆ–ä¸»é”®æ—¶ï¼Œéœ€è¦è¿”å›å›æ»šæˆåŠŸ==ã€‚è®©äº‹åŠ¡æœåŠ¡ç®¡ç†å™¨è®¤ä¸ºå·²å›æ»šï¼Œå¦åˆ™ä¼šä¸æ–­é‡è¯•ï¼Œè€Œ Cancel åˆæ²¡æœ‰å¯¹åº”çš„ä¸šåŠ¡æ•°æ®å¯ä»¥è¿›è¡Œå›æ»šã€‚</p><p><strong>3 TCC è®¾è®¡ - é˜²æ‚¬æŒ‚æ§åˆ¶ï¼š</strong></p><p><img alt="image-20200529180647874" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9hbe8aolj310l0k47do.jpg" class="lazyload"></p><p>æ‚¬æŒ‚çš„æ„æ€æ˜¯ï¼šCancel æ¯” Try æ¥å£å…ˆæ‰§è¡Œï¼Œå‡ºç°çš„åŸå› æ˜¯ Try ç”±äºç½‘ç»œæ‹¥å µè€Œè¶…æ—¶ï¼Œäº‹åŠ¡ç®¡ç†å™¨ç”Ÿæˆå›æ»šï¼Œè§¦å‘ Cancel æ¥å£ï¼Œè€Œæœ€ç»ˆåˆæ”¶åˆ°äº† Try æ¥å£è°ƒç”¨ï¼Œä½†æ˜¯ Cancel æ¯” Try å…ˆåˆ°ã€‚æŒ‰ç…§å‰é¢å…è®¸ç©ºå›æ»šçš„é€»è¾‘ï¼Œå›æ»šä¼šè¿”å›æˆåŠŸï¼Œäº‹åŠ¡ç®¡ç†å™¨è®¤ä¸ºäº‹åŠ¡å·²å›æ»šæˆåŠŸï¼Œåˆ™æ­¤æ—¶çš„ Try æ¥å£ä¸åº”è¯¥æ‰§è¡Œï¼Œå¦åˆ™ä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ ==Cancel ç©ºå›æ»šè¿”å›æˆåŠŸä¹‹å‰å…ˆè®°å½•è¯¥æ¡äº‹åŠ¡ xid æˆ–ä¸šåŠ¡ä¸»é”®ï¼Œæ ‡è¯†è¿™æ¡è®°å½•å·²ç»å›æ»šè¿‡ï¼ŒTry æ¥å£å…ˆæ£€æŸ¥è¿™æ¡äº‹åŠ¡xidæˆ–ä¸šåŠ¡ä¸»é”®å¦‚æœå·²ç»æ ‡è®°ä¸ºå›æ»šæˆåŠŸè¿‡ï¼Œåˆ™ä¸æ‰§è¡Œ Try çš„ä¸šåŠ¡æ“ä½œã€‚==</p><p>b+å¤šå°‘å±‚</p><p><strong>4 TCC è®¾è®¡ - å¹‚ç­‰æ§åˆ¶ï¼š</strong></p><p><img alt="image-20200529180631756" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9hb56oq8j310f0k8ahf.jpg" class="lazyload"></p><p>å¹‚ç­‰æ€§çš„æ„æ€æ˜¯ï¼šå¯¹åŒä¸€ä¸ªç³»ç»Ÿï¼Œä½¿ç”¨åŒæ ·çš„æ¡ä»¶ï¼Œä¸€æ¬¡è¯·æ±‚å’Œé‡å¤çš„å¤šæ¬¡è¯·æ±‚å¯¹ç³»ç»Ÿèµ„æºçš„å½±å“æ˜¯ä¸€è‡´çš„ã€‚å› ä¸ºç½‘ç»œæŠ–åŠ¨æˆ–æ‹¥å µå¯èƒ½ä¼šè¶…æ—¶ï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¼šå¯¹èµ„æºè¿›è¡Œé‡è¯•æ“ä½œï¼Œæ‰€ä»¥å¾ˆå¯èƒ½ä¸€ä¸ªä¸šåŠ¡æ“ä½œä¼šè¢«é‡å¤è°ƒç”¨ï¼Œä¸ºäº†ä¸å› ä¸ºé‡å¤è°ƒç”¨è€Œå¤šæ¬¡å ç”¨èµ„æºï¼Œéœ€è¦å¯¹æœåŠ¡è®¾è®¡æ—¶è¿›è¡Œå¹‚ç­‰æ§åˆ¶ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥ç”¨äº‹åŠ¡ xid æˆ–ä¸šåŠ¡ä¸»é”®åˆ¤é‡æ¥æ§åˆ¶ã€‚</p><h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><p>å¯¹æ¯”ä¸å‰é¢æåˆ°çš„ä¸¤é˜¶æ®µæäº¤æ³•, æœ‰ä¸¤å¤§ä¼˜åŠ¿:</p><p>â€‹        TCC èƒ½å¤Ÿå¯¹åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„å„ä¸ªèµ„æºè¿›è¡Œåˆ†åˆ«é”å®š, åˆ†åˆ«æäº¤ä¸é‡Šæ”¾, ä¾‹å¦‚, å‡è®¾æœ‰AB ä¸¤ä¸ªæ“ä½œ, å‡è®¾Aæ“ä½œè€—æ—¶çŸ­, é‚£ä¹ˆAå°±èƒ½è¾ƒå¿«çš„å®Œæˆè‡ªèº«çš„try-confirm-cancel æµç¨‹, é‡Šæ”¾èµ„æº.æ— éœ€ç­‰å¾… B æ“ä½œ. å¦‚æœäº‹åå‡ºç°é—®é¢˜, è¿½åŠ æ‰§è¡Œè¡¥å¿æ€§äº‹åŠ¡å³å¯.</p><p>TCC æ˜¯ç»‘å®šåœ¨å„ä¸ªå­ä¸šåŠ¡ä¸Šçš„(é™¤äº† cancel ä¸­çš„å…¨å±€å›æ»šæ“ä½œ), ä¹Ÿå°±æ˜¯å„æœåŠ¡ä¹‹é—´å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šâ€å¼‚æ­¥å¹¶è¡Œâ€æ‰§è¡Œã€‚</p><h4 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h4><p>â€¢ ä¸¥æ ¼ä¸€è‡´æ€§</p><p>â€¢ æ‰§è¡Œæ—¶é—´çŸ­</p><p>â€¢ å®æ—¶æ€§è¦æ±‚é«˜</p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p><a href="https://github.com/liuyangming/ByteTCC" target="_blank" rel="noopener">https://github.com/liuyangming/ByteTCC</a></p><h3 id="Saga"><a href="#Saga" class="headerlink" title="Saga"></a>Saga</h3><p><img alt="image-20200529163254714" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9elpmficj30ym0j8483.jpg" class="lazyload"></p><p>Saga æ˜¯ä¸€ç§è¡¥å¿åè®®ï¼Œåœ¨ Saga æ¨¡å¼ä¸‹ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å†…æœ‰å¤šä¸ªå‚ä¸è€…ï¼Œæ¯ä¸€ä¸ªå‚ä¸è€…éƒ½æ˜¯ä¸€ä¸ªå†²æ­£è¡¥å¿æœåŠ¡ï¼Œéœ€è¦ç”¨æˆ·æ ¹æ®ä¸šåŠ¡åœºæ™¯å®ç°å…¶æ­£å‘æ“ä½œå’Œé€†å‘å›æ»šæ“ä½œã€‚</p><p>åˆ†å¸ƒå¼äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¾æ¬¡æ‰§è¡Œå„å‚ä¸è€…çš„æ­£å‘æ“ä½œï¼Œå¦‚æœæ‰€æœ‰æ­£å‘æ“ä½œå‡æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆåˆ†å¸ƒå¼äº‹åŠ¡æäº¤ã€‚å¦‚æœä»»ä½•ä¸€ä¸ªæ­£å‘æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆåˆ†å¸ƒå¼äº‹åŠ¡ä¼šé€€å›å»æ‰§è¡Œå‰é¢å„å‚ä¸è€…çš„é€†å‘å›æ»šæ“ä½œï¼Œå›æ»šå·²æäº¤çš„å‚ä¸è€…ï¼Œä½¿åˆ†å¸ƒå¼äº‹åŠ¡å›åˆ°åˆå§‹çŠ¶æ€ã€‚</p><h3 id="æ¶ˆæ¯é˜Ÿåˆ—å®ç°"><a href="#æ¶ˆæ¯é˜Ÿåˆ—å®ç°" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—å®ç°"></a>æ¶ˆæ¯é˜Ÿåˆ—å®ç°</h3><p><code>ç‰¹ç‚¹</code>ï¼šå‚ä¸è€…åªèƒ½æˆåŠŸï¼Œä¸èƒ½å¤±è´¥</p><h4 id="å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ"><a href="#å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ" class="headerlink" title="å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ"></a>å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ</h4><p>å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆæ˜¯æŒ‡å½“äº‹åŠ¡å‘èµ·æ–¹æ‰§è¡Œå®Œæˆæœ¬åœ°äº‹åŠ¡åå¹¶å‘å‡ºä¸€æ¡æ¶ˆæ¯ï¼Œäº‹åŠ¡å‚ä¸æ–¹(æ¶ˆæ¯æ¶ˆè´¹è€…)ä¸€å®šèƒ½ å¤Ÿæ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç†äº‹åŠ¡æˆåŠŸï¼Œæ­¤æ–¹æ¡ˆå¼ºè°ƒçš„æ˜¯åªè¦æ¶ˆæ¯å‘ç»™äº‹åŠ¡å‚ä¸æ–¹æœ€ç»ˆäº‹åŠ¡è¦è¾¾åˆ°ä¸€è‡´.</p><p><img alt="image-20200527135027605" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf6yox0gxfj30ai0cygmj.jpg" class="lazyload"></p><h5 id="å®ç°è¿‡ç¨‹-1"><a href="#å®ç°è¿‡ç¨‹-1" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h5><ol><li>åœ¨ç³»ç»ŸAå¤„ç†ä»»åŠ¡Aå‰ï¼Œé¦–å…ˆå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€ä¸€æ¡æ¶ˆæ¯,æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°åå°†è¯¥æ¡æ¶ˆæ¯æŒä¹…åŒ–ï¼Œä½†å¹¶ä¸æŠ•é€’ã€‚</li><li>æ¶ˆæ¯ä¸­é—´ä»¶æŒä¹…åŒ–æˆåŠŸåï¼Œä¾¿å‘ç³»ç»ŸAè¿”å›ä¸€ä¸ªç¡®è®¤åº”ç­”ï¼›</li><li>ç³»ç»ŸAæ”¶åˆ°ç¡®è®¤åº”ç­”åï¼Œåˆ™å¯ä»¥å¼€å§‹å¤„ç†ä»»åŠ¡Aï¼›</li><li>ä»»åŠ¡Aå¤„ç†å®Œæˆåï¼Œå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€Commitè¯·æ±‚ã€‚è¯¥è¯·æ±‚å‘é€å®Œæˆåï¼Œå¯¹ç³»ç»ŸAè€Œè¨€ï¼Œè¯¥äº‹åŠ¡çš„å¤„ç†è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œæ­¤æ—¶å®ƒå¯ä»¥å¤„ç†åˆ«çš„ä»»åŠ¡äº†ã€‚<br> ä½†commitæ¶ˆæ¯å¯èƒ½ä¼šåœ¨ä¼ è¾“é€”ä¸­ä¸¢å¤±ï¼Œä»è€Œæ¶ˆæ¯ä¸­é—´ä»¶å¹¶ä¸ä¼šå‘ç³»ç»ŸBæŠ•é€’è¿™æ¡æ¶ˆæ¯ï¼Œä»è€Œç³»ç»Ÿå°±ä¼šå‡ºç°ä¸ä¸€è‡´æ€§ã€‚è¿™ä¸ªé—®é¢˜ç”±æ¶ˆæ¯ä¸­é—´ä»¶çš„äº‹åŠ¡å›æŸ¥æœºåˆ¶å®Œæˆï¼Œä¸‹æ–‡ä¼šä»‹ç»ã€‚</li><li>æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°CommitæŒ‡ä»¤åï¼Œä¾¿å‘ç³»ç»ŸBæŠ•é€’è¯¥æ¶ˆæ¯ï¼Œä»è€Œè§¦å‘ä»»åŠ¡Bçš„æ‰§è¡Œï¼›</li><li>å½“ä»»åŠ¡Bæ‰§è¡Œå®Œæˆåï¼Œç³»ç»ŸBå‘æ¶ˆæ¯ä¸­é—´ä»¶è¿”å›ä¸€ä¸ªç¡®è®¤åº”ç­”ï¼Œå‘Šè¯‰æ¶ˆæ¯ä¸­é—´ä»¶è¯¥æ¶ˆæ¯å·²ç»æˆåŠŸæ¶ˆè´¹ï¼Œé‚£ä¹ˆMQå°†æ­¤æ¡äº‹åŠ¡ç§»é™¤</li><li>å¦‚æœä»»åŠ¡Bæ‰§è¡Œå¤±è´¥ï¼ŒMQéœ€è¦å¯¹æ¶ˆæ¯é‡æ–°æŠ•é€’, ç›´è‡³æ¶ˆè´¹æˆåŠŸã€‚</li></ol><p>ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä»»åŠ¡Aå¤„ç†å¤±è´¥ï¼Œé‚£ä¹ˆéœ€è¦è¿›å…¥å›æ»šæµç¨‹:</p><ul><li>è‹¥ç³»ç»ŸAåœ¨å¤„ç†ä»»åŠ¡Aæ—¶å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€Rollbackè¯·æ±‚ã€‚å’Œå‘é€Commitè¯·æ±‚ä¸€æ ·ï¼Œç³»ç»ŸAå‘å®Œä¹‹åä¾¿å¯ä»¥è®¤ä¸ºå›æ»šå·²ç»å®Œæˆï¼Œå®ƒä¾¿å¯ä»¥å»åšå…¶ä»–çš„äº‹æƒ…ã€‚</li><li>æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°å›æ»šè¯·æ±‚åï¼Œç›´æ¥å°†è¯¥æ¶ˆæ¯ä¸¢å¼ƒï¼Œè€Œä¸æŠ•é€’ç»™ç³»ç»ŸBï¼Œä»è€Œä¸ä¼šè§¦å‘ç³»ç»ŸBçš„ä»»åŠ¡Bã€‚</li></ul><p>ä¸Šé¢æ‰€ä»‹ç»çš„<code>Commit</code>å’Œ<code>Rollback</code>éƒ½å±äºç†æƒ³æƒ…å†µï¼Œä½†åœ¨å®é™…ç³»ç»Ÿä¸­ï¼Œ<code>Commit</code>å’Œ<code>Rollback</code>æŒ‡ä»¤éƒ½æœ‰å¯èƒ½åœ¨ä¼ è¾“é€”ä¸­ä¸¢å¤±ã€‚é‚£ä¹ˆå½“å‡ºç°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶æ˜¯å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§å‘¢ï¼Ÿâ€”â€”ç­”æ¡ˆå°±æ˜¯==è¶…æ—¶è¯¢é—®æœºåˆ¶==ã€‚</p><p>ç³»ç»ŸAé™¤äº†å®ç°æ­£å¸¸çš„ä¸šåŠ¡æµç¨‹å¤–ï¼Œè¿˜éœ€æä¾›ä¸€ä¸ªäº‹åŠ¡è¯¢é—®çš„æ¥å£ï¼Œä¾›æ¶ˆæ¯ä¸­é—´ä»¶è°ƒç”¨ã€‚å½“æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°ä¸€æ¡äº‹åŠ¡å‹æ¶ˆæ¯åä¾¿å¼€å§‹è®¡æ—¶ï¼Œå¦‚æœåˆ°äº†è¶…æ—¶æ—¶é—´ä¹Ÿæ²¡æ”¶åˆ°ç³»ç»ŸAå‘æ¥çš„<code>Commit</code>æˆ–<code>Rollback</code>æŒ‡ä»¤çš„è¯ï¼Œå°±ä¼šä¸»åŠ¨è°ƒç”¨ç³»ç»ŸAæä¾›çš„äº‹åŠ¡è¯¢é—®æ¥å£è¯¢é—®è¯¥ç³»ç»Ÿç›®å‰çš„çŠ¶æ€ã€‚è¯¥æ¥å£ä¼šè¿”å›ä¸‰ç§ç»“æœï¼š</p><ul><li>æäº¤ ï¼Œåˆ™å°†è¯¥æ¶ˆæ¯æŠ•é€’ç»™ç³»ç»ŸBã€‚</li><li>å›æ»šï¼Œåˆ™ç›´æ¥å°†æ¡æ¶ˆæ¯ä¸¢å¼ƒã€‚</li><li>å¤„ç†ä¸­ï¼Œåˆ™ç»§ç»­ç­‰å¾…ã€‚</li></ul><p>æ¶ˆæ¯ä¸­é—´ä»¶å‘ä¸‹æ¸¸ç³»ç»ŸæŠ•é€’å®Œæ¶ˆæ¯åä¾¿è¿›å…¥é˜»å¡ç­‰å¾…çŠ¶æ€ï¼Œä¸‹æ¸¸ç³»ç»Ÿä¾¿ç«‹å³è¿›è¡Œä»»åŠ¡çš„å¤„ç†ï¼Œä»»åŠ¡å¤„ç†å®Œæˆåä¾¿å‘æ¶ˆæ¯ä¸­é—´ä»¶è¿”å›åº”ç­”ã€‚æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°ç¡®è®¤åº”ç­”åä¾¿è®¤ä¸ºè¯¥äº‹åŠ¡å¤„ç†å®Œæ¯•ï¼</p><p>å¦‚æœæ¶ˆæ¯åœ¨æŠ•é€’è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼Œæˆ–æ¶ˆæ¯çš„ç¡®è®¤åº”ç­”åœ¨è¿”å›é€”ä¸­ä¸¢å¤±ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¸­é—´ä»¶åœ¨ç­‰å¾…ç¡®è®¤åº”ç­”è¶…æ—¶ä¹‹åå°±ä¼šé‡æ–°æŠ•é€’ï¼Œç›´åˆ°ä¸‹æ¸¸æ¶ˆè´¹è€…è¿”å›æ¶ˆè´¹æˆåŠŸå“åº”ä¸ºæ­¢ã€‚å½“ç„¶ï¼Œä¸€èˆ¬æ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥è®¾ç½®æ¶ˆæ¯é‡è¯•çš„æ¬¡æ•°å’Œæ—¶é—´é—´éš”ï¼Œæ¯”å¦‚ï¼šå½“ç¬¬ä¸€æ¬¡æŠ•é€’å¤±è´¥åï¼Œæ¯éš”äº”åˆ†é’Ÿé‡è¯•ä¸€æ¬¡ï¼Œä¸€å…±é‡è¯•3æ¬¡ã€‚å¦‚æœé‡è¯•3æ¬¡ä¹‹åä»ç„¶æŠ•é€’å¤±è´¥ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯å°±éœ€è¦äººå·¥å¹²é¢„ã€‚</p><h5 id="ä½¿ç”¨åœºæ™¯ï¼š"><a href="#ä½¿ç”¨åœºæ™¯ï¼š" class="headerlink" title="ä½¿ç”¨åœºæ™¯ï¼š"></a>ä½¿ç”¨åœºæ™¯ï¼š</h5><p>â€¢ æ‰§è¡Œå‘¨æœŸè¾ƒé•¿</p><p>â€¢ å®æ—¶æ€§è¦æ±‚ä¸é«˜</p><h5 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>æ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ¡ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—å…·æœ‰äº‹åŠ¡æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œé˜¿é‡Œçš„<code>RocketMQ</code>å¯ä»¥å®ç°è¿™ä¸ªç›®æ ‡ã€‚å…¶ä»–çš„MQè¿˜ä¸è¡Œã€‚</p><hr><h4 id="æœ€å¤§åŠªåŠ›é€šçŸ¥ï¼ˆå®šæœŸæ ¡å¯¹ï¼‰"><a href="#æœ€å¤§åŠªåŠ›é€šçŸ¥ï¼ˆå®šæœŸæ ¡å¯¹ï¼‰" class="headerlink" title="æœ€å¤§åŠªåŠ›é€šçŸ¥ï¼ˆå®šæœŸæ ¡å¯¹ï¼‰"></a>æœ€å¤§åŠªåŠ›é€šçŸ¥ï¼ˆå®šæœŸæ ¡å¯¹ï¼‰</h4><p><img alt="image-20200527135941812" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf6yxpoyxfj30hi075jsh.jpg" class="lazyload"></p><h5 id="å®ç°è¿‡ç¨‹-2"><a href="#å®ç°è¿‡ç¨‹-2" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h5><p>â€‹    1ã€ç³»ç»Ÿ A æœ¬åœ°äº‹åŠ¡ï¼ˆå¤„ç†ä»»åŠ¡å¹¶æ’å…¥åˆ°æœ¬åœ°æ¶ˆæ¯è¡¨ï¼‰æ‰§è¡Œå®Œä¹‹åï¼Œå‘é€ä¸ªæ¶ˆæ¯åˆ°MQï¼›<br>â€‹    2ã€æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°æ¶ˆæ¯åè´Ÿè´£å°†è¯¥æ¶ˆæ¯åŒæ­¥æŠ•é€’ç»™ç›¸åº”çš„ä¸‹æ¸¸ç³»ç»Ÿï¼Œå¹¶è§¦å‘ä¸‹æ¸¸ç³»ç»Ÿçš„ä»»åŠ¡æ‰§è¡Œï¼›<br>â€‹    3ã€å½“ä¸‹æ¸¸ç³»ç»Ÿå¤„ç†æˆåŠŸåï¼Œå‘æ¶ˆæ¯ä¸­é—´ä»¶åé¦ˆç¡®è®¤åº”ç­”ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶ä¾¿å¯ä»¥å°†è¯¥æ¡æ¶ˆæ¯åˆ é™¤ï¼Œä»è€Œè¯¥äº‹åŠ¡å®Œæˆã€‚</p><p>ä¸Šé¢æ˜¯ä¸€ä¸ªç†æƒ³åŒ–çš„è¿‡ç¨‹ï¼Œä½†åœ¨å®é™…åœºæ™¯ä¸­ï¼Œå¾€å¾€ä¼šå‡ºç°å¦‚ä¸‹å‡ ç§æ„å¤–æƒ…å†µï¼š</p><ul><li>ä¸Šæ¸¸ç³»ç»Ÿå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€æ¶ˆæ¯å¤±è´¥</li><li>æ¶ˆæ¯ä¸­é—´ä»¶å‘ä¸‹æ¸¸ç³»ç»ŸæŠ•é€’æ¶ˆæ¯å¤±è´¥</li></ul><p><code>å¯¹äºç¬¬ä¸€ç§æƒ…å†µ</code>ï¼Œéœ€è¦åœ¨ä¸Šæ¸¸ç³»ç»Ÿä¸­å»ºç«‹æ¶ˆæ¯é‡å‘æœºåˆ¶ã€‚<strong>å¯ä»¥åœ¨ä¸Šæ¸¸ç³»ç»Ÿå»ºç«‹ä¸€å¼ æœ¬åœ°æ¶ˆæ¯è¡¨ï¼Œå¹¶å°†ä»»åŠ¡å¤„ç†è¿‡ç¨‹å’Œå‘æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­æ’å…¥æ¶ˆæ¯ è¿™ä¸¤ä¸ªæ­¥éª¤æ”¾åœ¨ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­å®Œæˆ</strong>ã€‚å¦‚æœå‘æœ¬åœ°æ¶ˆæ¯è¡¨æ’å…¥æ¶ˆæ¯å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘å›æ»šï¼Œä¹‹å‰çš„ä»»åŠ¡å¤„ç†ç»“æœå°±ä¼šè¢«å–æ¶ˆã€‚<strong>æ¥ä¸‹æ¥ä¼šæœ‰ä¸€ä¸ªä¸“é—¨çš„æ¶ˆæ¯å‘é€è€…ä¸æ–­åœ°å‘é€æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­çš„æ¶ˆæ¯</strong>ï¼Œå¦‚æœå‘é€å¤±è´¥å®ƒä¼šè¿”å›é‡è¯•ã€‚å½“ç„¶ï¼Œä¹Ÿè¦ç»™æ¶ˆæ¯å‘é€è€…è®¾ç½®é‡è¯•çš„ä¸Šé™ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œè¾¾åˆ°é‡è¯•ä¸Šé™ä»ç„¶å‘é€å¤±è´¥ï¼Œé‚£å°±æ„å‘³ç€æ¶ˆæ¯ä¸­é—´ä»¶å‡ºç°ä¸¥é‡çš„é—®é¢˜ï¼Œæ­¤æ—¶ä¹Ÿåªæœ‰äººå·¥å¹²é¢„æ‰èƒ½è§£å†³é—®é¢˜ã€‚</p><p><code>å¯¹äºç¬¬äºŒç§æƒ…å†µ</code>ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶å…·æœ‰é‡è¯•æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¶ˆæ¯ä¸­é—´ä»¶ä¸­è®¾ç½®æ¶ˆæ¯çš„é‡è¯•æ¬¡æ•°å’Œé‡è¯•æ—¶é—´é—´éš”ï¼Œå¯¹äºç½‘ç»œä¸ç¨³å®šå¯¼è‡´çš„æ¶ˆæ¯æŠ•é€’å¤±è´¥çš„æƒ…å†µï¼Œå¾€å¾€é‡è¯•å‡ æ¬¡åæ¶ˆæ¯ä¾¿å¯ä»¥æˆåŠŸæŠ•é€’ï¼Œ<strong>å¦‚æœè¶…è¿‡äº†é‡è¯•çš„ä¸Šé™ä»ç„¶æŠ•é€’å¤±è´¥ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¸­é—´ä»¶ä¸å†æŠ•é€’è¯¥æ¶ˆæ¯ï¼Œè€Œæ˜¯è®°å½•åœ¨å¤±è´¥æ¶ˆæ¯è¡¨ä¸­ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶éœ€è¦æä¾›å¤±è´¥æ¶ˆæ¯çš„æŸ¥è¯¢æ¥å£ï¼Œä¸‹æ¸¸ç³»ç»Ÿä¼šå®šæœŸæŸ¥è¯¢å¤±è´¥æ¶ˆæ¯ï¼Œå¹¶å°†å…¶æ¶ˆè´¹ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œ<code>å®šæœŸæ ¡å¯¹</code>â€</strong>ã€‚</p><p>å¦‚æœé‡å¤æŠ•é€’å’Œå®šæœŸæ ¡å¯¹éƒ½ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå¾€å¾€æ˜¯å› ä¸ºä¸‹æ¸¸ç³»ç»Ÿå‡ºç°äº†ä¸¥é‡çš„é”™è¯¯ï¼Œæ­¤æ—¶å°±éœ€è¦äººå·¥å¹²é¢„ã€‚</p><h5 id="é€‚ç”¨åœºæ™¯-1"><a href="#é€‚ç”¨åœºæ™¯-1" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h5><p>äº¤æ˜“ç»“æœæ¶ˆæ¯çš„é€šçŸ¥ç­‰</p><h5 id="ä½¿ç”¨åˆ†æ"><a href="#ä½¿ç”¨åˆ†æ" class="headerlink" title="ä½¿ç”¨åˆ†æ"></a>ä½¿ç”¨åˆ†æ</h5><p>å¯¹äºä¸æ”¯æŒäº‹åŠ¡å‹æ¶ˆæ¯çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¦‚æœè¦å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„è¯ï¼Œå°±å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚å®ƒèƒ½å¤Ÿé€šè¿‡é‡è¯•æœºåˆ¶+å®šæœŸæ ¡å¯¹å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†ç›¸æ¯”äºç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œå®ƒè¾¾åˆ°<strong>æ•°æ®ä¸€è‡´æ€§çš„å‘¨æœŸè¾ƒé•¿</strong>ï¼Œè€Œä¸”è¿˜éœ€è¦åœ¨ä¸Šæ¸¸ç³»ç»Ÿä¸­å®ç°æ¶ˆæ¯é‡è¯•å‘å¸ƒæœºåˆ¶ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯æˆåŠŸå‘å¸ƒç»™æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œè¿™æ— ç–‘å¢åŠ äº†ä¸šåŠ¡ç³»ç»Ÿçš„å¼€å‘æˆæœ¬ï¼Œä½¿å¾—ä¸šåŠ¡ç³»ç»Ÿä¸å¤Ÿçº¯ç²¹ï¼Œå¹¶ä¸”è¿™äº›é¢å¤–çš„ä¸šåŠ¡é€»è¾‘æ— ç–‘ä¼šå ç”¨ä¸šåŠ¡ç³»ç»Ÿçš„ç¡¬ä»¶èµ„æºï¼Œä»è€Œå½±å“æ€§èƒ½ã€‚</p><p>å› æ­¤ï¼Œå°½é‡é€‰æ‹©æ”¯æŒäº‹åŠ¡å‹æ¶ˆæ¯çš„æ¶ˆæ¯ä¸­é—´ä»¶æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¦‚RocketMQã€‚è¿˜æœ‰å…¶ä»–çš„ä¸€äº›è§£å†³æ€è·¯ï¼Œè¿™é‡Œå°±æš‚æ—¶åªæè¿°è¿™äº›ã€‚åç»­å†å­¦ä¹ ã€‚</p><h2 id="Seateåº•å±‚åŸç†"><a href="#Seateåº•å±‚åŸç†" class="headerlink" title="Seateåº•å±‚åŸç†"></a>Seateåº•å±‚åŸç†</h2><p>1ã€å®ç°ä¸€ä¸ªTMï¼ˆTransaction Manager å…¨å±€äº‹åŠ¡ç®¡ç†å™¨ï¼‰å’Œä¸€ä¸ªRMï¼ˆResource Manager åˆ†æ”¯äº‹åŠ¡ç®¡ç†å™¨ï¼‰ï¼ŒåŸºäºNettyç”¨äºåè°ƒåˆ†æ”¯çš„æœ¬åœ°äº‹åŠ¡ã€‚</p><p>2ã€åˆ©ç”¨SpringAopå®ç°Datasourceç±»ä¸­Connectionåˆ‡é¢ï¼Œåœ¨commitæ—¶é€šè¿‡æ–°å¯ä¸€ä¸ªå­çº¿ç¨‹å®Œæˆé”ï¼Œå…¶ä»–äº‹åŠ¡commitç”±RMè¿›è¡Œè§£é”ã€‚</p><p>3ã€ç”±å‘èµ·è€…å¼€å¯ä¸€ä¸ªäº‹åŠ¡ç»„ï¼Œå¹¶è¿›è¡Œæ³¨å†Œï¼Œç”±RMé€šçŸ¥å‚ä¸è€…å®Œæˆæ³¨å†Œã€‚</p><h2 id="ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Ÿ"><a href="#ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Ÿ" class="headerlink" title="ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Ÿ"></a>ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Ÿ</h2><p>å¦‚æœä½ çœŸçš„è¢«é—®åˆ°ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼Œæˆ‘ä»¬æŸæŸç‰¹åˆ«ä¸¥æ ¼çš„åœºæ™¯ï¼Œç”¨çš„æ˜¯ TCC æ¥ä¿è¯å¼ºä¸€è‡´æ€§ï¼›ç„¶åå…¶ä»–çš„ä¸€äº›åœºæ™¯åŸºäºé˜¿é‡Œçš„ RocketMQ æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>ä½ æ‰¾ä¸€ä¸ªä¸¥æ ¼èµ„é‡‘è¦æ±‚ç»å¯¹ä¸èƒ½é”™çš„åœºæ™¯ï¼Œä½ å¯ä»¥è¯´ä½ æ˜¯ç”¨çš„ TCC æ–¹æ¡ˆï¼›å¦‚æœæ˜¯ä¸€èˆ¬çš„åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯ï¼Œè®¢å•æ’å…¥ä¹‹åè¦è°ƒç”¨åº“å­˜æœåŠ¡æ›´æ–°åº“å­˜ï¼Œåº“å­˜æ•°æ®æ²¡æœ‰èµ„é‡‘é‚£ä¹ˆçš„æ•æ„Ÿï¼Œå¯ä»¥ç”¨å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆã€‚</p><p>seateå®ç°å¯å‚è€ƒï¼šmallï¼ˆ<a href="https://github.com/macrozheng/mallï¼‰" target="_blank" rel="noopener">https://github.com/macrozheng/mallï¼‰</a></p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ·é‡æ•°æ®å¤„ç†</title>
      <link href="/2020/01/15/8.%20%E7%AE%97%E6%B3%95-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/"/>
      <url>/2020/01/15/8.%20%E7%AE%97%E6%B3%95-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="é‡è¦æ€æƒ³"><a href="#é‡è¦æ€æƒ³" class="headerlink" title="é‡è¦æ€æƒ³"></a>é‡è¦æ€æƒ³</h2><p>1ã€åˆ†æ²»æ³•ï¼Œhashè¿ç®—å°†æœ‰ç›¸åŒç‰¹å¾çš„å€¼æ”¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­</p><p>2ã€bitMapä½å›¾æ³•ï¼Œæ±‚è§£æ•°æ®é‡å¤é—®é¢˜</p><p>3ã€ä½¿ç”¨å †æ’åºï¼Œè§£å†³topNé—®é¢˜ï¼ŒPriorityQueueæ˜¯å †å®ç°çš„</p><p>4ã€HashMapç»Ÿè®¡æœ‰é™keyçš„valueæ¬¡æ•°ï¼ŒHashSetå»é‡</p><h2 id="å•ä½æ¢ç®—"><a href="#å•ä½æ¢ç®—" class="headerlink" title="å•ä½æ¢ç®—"></a>å•ä½æ¢ç®—</h2><p>1 <strong>GB</strong> â‰ˆ 10^3^ <strong>MB</strong> â‰ˆ 10^6^ <strong>KB</strong> â‰ˆ 10^9^ <strong>å­—èŠ‚</strong> â‰ˆ 8<em>10^9^ *</em>Bit**</p><p>1ä¸ªbitå­˜å‚¨ä¸€ä¸ªæ•°å­—</p><p>40äº¿ä¸ªæ•° 40<em>10^8^Ã·8\</em>10^9^=5G</p><h2 id="å¦‚ä½•ä»å¤§é‡çš„-URL-ä¸­æ‰¾å‡ºç›¸åŒçš„-URLï¼Ÿ"><a href="#å¦‚ä½•ä»å¤§é‡çš„-URL-ä¸­æ‰¾å‡ºç›¸åŒçš„-URLï¼Ÿ" class="headerlink" title="å¦‚ä½•ä»å¤§é‡çš„ URL ä¸­æ‰¾å‡ºç›¸åŒçš„ URLï¼Ÿ"></a>å¦‚ä½•ä»å¤§é‡çš„ URL ä¸­æ‰¾å‡ºç›¸åŒçš„ URLï¼Ÿ</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ç»™å®š aã€b ä¸¤ä¸ªæ–‡ä»¶ï¼Œå„å­˜æ”¾ 50 äº¿ä¸ª URLï¼Œæ¯ä¸ª URL å„å  64Bï¼Œå†…å­˜é™åˆ¶æ˜¯ 4Gã€‚è¯·æ‰¾å‡º aã€b ä¸¤ä¸ªæ–‡ä»¶å…±åŒçš„ URLã€‚</p><h3 id="è§£ç­”æ€è·¯"><a href="#è§£ç­”æ€è·¯" class="headerlink" title="è§£ç­”æ€è·¯"></a>è§£ç­”æ€è·¯</h3><p>æ¯ä¸ª URL å  64Bï¼Œé‚£ä¹ˆ 50 äº¿ä¸ª URLå ç”¨çš„ç©ºé—´å¤§å°çº¦ä¸º 320GBã€‚</p><blockquote><p>5, 000, 000, 000 * 64B â‰ˆ 5GB * 64 = 320GB</p></blockquote><p>ç”±äºå†…å­˜å¤§å°åªæœ‰ 4Gï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¸å¯èƒ½ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰ URL åŠ è½½åˆ°å†…å­˜ä¸­å¤„ç†ã€‚å¯¹äºè¿™ç§ç±»å‹çš„é¢˜ç›®ï¼Œä¸€èˆ¬é‡‡ç”¨<strong>åˆ†æ²»ç­–ç•¥</strong>ï¼Œå³ï¼šæŠŠä¸€ä¸ªæ–‡ä»¶ä¸­çš„ URL æŒ‰ç…§æŸä¸ªç‰¹å¾åˆ’åˆ†ä¸ºå¤šä¸ªå°æ–‡ä»¶ï¼Œä½¿å¾—æ¯ä¸ªå°æ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 4Gï¼Œè¿™æ ·å°±å¯ä»¥æŠŠè¿™ä¸ªå°æ–‡ä»¶è¯»åˆ°å†…å­˜ä¸­è¿›è¡Œå¤„ç†äº†ã€‚</p><p><strong>æ€è·¯å¦‚ä¸‹</strong>ï¼š</p><p>==ç‰¹ç‚¹ï¼šé€šè¿‡hashè¿ç®—å°†æœ‰ç›¸åŒç‰¹å¾çš„å€¼æ”¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­==</p><p>é¦–å…ˆéå†æ–‡ä»¶ aï¼Œå¯¹éå†åˆ°çš„ URL æ±‚ <code>hash(URL) % 1000</code> ï¼Œæ ¹æ®è®¡ç®—ç»“æœæŠŠéå†åˆ°çš„ URL å­˜å‚¨åˆ° a0, a1, a2, â€¦, a999ï¼Œè¿™æ ·æ¯ä¸ªå¤§å°çº¦ä¸º 300MBã€‚ä½¿ç”¨åŒæ ·çš„æ–¹æ³•éå†æ–‡ä»¶ bï¼ŒæŠŠæ–‡ä»¶ b ä¸­çš„ URL åˆ†åˆ«å­˜å‚¨åˆ°æ–‡ä»¶ b0, b1, b2, â€¦, b999 ä¸­ã€‚è¿™æ ·å¤„ç†è¿‡åï¼Œæ‰€æœ‰å¯èƒ½ç›¸åŒçš„ URL éƒ½åœ¨å¯¹åº”çš„å°æ–‡ä»¶ä¸­ï¼Œå³ a0 å¯¹åº” b0, â€¦, a999 å¯¹åº” b999ï¼Œä¸å¯¹åº”çš„å°æ–‡ä»¶ä¸å¯èƒ½æœ‰ç›¸åŒçš„ URLã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦æ±‚å‡ºè¿™ 1000 å¯¹å°æ–‡ä»¶ä¸­ç›¸åŒçš„ URL å°±å¥½äº†ã€‚</p><p>æ¥ç€éå† ai( <code>iâˆˆ[0,999]</code> )ï¼ŒæŠŠ URL å­˜å‚¨åˆ°ä¸€ä¸ª HashSet é›†åˆä¸­ã€‚ç„¶åéå† bi ä¸­æ¯ä¸ª URLï¼Œçœ‹åœ¨ HashSet é›†åˆä¸­æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨ï¼Œè¯´æ˜è¿™å°±æ˜¯å…±åŒçš„ URLï¼Œå¯ä»¥æŠŠè¿™ä¸ª URL ä¿å­˜åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚</p><h3 id="æ–¹æ³•æ€»ç»“"><a href="#æ–¹æ³•æ€»ç»“" class="headerlink" title="æ–¹æ³•æ€»ç»“"></a>æ–¹æ³•æ€»ç»“</h3><ol><li>åˆ†è€Œæ²»ä¹‹ï¼Œè¿›è¡Œå“ˆå¸Œå–ä½™ï¼›</li><li>å¯¹æ¯ä¸ªå­æ–‡ä»¶è¿›è¡Œ HashSet ç»Ÿè®¡ã€‚</li></ol><hr><h2 id="å¦‚ä½•ä»å¤§é‡æ•°æ®ä¸­æ‰¾å‡ºé«˜é¢‘è¯ï¼Ÿ"><a href="#å¦‚ä½•ä»å¤§é‡æ•°æ®ä¸­æ‰¾å‡ºé«˜é¢‘è¯ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä»å¤§é‡æ•°æ®ä¸­æ‰¾å‡ºé«˜é¢‘è¯ï¼Ÿ"></a>å¦‚ä½•ä»å¤§é‡æ•°æ®ä¸­æ‰¾å‡ºé«˜é¢‘è¯ï¼Ÿ</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>æœ‰ä¸€ä¸ª 1GB å¤§å°çš„æ–‡ä»¶ï¼Œæ–‡ä»¶é‡Œæ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªè¯ï¼Œæ¯ä¸ªè¯çš„å¤§å°ä¸è¶…è¿‡ 16Bï¼Œå†…å­˜å¤§å°é™åˆ¶æ˜¯ 1MBï¼Œè¦æ±‚è¿”å›é¢‘æ•°æœ€é«˜çš„ 100 ä¸ªè¯(Top 100)ã€‚</p><h3 id="è§£ç­”æ€è·¯-1"><a href="#è§£ç­”æ€è·¯-1" class="headerlink" title="è§£ç­”æ€è·¯"></a>è§£ç­”æ€è·¯</h3><p>ç”±äºå†…å­˜é™åˆ¶ï¼Œæˆ‘ä»¬ä¾ç„¶æ— æ³•ç›´æ¥å°†å¤§æ–‡ä»¶çš„æ‰€æœ‰è¯ä¸€æ¬¡è¯»åˆ°å†…å­˜ä¸­ã€‚å› æ­¤ï¼ŒåŒæ ·å¯ä»¥é‡‡ç”¨<strong>åˆ†æ²»ç­–ç•¥</strong>ï¼ŒæŠŠä¸€ä¸ªå¤§æ–‡ä»¶åˆ†è§£æˆå¤šä¸ªå°æ–‡ä»¶ï¼Œä¿è¯æ¯ä¸ªæ–‡ä»¶çš„å¤§å°å°äº 1MBï¼Œè¿›è€Œç›´æ¥å°†å•ä¸ªå°æ–‡ä»¶è¯»å–åˆ°å†…å­˜ä¸­è¿›è¡Œå¤„ç†ã€‚</p><p><strong>æ€è·¯å¦‚ä¸‹</strong>ï¼š</p><p>==ç‰¹ç‚¹ï¼šé€šè¿‡hashè¿ç®—å°†æœ‰ç›¸åŒç‰¹å¾çš„å€¼æ”¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­==</p><p>é¦–å…ˆéå†å¤§æ–‡ä»¶ï¼Œå¯¹éå†åˆ°çš„æ¯ä¸ªè¯xï¼Œæ‰§è¡Œ <code>hash(x) % 5000</code> ï¼Œå°†ç»“æœä¸º i çš„è¯å­˜æ”¾åˆ°æ–‡ä»¶ ai ä¸­ã€‚éå†ç»“æŸåï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° 5000 ä¸ªå°æ–‡ä»¶ã€‚æ¯ä¸ªå°æ–‡ä»¶çš„å¤§å°ä¸º 200KB å·¦å³ã€‚å¦‚æœæœ‰çš„å°æ–‡ä»¶å¤§å°ä»ç„¶è¶…è¿‡ 1MBï¼Œåˆ™é‡‡ç”¨åŒæ ·çš„æ–¹å¼ç»§ç»­è¿›è¡Œåˆ†è§£ã€‚</p><p>æ¥ç€ç»Ÿè®¡æ¯ä¸ªå°æ–‡ä»¶ä¸­å‡ºç°é¢‘æ•°æœ€é«˜çš„ 100 ä¸ªè¯ã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ HashMap æ¥å®ç°ã€‚å…¶ä¸­ key ä¸ºè¯ï¼Œvalue ä¸ºè¯¥è¯å‡ºç°çš„é¢‘ç‡ã€‚å…·ä½“æ–¹æ³•æ˜¯ï¼šå¯¹äºéå†åˆ°çš„è¯ xï¼Œå¦‚æœåœ¨ map ä¸­ä¸å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œ <code>map.put(x, 1)</code> ï¼›è‹¥å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œ <code>map.put(x, map.get(x)+1)</code> ï¼Œå°†è¯¥è¯é¢‘æ•°åŠ  1ã€‚</p><p>ä¸Šé¢æˆ‘ä»¬ç»Ÿè®¡äº†æ¯ä¸ªå°æ–‡ä»¶å•è¯å‡ºç°çš„é¢‘æ•°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»´æŠ¤ä¸€ä¸ª<strong>å°é¡¶å †</strong>æ¥æ‰¾å‡ºæ‰€æœ‰è¯ä¸­å‡ºç°é¢‘æ•°æœ€é«˜çš„ 100 ä¸ªã€‚å…·ä½“æ–¹æ³•æ˜¯ï¼šä¾æ¬¡éå†æ¯ä¸ªå°æ–‡ä»¶ï¼Œæ„å»ºä¸€ä¸ª<strong>å°é¡¶å †</strong>ï¼Œå †å¤§å°ä¸º 100ã€‚å¦‚æœéå†åˆ°çš„è¯çš„å‡ºç°æ¬¡æ•°å¤§äºå †é¡¶è¯çš„å‡ºç°æ¬¡æ•°ï¼Œåˆ™ç”¨æ–°è¯æ›¿æ¢å †é¡¶çš„è¯ï¼Œç„¶åé‡æ–°è°ƒæ•´ä¸º<strong>å°é¡¶å †</strong>ï¼Œéå†ç»“æŸåï¼Œå°é¡¶å †ä¸Šçš„è¯å°±æ˜¯å‡ºç°é¢‘æ•°æœ€é«˜çš„ 100 ä¸ªè¯ã€‚</p><p>PriorityQueueåº•å±‚ç”±å°é¡¶å †å®ç°ï¼Œé€šè¿‡é‡å†™compareè½¬å˜æˆå¤§é¡¶å †ã€‚</p><h3 id="æ–¹æ³•æ€»ç»“-1"><a href="#æ–¹æ³•æ€»ç»“-1" class="headerlink" title="æ–¹æ³•æ€»ç»“"></a>æ–¹æ³•æ€»ç»“</h3><ol><li>åˆ†è€Œæ²»ä¹‹ï¼Œè¿›è¡Œå“ˆå¸Œå–ä½™ï¼›</li><li>ä½¿ç”¨ HashMap ç»Ÿè®¡é¢‘æ•°ï¼›</li><li>æ±‚è§£<strong>æœ€å¤§</strong>çš„ TopN ä¸ªï¼Œç”¨<strong>å°é¡¶å †</strong>ï¼›æ±‚è§£<strong>æœ€å°</strong>çš„ TopN ä¸ªï¼Œç”¨<strong>å¤§é¡¶å †</strong>ã€‚</li></ol><hr><h2 id="å¦‚ä½•æ‰¾å‡ºæŸä¸€å¤©è®¿é—®ç™¾åº¦ç½‘ç«™æœ€å¤šçš„-IPï¼Ÿ"><a href="#å¦‚ä½•æ‰¾å‡ºæŸä¸€å¤©è®¿é—®ç™¾åº¦ç½‘ç«™æœ€å¤šçš„-IPï¼Ÿ" class="headerlink" title="å¦‚ä½•æ‰¾å‡ºæŸä¸€å¤©è®¿é—®ç™¾åº¦ç½‘ç«™æœ€å¤šçš„ IPï¼Ÿ"></a>å¦‚ä½•æ‰¾å‡ºæŸä¸€å¤©è®¿é—®ç™¾åº¦ç½‘ç«™æœ€å¤šçš„ IPï¼Ÿ</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ç°æœ‰æµ·é‡æ—¥å¿—æ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªè¶…å¤§æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶æ— æ³•ç›´æ¥è¯»å…¥å†…å­˜ï¼Œè¦æ±‚ä»ä¸­æå–æŸå¤©è®¿é—®ç™¾åº¦æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ª IPã€‚</p><h3 id="è§£ç­”æ€è·¯-2"><a href="#è§£ç­”æ€è·¯-2" class="headerlink" title="è§£ç­”æ€è·¯"></a>è§£ç­”æ€è·¯</h3><p>==ç‰¹ç‚¹ï¼šé€šè¿‡hashè¿ç®—å°†æœ‰ç›¸åŒç‰¹å¾çš„å€¼æ”¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­==</p><p>è¿™é“é¢˜åªå…³å¿ƒæŸä¸€å¤©è®¿é—®ç™¾åº¦æœ€å¤šçš„ IPï¼Œå› æ­¤ï¼Œå¯ä»¥é¦–å…ˆå¯¹æ–‡ä»¶è¿›è¡Œä¸€æ¬¡éå†ï¼ŒæŠŠè¿™ä¸€å¤©è®¿é—®ç™¾åº¦ IP çš„ç›¸å…³ä¿¡æ¯è®°å½•åˆ°ä¸€ä¸ªå•ç‹¬çš„å¤§æ–‡ä»¶ä¸­ã€‚æ¥ä¸‹æ¥é‡‡ç”¨çš„æ–¹æ³•ä¸ä¸Šä¸€é¢˜ä¸€æ ·ï¼Œå¤§è‡´å°±æ˜¯å…ˆå¯¹ IP è¿›è¡Œå“ˆå¸Œæ˜ å°„ï¼Œæ¥ç€ä½¿ç”¨ HashMap ç»Ÿè®¡é‡å¤ IP çš„æ¬¡æ•°ï¼Œæœ€åè®¡ç®—å‡ºé‡å¤æ¬¡æ•°æœ€å¤šçš„ IPã€‚</p><blockquote><p>æ³¨ï¼šè¿™é‡Œåªéœ€è¦æ‰¾å‡ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„ IPï¼Œå¯ä»¥ä¸å¿…ä½¿ç”¨å †ï¼Œç›´æ¥ç”¨ä¸€ä¸ªå˜é‡ max å³å¯ã€‚</p></blockquote><h3 id="æ–¹æ³•æ€»ç»“-2"><a href="#æ–¹æ³•æ€»ç»“-2" class="headerlink" title="æ–¹æ³•æ€»ç»“"></a>æ–¹æ³•æ€»ç»“</h3><ol><li>åˆ†è€Œæ²»ä¹‹ï¼Œè¿›è¡Œå“ˆå¸Œå–ä½™ï¼›</li><li>ä½¿ç”¨ HashMap ç»Ÿè®¡é¢‘æ•°ï¼›</li><li>æ±‚è§£<strong>æœ€å¤§</strong>çš„ TopN ä¸ªï¼Œç”¨<strong>å°é¡¶å †</strong>ï¼›æ±‚è§£<strong>æœ€å°</strong>çš„ TopN ä¸ªï¼Œç”¨<strong>å¤§é¡¶å †</strong>ã€‚</li></ol><hr><h2 id="å¦‚ä½•åœ¨å¤§é‡çš„æ•°æ®ä¸­æ‰¾å‡ºä¸é‡å¤çš„æ•´æ•°ï¼Ÿ"><a href="#å¦‚ä½•åœ¨å¤§é‡çš„æ•°æ®ä¸­æ‰¾å‡ºä¸é‡å¤çš„æ•´æ•°ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨å¤§é‡çš„æ•°æ®ä¸­æ‰¾å‡ºä¸é‡å¤çš„æ•´æ•°ï¼Ÿ"></a>å¦‚ä½•åœ¨å¤§é‡çš„æ•°æ®ä¸­æ‰¾å‡ºä¸é‡å¤çš„æ•´æ•°ï¼Ÿ</h2><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>åœ¨ 2.5 äº¿ä¸ªæ•´æ•°ä¸­æ‰¾å‡ºä¸é‡å¤çš„æ•´æ•°ã€‚æ³¨æ„ï¼šå†…å­˜ä¸è¶³ä»¥å®¹çº³è¿™ 2.5 äº¿ä¸ªæ•´æ•°ã€‚</p><h3 id="è§£ç­”æ€è·¯-3"><a href="#è§£ç­”æ€è·¯-3" class="headerlink" title="è§£ç­”æ€è·¯"></a>è§£ç­”æ€è·¯</h3><h4 id="æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•"><a href="#æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•" class="headerlink" title="æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•"></a>æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•</h4><p>ä¸å‰é¢çš„é¢˜ç›®æ–¹æ³•ç±»ä¼¼ï¼Œå…ˆå°† 2.5 äº¿ä¸ªæ•°åˆ’åˆ†åˆ°å¤šä¸ªå°æ–‡ä»¶ï¼Œç”¨ HashSet/HashMap æ‰¾å‡ºæ¯ä¸ªå°æ–‡ä»¶ä¸­ä¸é‡å¤çš„æ•´æ•°ï¼Œå†åˆå¹¶æ¯ä¸ªå­ç»“æœï¼Œå³ä¸ºæœ€ç»ˆç»“æœã€‚</p><h4 id="æ–¹æ³•äºŒï¼šä½å›¾æ³•"><a href="#æ–¹æ³•äºŒï¼šä½å›¾æ³•" class="headerlink" title="æ–¹æ³•äºŒï¼šä½å›¾æ³•"></a>æ–¹æ³•äºŒï¼šä½å›¾æ³•</h4><p><strong>ä½å›¾</strong>ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª bit æ¥æ ‡è®°æŸä¸ªå…ƒç´ å¯¹åº”çš„å€¼ï¼Œè€Œé”®å°±æ˜¯è¯¥å…ƒç´ ã€‚é‡‡ç”¨ä½ä½œä¸ºå•ä½æ¥å­˜å‚¨æ•°æ®ï¼Œå¯ä»¥å¤§å¤§èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p><p>ä½å›¾é€šè¿‡ä½¿ç”¨ä½æ•°ç»„æ¥è¡¨ç¤ºæŸäº›å…ƒç´ æ˜¯å¦å­˜åœ¨ã€‚å®ƒå¯ä»¥ç”¨äºå¿«é€ŸæŸ¥æ‰¾ï¼Œåˆ¤é‡ï¼Œæ’åºç­‰ã€‚ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Ÿæˆ‘å…ˆä¸¾ä¸ªå°ä¾‹å­ã€‚</p><p>å‡è®¾æˆ‘ä»¬è¦å¯¹ <code>[0,7]</code> ä¸­çš„ 5 ä¸ªå…ƒç´  (6, 4, 2, 1, 5) è¿›è¡Œæ’åºï¼Œå¯ä»¥é‡‡ç”¨ä½å›¾æ³•ã€‚0~7 èŒƒå›´æ€»å…±æœ‰ 8 ä¸ªæ•°ï¼Œåªéœ€è¦ 8bitï¼Œå³ 1 ä¸ªå­—èŠ‚ã€‚é¦–å…ˆå°†æ¯ä¸ªä½éƒ½ç½® 0ï¼š</p><pre><code>0 0 0 0 0 0 0 0</code></pre><p>ç„¶åéå† 5 ä¸ªå…ƒç´ ï¼Œé¦–å…ˆé‡åˆ° 6ï¼Œé‚£ä¹ˆå°†ä¸‹æ ‡ä¸º 6 çš„ä½çš„ 0 ç½®ä¸º 1ï¼›æ¥ç€é‡åˆ° 4ï¼ŒæŠŠä¸‹æ ‡ä¸º 4 çš„ä½ çš„ 0 ç½®ä¸º 1ï¼š</p><pre><code>0 0 0 0 1 0 1 0</code></pre><p>ä¾æ¬¡éå†ï¼Œç»“æŸåï¼Œä½æ•°ç»„æ˜¯è¿™æ ·çš„ï¼š</p><pre><code>0 1 1 0 1 1 1 0</code></pre><p>æ¯ä¸ªä¸º 1 çš„ä½ï¼Œå®ƒçš„ä¸‹æ ‡éƒ½è¡¨ç¤ºäº†ä¸€ä¸ªæ•°ï¼š</p><pre><code>for i in range(8):    if bits[i] == 1:        print(i)</code></pre><p>è¿™æ ·æˆ‘ä»¬å…¶å®å°±å·²ç»å®ç°äº†æ’åºã€‚</p><p>å¯¹äºæ•´æ•°ç›¸å…³çš„ç®—æ³•çš„æ±‚è§£ï¼Œ<strong>ä½å›¾æ³•</strong>æ˜¯ä¸€ç§éå¸¸å®ç”¨çš„ç®—æ³•ã€‚å‡è®¾ int æ•´æ•°å ç”¨ 4Bï¼Œå³ 32bitï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¡¨ç¤ºçš„æ•´æ•°çš„ä¸ªæ•°ä¸º 232ã€‚</p><p><strong>é‚£ä¹ˆå¯¹äºè¿™é“é¢˜</strong>ï¼Œæˆ‘ä»¬ç”¨ 2 ä¸ª bit æ¥è¡¨ç¤ºå„ä¸ªæ•°å­—çš„çŠ¶æ€ï¼š</p><ul><li>00 è¡¨ç¤ºè¿™ä¸ªæ•°å­—æ²¡å‡ºç°è¿‡ï¼›</li><li>01 è¡¨ç¤ºè¿™ä¸ªæ•°å­—å‡ºç°è¿‡ä¸€æ¬¡ï¼ˆå³ä¸ºé¢˜ç›®æ‰€æ‰¾çš„ä¸é‡å¤æ•´æ•°ï¼‰ï¼›</li><li>10 è¡¨ç¤ºè¿™ä¸ªæ•°å­—å‡ºç°äº†å¤šæ¬¡ã€‚</li></ul><p>é‚£ä¹ˆè¿™ 232 ä¸ªæ•´æ•°ï¼Œæ€»å…±æ‰€éœ€å†…å­˜ä¸º 232*2b=1GBã€‚å› æ­¤ï¼Œå½“å¯ç”¨å†…å­˜è¶…è¿‡ 1GB æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ä½å›¾æ³•ã€‚å‡è®¾å†…å­˜æ»¡è¶³ä½å›¾æ³•éœ€æ±‚ï¼Œè¿›è¡Œä¸‹é¢çš„æ“ä½œï¼š</p><p>éå† 2.5 äº¿ä¸ªæ•´æ•°ï¼ŒæŸ¥çœ‹ä½å›¾ä¸­å¯¹åº”çš„ä½ï¼Œå¦‚æœæ˜¯ 00ï¼Œåˆ™å˜ä¸º 01ï¼Œå¦‚æœæ˜¯ 01 åˆ™å˜ä¸º 10ï¼Œå¦‚æœæ˜¯ 10 åˆ™ä¿æŒä¸å˜ã€‚éå†ç»“æŸåï¼ŒæŸ¥çœ‹ä½å›¾ï¼ŒæŠŠå¯¹åº”ä½æ˜¯ 01 çš„æ•´æ•°è¾“å‡ºå³å¯ã€‚</p><h3 id="æ–¹æ³•æ€»ç»“-3"><a href="#æ–¹æ³•æ€»ç»“-3" class="headerlink" title="æ–¹æ³•æ€»ç»“"></a>æ–¹æ³•æ€»ç»“</h3><p><strong>åˆ¤æ–­æ•°å­—æ˜¯å¦é‡å¤çš„é—®é¢˜</strong>ï¼Œä½å›¾æ³•æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„æ–¹æ³•ã€‚</p><hr><h2 id="å¦‚ä½•åœ¨å¤§é‡æ•°æ®ä¸­åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦å­˜åœ¨ï¼Ÿ"><a href="#å¦‚ä½•åœ¨å¤§é‡æ•°æ®ä¸­åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦å­˜åœ¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨å¤§é‡æ•°æ®ä¸­åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦å­˜åœ¨ï¼Ÿ"></a>å¦‚ä½•åœ¨å¤§é‡æ•°æ®ä¸­åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦å­˜åœ¨ï¼Ÿ</h2><h3 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ç»™å®š 40 äº¿ä¸ªä¸é‡å¤çš„æ²¡æ’è¿‡åºçš„ unsigned int å‹æ•´æ•°ï¼Œç„¶åå†ç»™å®šä¸€ä¸ªæ•°ï¼Œå¦‚ä½•å¿«é€Ÿåˆ¤æ–­è¿™ä¸ªæ•°æ˜¯å¦åœ¨è¿™ 40 äº¿ä¸ªæ•´æ•°å½“ä¸­ï¼Ÿ</p><h3 id="è§£ç­”æ€è·¯-4"><a href="#è§£ç­”æ€è·¯-4" class="headerlink" title="è§£ç­”æ€è·¯"></a>è§£ç­”æ€è·¯</h3><h4 id="æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•-1"><a href="#æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•-1" class="headerlink" title="æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•"></a>æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•</h4><p>ä¾ç„¶å¯ä»¥ç”¨åˆ†æ²»æ³•è§£å†³ï¼Œæ–¹æ³•ä¸å‰é¢ç±»ä¼¼ï¼Œå°±ä¸å†æ¬¡èµ˜è¿°äº†ã€‚</p><h4 id="æ–¹æ³•äºŒï¼šä½å›¾æ³•-1"><a href="#æ–¹æ³•äºŒï¼šä½å›¾æ³•-1" class="headerlink" title="æ–¹æ³•äºŒï¼šä½å›¾æ³•"></a>æ–¹æ³•äºŒï¼šä½å›¾æ³•</h4><p>40 äº¿ä¸ªä¸é‡å¤æ•´æ•°ï¼Œæˆ‘ä»¬ç”¨ 40 äº¿ä¸ª bit æ¥è¡¨ç¤ºï¼Œåˆå§‹ä½å‡ä¸º 0ï¼Œé‚£ä¹ˆæ€»å…±éœ€è¦å†…å­˜ï¼š4, 000, 000, 000bâ‰ˆ512Mã€‚</p><p>æˆ‘ä»¬è¯»å–è¿™ 40 äº¿ä¸ªæ•´æ•°ï¼Œå°†å¯¹åº”çš„ bit è®¾ç½®ä¸º 1ã€‚æ¥ç€è¯»å–è¦æŸ¥è¯¢çš„æ•°ï¼ŒæŸ¥çœ‹ç›¸åº”ä½æ˜¯å¦ä¸º 1ï¼Œå¦‚æœä¸º 1 è¡¨ç¤ºå­˜åœ¨ï¼Œå¦‚æœä¸º 0 è¡¨ç¤ºä¸å­˜åœ¨ã€‚</p><h3 id="æ–¹æ³•æ€»ç»“-4"><a href="#æ–¹æ³•æ€»ç»“-4" class="headerlink" title="æ–¹æ³•æ€»ç»“"></a>æ–¹æ³•æ€»ç»“</h3><p><strong>åˆ¤æ–­æ•°å­—æ˜¯å¦å­˜åœ¨ã€åˆ¤æ–­æ•°å­—æ˜¯å¦é‡å¤çš„é—®é¢˜</strong>ï¼Œä½å›¾æ³•æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„æ–¹æ³•ã€‚</p><hr><h2 id="å¦‚ä½•æŸ¥è¯¢æœ€çƒ­é—¨çš„æŸ¥è¯¢ä¸²ï¼Ÿ"><a href="#å¦‚ä½•æŸ¥è¯¢æœ€çƒ­é—¨çš„æŸ¥è¯¢ä¸²ï¼Ÿ" class="headerlink" title="å¦‚ä½•æŸ¥è¯¢æœ€çƒ­é—¨çš„æŸ¥è¯¢ä¸²ï¼Ÿ"></a>å¦‚ä½•æŸ¥è¯¢æœ€çƒ­é—¨çš„æŸ¥è¯¢ä¸²ï¼Ÿ</h2><h3 id="é¢˜ç›®æè¿°-5"><a href="#é¢˜ç›®æè¿°-5" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>æœç´¢å¼•æ“ä¼šé€šè¿‡æ—¥å¿—æ–‡ä»¶æŠŠç”¨æˆ·æ¯æ¬¡æ£€ç´¢ä½¿ç”¨çš„æ‰€æœ‰æŸ¥è¯¢ä¸²éƒ½è®°å½•ä¸‹æ¥ï¼Œæ¯ä¸ªæŸ¥è¯¢ä¸²çš„é•¿åº¦ä¸è¶…è¿‡ 255 å­—èŠ‚ã€‚</p><p>å‡è®¾ç›®å‰æœ‰ 1000w ä¸ªè®°å½•ï¼ˆè¿™äº›æŸ¥è¯¢ä¸²çš„é‡å¤åº¦æ¯”è¾ƒé«˜ï¼Œè™½ç„¶æ€»æ•°æ˜¯ 1000wï¼Œä½†å¦‚æœé™¤å»é‡å¤åï¼Œåˆ™ä¸è¶…è¿‡ 300w ä¸ªï¼‰ã€‚è¯·ç»Ÿè®¡æœ€çƒ­é—¨çš„ 10 ä¸ªæŸ¥è¯¢ä¸²ï¼Œè¦æ±‚ä½¿ç”¨çš„å†…å­˜ä¸èƒ½è¶…è¿‡ 1Gã€‚ï¼ˆä¸€ä¸ªæŸ¥è¯¢ä¸²çš„é‡å¤åº¦è¶Šé«˜ï¼Œè¯´æ˜æŸ¥è¯¢å®ƒçš„ç”¨æˆ·è¶Šå¤šï¼Œä¹Ÿå°±è¶Šçƒ­é—¨ã€‚ï¼‰</p><h3 id="è§£ç­”æ€è·¯-5"><a href="#è§£ç­”æ€è·¯-5" class="headerlink" title="è§£ç­”æ€è·¯"></a>è§£ç­”æ€è·¯</h3><p>æ¯ä¸ªæŸ¥è¯¢ä¸²æœ€é•¿ä¸º 255Bï¼Œ1000w ä¸ªä¸²éœ€è¦å ç”¨ çº¦ 2.55G å†…å­˜ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æ— æ³•å°†æ‰€æœ‰å­—ç¬¦ä¸²å…¨éƒ¨è¯»å…¥åˆ°å†…å­˜ä¸­å¤„ç†ã€‚</p><h4 id="æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•-2"><a href="#æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•-2" class="headerlink" title="æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•"></a>æ–¹æ³•ä¸€ï¼šåˆ†æ²»æ³•</h4><p>åˆ†æ²»æ³•ä¾ç„¶æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„æ–¹æ³•ã€‚</p><p>åˆ’åˆ†ä¸ºå¤šä¸ªå°æ–‡ä»¶ï¼Œä¿è¯å•ä¸ªå°æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²èƒ½è¢«ç›´æ¥åŠ è½½åˆ°å†…å­˜ä¸­å¤„ç†ï¼Œç„¶åæ±‚å‡ºæ¯ä¸ªæ–‡ä»¶ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„ 10 ä¸ªå­—ç¬¦ä¸²ï¼›æœ€åé€šè¿‡ä¸€ä¸ªå°é¡¶å †ç»Ÿè®¡å‡ºæ‰€æœ‰æ–‡ä»¶ä¸­å‡ºç°æœ€å¤šçš„ 10 ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>æ–¹æ³•å¯è¡Œï¼Œä½†ä¸æ˜¯æœ€å¥½ï¼Œä¸‹é¢ä»‹ç»å…¶ä»–æ–¹æ³•ã€‚</p><h4 id="æ–¹æ³•äºŒï¼šHashMap-æ³•"><a href="#æ–¹æ³•äºŒï¼šHashMap-æ³•" class="headerlink" title="æ–¹æ³•äºŒï¼šHashMap æ³•"></a>æ–¹æ³•äºŒï¼šHashMap æ³•</h4><p>è™½ç„¶å­—ç¬¦ä¸²æ€»æ•°æ¯”è¾ƒå¤šï¼Œä½†å»é‡åä¸è¶…è¿‡ 300wï¼Œå› æ­¤ï¼Œå¯ä»¥è€ƒè™‘æŠŠæ‰€æœ‰å­—ç¬¦ä¸²åŠå‡ºç°æ¬¡æ•°ä¿å­˜åœ¨ä¸€ä¸ª HashMap ä¸­ï¼Œæ‰€å ç”¨çš„ç©ºé—´ä¸º 300w*(255+4)â‰ˆ777Mï¼ˆå…¶ä¸­ï¼Œ4è¡¨ç¤ºæ•´æ•°å ç”¨çš„4ä¸ªå­—èŠ‚ï¼‰ã€‚ç”±æ­¤å¯è§ï¼Œ1G çš„å†…å­˜ç©ºé—´å®Œå…¨å¤Ÿç”¨ã€‚</p><p><strong>æ€è·¯å¦‚ä¸‹</strong>ï¼š</p><p>é¦–å…ˆï¼Œéå†å­—ç¬¦ä¸²ï¼Œè‹¥ä¸åœ¨ map ä¸­ï¼Œç›´æ¥å­˜å…¥ mapï¼Œvalue è®°ä¸º 1ï¼›è‹¥åœ¨ map ä¸­ï¼Œåˆ™æŠŠå¯¹åº”çš„ value åŠ  1ï¼Œè¿™ä¸€æ­¥æ—¶é—´å¤æ‚åº¦ <code>O(N)</code> ã€‚</p><p>æ¥ç€éå† mapï¼Œæ„å»ºä¸€ä¸ª 10 ä¸ªå…ƒç´ çš„å°é¡¶å †ï¼Œè‹¥éå†åˆ°çš„å­—ç¬¦ä¸²çš„å‡ºç°æ¬¡æ•°å¤§äºå †é¡¶å­—ç¬¦ä¸²çš„å‡ºç°æ¬¡æ•°ï¼Œåˆ™è¿›è¡Œæ›¿æ¢ï¼Œå¹¶å°†å †è°ƒæ•´ä¸ºå°é¡¶å †ã€‚</p><p>éå†ç»“æŸåï¼Œå †ä¸­ 10 ä¸ªå­—ç¬¦ä¸²å°±æ˜¯å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—ç¬¦ä¸²ã€‚è¿™ä¸€æ­¥æ—¶é—´å¤æ‚åº¦ <code>O(Nlog10)</code> ã€‚</p><h4 id="æ–¹æ³•ä¸‰ï¼šå‰ç¼€æ ‘æ³•"><a href="#æ–¹æ³•ä¸‰ï¼šå‰ç¼€æ ‘æ³•" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šå‰ç¼€æ ‘æ³•"></a>æ–¹æ³•ä¸‰ï¼šå‰ç¼€æ ‘æ³•</h4><p>æ–¹æ³•äºŒä½¿ç”¨äº† HashMap æ¥ç»Ÿè®¡æ¬¡æ•°ï¼Œå½“è¿™äº›å­—ç¬¦ä¸²æœ‰å¤§é‡ç›¸åŒå‰ç¼€æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å‰ç¼€æ ‘æ¥ç»Ÿè®¡å­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°ï¼Œæ ‘çš„ç»“ç‚¹ä¿å­˜å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°ï¼Œ0 è¡¨ç¤ºæ²¡æœ‰å‡ºç°ã€‚</p><p><strong>æ€è·¯å¦‚ä¸‹</strong>ï¼š</p><p>åœ¨éå†å­—ç¬¦ä¸²æ—¶ï¼Œåœ¨å‰ç¼€æ ‘ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™æŠŠç»“ç‚¹ä¸­ä¿å­˜çš„å­—ç¬¦ä¸²æ¬¡æ•°åŠ  1ï¼Œå¦åˆ™ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²æ„å»ºæ–°ç»“ç‚¹ï¼Œæ„å»ºå®ŒæˆåæŠŠå¶å­ç»“ç‚¹ä¸­å­—ç¬¦ä¸²çš„å‡ºç°æ¬¡æ•°ç½®ä¸º 1ã€‚</p><p>æœ€åä¾ç„¶ä½¿ç”¨å°é¡¶å †æ¥å¯¹å­—ç¬¦ä¸²çš„å‡ºç°æ¬¡æ•°è¿›è¡Œæ’åºã€‚</p><h3 id="æ–¹æ³•æ€»ç»“-5"><a href="#æ–¹æ³•æ€»ç»“-5" class="headerlink" title="æ–¹æ³•æ€»ç»“"></a>æ–¹æ³•æ€»ç»“</h3><p>å‰ç¼€æ ‘ç»å¸¸è¢«ç”¨æ¥ç»Ÿè®¡å­—ç¬¦ä¸²çš„å‡ºç°æ¬¡æ•°ã€‚å®ƒçš„å¦å¤–ä¸€ä¸ªå¤§çš„ç”¨é€”æ˜¯å­—ç¬¦ä¸²æŸ¥æ‰¾ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰é‡å¤çš„å­—ç¬¦ä¸²ç­‰ã€‚</p><hr><h2 id="å¦‚ä½•ç»Ÿè®¡ä¸åŒç”µè¯å·ç çš„ä¸ªæ•°ï¼Ÿ"><a href="#å¦‚ä½•ç»Ÿè®¡ä¸åŒç”µè¯å·ç çš„ä¸ªæ•°ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç»Ÿè®¡ä¸åŒç”µè¯å·ç çš„ä¸ªæ•°ï¼Ÿ"></a>å¦‚ä½•ç»Ÿè®¡ä¸åŒç”µè¯å·ç çš„ä¸ªæ•°ï¼Ÿ</h2><h3 id="é¢˜ç›®æè¿°-6"><a href="#é¢˜ç›®æè¿°-6" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>å·²çŸ¥æŸä¸ªæ–‡ä»¶å†…åŒ…å«ä¸€äº›ç”µè¯å·ç ï¼Œæ¯ä¸ªå·ç ä¸º 8 ä½æ•°å­—ï¼Œç»Ÿè®¡ä¸åŒå·ç çš„ä¸ªæ•°ã€‚</p><h3 id="è§£ç­”æ€è·¯-6"><a href="#è§£ç­”æ€è·¯-6" class="headerlink" title="è§£ç­”æ€è·¯"></a>è§£ç­”æ€è·¯</h3><p>è¿™é“é¢˜æœ¬è´¨è¿˜æ˜¯æ±‚è§£<strong>æ•°æ®é‡å¤</strong>çš„é—®é¢˜ï¼Œå¯¹äºè¿™ç±»é—®é¢˜ï¼Œä¸€èˆ¬é¦–å…ˆè€ƒè™‘ä½å›¾æ³•ã€‚</p><p>å¯¹äºæœ¬é¢˜ï¼Œ8 ä½ç”µè¯å·ç å¯ä»¥è¡¨ç¤ºçš„å·ç ä¸ªæ•°ä¸º 108 ä¸ªï¼Œå³ 1 äº¿ä¸ªã€‚æˆ‘ä»¬æ¯ä¸ªå·ç ç”¨ä¸€ä¸ª bit æ¥è¡¨ç¤ºï¼Œåˆ™æ€»å…±éœ€è¦ 1 äº¿ä¸ª bitï¼Œå†…å­˜å ç”¨çº¦ 100Mã€‚</p><p><strong>æ€è·¯å¦‚ä¸‹</strong>ï¼š</p><p>ç”³è¯·ä¸€ä¸ªä½å›¾æ•°ç»„ï¼Œé•¿åº¦ä¸º 1 äº¿ï¼Œåˆå§‹åŒ–ä¸º 0ã€‚ç„¶åéå†æ‰€æœ‰ç”µè¯å·ç ï¼ŒæŠŠå·ç å¯¹åº”çš„ä½å›¾ä¸­çš„ä½ç½®ç½®ä¸º 1ã€‚éå†å®Œæˆåï¼Œå¦‚æœ bit ä¸º 1ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªç”µè¯å·ç åœ¨æ–‡ä»¶ä¸­å­˜åœ¨ï¼Œå¦åˆ™ä¸å­˜åœ¨ã€‚bit å€¼ä¸º 1 çš„æ•°é‡å³ä¸º ä¸åŒç”µè¯å·ç çš„ä¸ªæ•°ã€‚</p><h3 id="æ–¹æ³•æ€»ç»“-6"><a href="#æ–¹æ³•æ€»ç»“-6" class="headerlink" title="æ–¹æ³•æ€»ç»“"></a>æ–¹æ³•æ€»ç»“</h3><p>æ±‚è§£æ•°æ®é‡å¤é—®é¢˜ï¼Œè®°å¾—è€ƒè™‘ä½å›¾æ³•ã€‚</p><h2 id="å¦‚ä½•æŒ‰ç…§-query-çš„é¢‘åº¦æ’åºï¼Ÿ"><a href="#å¦‚ä½•æŒ‰ç…§-query-çš„é¢‘åº¦æ’åºï¼Ÿ" class="headerlink" title="å¦‚ä½•æŒ‰ç…§ query çš„é¢‘åº¦æ’åºï¼Ÿ"></a>å¦‚ä½•æŒ‰ç…§ query çš„é¢‘åº¦æ’åºï¼Ÿ</h2><h3 id="é¢˜ç›®æè¿°-7"><a href="#é¢˜ç›®æè¿°-7" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>æœ‰ 10 ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¤§å°ä¸º 1Gï¼Œæ¯ä¸ªæ–‡ä»¶çš„æ¯ä¸€è¡Œå­˜æ”¾çš„éƒ½æ˜¯ç”¨æˆ·çš„ queryï¼Œæ¯ä¸ªæ–‡ä»¶çš„ query éƒ½å¯èƒ½é‡å¤ã€‚è¦æ±‚æŒ‰ç…§ query çš„é¢‘åº¦æ’åºã€‚</p><h3 id="è§£ç­”æ€è·¯-7"><a href="#è§£ç­”æ€è·¯-7" class="headerlink" title="è§£ç­”æ€è·¯"></a>è§£ç­”æ€è·¯</h3><p>å¦‚æœ query çš„é‡å¤åº¦æ¯”è¾ƒå¤§ï¼Œå¯ä»¥è€ƒè™‘ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰ query è¯»å…¥å†…å­˜ä¸­å¤„ç†ï¼›å¦‚æœ query çš„é‡å¤ç‡ä¸é«˜ï¼Œé‚£ä¹ˆå¯ç”¨å†…å­˜ä¸è¶³ä»¥å®¹çº³æ‰€æœ‰çš„ queryï¼Œè¿™æ—¶å€™å°±éœ€è¦é‡‡ç”¨åˆ†æ²»æ³•æˆ–å…¶ä»–çš„æ–¹æ³•æ¥è§£å†³ã€‚</p><h4 id="æ–¹æ³•ä¸€ï¼šHashMap-æ³•"><a href="#æ–¹æ³•ä¸€ï¼šHashMap-æ³•" class="headerlink" title="æ–¹æ³•ä¸€ï¼šHashMap æ³•"></a>æ–¹æ³•ä¸€ï¼šHashMap æ³•</h4><p>å¦‚æœ query é‡å¤ç‡é«˜ï¼Œè¯´æ˜ä¸åŒ query æ€»æ•°æ¯”è¾ƒå°ï¼Œå¯ä»¥è€ƒè™‘æŠŠæ‰€æœ‰çš„ query éƒ½åŠ è½½åˆ°å†…å­˜ä¸­çš„ HashMap ä¸­ã€‚æ¥ç€å°±å¯ä»¥æŒ‰ç…§ query å‡ºç°çš„æ¬¡æ•°è¿›è¡Œæ’åºã€‚</p><h4 id="æ–¹æ³•äºŒï¼šåˆ†æ²»æ³•"><a href="#æ–¹æ³•äºŒï¼šåˆ†æ²»æ³•" class="headerlink" title="æ–¹æ³•äºŒï¼šåˆ†æ²»æ³•"></a>æ–¹æ³•äºŒï¼šåˆ†æ²»æ³•</h4><p>åˆ†æ²»æ³•éœ€è¦æ ¹æ®æ•°æ®é‡å¤§å°ä»¥åŠå¯ç”¨å†…å­˜çš„å¤§å°æ¥ç¡®å®šé—®é¢˜åˆ’åˆ†çš„è§„æ¨¡ã€‚å¯¹äºè¿™é“é¢˜ï¼Œå¯ä»¥é¡ºåºéå† 10 ä¸ªæ–‡ä»¶ä¸­çš„ queryï¼Œé€šè¿‡ Hash å‡½æ•° <code>hash(query) % 10</code> æŠŠè¿™äº› query åˆ’åˆ†åˆ° 10 ä¸ªå°æ–‡ä»¶ä¸­ã€‚ä¹‹åå¯¹æ¯ä¸ªå°æ–‡ä»¶ä½¿ç”¨ HashMap ç»Ÿè®¡ query å‡ºç°æ¬¡æ•°ï¼Œæ ¹æ®æ¬¡æ•°æ’åºå¹¶å†™å…¥åˆ°é›¶å¤–ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ä¸­ã€‚</p><p>æ¥ç€å¯¹æ‰€æœ‰æ–‡ä»¶æŒ‰ç…§ query çš„æ¬¡æ•°è¿›è¡Œæ’åºï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨å½’å¹¶æ’åºï¼ˆç”±äºæ— æ³•æŠŠæ‰€æœ‰ query éƒ½è¯»å…¥å†…å­˜ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¤–æ’åºï¼‰ã€‚</p><h3 id="æ–¹æ³•æ€»ç»“-7"><a href="#æ–¹æ³•æ€»ç»“-7" class="headerlink" title="æ–¹æ³•æ€»ç»“"></a>æ–¹æ³•æ€»ç»“</h3><ul><li>å†…å­˜è‹¥å¤Ÿï¼Œç›´æ¥è¯»å…¥è¿›è¡Œæ’åºï¼›</li><li>å†…å­˜ä¸å¤Ÿï¼Œå…ˆåˆ’åˆ†ä¸ºå°æ–‡ä»¶ï¼Œå°æ–‡ä»¶æ’å¥½åºåï¼Œæ•´ç†ä½¿ç”¨å¤–æ’åºè¿›è¡Œå½’å¹¶ã€‚</li></ul><h2 id="å¦‚ä½•ä»-5-äº¿ä¸ªæ•°ä¸­æ‰¾å‡ºä¸­ä½æ•°ï¼Ÿ"><a href="#å¦‚ä½•ä»-5-äº¿ä¸ªæ•°ä¸­æ‰¾å‡ºä¸­ä½æ•°ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä» 5 äº¿ä¸ªæ•°ä¸­æ‰¾å‡ºä¸­ä½æ•°ï¼Ÿ"></a>å¦‚ä½•ä» 5 äº¿ä¸ªæ•°ä¸­æ‰¾å‡ºä¸­ä½æ•°ï¼Ÿ</h2><h3 id="é¢˜ç›®æè¿°-8"><a href="#é¢˜ç›®æè¿°-8" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ä» 5 äº¿ä¸ªæ•°ä¸­æ‰¾å‡ºä¸­ä½æ•°ã€‚æ•°æ®æ’åºåï¼Œä½ç½®åœ¨æœ€ä¸­é—´çš„æ•°å°±æ˜¯ä¸­ä½æ•°ã€‚å½“æ ·æœ¬æ•°ä¸ºå¥‡æ•°æ—¶ï¼Œä¸­ä½æ•°ä¸º ç¬¬ <code>(N+1)/2</code> ä¸ªæ•°ï¼›å½“æ ·æœ¬æ•°ä¸ºå¶æ•°æ—¶ï¼Œä¸­ä½æ•°ä¸º ç¬¬ <code>N/2</code> ä¸ªæ•°ä¸ç¬¬ <code>1+N/2</code> ä¸ªæ•°çš„å‡å€¼ã€‚</p><h3 id="è§£ç­”æ€è·¯-8"><a href="#è§£ç­”æ€è·¯-8" class="headerlink" title="è§£ç­”æ€è·¯"></a>è§£ç­”æ€è·¯</h3><p>å¦‚æœè¿™é“é¢˜æ²¡æœ‰å†…å­˜å¤§å°é™åˆ¶ï¼Œåˆ™å¯ä»¥æŠŠæ‰€æœ‰æ•°è¯»åˆ°å†…å­˜ä¸­æ’åºåæ‰¾å‡ºä¸­ä½æ•°ã€‚ä½†æ˜¯æœ€å¥½çš„æ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º <code>O(NlogN)</code> ã€‚è¿™é‡Œä½¿ç”¨å…¶ä»–æ–¹æ³•ã€‚</p><h4 id="æ–¹æ³•ä¸€ï¼šåŒå †æ³•"><a href="#æ–¹æ³•ä¸€ï¼šåŒå †æ³•" class="headerlink" title="æ–¹æ³•ä¸€ï¼šåŒå †æ³•"></a>æ–¹æ³•ä¸€ï¼šåŒå †æ³•</h4><p>ç»´æŠ¤ä¸¤ä¸ªå †ï¼Œä¸€ä¸ªå¤§é¡¶å †ï¼Œä¸€ä¸ªå°é¡¶å †ã€‚å¤§é¡¶å †ä¸­æœ€å¤§çš„æ•°<strong>å°äºç­‰äº</strong>å°é¡¶å †ä¸­æœ€å°çš„æ•°ï¼›ä¿è¯è¿™ä¸¤ä¸ªå †ä¸­çš„å…ƒç´ ä¸ªæ•°çš„å·®ä¸è¶…è¿‡ 1ã€‚</p><p>è‹¥æ•°æ®æ€»æ•°ä¸º<strong>å¶æ•°</strong>ï¼Œå½“è¿™ä¸¤ä¸ªå †å»ºå¥½ä¹‹åï¼Œ<strong>ä¸­ä½æ•°å°±æ˜¯è¿™ä¸¤ä¸ªå †é¡¶å…ƒç´ çš„å¹³å‡å€¼</strong>ã€‚å½“æ•°æ®æ€»æ•°ä¸º<strong>å¥‡æ•°</strong>æ—¶ï¼Œæ ¹æ®ä¸¤ä¸ªå †çš„å¤§å°ï¼Œ<strong>ä¸­ä½æ•°ä¸€å®šåœ¨æ•°æ®å¤šçš„å †çš„å †é¡¶</strong>ã€‚</p><pre><code>class MedianFinder {    private PriorityQueue&lt;Integer&gt; maxHeap;    private PriorityQueue&lt;Integer&gt; minHeap;    /** initialize your data structure here. */    public MedianFinder() {        maxHeap = new PriorityQueue&lt;&gt;(Comparator.reverseOrder());        minHeap = new PriorityQueue&lt;&gt;(Integer::compareTo);    }    public void addNum(int num) {        if (maxHeap.isEmpty() || maxHeap.peek() &gt; num) {            maxHeap.offer(num);        } else {            minHeap.offer(num);        }        int size1 = maxHeap.size();        int size2 = minHeap.size();        if (size1 - size2 &gt; 1) {            minHeap.offer(maxHeap.poll());        } else if (size2 - size1 &gt; 1) {            maxHeap.offer(minHeap.poll());        }    }    public double findMedian() {        int size1 = maxHeap.size();        int size2 = minHeap.size();        return size1 == size2             ? (maxHeap.peek() + minHeap.peek()) * 1.0 / 2            : (size1 &gt; size2 ? maxHeap.peek() : minHeap.peek());    }}</code></pre><blockquote><p>è§ LeetCode No.295ï¼š<a href="https://leetcode.com/problems/find-median-from-data-stream/" target="_blank" rel="noopener">https://leetcode.com/problems/find-median-from-data-stream/</a></p></blockquote><p>ä»¥ä¸Šè¿™ç§æ–¹æ³•ï¼Œéœ€è¦æŠŠæ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œå°±ä¸èƒ½è¿™æ ·äº†ï¼Œå› æ­¤ï¼Œè¿™ç§æ–¹æ³•<strong>é€‚ç”¨äºæ•°æ®é‡è¾ƒå°çš„æƒ…å†µ</strong>ã€‚5 äº¿ä¸ªæ•°ï¼Œæ¯ä¸ªæ•°å­—å ç”¨ 4Bï¼Œæ€»å…±éœ€è¦ 2G å†…å­˜ã€‚å¦‚æœå¯ç”¨å†…å­˜ä¸è¶³ 2Gï¼Œå°±ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•äº†ï¼Œä¸‹é¢ä»‹ç»å¦ä¸€ç§æ–¹æ³•ã€‚</p><h4 id="æ–¹æ³•äºŒï¼šåˆ†æ²»æ³•-1"><a href="#æ–¹æ³•äºŒï¼šåˆ†æ²»æ³•-1" class="headerlink" title="æ–¹æ³•äºŒï¼šåˆ†æ²»æ³•"></a>æ–¹æ³•äºŒï¼šåˆ†æ²»æ³•</h4><p>åˆ†æ²»æ³•çš„æ€æƒ³æ˜¯æŠŠä¸€ä¸ªå¤§çš„é—®é¢˜é€æ¸è½¬æ¢ä¸ºè§„æ¨¡è¾ƒå°çš„é—®é¢˜æ¥æ±‚è§£ã€‚</p><p>å¯¹äºè¿™é“é¢˜ï¼Œé¡ºåºè¯»å–è¿™ 5 äº¿ä¸ªæ•°å­—ï¼Œå¯¹äºè¯»å–åˆ°çš„æ•°å­— numï¼Œå¦‚æœå®ƒå¯¹åº”çš„äºŒè¿›åˆ¶ä¸­æœ€é«˜ä½ä¸º 1ï¼Œåˆ™æŠŠè¿™ä¸ªæ•°å­—å†™åˆ° f1 ä¸­ï¼Œå¦åˆ™å†™å…¥ f0 ä¸­ã€‚é€šè¿‡è¿™ä¸€æ­¥ï¼Œå¯ä»¥æŠŠè¿™ 5 äº¿ä¸ªæ•°åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œè€Œä¸” f0 ä¸­çš„æ•°éƒ½å¤§äº f1 ä¸­çš„æ•°ï¼ˆæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼‰ã€‚</p><p>åˆ’åˆ†ä¹‹åï¼Œå¯ä»¥éå¸¸å®¹æ˜“åœ°çŸ¥é“ä¸­ä½æ•°æ˜¯åœ¨ f0 è¿˜æ˜¯ f1 ä¸­ã€‚å‡è®¾ f1 ä¸­æœ‰ 1 äº¿ä¸ªæ•°ï¼Œé‚£ä¹ˆä¸­ä½æ•°ä¸€å®šåœ¨ f0 ä¸­ï¼Œä¸”æ˜¯åœ¨ f0 ä¸­ï¼Œä»å°åˆ°å¤§æ’åˆ—çš„ç¬¬ 1.5 äº¿ä¸ªæ•°ä¸å®ƒåé¢çš„ä¸€ä¸ªæ•°çš„å¹³å‡å€¼ã€‚</p><blockquote><p><strong>æç¤º</strong>ï¼Œ5 äº¿æ•°çš„ä¸­ä½æ•°æ˜¯ç¬¬ 2.5 äº¿ä¸å³è¾¹ç›¸é‚»ä¸€ä¸ªæ•°æ±‚å¹³å‡å€¼ã€‚è‹¥ f1 æœ‰ä¸€äº¿ä¸ªæ•°ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯ f0 ä¸­ä»ç¬¬ 1.5 äº¿ä¸ªæ•°å¼€å§‹çš„ä¸¤ä¸ªæ•°æ±‚å¾—çš„å¹³å‡å€¼ã€‚</p></blockquote><p>å¯¹äº f0 å¯ä»¥ç”¨æ¬¡é«˜ä½çš„äºŒè¿›åˆ¶ç»§ç»­å°†æ–‡ä»¶ä¸€åˆ†ä¸ºäºŒï¼Œå¦‚æ­¤åˆ’åˆ†ä¸‹å»ï¼Œç›´åˆ°åˆ’åˆ†åçš„æ–‡ä»¶å¯ä»¥è¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼ŒæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ä»¥åç›´æ¥æ’åºï¼Œæ‰¾å‡ºä¸­ä½æ•°ã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ï¼Œå½“æ•°æ®æ€»æ•°ä¸ºå¶æ•°ï¼Œå¦‚æœåˆ’åˆ†åä¸¤ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®æœ‰ç›¸åŒä¸ªæ•°ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯æ•°æ®è¾ƒå°çš„æ–‡ä»¶ä¸­çš„æœ€å¤§å€¼ä¸æ•°æ®è¾ƒå¤§çš„æ–‡ä»¶ä¸­çš„æœ€å°å€¼çš„å¹³å‡å€¼ã€‚</p></blockquote><h3 id="æ–¹æ³•æ€»ç»“-8"><a href="#æ–¹æ³•æ€»ç»“-8" class="headerlink" title="æ–¹æ³•æ€»ç»“"></a>æ–¹æ³•æ€»ç»“</h3><p>åˆ†æ²»æ³•ï¼ŒçœŸé¦™ï¼</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç»œç›¸å…³åŸºç¡€</title>
      <link href="/2020/01/15/1.%20Java%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/"/>
      <url>/2020/01/15/1.%20Java%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="HTTP-å’Œ-HTTPS-çš„åŒºåˆ«"><a href="#HTTP-å’Œ-HTTPS-çš„åŒºåˆ«" class="headerlink" title="HTTP å’Œ HTTPS çš„åŒºåˆ«"></a>HTTP å’Œ HTTPS çš„åŒºåˆ«</h2><p>HTTP æ˜¯ä¸€ç§ <code>è¶…æ–‡æœ¬ä¼ è¾“åè®®(Hypertext Transfer Protocol)</code>ï¼Œ**HTTP æ˜¯ä¸€ä¸ªåœ¨è®¡ç®—æœºä¸–ç•Œé‡Œä¸“é—¨åœ¨ä¸¤ç‚¹ä¹‹é—´ä¼ è¾“æ–‡å­—ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰è¶…æ–‡æœ¬æ•°æ®çš„çº¦å®šå’Œè§„èŒƒ</p><p>HTTPS çš„å…¨ç§°æ˜¯ <code>Hypertext Transfer Protocol Secure</code>ï¼Œä»åç§°æˆ‘ä»¬å¯ä»¥çœ‹å‡º HTTPS è¦æ¯” HTTPS å¤šäº† secure å®‰å…¨æ€§è¿™ä¸ªæ¦‚å¿µï¼Œå®é™…ä¸Šï¼Œ HTTPS å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„åº”ç”¨å±‚åè®®ï¼Œå®ƒå…¶å®å°±æ˜¯ HTTP + TLS/SSL åè®®ç»„åˆè€Œæˆï¼Œè€Œå®‰å…¨æ€§çš„ä¿è¯æ­£æ˜¯ TLS/SSL æ‰€åšçš„å·¥ä½œã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>HTTPS å°±æ˜¯èº«æŠ«äº†ä¸€å±‚ SSL çš„ HTTP</strong>ã€‚</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyD19RoMWPIg8hv6BJZOaAle0qiclXjXBF4UUH9TWfjwmdibwP7EHssGqhA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>é‚£ä¹ˆï¼ŒHTTP å’Œ HTTPS çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>æœ€ç®€å•çš„ï¼ŒHTTP åœ¨åœ°å€æ ä¸Šçš„åè®®æ˜¯ä»¥ <code>http://</code> å¼€å¤´ï¼Œè€Œ HTTPS åœ¨åœ°å€æ ä¸Šçš„åè®®æ˜¯ä»¥ <code>https://</code> å¼€å¤´</li></ul><pre><code class="java">http://www.cxuanblog.com/https://www.cxuanblog.com/</code></pre><ul><li>HTTP æ˜¯æœªç»å®‰å…¨åŠ å¯†çš„åè®®ï¼Œå®ƒçš„ä¼ è¾“è¿‡ç¨‹å®¹æ˜“è¢«æ”»å‡»è€…ç›‘å¬ã€æ•°æ®å®¹æ˜“è¢«çªƒå–ã€å‘é€æ–¹å’Œæ¥æ”¶æ–¹å®¹æ˜“è¢«ä¼ªé€ ï¼›è€Œ HTTPS æ˜¯å®‰å…¨çš„åè®®ï¼Œå®ƒé€šè¿‡ <strong>å¯†é’¥äº¤æ¢ç®—æ³• - ç­¾åç®—æ³• - å¯¹ç§°åŠ å¯†ç®—æ³• - æ‘˜è¦ç®—æ³•</strong> èƒ½å¤Ÿè§£å†³ä¸Šé¢è¿™äº›é—®é¢˜ã€‚</li></ul><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyD7epCiaoQwrgS3xQsl4f0b0h6jopmrQO9ryZHhia6EicGN2fDBKQj1as2g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><ul><li>HTTP çš„é»˜è®¤ç«¯å£æ˜¯ 80ï¼Œè€Œ HTTPS çš„é»˜è®¤ç«¯å£æ˜¯ 443ã€‚</li></ul><h2 id="HTTP-Get-å’Œ-Post-åŒºåˆ«"><a href="#HTTP-Get-å’Œ-Post-åŒºåˆ«" class="headerlink" title="HTTP Get å’Œ Post åŒºåˆ«"></a>HTTP Get å’Œ Post åŒºåˆ«</h2><p>HTTP ä¸­åŒ…æ‹¬è®¸å¤šæ–¹æ³•ï¼Œ<strong>Get å’Œ Post æ˜¯ HTTP ä¸­æœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ–¹æ³•</strong>ï¼ŒåŸºæœ¬ä¸Šä½¿ç”¨ HTTP æ–¹æ³•ä¸­æœ‰ 99% éƒ½æ˜¯åœ¨ä½¿ç”¨ Get æ–¹æ³•å’Œ Post æ–¹æ³•ï¼Œæ‰€ä»¥æœ‰å¿…è¦æˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰æ›´åŠ æ·±åˆ»çš„è®¤è¯†ã€‚</p><ul><li><p>get æ–¹æ³•ä¸€èˆ¬ç”¨äºè¯·æ±‚ï¼Œæ¯”å¦‚ä½ åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ <code>www.cxuanblog.com</code> å…¶å®å°±æ˜¯å‘é€äº†ä¸€ä¸ª get è¯·æ±‚ï¼Œå®ƒçš„ä¸»è¦ç‰¹å¾æ˜¯è¯·æ±‚æœåŠ¡å™¨è¿”å›èµ„æºï¼Œè€Œ post æ–¹æ³•ä¸€èˆ¬ç”¨äº</p><p><code>è¡¨å•</code>çš„æäº¤ï¼Œç›¸å½“äºæ˜¯æŠŠä¿¡æ¯æäº¤ç»™æœåŠ¡å™¨ï¼Œç­‰å¾…æœåŠ¡å™¨ä½œå‡ºå“åº”ï¼Œget ç›¸å½“äºä¸€ä¸ªæ˜¯ pull/æ‹‰çš„æ“ä½œï¼Œè€Œ post ç›¸å½“äºæ˜¯ä¸€ä¸ª push/æ¨çš„æ“ä½œã€‚</p></li><li><p>get æ–¹æ³•æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºä½ åœ¨å‘é€è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œä½ çš„è¯·æ±‚å‚æ•°ä¼šæ‹¼åœ¨ URL åé¢ï¼Œä»è€Œå¯¼è‡´å®¹æ˜“è¢«æ”»å‡»è€…çªƒå–ï¼Œå¯¹ä½ çš„ä¿¡æ¯é€ æˆç ´åå’Œä¼ªé€ ï¼›</p></li></ul><pre><code>/test/demo_form.asp?name1=value1&amp;name2=value2</code></pre><p>è€Œ post æ–¹æ³•æ˜¯æŠŠå‚æ•°æ”¾åœ¨è¯·æ±‚ä½“ body ä¸­çš„ï¼Œè¿™å¯¹ç”¨æˆ·æ¥è¯´ä¸å¯è§ã€‚</p><pre><code>POST /test/demo_form.asp HTTP/1.1Host: w3schools.comname1=value1&amp;name2=value2</code></pre><ul><li>get è¯·æ±‚çš„ URL æœ‰é•¿åº¦é™åˆ¶ï¼Œè€Œ post è¯·æ±‚ä¼šæŠŠå‚æ•°å’Œå€¼æ”¾åœ¨æ¶ˆæ¯ä½“ä¸­ï¼Œå¯¹æ•°æ®é•¿åº¦æ²¡æœ‰è¦æ±‚ã€‚</li><li>get è¯·æ±‚ä¼šè¢«æµè§ˆå™¨ä¸»åŠ¨ cacheï¼Œè€Œ post ä¸ä¼šï¼Œé™¤éæ‰‹åŠ¨è®¾ç½®ã€‚</li><li>get è¯·æ±‚åœ¨æµè§ˆå™¨åå¤çš„ <code>å›é€€/å‰è¿›</code> æ“ä½œæ˜¯æ— å®³çš„ï¼Œè€Œ post æ“ä½œä¼šå†æ¬¡æäº¤è¡¨å•è¯·æ±‚ã€‚</li><li>get è¯·æ±‚åœ¨å‘é€è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿä¸€ä¸ª TCP æ•°æ®åŒ…ï¼›post åœ¨å‘é€è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿä¸¤ä¸ª TCP æ•°æ®åŒ…ã€‚å¯¹äº get æ–¹å¼çš„è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šæŠŠ http header å’Œ data ä¸€å¹¶å‘é€å‡ºå»ï¼ŒæœåŠ¡å™¨å“åº” 200ï¼ˆè¿”å›æ•°æ®ï¼‰ï¼›è€Œå¯¹äº postï¼Œæµè§ˆå™¨å…ˆå‘é€ headerï¼ŒæœåŠ¡å™¨å“åº” 100 continueï¼Œæµè§ˆå™¨å†å‘é€ dataï¼ŒæœåŠ¡å™¨å“åº” 200 okï¼ˆè¿”å›æ•°æ®ï¼‰ã€‚</li></ul><h2 id="ä»€ä¹ˆæ˜¯æ— çŠ¶æ€åè®®ï¼ŒHTTP-æ˜¯æ— çŠ¶æ€åè®®å—ï¼Œæ€ä¹ˆè§£å†³"><a href="#ä»€ä¹ˆæ˜¯æ— çŠ¶æ€åè®®ï¼ŒHTTP-æ˜¯æ— çŠ¶æ€åè®®å—ï¼Œæ€ä¹ˆè§£å†³" class="headerlink" title="ä»€ä¹ˆæ˜¯æ— çŠ¶æ€åè®®ï¼ŒHTTP æ˜¯æ— çŠ¶æ€åè®®å—ï¼Œæ€ä¹ˆè§£å†³"></a>ä»€ä¹ˆæ˜¯æ— çŠ¶æ€åè®®ï¼ŒHTTP æ˜¯æ— çŠ¶æ€åè®®å—ï¼Œæ€ä¹ˆè§£å†³</h2><p><code>æ— çŠ¶æ€åè®®(Stateless Protocol)</code> å°±æ˜¯æŒ‡<strong>æµè§ˆå™¨å¯¹äºäº‹åŠ¡çš„å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›</strong>ã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´å°±æ˜¯æ¯”å¦‚å®¢æˆ·è¯·æ±‚è·å¾—ç½‘é¡µä¹‹åå…³é—­æµè§ˆå™¨ï¼Œç„¶åå†æ¬¡å¯åŠ¨æµè§ˆå™¨ï¼Œç™»å½•è¯¥ç½‘ç«™ï¼Œä½†æ˜¯æœåŠ¡å™¨å¹¶ä¸çŸ¥é“å®¢æˆ·å…³é—­äº†ä¸€æ¬¡æµè§ˆå™¨ã€‚</p><p>HTTP å°±æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼Œä»–å¯¹ç”¨æˆ·çš„æ“ä½œæ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚å¯èƒ½å¤§å¤šæ•°ç”¨æˆ·ä¸ç›¸ä¿¡ï¼Œä»–å¯èƒ½è§‰å¾—æ¯æ¬¡è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»é™†ä¸€ä¸ªç½‘ç«™åï¼Œä¸‹æ¬¡ç™»é™†å°±ä¸å†é‡æ–°è¾“å…¥ç”¨æˆ·åå’Œå¯†ç äº†ã€‚è¿™å…¶å®ä¸æ˜¯ HTTP åšçš„äº‹æƒ…ï¼Œèµ·ä½œç”¨çš„æ˜¯ä¸€ä¸ªå«åš <code>å°ç”œé¥¼(Cookie)</code> çš„æœºåˆ¶ã€‚å®ƒèƒ½å¤Ÿè®©æµè§ˆå™¨å…·æœ‰<code>è®°å¿†</code>èƒ½åŠ›ã€‚</p><p>å¦‚æœä½ çš„æµè§ˆå™¨å…è®¸ cookie çš„è¯ï¼ŒæŸ¥çœ‹æ–¹å¼ <strong>chrome://settings/content/cookies</strong></p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyDsCBfLLWyK87vklbxJHwlVkL8xicYPDIbW7VEfKjNCjS2YMnpP17ya6w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>ä¹Ÿå°±è¯´æ˜ä½ çš„è®°å¿†èŠ¯ç‰‡é€šç”µäº†â€¦â€¦ å½“ä½ å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç»™ä½ å‘é€ä¸€ä¸ªè®¤è¯ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå¼€è¾Ÿäº†ä¸€å— Session ç©ºé—´ï¼ˆåˆ›å»ºäº†Sessionå¯¹è±¡ï¼‰ï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ª sessionId ï¼Œå¹¶é€šè¿‡å“åº”å¤´çš„ Set-Cookieï¼šJSESSIONID=XXXXXXX å‘½ä»¤ï¼Œå‘å®¢æˆ·ç«¯å‘é€è¦æ±‚è®¾ç½® Cookie çš„å“åº”ï¼›å®¢æˆ·ç«¯æ”¶åˆ°å“åº”åï¼Œåœ¨æœ¬æœºå®¢æˆ·ç«¯è®¾ç½®äº†ä¸€ä¸ª JSESSIONID=XXXXXXX çš„ Cookie ä¿¡æ¯ï¼Œè¯¥ Cookie çš„è¿‡æœŸæ—¶é—´ä¸ºæµè§ˆå™¨ä¼šè¯ç»“æŸï¼›</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyDnLQ4cbMCZLF9ibM2km6nu7wyy0b9vZFq3L03vSG3omzRhncV68By8Ig/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>æ¥ä¸‹æ¥å®¢æˆ·ç«¯æ¯æ¬¡å‘åŒä¸€ä¸ªç½‘ç«™å‘é€è¯·æ±‚æ—¶ï¼Œè¯·æ±‚å¤´éƒ½ä¼šå¸¦ä¸Šè¯¥ Cookieä¿¡æ¯ï¼ˆåŒ…å« sessionId ï¼‰ï¼Œ ç„¶åï¼ŒæœåŠ¡å™¨é€šè¿‡è¯»å–è¯·æ±‚å¤´ä¸­çš„ Cookie ä¿¡æ¯ï¼Œè·å–åç§°ä¸º JSESSIONID çš„å€¼ï¼Œå¾—åˆ°æ­¤æ¬¡è¯·æ±‚çš„ sessionIdã€‚è¿™æ ·ï¼Œä½ çš„æµè§ˆå™¨æ‰å…·æœ‰äº†è®°å¿†èƒ½åŠ›ã€‚</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyDt4V7IRicwA7d9MIEdibHaxiaFBPaSKD2A3kuwxwM6micorkKJqiasj9AicaQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ JWT æœºåˆ¶ï¼Œå®ƒä¹Ÿæ˜¯èƒ½å¤Ÿè®©ä½ çš„æµè§ˆå™¨å…·æœ‰è®°å¿†èƒ½åŠ›çš„ä¸€ç§æœºåˆ¶ã€‚ä¸ Cookie ä¸åŒï¼ŒJWT æ˜¯ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œå®ƒå¹¿æ³›çš„åº”ç”¨äºå•ç‚¹ç™»å½•çš„æƒ…å†µã€‚JWT å…·æœ‰ä¸¤ä¸ªç‰¹ç‚¹</p><ul><li>JWT çš„ Cookie ä¿¡æ¯å­˜å‚¨åœ¨<code>å®¢æˆ·ç«¯</code>ï¼Œè€Œä¸æ˜¯æœåŠ¡ç«¯å†…å­˜ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒJWT ç›´æ¥æœ¬åœ°è¿›è¡ŒéªŒè¯å°±å¯ä»¥ï¼ŒéªŒè¯å®Œæ¯•åï¼Œè¿™ä¸ª Token å°±ä¼šåœ¨ Session ä¸­éšè¯·æ±‚ä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥èŠ‚çœæœåŠ¡å™¨èµ„æºï¼Œå¹¶ä¸” token å¯ä»¥è¿›è¡Œå¤šæ¬¡éªŒè¯ã€‚</li><li>JWT æ”¯æŒè·¨åŸŸè®¤è¯ï¼ŒCookies åªèƒ½ç”¨åœ¨<code>å•ä¸ªèŠ‚ç‚¹çš„åŸŸ</code>æˆ–è€…å®ƒçš„<code>å­åŸŸ</code>ä¸­æœ‰æ•ˆã€‚å¦‚æœå®ƒä»¬å°è¯•é€šè¿‡ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹è®¿é—®ï¼Œå°±ä¼šè¢«ç¦æ­¢ã€‚ä½¿ç”¨ JWT å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨ JWT èƒ½å¤Ÿé€šè¿‡<code>å¤šä¸ªèŠ‚ç‚¹</code>è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<code>è·¨åŸŸè®¤è¯</code>ã€‚</li></ul><h2 id="UDP-å’Œ-TCP-çš„åŒºåˆ«"><a href="#UDP-å’Œ-TCP-çš„åŒºåˆ«" class="headerlink" title="UDP å’Œ TCP çš„åŒºåˆ«"></a>UDP å’Œ TCP çš„åŒºåˆ«</h2><p>TCP å’Œ UDP éƒ½ä½äºè®¡ç®—æœºç½‘ç»œæ¨¡å‹ä¸­çš„è¿è¾“å±‚ï¼Œå®ƒä»¬è´Ÿè´£ä¼ è¾“åº”ç”¨å±‚äº§ç”Ÿçš„æ•°æ®ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥èŠä¸€èŠ TCP å’Œ UDP åˆ†åˆ«çš„ç‰¹å¾å’Œä»–ä»¬çš„åŒºåˆ«</p><h3 id="UDP-æ˜¯ä»€ä¹ˆ"><a href="#UDP-æ˜¯ä»€ä¹ˆ" class="headerlink" title="UDP æ˜¯ä»€ä¹ˆ"></a>UDP æ˜¯ä»€ä¹ˆ</h3><p>UDP çš„å…¨ç§°æ˜¯ <code>User Datagram Protocol</code>ï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®ã€‚å®ƒä¸éœ€è¦æ‰€è°“çš„<code>æ¡æ‰‹</code>æ“ä½œï¼Œä»è€ŒåŠ å¿«äº†é€šä¿¡é€Ÿåº¦ï¼Œå…è®¸ç½‘ç»œä¸Šçš„å…¶ä»–ä¸»æœºåœ¨æ¥æ”¶æ–¹åŒæ„é€šä¿¡ä¹‹å‰è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p><blockquote><p>æ•°æ®æŠ¥æ˜¯ä¸åˆ†ç»„äº¤æ¢ç½‘ç»œå…³è”çš„ä¼ è¾“å•å…ƒã€‚</p></blockquote><p>UDP çš„ç‰¹ç‚¹ä¸»è¦æœ‰</p><ul><li>UDP èƒ½å¤Ÿæ”¯æŒå®¹å¿æ•°æ®åŒ…ä¸¢å¤±çš„å¸¦å®½å¯†é›†å‹åº”ç”¨ç¨‹åº</li><li>UDP å…·æœ‰ä½å»¶è¿Ÿçš„ç‰¹ç‚¹</li><li>UDP èƒ½å¤Ÿå‘é€å¤§é‡çš„æ•°æ®åŒ…</li><li>UDP èƒ½å¤Ÿå…è®¸ DNS æŸ¥æ‰¾ï¼ŒDNS æ˜¯å»ºç«‹åœ¨ UDP ä¹‹ä¸Šçš„åº”ç”¨å±‚åè®®ã€‚</li></ul><h3 id="TCP-æ˜¯ä»€ä¹ˆ"><a href="#TCP-æ˜¯ä»€ä¹ˆ" class="headerlink" title="TCP æ˜¯ä»€ä¹ˆ"></a>TCP æ˜¯ä»€ä¹ˆ</h3><p>TCP çš„å…¨ç§°æ˜¯<code>Transmission Control Protocol</code> ï¼Œä¼ è¾“æ§åˆ¶åè®®ã€‚å®ƒèƒ½å¤Ÿå¸®åŠ©ä½ ç¡®å®šè®¡ç®—æœºè¿æ¥åˆ° Internet ä»¥åŠå®ƒä»¬ä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹ TCP è¿æ¥ï¼Œä¸‰æ¬¡æ¡æ‰‹å°±æ˜¯ç”¨æ¥å¯åŠ¨å’Œç¡®è®¤ TCP è¿æ¥çš„è¿‡ç¨‹ã€‚ä¸€æ—¦è¿æ¥å»ºç«‹åï¼Œå°±å¯ä»¥å‘é€æ•°æ®äº†ï¼Œå½“æ•°æ®ä¼ è¾“å®Œæˆåï¼Œä¼šé€šè¿‡å…³é—­è™šæ‹Ÿç”µè·¯æ¥æ–­å¼€è¿æ¥ã€‚</p><p>TCP çš„ä¸»è¦ç‰¹ç‚¹æœ‰</p><ul><li>TCP èƒ½å¤Ÿç¡®ä¿è¿æ¥çš„å»ºç«‹å’Œæ•°æ®åŒ…çš„å‘é€</li><li>TCP æ”¯æŒé”™è¯¯é‡ä¼ æœºåˆ¶</li><li>TCP æ”¯æŒæ‹¥å¡æ§åˆ¶ï¼Œèƒ½å¤Ÿåœ¨ç½‘ç»œæ‹¥å µçš„æƒ…å†µä¸‹å»¶è¿Ÿå‘é€</li><li>TCP èƒ½å¤Ÿæä¾›é”™è¯¯æ ¡éªŒå’Œï¼Œç”„åˆ«æœ‰å®³çš„æ•°æ®åŒ…ã€‚</li></ul><h3 id="TCP-å’Œ-UDP-çš„ä¸åŒ"><a href="#TCP-å’Œ-UDP-çš„ä¸åŒ" class="headerlink" title="TCP å’Œ UDP çš„ä¸åŒ"></a>TCP å’Œ UDP çš„ä¸åŒ</h3><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyDcsTFw3N3N0qAiche76WjEFl1TE3ckqW9oIT5yeEBiaHeKL1OpWd9Y9vA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>ä¸‹é¢ä¸ºä½ ç½—åˆ—äº†ä¸€äº› TCP å’Œ UDP çš„ä¸åŒç‚¹ï¼Œæ–¹ä¾¿ç†è§£ï¼Œæ–¹ä¾¿è®°å¿†ã€‚</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyDcUC1xOPDkPMCnPWX4DutTkGW3ooiaoEl8yoyPwcrLlkB8h5wlhMNqmw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h2 id="TCP-ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"><a href="#TCP-ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹" class="headerlink" title="TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"></a>TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹</h2><p>TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ä¹Ÿæ˜¯é¢è¯•é¢˜çš„çƒ­é—¨è€ƒç‚¹ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº” TCP çš„è¿æ¥å’Œé‡Šæ”¾è¿‡ç¨‹ã€‚ä¸‹é¢å°±æ¥ç®€å•è®¤è¯†ä¸€ä¸‹è¿™ä¸¤ä¸ªè¿‡ç¨‹</p><h3 id="TCP-ä¸‰æ¬¡æ¡æ‰‹"><a href="#TCP-ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="TCP ä¸‰æ¬¡æ¡æ‰‹"></a>TCP ä¸‰æ¬¡æ¡æ‰‹</h3><p>åœ¨äº†è§£å…·ä½“çš„æµç¨‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¤è¯†å‡ ä¸ªæ¦‚å¿µ</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyD58Npf1AOxttKsHPFl4aOQ54Znzk6P3mic47cYsh2RLgQMibV4I8iaKbZw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><ul><li>SYNï¼šå®ƒçš„å…¨ç§°æ˜¯ <code>Synchronize Sequence Numbers</code>ï¼ŒåŒæ­¥åºåˆ—ç¼–å·ã€‚æ˜¯ TCP/IP å»ºç«‹è¿æ¥æ—¶ä½¿ç”¨çš„æ¡æ‰‹ä¿¡å·ã€‚åœ¨å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ TCP è¿æ¥æ—¶ï¼Œé¦–å…ˆä¼šå‘é€çš„ä¸€ä¸ªä¿¡å·ã€‚å®¢æˆ·ç«¯åœ¨æ¥å—åˆ° SYN æ¶ˆæ¯æ—¶ï¼Œå°±ä¼šåœ¨è‡ªå·±çš„æ®µå†…ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ Xã€‚</li><li>SYN-ACKï¼šæœåŠ¡å™¨æ”¶åˆ° SYN åï¼Œæ‰“å¼€å®¢æˆ·ç«¯è¿æ¥ï¼Œå‘é€ä¸€ä¸ª SYN-ACK ä½œä¸ºç­”å¤ã€‚ç¡®è®¤å·è®¾ç½®ä¸ºæ¯”æ¥æ”¶åˆ°çš„åºåˆ—å·å¤šä¸€ä¸ªï¼Œå³ X + 1ï¼ŒæœåŠ¡å™¨ä¸ºæ•°æ®åŒ…é€‰æ‹©çš„åºåˆ—å·æ˜¯å¦ä¸€ä¸ªéšæœºæ•° Yã€‚</li><li>ACKï¼š<code>Acknowledge character</code>, ç¡®è®¤å­—ç¬¦ï¼Œè¡¨ç¤ºå‘æ¥çš„æ•°æ®å·²ç¡®è®¤æ¥æ”¶æ— è¯¯ã€‚æœ€åï¼Œå®¢æˆ·ç«¯å°† ACK å‘é€ç»™æœåŠ¡å™¨ã€‚åºåˆ—å·è¢«è®¾ç½®ä¸ºæ‰€æ¥æ”¶çš„ç¡®è®¤å€¼å³ Y + 1ã€‚</li></ul><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyDA1U4Yibbc99AU5HU3dv9A4WGuhdQHP4X1REia3oibJZevyDBKRictC58bQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p>å¦‚æœç”¨ç°å®ç”Ÿæ´»æ¥ä¸¾ä¾‹çš„è¯å°±æ˜¯</p><p>å°æ˜ - å®¢æˆ·ç«¯ å°çº¢ - æœåŠ¡ç«¯</p><ul><li>å°æ˜ç»™å°çº¢æ‰“ç”µè¯ï¼Œæ¥é€šäº†åï¼Œå°æ˜è¯´<strong>å–‚ï¼Œèƒ½å¬åˆ°å—</strong>ï¼Œè¿™å°±ç›¸å½“äºæ˜¯è¿æ¥å»ºç«‹ã€‚</li><li>å°çº¢ç»™å°æ˜å›åº”ï¼Œ<strong>èƒ½å¬åˆ°ï¼Œä½ èƒ½å¬åˆ°æˆ‘è¯´çš„è¯å—</strong>ï¼Œè¿™å°±ç›¸å½“äºæ˜¯è¯·æ±‚å“åº”ã€‚</li><li>å°æ˜å¬åˆ°å°çº¢çš„å›åº”åï¼Œ<strong>å¥½çš„</strong>ï¼Œè¿™ç›¸å½“äºæ˜¯è¿æ¥ç¡®è®¤ã€‚åœ¨è¿™ä¹‹åå°æ˜å’Œå°çº¢å°±å¯ä»¥é€šè¯/äº¤æ¢ä¿¡æ¯äº†ã€‚</li></ul><h3 id="TCP-å››æ¬¡æŒ¥æ‰‹"><a href="#TCP-å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="TCP å››æ¬¡æŒ¥æ‰‹"></a>TCP å››æ¬¡æŒ¥æ‰‹</h3><p>åœ¨è¿æ¥ç»ˆæ­¢é˜¶æ®µä½¿ç”¨å››æ¬¡æŒ¥æ‰‹ï¼Œè¿æ¥çš„æ¯ä¸€ç«¯éƒ½ä¼šç‹¬ç«‹çš„ç»ˆæ­¢ã€‚ä¸‹é¢æˆ‘ä»¬æ¥æè¿°ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyDfa4qx2k7PGicQrGqVPIbqNbIxmbzEicT8F1mtgFbGfmxjGWlricibfgy1Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><ul><li>é¦–å…ˆï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå†³å®šè¦ç»ˆæ­¢è¿æ¥(è¿™é‡ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥é€‰æ‹©æ–­å¼€è¿æ¥)ã€‚è¿™ä¼šä½¿å®¢æˆ·ç«¯å°† FIN å‘é€åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥ <code>FIN_WAIT_1</code> çŠ¶æ€ã€‚å½“å®¢æˆ·ç«¯å¤„äº FIN_WAIT_1 çŠ¶æ€æ—¶ï¼Œå®ƒä¼šç­‰å¾…æ¥è‡ªæœåŠ¡å™¨çš„ ACK å“åº”ã€‚</li><li>ç„¶åç¬¬äºŒæ­¥ï¼Œå½“æœåŠ¡å™¨æ”¶åˆ° FIN æ¶ˆæ¯æ—¶ï¼ŒæœåŠ¡å™¨ä¼šç«‹åˆ»å‘å®¢æˆ·ç«¯å‘é€ ACK ç¡®è®¤æ¶ˆæ¯ã€‚</li><li>å½“å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„ ACK å“åº”åï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥ <code>FIN_WAIT_2</code> çŠ¶æ€ï¼Œç„¶åç­‰å¾…æ¥è‡ªæœåŠ¡å™¨çš„ <code>FIN</code> æ¶ˆæ¯</li><li>æœåŠ¡å™¨å‘é€ ACK ç¡®è®¤æ¶ˆæ¯åï¼Œä¸€æ®µæ—¶é—´ï¼ˆå¯ä»¥è¿›è¡Œå…³é—­åï¼‰ä¼šå‘é€ FIN æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯å¯ä»¥è¿›è¡Œå…³é—­ã€‚</li><li>å½“å®¢æˆ·ç«¯æ”¶åˆ°ä»æœåŠ¡ç«¯å‘é€çš„ FIN æ¶ˆæ¯æ—¶ï¼Œå®¢æˆ·ç«¯å°±ä¼šç”± FIN_WAIT_2 çŠ¶æ€å˜ä¸º <code>TIME_WAIT</code> çŠ¶æ€ã€‚å¤„äº TIME_WAIT çŠ¶æ€çš„å®¢æˆ·ç«¯å…è®¸é‡æ–°å‘é€ ACK åˆ°æœåŠ¡å™¨ä¸ºäº†é˜²æ­¢ä¿¡æ¯ä¸¢å¤±ã€‚å®¢æˆ·ç«¯åœ¨ TIME_WAIT çŠ¶æ€ä¸‹èŠ±è´¹çš„æ—¶é—´å–å†³äºå®ƒçš„å®ç°ï¼Œåœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œè¿æ¥å…³é—­ï¼Œå®¢æˆ·ç«¯ä¸Šæ‰€æœ‰çš„èµ„æºï¼ˆåŒ…æ‹¬ç«¯å£å·å’Œç¼“å†²åŒºæ•°æ®ï¼‰éƒ½è¢«é‡Šæ”¾ã€‚</li></ul><p>è¿˜æ˜¯å¯ä»¥ç”¨ä¸Šé¢é‚£ä¸ªé€šè¯çš„ä¾‹å­æ¥è¿›è¡Œæè¿°</p><ul><li>å°æ˜å¯¹å°çº¢è¯´ï¼Œæˆ‘æ‰€æœ‰çš„ä¸œè¥¿éƒ½è¯´å®Œäº†ï¼Œæˆ‘è¦æŒ‚ç”µè¯äº†ã€‚</li><li>å°çº¢è¯´ï¼Œæ”¶åˆ°ï¼Œæˆ‘è¿™è¾¹è¿˜æœ‰ä¸€äº›ä¸œè¥¿æ²¡è¯´ã€‚</li><li>ç»è¿‡è‹¥å¹²ç§’åï¼Œå°çº¢ä¹Ÿè¯´å®Œäº†ï¼Œå°çº¢è¯´ï¼Œæˆ‘è¯´å®Œäº†ï¼Œç°åœ¨å¯ä»¥æŒ‚æ–­äº†</li><li>å°æ˜æ”¶åˆ°æ¶ˆæ¯åï¼Œåˆç­‰äº†è‹¥å¹²æ—¶é—´åï¼ŒæŒ‚æ–­äº†ç”µè¯ã€‚</li></ul><h2 id="ç®€è¿°-HTTP1-0-1-1-2-0-çš„åŒºåˆ«"><a href="#ç®€è¿°-HTTP1-0-1-1-2-0-çš„åŒºåˆ«" class="headerlink" title="ç®€è¿° HTTP1.0/1.1/2.0 çš„åŒºåˆ«"></a>ç®€è¿° HTTP1.0/1.1/2.0 çš„åŒºåˆ«</h2><h3 id="HTTP-1-0"><a href="#HTTP-1-0" class="headerlink" title="HTTP 1.0"></a>HTTP 1.0</h3><p>HTTP 1.0 æ˜¯åœ¨ 1996 å¹´å¼•å…¥çš„ï¼Œä»é‚£æ—¶å¼€å§‹ï¼Œå®ƒçš„æ™®åŠç‡å°±è¾¾åˆ°äº†æƒŠäººçš„æ•ˆæœã€‚</p><ul><li>HTTP 1.0 ä»…ä»…æä¾›äº†æœ€åŸºæœ¬çš„è®¤è¯ï¼Œè¿™æ—¶å€™ç”¨æˆ·åå’Œå¯†ç è¿˜æœªç»åŠ å¯†ï¼Œå› æ­¤å¾ˆå®¹æ˜“æ”¶åˆ°çª¥æ¢ã€‚</li><li>HTTP 1.0 è¢«è®¾è®¡ç”¨æ¥ä½¿ç”¨çŸ­é“¾æ¥ï¼Œå³æ¯æ¬¡å‘é€æ•°æ®éƒ½ä¼šç»è¿‡ TCP çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ï¼Œæ•ˆç‡æ¯”è¾ƒä½ã€‚</li><li>HTTP 1.0 åªä½¿ç”¨ header ä¸­çš„ If-Modified-Since å’Œ Expires ä½œä¸ºç¼“å­˜å¤±æ•ˆçš„æ ‡å‡†ã€‚</li><li>HTTP 1.0 ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡éƒ½ä¼šä¼ é€å…¨éƒ¨çš„é¡µé¢å’Œæ•°æ®ã€‚</li><li>HTTP 1.0 è®¤ä¸ºæ¯å°è®¡ç®—æœºåªèƒ½ç»‘å®šä¸€ä¸ª IPï¼Œæ‰€ä»¥è¯·æ±‚æ¶ˆæ¯ä¸­çš„ URL å¹¶æ²¡æœ‰ä¼ é€’ä¸»æœºåï¼ˆhostnameï¼‰ã€‚</li></ul><h3 id="HTTP-1-1"><a href="#HTTP-1-1" class="headerlink" title="HTTP 1.1"></a>HTTP 1.1</h3><p>HTTP 1.1 æ˜¯ HTTP 1.0 å¼€å‘ä¸‰å¹´åå‡ºç°çš„ï¼Œä¹Ÿå°±æ˜¯ 1999 å¹´ï¼Œå®ƒåšå‡ºäº†ä»¥ä¸‹æ–¹é¢çš„å˜åŒ–</p><ul><li>HTTP 1.1 ä½¿ç”¨äº†æ‘˜è¦ç®—æ³•æ¥è¿›è¡Œèº«ä»½éªŒè¯</li><li>HTTP 1.1 é»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼Œé•¿è¿æ¥å°±æ˜¯åªéœ€ä¸€æ¬¡å»ºç«‹å°±å¯ä»¥ä¼ è¾“å¤šæ¬¡æ•°æ®ï¼Œä¼ è¾“å®Œæˆåï¼Œåªéœ€è¦ä¸€æ¬¡åˆ‡æ–­è¿æ¥å³å¯ã€‚é•¿è¿æ¥çš„è¿æ¥æ—¶é•¿å¯ä»¥é€šè¿‡è¯·æ±‚å¤´ä¸­çš„ <code>keep-alive</code> æ¥è®¾ç½®</li><li>HTTP 1.1 ä¸­æ–°å¢åŠ äº† E-tagï¼ŒIf-Unmodified-Since, If-Match, If-None-Match ç­‰ç¼“å­˜æ§åˆ¶æ ‡å¤´æ¥æ§åˆ¶ç¼“å­˜å¤±æ•ˆã€‚</li><li>HTTP 1.1 æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œé€šè¿‡ä½¿ç”¨è¯·æ±‚å¤´ä¸­çš„ <code>Range</code> æ¥å®ç°ã€‚</li><li>HTTP 1.1 ä½¿ç”¨äº†è™šæ‹Ÿç½‘ç»œï¼Œåœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼ˆMulti-homed Web Serversï¼‰ï¼Œå¹¶ä¸”å®ƒä»¬å…±äº«ä¸€ä¸ªIPåœ°å€ã€‚</li></ul><h3 id="HTTP-2-0"><a href="#HTTP-2-0" class="headerlink" title="HTTP 2.0"></a>HTTP 2.0</h3><p>HTTP 2.0 æ˜¯ 2015 å¹´å¼€å‘å‡ºæ¥çš„æ ‡å‡†ï¼Œå®ƒä¸»è¦åšçš„æ”¹å˜å¦‚ä¸‹</p><ul><li><code>å¤´éƒ¨å‹ç¼©</code>ï¼Œç”±äº HTTP 1.1 ç»å¸¸ä¼šå‡ºç° <strong>User-Agentã€Cookieã€Acceptã€Serverã€Range</strong> ç­‰å­—æ®µå¯èƒ½ä¼šå ç”¨å‡ ç™¾ç”šè‡³å‡ åƒå­—èŠ‚ï¼Œè€Œ Body å´ç»å¸¸åªæœ‰å‡ åå­—èŠ‚ï¼Œæ‰€ä»¥å¯¼è‡´å¤´éƒ¨åé‡ã€‚HTTP 2.0 ä½¿ç”¨ <code>HPACK</code> ç®—æ³•è¿›è¡Œå‹ç¼©ã€‚</li><li><code>äºŒè¿›åˆ¶æ ¼å¼</code>ï¼ŒHTTP 2.0 ä½¿ç”¨äº†æ›´åŠ é è¿‘ TCP/IP çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œè€ŒæŠ›å¼ƒäº† ASCII ç ï¼Œæå‡äº†è§£ææ•ˆç‡</li><li><code>å¼ºåŒ–å®‰å…¨</code>ï¼Œç”±äºå®‰å…¨å·²ç»æˆä¸ºé‡ä¸­ä¹‹é‡ï¼Œæ‰€ä»¥ HTTP2.0 ä¸€èˆ¬éƒ½è·‘åœ¨ HTTPS ä¸Šã€‚</li><li><code>å¤šè·¯å¤ç”¨</code>ï¼Œå³æ¯ä¸€ä¸ªè¯·æ±‚éƒ½æ˜¯æ˜¯ç”¨ä½œè¿æ¥å…±äº«ã€‚ä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªidï¼Œè¿™æ ·ä¸€ä¸ªè¿æ¥ä¸Šå¯ä»¥æœ‰å¤šä¸ªè¯·æ±‚ã€‚</li></ul><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyDcfUyocV41Ivn7j8Zk3gj1cMZNzPKCkGjESbHJBAFScJKfY9GkFX1kQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h2 id="è¯·ä½ è¯´ä¸€ä¸‹-HTTP-å¸¸è§çš„è¯·æ±‚å¤´"><a href="#è¯·ä½ è¯´ä¸€ä¸‹-HTTP-å¸¸è§çš„è¯·æ±‚å¤´" class="headerlink" title="è¯·ä½ è¯´ä¸€ä¸‹ HTTP å¸¸è§çš„è¯·æ±‚å¤´"></a>è¯·ä½ è¯´ä¸€ä¸‹ HTTP å¸¸è§çš„è¯·æ±‚å¤´</h2><p>è¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¼€æ”¾ï¼Œå› ä¸º HTTP è¯·æ±‚å¤´æœ‰å¾ˆå¤šï¼Œè¿™é‡Œåªç®€å•ä¸¾å‡ºå‡ ä¸ªä¾‹å­ã€‚</p><p>HTTP æ ‡å¤´ä¼šåˆ†ä¸ºå››ç§ï¼Œåˆ†åˆ«æ˜¯ <code>é€šç”¨æ ‡å¤´</code>ã€<code>å®ä½“æ ‡å¤´</code>ã€<code>è¯·æ±‚æ ‡å¤´</code>ã€<code>å“åº”æ ‡å¤´</code>ã€‚åˆ†åˆ«ä»‹ç»ä¸€ä¸‹</p><h3 id="é€šç”¨æ ‡å¤´"><a href="#é€šç”¨æ ‡å¤´" class="headerlink" title="é€šç”¨æ ‡å¤´"></a>é€šç”¨æ ‡å¤´</h3><p>é€šç”¨æ ‡å¤´ä¸»è¦æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯ <code>Date</code>ã€<code>Cache-Control</code> å’Œ <code>Connection</code></p><p><strong>Date</strong></p><p>Date æ˜¯ä¸€ä¸ªé€šç”¨æ ‡å¤´ï¼Œå®ƒå¯ä»¥å‡ºç°åœ¨è¯·æ±‚æ ‡å¤´å’Œå“åº”æ ‡å¤´ä¸­ï¼Œå®ƒçš„åŸºæœ¬è¡¨ç¤ºå¦‚ä¸‹</p><pre><code>Date: Wed, 21 Oct 2015 07:28:00 GMT </code></pre><p>è¡¨ç¤ºçš„æ˜¯æ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´è¦æ¯”åŒ—äº¬æ—¶é—´æ…¢å…«ä¸ªå°æ—¶</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyDmzuJXYqHrcAxWIRWaLoXrHCGJeABNUeFW79yCDB9WLaFsdZvKwBXxg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><p><strong>Cache-Control</strong></p><p>Cache-Control æ˜¯ä¸€ä¸ªé€šç”¨æ ‡å¤´ï¼Œä»–å¯ä»¥å‡ºç°åœ¨<code>è¯·æ±‚æ ‡å¤´</code>å’Œ<code>å“åº”æ ‡å¤´</code>ä¸­ï¼ŒCache-Control çš„ç§ç±»æ¯”è¾ƒå¤šï¼Œè™½ç„¶è¯´è¿™æ˜¯ä¸€ä¸ªé€šç”¨æ ‡å¤´ï¼Œä½†æ˜¯æœ‰ä¸€äº›ç‰¹æ€§æ˜¯è¯·æ±‚æ ‡å¤´å…·æœ‰çš„ï¼Œæœ‰ä¸€äº›æ˜¯å“åº”æ ‡å¤´æ‰æœ‰çš„ã€‚ä¸»è¦å¤§ç±»æœ‰ <code>å¯ç¼“å­˜æ€§</code>ã€<code>é˜ˆå€¼æ€§</code>ã€ <code>é‡æ–°éªŒè¯å¹¶é‡æ–°åŠ è½½</code> å’Œ<code>å…¶ä»–ç‰¹æ€§</code></p><p><strong>Connection</strong></p><p>Connection å†³å®šå½“å‰äº‹åŠ¡ï¼ˆä¸€æ¬¡ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ï¼‰å®Œæˆåï¼Œæ˜¯å¦ä¼šå…³é—­ç½‘ç»œè¿æ¥ã€‚Connection æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯<code>æŒä¹…æ€§è¿æ¥</code>ï¼Œå³ä¸€æ¬¡äº‹åŠ¡å®Œæˆåä¸å…³é—­ç½‘ç»œè¿æ¥</p><pre><code>Connection: keep-alive</code></pre><p>å¦ä¸€ç§æ˜¯<code>éæŒä¹…æ€§è¿æ¥</code>ï¼Œå³ä¸€æ¬¡äº‹åŠ¡å®Œæˆåå…³é—­ç½‘ç»œè¿æ¥</p><pre><code>Connection: close</code></pre><p>HTTP1.1 å…¶ä»–é€šç”¨æ ‡å¤´å¦‚ä¸‹</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/libYRuvULTdUPX8o1HyXqaaxrG5kPIzyDWjX0AWOxGVEib9VQ246ib4fplMDVcFPSSia69fd1HHcj2BpWicXtnInkFQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload"></p><h3 id="å®ä½“æ ‡å¤´"><a href="#å®ä½“æ ‡å¤´" class="headerlink" title="å®ä½“æ ‡å¤´"></a>å®ä½“æ ‡å¤´</h3><p>å®ä½“æ ‡å¤´æ˜¯æè¿°æ¶ˆæ¯æ­£æ–‡å†…å®¹çš„ HTTP æ ‡å¤´ã€‚å®ä½“æ ‡å¤´ç”¨äº HTTP è¯·æ±‚å’Œå“åº”ä¸­ã€‚å¤´éƒ¨<code>Content-Length</code>ã€ <code>Content-Language</code>ã€ <code>Content-Encoding</code> æ˜¯å®ä½“å¤´ã€‚</p><ul><li><p>Content-Length å®ä½“æŠ¥å¤´æŒ‡ç¤ºå®ä½“ä¸»ä½“çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œå‘é€åˆ°æ¥æ”¶æ–¹ã€‚</p></li><li><p>Content-Language å®ä½“æŠ¥å¤´æè¿°äº†å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡ç«¯èƒ½å¤Ÿæ¥å—çš„è¯­è¨€ã€‚</p></li><li><p>Content-Encoding è¿™åˆæ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„å±æ€§ï¼Œè¿™ä¸ªå®ä½“æŠ¥å¤´ç”¨æ¥å‹ç¼©åª’ä½“ç±»å‹ã€‚Content-Encoding æŒ‡ç¤ºå¯¹å®ä½“åº”ç”¨äº†ä½•ç§ç¼–ç ã€‚</p><p>å¸¸è§çš„å†…å®¹ç¼–ç æœ‰è¿™å‡ ç§ï¼š <strong>gzipã€compressã€deflateã€identity</strong> ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥åº”ç”¨åœ¨è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ä¸­</p></li></ul><pre><code>Accept-Encoding: gzip, deflate //è¯·æ±‚å¤´Content-Encoding: gzip  //å“åº”å¤´</code></pre><p>ä¸‹é¢æ˜¯ä¸€äº›å®ä½“æ ‡å¤´å­—æ®µ</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><h3 id="è¯·æ±‚æ ‡å¤´"><a href="#è¯·æ±‚æ ‡å¤´" class="headerlink" title="è¯·æ±‚æ ‡å¤´"></a>è¯·æ±‚æ ‡å¤´</h3><p><strong>Host</strong></p><p>Host è¯·æ±‚å¤´æŒ‡æ˜äº†æœåŠ¡å™¨çš„åŸŸåï¼ˆå¯¹äºè™šæ‹Ÿä¸»æœºæ¥è¯´ï¼‰ï¼Œä»¥åŠï¼ˆå¯é€‰çš„ï¼‰æœåŠ¡å™¨ç›‘å¬çš„ TCP ç«¯å£å·ã€‚å¦‚æœæ²¡æœ‰ç»™å®šç«¯å£å·ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨è¢«è¯·æ±‚æœåŠ¡çš„é»˜è®¤ç«¯å£ï¼ˆæ¯”å¦‚è¯·æ±‚ä¸€ä¸ª HTTP çš„ URL ä¼šè‡ªåŠ¨ä½¿ç”¨ 80 ä½œä¸ºç«¯å£ï¼‰ã€‚</p><pre><code>Host: developer.mozilla.org</code></pre><p>ä¸Šé¢çš„ <code>Accpet</code>ã€ <code>Accept-Language</code>ã€<code>Accept-Encoding</code> éƒ½æ˜¯å±äºå†…å®¹åå•†çš„è¯·æ±‚æ ‡å¤´ã€‚</p><p><strong>Referer</strong></p><p>HTTP Referer å±æ€§æ˜¯è¯·æ±‚æ ‡å¤´çš„ä¸€éƒ¨åˆ†ï¼Œå½“æµè§ˆå™¨å‘ web æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå¸¦ä¸Š Refererï¼Œå‘Šè¯‰æœåŠ¡å™¨è¯¥ç½‘é¡µæ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ï¼ŒæœåŠ¡å™¨å› æ­¤å¯ä»¥è·å¾—ä¸€äº›ä¿¡æ¯ç”¨äºå¤„ç†ã€‚</p><pre><code>Referer: https://developer.mozilla.org/testpage.html</code></pre><p><strong>If-Modified-Since</strong></p><p>If-Modified-Since é€šå¸¸ä¼šä¸ If-None-Match æ­é…ä½¿ç”¨ï¼ŒIf-Modified-Since ç”¨äºç¡®è®¤ä»£ç†æˆ–å®¢æˆ·ç«¯æ‹¥æœ‰çš„æœ¬åœ°èµ„æºçš„æœ‰æ•ˆæ€§ã€‚è·å–èµ„æºçš„æ›´æ–°æ—¥æœŸæ—¶é—´ï¼Œå¯é€šè¿‡ç¡®è®¤é¦–éƒ¨å­—æ®µ <code>Last-Modified</code> æ¥ç¡®å®šã€‚</p><p>å¤§ç™½è¯è¯´å°±æ˜¯å¦‚æœåœ¨ <code>Last-Modified</code> ä¹‹åæ›´æ–°äº†æœåŠ¡å™¨èµ„æºï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šå“åº” 200ï¼Œå¦‚æœåœ¨ <code>Last-Modified</code> ä¹‹åæ²¡æœ‰æ›´æ–°è¿‡èµ„æºï¼Œåˆ™è¿”å› 304ã€‚</p><pre><code>If-Modified-Since: Mon, 18 Jul 2016 02:36:04 GMT</code></pre><p><strong>If-None-Match</strong></p><p>If-None-Match HTTP è¯·æ±‚æ ‡å¤´ä½¿è¯·æ±‚æˆä¸ºæ¡ä»¶è¯·æ±‚ã€‚å¯¹äº GET å’Œ HEAD æ–¹æ³•ï¼Œä»…å½“æœåŠ¡å™¨æ²¡æœ‰ä¸ç»™å®šèµ„æºåŒ¹é…çš„ <code>ETag</code> æ—¶ï¼ŒæœåŠ¡å™¨æ‰ä¼šä»¥ 200 çŠ¶æ€å‘é€å›è¯·æ±‚çš„èµ„æºã€‚å¯¹äºå…¶ä»–æ–¹æ³•ï¼Œä»…å½“æœ€ç»ˆç°æœ‰èµ„æºçš„<code>ETag</code>ä¸åˆ—å‡ºçš„ä»»ä½•å€¼éƒ½ä¸åŒ¹é…æ—¶ï¼Œæ‰ä¼šå¤„ç†è¯·æ±‚ã€‚</p><pre><code>If-None-Match: &quot;c561c68d0ba92bbeb8b0fff2a9199f722e3a621a&quot;</code></pre><p><strong>Accept</strong></p><p>æ¥å—è¯·æ±‚ HTTP æ ‡å¤´ä¼šé€šå‘Šå®¢æˆ·ç«¯å…¶èƒ½å¤Ÿç†è§£çš„ MIME ç±»å‹</p><p><strong>Accept-Charset</strong></p><p>accept-charset å±æ€§è§„å®šæœåŠ¡å™¨å¤„ç†è¡¨å•æ•°æ®æ‰€æ¥å—çš„å­—ç¬¦é›†ã€‚</p><p>å¸¸ç”¨çš„å­—ç¬¦é›†æœ‰ï¼šUTF-8 - Unicode å­—ç¬¦ç¼–ç  ï¼›ISO-8859-1 - æ‹‰ä¸å­—æ¯è¡¨çš„å­—ç¬¦ç¼–ç </p><p><strong>Accept-Language</strong></p><p>é¦–éƒ¨å­—æ®µ Accept-Language ç”¨æ¥å‘ŠçŸ¥æœåŠ¡å™¨ç”¨æˆ·ä»£ç†èƒ½å¤Ÿå¤„ç†çš„è‡ªç„¶è¯­è¨€é›†ï¼ˆæŒ‡ä¸­æ–‡æˆ–è‹±æ–‡ç­‰ï¼‰ï¼Œä»¥åŠè‡ªç„¶è¯­è¨€é›†çš„ç›¸å¯¹ä¼˜å…ˆçº§ã€‚å¯ä¸€æ¬¡æŒ‡å®šå¤šç§è‡ªç„¶è¯­è¨€é›†ã€‚</p><p>è¯·æ±‚æ ‡å¤´æˆ‘ä»¬å¤§æ¦‚å°±ä»‹ç»è¿™å‡ ç§ï¼Œåé¢ä¼šæœ‰ä¸€ç¯‡æ–‡ç« è¯¦ç»†æ·±æŒ–æ‰€æœ‰çš„å“åº”å¤´çš„ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå“åº”å¤´çš„æ±‡æ€»ï¼ŒåŸºäº HTTP 1.1</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><h3 id="å“åº”æ ‡å¤´"><a href="#å“åº”æ ‡å¤´" class="headerlink" title="å“åº”æ ‡å¤´"></a>å“åº”æ ‡å¤´</h3><p><strong>Access-Control-Allow-Origin</strong></p><p>ä¸€ä¸ªè¿”å›çš„ HTTP æ ‡å¤´å¯èƒ½ä¼šå…·æœ‰ Access-Control-Allow-Origin ï¼Œ<code>Access-Control-Allow-Origin</code> æŒ‡å®šä¸€ä¸ªæ¥æºï¼Œå®ƒå‘Šè¯‰æµè§ˆå™¨å…è®¸è¯¥æ¥æºè¿›è¡Œèµ„æºè®¿é—®ã€‚</p><p><strong>Keep-Alive</strong></p><p>Keep-Alive è¡¨ç¤ºçš„æ˜¯ Connection éæŒç»­è¿æ¥çš„å­˜æ´»æ—¶é—´ï¼Œå¯ä»¥è¿›è¡ŒæŒ‡å®šã€‚</p><p><strong>Server</strong></p><p>æœåŠ¡å™¨æ ‡å¤´åŒ…å«æœ‰å…³åŸå§‹æœåŠ¡å™¨ç”¨æ¥å¤„ç†è¯·æ±‚çš„è½¯ä»¶çš„ä¿¡æ¯ã€‚</p><p>åº”è¯¥é¿å…ä½¿ç”¨è¿‡äºå†—é•¿å’Œè¯¦ç»†çš„ Server å€¼ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šæ³„éœ²å†…éƒ¨å®æ–½ç»†èŠ‚ï¼Œè¿™å¯èƒ½ä¼šä½¿æ”»å‡»è€…å®¹æ˜“åœ°å‘ç°å¹¶åˆ©ç”¨å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ç§å†™æ³•</p><pre><code>Server: Apache/2.4.1 (Unix)</code></pre><p><strong>Set-Cookie</strong></p><p>Set-Cookie ç”¨äºæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ sessionIDã€‚</p><p><strong>Transfer-Encoding</strong></p><p>é¦–éƒ¨å­—æ®µ Transfer-Encoding è§„å®šäº†ä¼ è¾“æŠ¥æ–‡ä¸»ä½“æ—¶é‡‡ç”¨çš„ç¼–ç æ–¹å¼ã€‚</p><p>HTTP /1.1 çš„ä¼ è¾“ç¼–ç æ–¹å¼ä»…å¯¹åˆ†å—ä¼ è¾“ç¼–ç æœ‰æ•ˆã€‚</p><p><strong>X-Frame-Options</strong></p><p>HTTP é¦–éƒ¨å­—æ®µæ˜¯å¯ä»¥è‡ªè¡Œæ‰©å±•çš„ã€‚æ‰€ä»¥åœ¨ Web æœåŠ¡å™¨å’Œæµè§ˆå™¨çš„åº”ç”¨ä¸Šï¼Œä¼šå‡ºç°å„ç§éæ ‡å‡†çš„é¦–éƒ¨å­—æ®µã€‚</p><p>é¦–éƒ¨å­—æ®µ <code>X-Frame-Options</code> å±äº HTTP å“åº”é¦–éƒ¨ï¼Œç”¨äºæ§åˆ¶ç½‘ç«™å†…å®¹åœ¨å…¶ä»– Web ç½‘ç«™çš„ Frame æ ‡ç­¾å†…çš„æ˜¾ç¤ºé—®é¢˜ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢ç‚¹å‡»åŠ«æŒï¼ˆclickjackingï¼‰æ”»å‡»ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå“åº”å¤´çš„æ±‡æ€»ï¼ŒåŸºäº HTTP 1.1</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><h2 id="åœ°å€æ è¾“å…¥-URL-å‘ç”Ÿäº†ä»€ä¹ˆ"><a href="#åœ°å€æ è¾“å…¥-URL-å‘ç”Ÿäº†ä»€ä¹ˆ" class="headerlink" title="åœ°å€æ è¾“å…¥ URL å‘ç”Ÿäº†ä»€ä¹ˆ"></a>åœ°å€æ è¾“å…¥ URL å‘ç”Ÿäº†ä»€ä¹ˆ</h2><p>è¿™é“é¢˜ä¹Ÿæ˜¯ä¸€é“ç»å¸¸ä¼šè€ƒçš„é¢è¯•é¢˜ã€‚é‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°±æ¥æ¢è®¨ä¸€ä¸‹ä»ä½ è¾“å…¥ URL ååˆ°å“åº”ï¼Œéƒ½ç»å†äº†å“ªäº›è¿‡ç¨‹ã€‚</p><ul><li>é¦–å…ˆï¼Œä½ éœ€è¦åœ¨æµè§ˆå™¨ä¸­çš„ URL åœ°å€ä¸Šï¼Œè¾“å…¥ä½ æƒ³è®¿é—®çš„åœ°å€ï¼Œå¦‚ä¸‹</li></ul><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>ä½ åº”è¯¥è®¿é—®ä¸åˆ°çš„ï¼Œå¯¹ä¸å¯¹~</p><ul><li>ç„¶åï¼Œæµè§ˆå™¨ä¼šæ ¹æ®ä½ è¾“å…¥çš„ URL åœ°å€ï¼Œå»æŸ¥æ‰¾åŸŸåæ˜¯å¦è¢«æœ¬åœ° DNS ç¼“å­˜ï¼Œä¸åŒæµè§ˆå™¨å¯¹ DNS çš„è®¾ç½®ä¸åŒï¼Œå¦‚æœæµè§ˆå™¨ç¼“å­˜äº†ä½ æƒ³è®¿é—®çš„ URL åœ°å€ï¼Œé‚£å°±ç›´æ¥è¿”å› ipã€‚å¦‚æœæ²¡æœ‰ç¼“å­˜ä½ çš„ URL åœ°å€ï¼Œæµè§ˆå™¨å°±ä¼šå‘èµ·ç³»ç»Ÿè°ƒç”¨æ¥æŸ¥è¯¢æœ¬æœº <code>hosts</code> æ–‡ä»¶æ˜¯å¦æœ‰é…ç½® ip åœ°å€ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œç›´æ¥è¿”å›ã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±å‘ç½‘ç»œä¸­å‘èµ·ä¸€ä¸ª DNS æŸ¥è¯¢ã€‚</li></ul><blockquote><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ DNS æ˜¯å•¥ï¼Œäº’è”ç½‘ä¸­è¯†åˆ«ä¸»æœºçš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œé€šè¿‡<code>ä¸»æœºå</code>å’Œ <code>IP åœ°å€</code>ã€‚æˆ‘ä»¬äººå–œæ¬¢ç”¨åå­—çš„æ–¹å¼è¿›è¡Œè®°å¿†ï¼Œä½†æ˜¯é€šä¿¡é“¾è·¯ä¸­çš„è·¯ç”±å´å–œæ¬¢å®šé•¿ã€æœ‰å±‚æ¬¡ç»“æ„çš„ IP åœ°å€ã€‚</p><p>æ‰€ä»¥å°±éœ€è¦ä¸€ç§èƒ½å¤ŸæŠŠä¸»æœºååˆ° IP åœ°å€çš„è½¬æ¢æœåŠ¡ï¼Œè¿™ç§æœåŠ¡å°±æ˜¯ç”± DNS æä¾›çš„ã€‚DNS çš„å…¨ç§°æ˜¯ <code>Domain Name System</code> åŸŸåç³»ç»Ÿã€‚DNS æ˜¯ä¸€ç§ç”±åˆ†å±‚çš„ DNS æœåŠ¡å™¨å®ç°çš„åˆ†å¸ƒå¼æ•°æ®åº“ã€‚DNS è¿è¡Œåœ¨ UDP ä¸Šï¼Œä½¿ç”¨ 53 ç«¯å£ã€‚</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p></blockquote><p>DNS æ˜¯ä¸€ç§åˆ†å±‚æ•°æ®åº“ï¼Œå®ƒçš„ä¸»è¦å±‚æ¬¡ç»“æ„å¦‚ä¸‹</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>ä¸€èˆ¬åŸŸåæœåŠ¡å™¨çš„å±‚æ¬¡ç»“æ„ä¸»è¦æ˜¯ä»¥ä¸Šä¸‰ç§ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç±»é‡è¦çš„ DNS æœåŠ¡å™¨ï¼Œå®ƒæ˜¯ <code>æœ¬åœ° DNS æœåŠ¡å™¨(local DNS server)</code>ã€‚</p><p>ä¸¥æ ¼æ¥è¯´ï¼Œæœ¬åœ° DNS æœåŠ¡å™¨å¹¶ä¸å±äºä¸Šè¿°å±‚æ¬¡ç»“æ„ï¼Œä½†æ˜¯æœ¬åœ° DNS æœåŠ¡å™¨åˆæ˜¯è‡³å…³é‡è¦çš„ã€‚æ¯ä¸ª <code>ISP(Internet Service Provider)</code> æ¯”å¦‚å±…æ°‘åŒºçš„ ISP æˆ–è€…ä¸€ä¸ªæœºæ„çš„ ISP éƒ½æœ‰ä¸€å°æœ¬åœ° DNS æœåŠ¡å™¨ã€‚å½“ä¸»æœºå’Œ ISP è¿›è¡Œè¿æ¥æ—¶ï¼Œè¯¥ ISP ä¼šæä¾›ä¸€å°ä¸»æœºçš„ IP åœ°å€ï¼Œè¯¥ä¸»æœºä¼šå…·æœ‰ä¸€å°æˆ–å¤šå°å…¶æœ¬åœ° DNS æœåŠ¡å™¨çš„ IPåœ°å€ã€‚</p><p>é€šè¿‡è®¿é—®ç½‘ç»œè¿æ¥ï¼Œç”¨æˆ·èƒ½å¤Ÿå®¹æ˜“çš„ç¡®å®š DNS æœåŠ¡å™¨çš„ IPåœ°å€ã€‚å½“ä¸»æœºå‘å‡º DNS è¯·æ±‚åï¼Œè¯¥è¯·æ±‚è¢«å‘å¾€æœ¬åœ° DNS æœåŠ¡å™¨ï¼Œå®ƒèµ·ç€ä»£ç†çš„ä½œç”¨ï¼Œå¹¶å°†è¯¥è¯·æ±‚è½¬å‘åˆ° DNS æœåŠ¡å™¨å±‚æ¬¡ç³»ç»Ÿä¸­ã€‚</p><p>é¦–å…ˆï¼ŒæŸ¥è¯¢è¯·æ±‚ä¼šå…ˆæ‰¾åˆ°æœ¬åœ° DNS æœåŠ¡å™¨æ¥æŸ¥è¯¢æ˜¯å¦åŒ…å« IP åœ°å€ï¼Œå¦‚æœæœ¬åœ° DNS æ— æ³•æŸ¥è¯¢åˆ°ç›®æ ‡ IP åœ°å€ï¼Œå°±ä¼šå‘æ ¹åŸŸåæœåŠ¡å™¨å‘èµ·ä¸€ä¸ª DNS æŸ¥è¯¢ã€‚</p><blockquote><p>æ³¨æ„ï¼šDNS æ¶‰åŠä¸¤ç§æŸ¥è¯¢æ–¹å¼ï¼šä¸€ç§æ˜¯<code>é€’å½’æŸ¥è¯¢(Recursive query)</code> ï¼Œä¸€ç§æ˜¯<code>è¿­ä»£æŸ¥è¯¢(Iteration query)</code>ã€‚ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹ç«Ÿç„¶æ²¡æœ‰ç»™å‡ºé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢çš„åŒºåˆ«ï¼Œæ‰¾äº†ä¸€ä¸‹ç½‘ä¸Šçš„èµ„æ–™å¤§æ¦‚æ˜ç™½äº†ä¸‹ã€‚</p><p>å¦‚æœæ ¹åŸŸåæœåŠ¡å™¨æ— æ³•å‘ŠçŸ¥æœ¬åœ° DNS æœåŠ¡å™¨ä¸‹ä¸€æ­¥éœ€è¦è®¿é—®å“ªä¸ªé¡¶çº§åŸŸåæœåŠ¡å™¨ï¼Œå°±ä¼šä½¿ç”¨é€’å½’æŸ¥è¯¢ï¼›</p><p>å¦‚æœæ ¹åŸŸåæœåŠ¡å™¨èƒ½å¤Ÿå‘ŠçŸ¥ DNS æœåŠ¡å™¨ä¸‹ä¸€æ­¥éœ€è¦è®¿é—®çš„é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼Œå°±ä¼šä½¿ç”¨è¿­ä»£æŸ¥è¯¢ã€‚</p></blockquote><p>åœ¨ç”±æ ¹åŸŸåæœåŠ¡å™¨ -&gt; é¡¶çº§åŸŸåæœåŠ¡å™¨ -&gt; æƒå¨ DNS æœåŠ¡å™¨åï¼Œç”±æƒå¨æœåŠ¡å™¨å‘Šè¯‰æœ¬åœ°æœåŠ¡å™¨ç›®æ ‡ IP åœ°å€ï¼Œå†æœ‰æœ¬åœ° DNS æœåŠ¡å™¨å‘Šè¯‰ç”¨æˆ·éœ€è¦è®¿é—®çš„ IP åœ°å€ã€‚</p><ul><li>ç¬¬ä¸‰æ­¥ï¼Œæµè§ˆå™¨éœ€è¦å’Œç›®æ ‡æœåŠ¡å™¨å»ºç«‹ TCP è¿æ¥ï¼Œéœ€è¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ï¼Œå…·ä½“çš„æ¡æ‰‹è¿‡ç¨‹è¯·å‚è€ƒä¸Šé¢çš„å›ç­”ã€‚</li><li>åœ¨å»ºç«‹è¿æ¥åï¼Œæµè§ˆå™¨ä¼šå‘ç›®æ ‡æœåŠ¡å™¨å‘èµ· <code>HTTP-GET</code> è¯·æ±‚ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„ URLï¼ŒHTTP 1.1 åé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼Œåªéœ€è¦ä¸€æ¬¡æ¡æ‰‹å³å¯å¤šæ¬¡ä¼ è¾“æ•°æ®ã€‚</li><li>å¦‚æœç›®æ ‡æœåŠ¡å™¨åªæ˜¯ä¸€ä¸ªç®€å•çš„é¡µé¢ï¼Œå°±ä¼šç›´æ¥è¿”å›ã€‚ä½†æ˜¯å¯¹äºæŸäº›å¤§å‹ç½‘ç«™çš„ç«™ç‚¹ï¼Œå¾€å¾€ä¸ä¼šç›´æ¥è¿”å›ä¸»æœºåæ‰€åœ¨çš„é¡µé¢ï¼Œè€Œä¼šç›´æ¥é‡å®šå‘ã€‚è¿”å›çš„çŠ¶æ€ç å°±ä¸æ˜¯ 200 ï¼Œè€Œæ˜¯ 301,302 ä»¥ 3 å¼€å¤´çš„é‡å®šå‘ç ï¼Œæµè§ˆå™¨åœ¨è·å–äº†é‡å®šå‘å“åº”åï¼Œåœ¨å“åº”æŠ¥æ–‡ä¸­ Location é¡¹æ‰¾åˆ°é‡å®šå‘åœ°å€ï¼Œæµè§ˆå™¨é‡æ–°ç¬¬ä¸€æ­¥è®¿é—®å³å¯ã€‚</li><li>ç„¶åæµè§ˆå™¨é‡æ–°å‘é€è¯·æ±‚ï¼Œæºå¸¦æ–°çš„ URLï¼Œè¿”å›çŠ¶æ€ç  200 OKï¼Œè¡¨ç¤ºæœåŠ¡å™¨å¯ä»¥å“åº”è¯·æ±‚ï¼Œè¿”å›æŠ¥æ–‡ã€‚</li></ul><h2 id="HTTPS-çš„å·¥ä½œåŸç†"><a href="#HTTPS-çš„å·¥ä½œåŸç†" class="headerlink" title="HTTPS çš„å·¥ä½œåŸç†"></a>HTTPS çš„å·¥ä½œåŸç†</h2><p>æˆ‘ä»¬ä¸Šé¢æè¿°äº†ä¸€ä¸‹ HTTP çš„å·¥ä½œåŸç†ï¼Œä¸‹é¢æ¥è®²è¿°ä¸€ä¸‹ HTTPS çš„å·¥ä½œåŸç†ã€‚å› ä¸ºæˆ‘ä»¬çŸ¥é“ HTTPS ä¸æ˜¯ä¸€ç§æ–°å‡ºç°çš„åè®®ï¼Œè€Œæ˜¯</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æ¢è®¨ HTTPS çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯ SSL/TLS çš„æ¡æ‰‹è¿‡ç¨‹ã€‚</p><p>TLS æ—¨åœ¨ä¸º Internet æä¾›é€šä¿¡å®‰å…¨çš„åŠ å¯†åè®®ã€‚TLS æ¡æ‰‹æ˜¯å¯åŠ¨å’Œä½¿ç”¨ TLS åŠ å¯†çš„é€šä¿¡ä¼šè¯çš„è¿‡ç¨‹ã€‚åœ¨ TLS æ¡æ‰‹æœŸé—´ï¼ŒInternet ä¸­çš„é€šä¿¡åŒæ–¹ä¼šå½¼æ­¤äº¤æ¢ä¿¡æ¯ï¼ŒéªŒè¯å¯†ç å¥—ä»¶ï¼Œäº¤æ¢ä¼šè¯å¯†é’¥ã€‚</p><p>æ¯å½“ç”¨æˆ·é€šè¿‡ HTTPS å¯¼èˆªåˆ°å…·ä½“çš„ç½‘ç«™å¹¶å‘é€è¯·æ±‚æ—¶ï¼Œå°±ä¼šè¿›è¡Œ TLS æ¡æ‰‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯å½“å…¶ä»–ä»»ä½•é€šä¿¡ä½¿ç”¨HTTPSï¼ˆåŒ…æ‹¬ API è°ƒç”¨å’Œåœ¨ HTTPS ä¸ŠæŸ¥è¯¢ DNSï¼‰æ—¶ï¼Œä¹Ÿä¼šå‘ç”Ÿ TLS æ¡æ‰‹ã€‚</p><p>TLS å…·ä½“çš„æ¡æ‰‹è¿‡ç¨‹ä¼šæ ¹æ®æ‰€ä½¿ç”¨çš„<code>å¯†é’¥äº¤æ¢ç®—æ³•çš„ç±»å‹</code>å’ŒåŒæ–¹æ”¯æŒçš„<code>å¯†ç å¥—ä»¶</code>è€Œä¸åŒã€‚æˆ‘ä»¬ä»¥<code>RSA éå¯¹ç§°åŠ å¯†</code>æ¥è®¨è®ºè¿™ä¸ªè¿‡ç¨‹ã€‚æ•´ä¸ª TLS é€šä¿¡æµç¨‹å›¾å¦‚ä¸‹</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><ul><li>åœ¨è¿›è¡Œé€šä¿¡å‰ï¼Œé¦–å…ˆä¼šè¿›è¡Œ HTTP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œæ¡æ‰‹å®Œæˆåï¼Œå†è¿›è¡Œ TLS çš„æ¡æ‰‹è¿‡ç¨‹</li><li>ClientHelloï¼šå®¢æˆ·ç«¯é€šè¿‡å‘æœåŠ¡å™¨å‘é€ <code>hello</code> æ¶ˆæ¯æ¥å‘èµ·æ¡æ‰‹è¿‡ç¨‹ã€‚è¿™ä¸ªæ¶ˆæ¯ä¸­ä¼šå¤¹å¸¦ç€å®¢æˆ·ç«¯æ”¯æŒçš„ <code>TLS ç‰ˆæœ¬å·(TLS1.0 ã€TLS1.2ã€TLS1.3)</code> ã€å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶ã€ä»¥åŠä¸€ä¸² <code>å®¢æˆ·ç«¯éšæœºæ•°</code>ã€‚</li><li>ServerHelloï¼šåœ¨å®¢æˆ·ç«¯å‘é€ hello æ¶ˆæ¯åï¼ŒæœåŠ¡å™¨ä¼šå‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¿™æ¡æ¶ˆæ¯åŒ…å«äº†æœåŠ¡å™¨çš„ SSL è¯ä¹¦ã€æœåŠ¡å™¨é€‰æ‹©çš„å¯†ç å¥—ä»¶å’ŒæœåŠ¡å™¨ç”Ÿæˆçš„éšæœºæ•°ã€‚</li><li>è®¤è¯(Authentication)ï¼šå®¢æˆ·ç«¯çš„è¯ä¹¦é¢å‘æœºæ„ä¼šè®¤è¯ SSL è¯ä¹¦ï¼Œç„¶åå‘é€ <code>Certificate</code> æŠ¥æ–‡ï¼ŒæŠ¥æ–‡ä¸­åŒ…å«å…¬å¼€å¯†é’¥è¯ä¹¦ã€‚æœ€åæœåŠ¡å™¨å‘é€ <code>ServerHelloDone</code> ä½œä¸º <code>hello</code> è¯·æ±‚çš„å“åº”ã€‚ç¬¬ä¸€éƒ¨åˆ†æ¡æ‰‹é˜¶æ®µç»“æŸã€‚</li><li><code>åŠ å¯†é˜¶æ®µ</code>ï¼šåœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µæ¡æ‰‹å®Œæˆåï¼Œå®¢æˆ·ç«¯ä¼šå‘é€ <code>ClientKeyExchange</code> ä½œä¸ºå“åº”ï¼Œè¿™ä¸ªå“åº”ä¸­åŒ…å«äº†ä¸€ç§ç§°ä¸º <code>The premaster secret</code> çš„å¯†é’¥å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä½¿ç”¨ä¸Šé¢å…¬å¼€å¯†é’¥è¯ä¹¦è¿›è¡ŒåŠ å¯†çš„å­—ç¬¦ä¸²ã€‚éšåå®¢æˆ·ç«¯ä¼šå‘é€ <code>ChangeCipherSpec</code>ï¼Œå‘Šè¯‰æœåŠ¡ç«¯ä½¿ç”¨ç§é’¥è§£å¯†è¿™ä¸ª <code>premaster secret</code> çš„å­—ç¬¦ä¸²ï¼Œç„¶åå®¢æˆ·ç«¯å‘é€ <code>Finished</code> å‘Šè¯‰æœåŠ¡ç«¯è‡ªå·±å‘é€å®Œæˆäº†ã€‚</li></ul><blockquote><p>Session key å…¶å®å°±æ˜¯ç”¨å…¬é’¥è¯ä¹¦åŠ å¯†çš„å…¬é’¥ã€‚</p></blockquote><ul><li><code>å®ç°äº†å®‰å…¨çš„éå¯¹ç§°åŠ å¯†</code>ï¼šç„¶åï¼ŒæœåŠ¡å™¨å†å‘é€ <code>ChangeCipherSpec</code> å’Œ <code>Finished</code> å‘Šè¯‰å®¢æˆ·ç«¯è§£å¯†å®Œæˆï¼Œè‡³æ­¤å®ç°äº† RSA çš„éå¯¹ç§°åŠ å¯†ã€‚</li></ul><h2 id="TCPæ‹¥å¡æ§åˆ¶"><a href="#TCPæ‹¥å¡æ§åˆ¶" class="headerlink" title="TCPæ‹¥å¡æ§åˆ¶"></a>TCPæ‹¥å¡æ§åˆ¶</h2><p><strong>TCPæ‹¥å¡æ§åˆ¶</strong>æ˜¯<a href="https://baike.baidu.com/item/ä¼ è¾“æ§åˆ¶åè®®" target="_blank" rel="noopener">ä¼ è¾“æ§åˆ¶åè®®</a>ï¼ˆè‹±è¯­ï¼šTransmission Control Protocolï¼Œç¼©å†™TCPï¼‰é¿å…ç½‘ç»œæ‹¥å¡çš„ç®—æ³•ï¼Œæ˜¯<a href="https://baike.baidu.com/item/äº’è”ç½‘" target="_blank" rel="noopener">äº’è”ç½‘</a>ä¸Šä¸»è¦çš„ä¸€ä¸ª<a href="https://baike.baidu.com/item/æ‹¥å¡æ§åˆ¶" target="_blank" rel="noopener">æ‹¥å¡æ§åˆ¶</a>æªæ–½ã€‚å®ƒä½¿ç”¨ä¸€å¥—åŸºäºçº¿å¢ç§¯å‡æ¨¡å¼çš„å¤šæ ·åŒ–ç½‘ç»œæ‹¥å¡æ§åˆ¶æ–¹æ³•ï¼ˆåŒ…æ‹¬æ…¢å¯åŠ¨å’Œæ‹¥å¡çª—å£ç­‰æ¨¡å¼ï¼‰æ¥æ§åˆ¶æ‹¥å¡ã€‚åœ¨äº’è”ç½‘ä¸Šåº”ç”¨ä¸­æœ‰ç›¸å½“å¤šçš„å…·ä½“å®ç°ç®—æ³•ã€‚</p>  <script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>    const btw = new BTWPlugin();    btw.init({        id: 'post-content',        blogId: '24566-1604926750091-584',        name: 'BestBear',        qrcode: 'https://s1.ax1x.com/2020/11/09/BbCVyQ.jpg',        keyword: '666',    });</script>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“</title>
      <link href="/2020/01/15/5.%20%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>/2020/01/15/5.%20%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h2 id="æ•°æ®åº“ä¸‰èŒƒå¼"><a href="#æ•°æ®åº“ä¸‰èŒƒå¼" class="headerlink" title="æ•°æ®åº“ä¸‰èŒƒå¼"></a>æ•°æ®åº“ä¸‰èŒƒå¼</h2><p>èŒƒå¼å°±æ˜¯è§„èŒƒï¼Œè¦æ»¡è¶³ç¬¬äºŒèŒƒå¼å¿…é¡»å…ˆæ»¡è¶³ç¬¬ä¸€èŒƒå¼ï¼Œè¦æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼Œå¿…é¡»è¦å…ˆæ»¡è¶³ç¬¬äºŒèŒƒå¼ã€‚</p><ul><li>1NF(ç¬¬ä¸€èŒƒå¼)ï¼šåˆ—æ•°æ®ä¸å¯åˆ†å‰²ï¼Œå³ä¸€åˆ—ä¸èƒ½æœ‰å¤šä¸ªå€¼</li><li>2NF(ç¬¬äºŒèŒƒå¼)ï¼šä¸»é”®(æ¯ä¸€è¡Œéƒ½æœ‰å”¯ä¸€æ ‡è¯†)</li><li>3NF(ç¬¬ä¸‰èŒƒå¼)ï¼šå¤–é”®(è¡¨ä¸­ä¸åŒ…å«å·²åœ¨å…¶ä»–è¡¨ä¸­åŒ…å«çš„éä¸»å…³é”®ä¿¡æ¯)</li></ul><h2 id="count-1-ã€count-ä¸count-åˆ—å-çš„åŒºåˆ«"><a href="#count-1-ã€count-ä¸count-åˆ—å-çš„åŒºåˆ«" class="headerlink" title="count(1)ã€count(*)ä¸count(åˆ—å)çš„åŒºåˆ«"></a>count(1)ã€count(*)ä¸count(åˆ—å)çš„åŒºåˆ«</h2><p>æ‰§è¡Œæ•ˆæœä¸Šï¼š </p><p>count(*)=count(1)&lt;&gt;count(åˆ—å)</p><p>count(*)åŒ…æ‹¬äº†æ‰€æœ‰çš„åˆ—ï¼Œç›¸å½“äºè¡Œæ•°ï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¸ä¼šå¿½ç•¥åˆ—å€¼ä¸ºNULL </p><p>count(1)åŒ…æ‹¬äº†å¿½ç•¥æ‰€æœ‰åˆ—ï¼Œç”¨1ä»£è¡¨ä»£ç è¡Œï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¸ä¼šå¿½ç•¥åˆ—å€¼ä¸ºNULL </p><p>count(åˆ—å)åªåŒ…æ‹¬åˆ—åé‚£ä¸€åˆ—ï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¼šå¿½ç•¥åˆ—å€¼ä¸ºç©ºä¸ç»Ÿè®¡ã€‚</p><h2 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h2><h3 id="æŸ¥çœ‹è¡¨çš„å­˜å‚¨å¼•æ“"><a href="#æŸ¥çœ‹è¡¨çš„å­˜å‚¨å¼•æ“" class="headerlink" title="æŸ¥çœ‹è¡¨çš„å­˜å‚¨å¼•æ“"></a><strong>æŸ¥çœ‹è¡¨çš„å­˜å‚¨å¼•æ“</strong></h3><pre><code class="sql">show table status like &quot;table_name&quot; ;</code></pre><h3 id="MyISAMå’ŒInnoDBåŒºåˆ«"><a href="#MyISAMå’ŒInnoDBåŒºåˆ«" class="headerlink" title="MyISAMå’ŒInnoDBåŒºåˆ«"></a>MyISAMå’ŒInnoDBåŒºåˆ«</h3><ol><li><p><strong>æ˜¯å¦æ”¯æŒè¡Œçº§é”</strong> : MyISAM åªæœ‰è¡¨çº§é”(table-level locking)ï¼Œè€ŒInnoDB æ”¯æŒè¡Œçº§é”(row-level locking)å’Œè¡¨çº§é”,é»˜è®¤ä¸ºè¡Œçº§é”ã€‚</p></li><li><p><strong>æ˜¯å¦æ”¯æŒäº‹åŠ¡å’Œå´©æºƒåçš„å®‰å…¨æ¢å¤ï¼š MyISAM</strong> å¼ºè°ƒçš„æ˜¯æ€§èƒ½ï¼Œæ¯æ¬¡æŸ¥è¯¢å…·æœ‰åŸå­æ€§,å…¶æ‰§è¡Œé€Ÿåº¦æ¯”InnoDBç±»å‹æ›´å¿«ï¼Œä½†æ˜¯ä¸æä¾›äº‹åŠ¡æ”¯æŒã€‚ä½†æ˜¯<strong>InnoDB</strong> æä¾›äº‹åŠ¡æ”¯æŒäº‹åŠ¡ï¼Œå¤–éƒ¨é”®ç­‰é«˜çº§æ•°æ®åº“åŠŸèƒ½ã€‚ å…·æœ‰äº‹åŠ¡(commit)ã€å›æ»š(rollback)å’Œå´©æºƒä¿®å¤èƒ½åŠ›(crash recovery capabilities)çš„äº‹åŠ¡å®‰å…¨(transaction-safe (ACID compliant))å‹è¡¨ã€‚</p></li><li><p><strong>æ˜¯å¦æ”¯æŒå¤–é”®ï¼š</strong> MyISAMä¸æ”¯æŒï¼Œè€ŒInnoDBæ”¯æŒã€‚</p></li><li><p><strong>æ˜¯å¦æ”¯æŒMVCC</strong> ï¼šä»… InnoDB æ”¯æŒã€‚åº”å¯¹é«˜å¹¶å‘äº‹åŠ¡, MVCCæ¯”å•çº¯çš„åŠ é”æ›´é«˜æ•ˆ;MVCCåªåœ¨ <code>READ COMMITTED</code> å’Œ <code>REPEATABLE READ</code> ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹å·¥ä½œ;MVCCå¯ä»¥ä½¿ç”¨ ä¹è§‚(optimistic)é” å’Œ æ‚²è§‚(pessimistic)é”æ¥å®ç°;å„æ•°æ®åº“ä¸­MVCCå®ç°å¹¶ä¸ç»Ÿä¸€ã€‚æ¨èé˜…è¯»ï¼š<a href="https://segmentfault.com/a/1190000012650596" target="_blank" rel="noopener">MySQL-InnoDB-MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</a></p><p>â€‹        <code>MVCCåè®®</code>ä¸­,æ¯ä¸ªç”¨æˆ·åœ¨è¿æ¥æ•°æ®åº“æ—¶çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªå…·æœ‰ä¸€è‡´æ€§çŠ¶æ€çš„é•œåƒ,æ¯ä¸ªäº‹åŠ¡åœ¨æäº¤åˆ°æ•°æ®åº“ä¹‹å‰å¯¹å…¶ä»–ç”¨æˆ·å‡æ˜¯ä¸å¯è§çš„ã€‚å½“äº‹åŠ¡éœ€è¦æ›´æ–°æ•°æ®æ—¶,ä¸ä¼šç›´æ¥è¦†ç›–ä»¥å‰çš„æ•°æ®,è€Œæ˜¯ç”Ÿæˆâ€”ä¸ªæ–°çš„ç‰ˆæœ¬çš„æ•°æ®,å› æ­¤ä¸€æ¡æ•°æ®ä¼šæœ‰å¤šä¸ªç‰ˆæœ¬å­˜å‚¨,ä½†æ˜¯åŒä¸€æ—¶åˆ»åªæœ‰æœ€æ–°çš„ç‰ˆæœ¬å·æ˜¯æœ‰æ•ˆçš„ã€‚å› æ­¤,è¯»çš„æ—¶å€™å°±å¯ä»¥ä¿è¯æ€»æ˜¯ä»¥å½“å‰æ—¶åˆ»çš„ç‰ˆæœ¬çš„æ•°æ®å¯ä»¥è¢«è¯»åˆ°,ä¸è®ºè¿™æ¡æ•°æ®åæ¥æ˜¯å¦è¢«ä¿®æ”¹æˆ–åˆ é™¤ã€‚</p><p><code>undo log</code>æ˜¯InnoDB MVCCäº‹åŠ¡ç‰¹æ€§çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å½“æˆ‘ä»¬å¯¹è®°å½•åšäº†å˜æ›´æ“ä½œæ—¶å°±ä¼šäº§ç”Ÿundoè®°å½•ï¼Œundoè®°å½•ä¸­å­˜å‚¨çš„æ˜¯è€ç‰ˆæœ¬æ•°æ®ï¼Œå½“ä¸€ä¸ªæ—§çš„äº‹åŠ¡éœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œä¸ºäº†èƒ½è¯»å–åˆ°è€ç‰ˆæœ¬çš„æ•°æ®ï¼Œéœ€è¦é¡ºç€undoé“¾æ‰¾åˆ°æ»¡è¶³å…¶å¯è§æ€§çš„è®°å½•ã€‚</p></li></ol><ol start="5"><li><strong>MyISAM</strong>ä¸»é”®ç´¢å¼•æ˜¯éèšé›†ç´¢å¼•ï¼Œå­˜å‚¨çš„æ•°æ®ä¸ç´¢å¼•åˆ†ç¦»ï¼Œéœ€è¦å›è¡¨ã€‚è€Œ<strong>InnoDB</strong>ä¸»é”®ç´¢å¼•æ˜¯èšé›†ç´¢å¼•ã€‚</li></ol><p>InnoDBçš„é€Ÿåº¦éƒ½å¯ä»¥è®©MyISAMæœ›å°˜è«åŠï¼Œå°¤å…¶æ˜¯ç”¨åˆ°äº†èšç°‡ç´¢å¼•ï¼Œæˆ–è€…éœ€è¦è®¿é—®çš„æ•°æ®éƒ½å¯ä»¥æ”¾å…¥å†…å­˜çš„åº”ç”¨ã€‚</p><p><strong>è¡¨çº§é”å’Œè¡Œçº§é”å¯¹æ¯”ï¼š</strong></p><ul><li><strong>è¡¨çº§é”ï¼š</strong> MySQLä¸­é”å®š <strong>ç²’åº¦æœ€å¤§</strong> çš„ä¸€ç§é”ï¼Œå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°‘ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚å…¶é”å®šç²’åº¦æœ€å¤§ï¼Œè§¦å‘é”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ï¼ŒMyISAMå’Œ InnoDBå¼•æ“éƒ½æ”¯æŒè¡¨çº§é”ã€‚</li><li><strong>è¡Œçº§é”ï¼š</strong> MySQLä¸­é”å®š <strong>ç²’åº¦æœ€å°</strong> çš„ä¸€ç§é”ï¼Œåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè¿›è¡ŒåŠ é”ã€‚ è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œå¹¶å‘åº¦é«˜ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”ã€‚</li></ul><h2 id="ç´¢å¼•ç¯‡"><a href="#ç´¢å¼•ç¯‡" class="headerlink" title="ç´¢å¼•ç¯‡"></a>ç´¢å¼•ç¯‡</h2><h3 id="ç´¢å¼•çš„æ•°æ®ç»“æ„-åº•å±‚å®ç°"><a href="#ç´¢å¼•çš„æ•°æ®ç»“æ„-åº•å±‚å®ç°" class="headerlink" title="ç´¢å¼•çš„æ•°æ®ç»“æ„(åº•å±‚å®ç°)?"></a>ç´¢å¼•çš„æ•°æ®ç»“æ„(åº•å±‚å®ç°)?</h3><p>ç´¢å¼•çš„æ•°æ®ç»“æ„å’Œå…·ä½“å­˜å‚¨å¼•æ“çš„å®ç°æœ‰å…³, åœ¨MySQLä¸­ä½¿ç”¨è¾ƒå¤šçš„ç´¢å¼•æœ‰Hashç´¢å¼•,B+æ ‘ç´¢å¼•ç­‰,è€Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„InnoDBå­˜å‚¨å¼•æ“çš„é»˜è®¤ç´¢å¼•å®ç°ä¸º:B+æ ‘ç´¢å¼•.</p><h3 id="Bæ ‘å’ŒB-æ ‘åŒºåˆ«"><a href="#Bæ ‘å’ŒB-æ ‘åŒºåˆ«" class="headerlink" title="Bæ ‘å’ŒB+æ ‘åŒºåˆ«"></a>Bæ ‘å’ŒB+æ ‘åŒºåˆ«</h3><ul><li>Bæ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æ—¢å­˜æ”¾é”®(key) ä¹Ÿå­˜æ”¾æ•°æ®(data)ï¼›è€ŒB+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹å­˜æ”¾ keyå’Œdataï¼Œå…¶ä»–å†…èŠ‚ç‚¹åªå­˜æ”¾keyã€‚</li><li>Bæ ‘çš„å¶å­èŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹çš„;B+æ ‘çš„å¶å­èŠ‚ç‚¹æœ‰ä¸€æ¡å¼•ç”¨é“¾æŒ‡å‘ä¸å®ƒç›¸é‚»çš„å¶å­èŠ‚ç‚¹ï¼Œæœ‰åˆ©äºåŒºé—´æŸ¥æ‰¾ã€‚</li><li>Bæ ‘çš„æ£€ç´¢çš„è¿‡ç¨‹ç›¸å½“äºå¯¹èŒƒå›´å†…çš„æ¯ä¸ªèŠ‚ç‚¹çš„å…³é”®å­—åšäºŒåˆ†æŸ¥æ‰¾ï¼Œå¯èƒ½è¿˜æ²¡æœ‰åˆ°è¾¾å¶å­èŠ‚ç‚¹ï¼Œæ£€ç´¢å°±ç»“æŸäº†ã€‚è€ŒB+æ ‘çš„æ£€ç´¢æ•ˆç‡å°±å¾ˆç¨³å®šäº†ï¼Œä»»ä½•æŸ¥æ‰¾éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œå¶å­èŠ‚ç‚¹çš„é¡ºåºæ£€ç´¢å¾ˆæ˜æ˜¾ã€‚</li></ul><p>ç”±äºç£ç›˜çš„è¯»å–ä¹Ÿæ˜¯æŒ‰<strong>block</strong>å—æ“ä½œçš„ï¼ˆå†…å­˜æ˜¯æŒ‰<strong>page</strong>é¡µé¢æ“ä½œçš„ï¼‰ï¼Œå› æ­¤B+æ ‘çš„èŠ‚ç‚¹å¤§å°ä¸€èˆ¬è®¾ç½®ä¸ºå’Œç£ç›˜å—å¤§å°ä¸€è‡´ï¼Œè¿™æ ·ä¸€ä¸ªB+æ ‘èŠ‚ç‚¹ï¼Œå°±å¯ä»¥é€šè¿‡ä¸€æ¬¡ç£ç›˜I/OæŠŠä¸€ä¸ªç£ç›˜å—çš„æ•°æ®å…¨éƒ¨å­˜å‚¨ä¸‹æ¥ï¼Œ<strong>æ‰€ä»¥å½“ä½¿ç”¨B-æ ‘å­˜å‚¨ç´¢å¼•çš„æ—¶å€™ï¼Œç£ç›˜I/Oçš„æ“ä½œæ¬¡æ•°æ˜¯æœ€å°‘çš„</strong></p><p>é‚£ä¹ˆMySQLæœ€ç»ˆä¸ºä»€ä¹ˆè¦é‡‡ç”¨B+æ ‘å­˜å‚¨ç´¢å¼•ç»“æ„å‘¢ï¼Œé‚£ä¹ˆçœ‹çœ‹B-æ ‘å’ŒB+æ ‘åœ¨å­˜å‚¨ç»“æ„ä¸Šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p><ul><li>B-æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå­˜äº†å…³é”®å­—å’Œå¯¹åº”çš„æ•°æ®åœ°å€ï¼Œè€ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹åªå­˜å…³é”®å­—ï¼Œä¸å­˜æ•°æ®åœ°å€ã€‚å› æ­¤B+æ ‘çš„æ¯ä¸€ä¸ªéå¶å­èŠ‚ç‚¹å­˜å‚¨çš„å…³é”®å­—æ˜¯è¿œè¿œå¤šäºB-æ ‘çš„ï¼ŒB+æ ‘çš„å¶å­èŠ‚ç‚¹å­˜æ”¾å…³é”®å­—å’Œæ•°æ®ï¼Œå› æ­¤ï¼Œ<strong>ä»æ ‘çš„é«˜åº¦ä¸Šæ¥è¯´ï¼ŒB+æ ‘çš„é«˜åº¦è¦å°äºB-æ ‘ï¼Œä½¿ç”¨çš„ç£ç›˜I/Oæ¬¡æ•°å°‘ï¼Œå› æ­¤æŸ¥è¯¢ä¼šæ›´å¿«ä¸€äº›ã€‚</strong></li><li>B-æ ‘ç”±äºæ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨å…³é”®å­—å’Œæ•°æ®ï¼Œå› æ­¤ç¦»æ ¹èŠ‚ç‚¹è¿›çš„æ•°æ®ï¼ŒæŸ¥è¯¢çš„å°±å¿«ï¼Œç¦»æ ¹èŠ‚ç‚¹è¿œçš„æ•°æ®ï¼ŒæŸ¥è¯¢çš„å°±æ…¢ï¼›B+æ ‘æ‰€æœ‰çš„æ•°æ®éƒ½å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤åœ¨B+æ ‘ä¸Šæœç´¢å…³é”®å­—ï¼Œæ‰¾åˆ°å¯¹åº”æ•°æ®çš„<strong>æ—¶é—´æ˜¯æ¯”è¾ƒå¹³å‡</strong>çš„ï¼Œæ²¡æœ‰å¿«æ…¢ä¹‹åˆ†ã€‚</li><li>åœ¨B-æ ‘ä¸Šå¦‚æœåšåŒºé—´æŸ¥æ‰¾ï¼Œéå†çš„èŠ‚ç‚¹æ˜¯éå¸¸å¤šçš„ï¼›B+æ ‘æ‰€æœ‰å¶å­èŠ‚ç‚¹è¢«è¿æ¥æˆäº†æœ‰åºé“¾è¡¨ç»“æ„ï¼Œå› æ­¤åšæ•´è¡¨éå†å’Œ<strong>åŒºé—´æŸ¥æ‰¾æ˜¯éå¸¸å®¹æ˜“</strong>çš„ã€‚</li></ul><p>ç»è¿‡ä¼˜åŒ–çš„B+æ ‘ï¼Œä¸»è¦æ˜¯åœ¨æ‰€æœ‰çš„å¶å­ç»“ç‚¹ä¸­å¢åŠ äº†æŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå› æ­¤InnoDBå»ºè®®ä¸ºå¤§éƒ¨åˆ†è¡¨ä½¿ç”¨é»˜è®¤è‡ªå¢çš„ä¸»é”®ä½œä¸ºä¸»ç´¢å¼•ã€‚</p><p><img alt="image-20200527195106340" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf793blg6mj30eh084jul.jpg" class="lazyload"></p><p><img alt="image-20200527195115403" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf793gwpn1j30dz09m0x6.jpg" class="lazyload"></p><p>Bæ ‘</p><p><img alt="image-20200527195146433" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf7940mxe1j308907mdgu.jpg" class="lazyload"></p><h3 id="Hashç´¢å¼•å’ŒB-æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢"><a href="#Hashç´¢å¼•å’ŒB-æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢" class="headerlink" title="Hashç´¢å¼•å’ŒB+æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢?"></a><strong>Hashç´¢å¼•å’ŒB+æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢?</strong></h3><p>hashç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ›´å¿«(ä¸€èˆ¬æƒ…å†µä¸‹),ä½†æ˜¯å´æ— æ³•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢.</p><p>hashç´¢å¼•ä¸æ”¯æŒä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åº,æ¨¡ç³ŠæŸ¥è¯¢</p><h3 id="ä¸ºä»€ä¹ˆä¸å¯¹è¡¨ä¸­çš„æ¯ä¸€ä¸ªåˆ—åˆ›å»ºä¸€ä¸ªç´¢å¼•å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸å¯¹è¡¨ä¸­çš„æ¯ä¸€ä¸ªåˆ—åˆ›å»ºä¸€ä¸ªç´¢å¼•å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸å¯¹è¡¨ä¸­çš„æ¯ä¸€ä¸ªåˆ—åˆ›å»ºä¸€ä¸ªç´¢å¼•å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸å¯¹è¡¨ä¸­çš„æ¯ä¸€ä¸ªåˆ—åˆ›å»ºä¸€ä¸ªç´¢å¼•å‘¢ï¼Ÿ</h3><p>å½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ï¼Œè¿™æ ·å°±é™ä½äº†æ•°æ®çš„ç»´æŠ¤é€Ÿåº¦ã€‚</p><h3 id="ä¸ºä»€ä¹ˆç´¢å¼•èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦"><a href="#ä¸ºä»€ä¹ˆç´¢å¼•èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦" class="headerlink" title="ä¸ºä»€ä¹ˆç´¢å¼•èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦"></a>ä¸ºä»€ä¹ˆç´¢å¼•èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦</h3><h4 id="å…ˆä»-MySQL-çš„åŸºæœ¬å­˜å‚¨ç»“æ„è¯´èµ·"><a href="#å…ˆä»-MySQL-çš„åŸºæœ¬å­˜å‚¨ç»“æ„è¯´èµ·" class="headerlink" title="å…ˆä» MySQL çš„åŸºæœ¬å­˜å‚¨ç»“æ„è¯´èµ·"></a>å…ˆä» MySQL çš„åŸºæœ¬å­˜å‚¨ç»“æ„è¯´èµ·</h4><p>MySQLçš„åŸºæœ¬å­˜å‚¨ç»“æ„æ˜¯é¡µ(è®°å½•éƒ½å­˜åœ¨é¡µé‡Œè¾¹)ï¼š</p><p><img alt="image-20200527165933957" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf744uarg0j30lw0hewj5.jpg" class="lazyload"></p><p><img alt="image-20200527165912250" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf744gnf4jj30yy0cd46k.jpg" class="lazyload"></p><ul><li><strong>å„ä¸ªæ•°æ®é¡µå¯ä»¥ç»„æˆä¸€ä¸ªåŒå‘é“¾è¡¨</strong></li><li>æ¯ä¸ªæ•°æ®é¡µä¸­çš„è®°å½•åˆå¯ä»¥ç»„æˆä¸€ä¸ªå•å‘é“¾è¡¨<ul><li>æ¯ä¸ªæ•°æ®é¡µéƒ½ä¼šä¸ºå­˜å‚¨åœ¨å®ƒé‡Œè¾¹å„¿çš„è®°å½•ç”Ÿæˆä¸€ä¸ªé¡µç›®å½•ï¼Œåœ¨é€šè¿‡ä¸»é”®æŸ¥æ‰¾æŸæ¡è®°å½•çš„æ—¶å€™å¯ä»¥åœ¨é¡µç›®å½•ä¸­ä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ§½ï¼Œç„¶åå†éå†è¯¥æ§½å¯¹åº”åˆ†ç»„ä¸­çš„è®°å½•å³å¯å¿«é€Ÿæ‰¾åˆ°æŒ‡å®šçš„è®°å½•</li><li>ä»¥å…¶ä»–åˆ—(éä¸»é”®)ä½œä¸ºæœç´¢æ¡ä»¶ï¼šåªèƒ½ä»æœ€å°è®°å½•å¼€å§‹ä¾æ¬¡éå†å•é“¾è¡¨ä¸­çš„æ¯æ¡è®°å½•ã€‚</li></ul></li></ul><p>æ‰€ä»¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬å†™select * from user where indexname = â€˜xxxâ€™è¿™æ ·æ²¡æœ‰è¿›è¡Œä»»ä½•ä¼˜åŒ–çš„sqlè¯­å¥ï¼Œé»˜è®¤ä¼šè¿™æ ·åšï¼š</p><ol><li><strong>å®šä½åˆ°è®°å½•æ‰€åœ¨çš„é¡µï¼šéœ€è¦éå†åŒå‘é“¾è¡¨ï¼Œæ‰¾åˆ°æ‰€åœ¨çš„é¡µ</strong></li><li><strong>ä»æ‰€åœ¨çš„é¡µå†…ä¸­æŸ¥æ‰¾ç›¸åº”çš„è®°å½•ï¼šç”±äºä¸æ˜¯æ ¹æ®ä¸»é”®æŸ¥è¯¢ï¼Œåªèƒ½éå†æ‰€åœ¨é¡µçš„å•é“¾è¡¨äº†</strong></li></ol><p>å¾ˆæ˜æ˜¾ï¼Œåœ¨æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µä¸‹è¿™æ ·æŸ¥æ‰¾ä¼šå¾ˆæ…¢ï¼è¿™æ ·çš„æ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆnï¼‰ã€‚</p><h4 id="ä½¿ç”¨ç´¢å¼•ä¹‹å"><a href="#ä½¿ç”¨ç´¢å¼•ä¹‹å" class="headerlink" title="ä½¿ç”¨ç´¢å¼•ä¹‹å"></a>ä½¿ç”¨ç´¢å¼•ä¹‹å</h4><p>ç´¢å¼•åšäº†äº›ä»€ä¹ˆå¯ä»¥è®©æˆ‘ä»¬æŸ¥è¯¢åŠ å¿«é€Ÿåº¦å‘¢ï¼Ÿå…¶å®å°±æ˜¯å°†æ— åºçš„æ•°æ®å˜æˆæœ‰åº(ç›¸å¯¹)ï¼š</p><p><img alt="image-20200527165842152" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf743xob4oj30zh0itgyz.jpg" class="lazyload"></p><p>è¦æ‰¾åˆ°idä¸º8çš„è®°å½•ç®€è¦æ­¥éª¤ï¼š</p><p><img alt="image-20200527165814369" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf743gld1lj30zd0jmndj.jpg" class="lazyload"></p><p>å¾ˆæ˜æ˜¾çš„æ˜¯ï¼šæ²¡æœ‰ç”¨ç´¢å¼•æˆ‘ä»¬æ˜¯éœ€è¦éå†åŒå‘é“¾è¡¨æ¥å®šä½å¯¹åº”çš„é¡µï¼Œç°åœ¨é€šè¿‡ <strong>â€œç›®å½•â€</strong> å°±å¯ä»¥å¾ˆå¿«åœ°å®šä½åˆ°å¯¹åº”çš„é¡µä¸Šäº†ï¼ï¼ˆäºŒåˆ†æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦è¿‘ä¼¼ä¸ºO(logn)ï¼‰</p><p>å…¶å®åº•å±‚ç»“æ„å°±æ˜¯B+æ ‘ï¼ŒB+æ ‘ä½œä¸ºæ ‘çš„ä¸€ç§å®ç°ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬å¾ˆå¿«åœ°æŸ¥æ‰¾å‡ºå¯¹åº”çš„è®°å½•ã€‚</p><h3 id="ç´¢å¼•ç±»å‹"><a href="#ç´¢å¼•ç±»å‹" class="headerlink" title="ç´¢å¼•ç±»å‹"></a>ç´¢å¼•ç±»å‹</h3><h4 id="ä¸»é”®ç´¢å¼•-Primary-Key"><a href="#ä¸»é”®ç´¢å¼•-Primary-Key" class="headerlink" title="ä¸»é”®ç´¢å¼•(Primary Key)"></a>ä¸»é”®ç´¢å¼•(Primary Key)</h4><p><strong>æ•°æ®è¡¨çš„ä¸»é”®åˆ—ä½¿ç”¨çš„å°±æ˜¯ä¸»é”®ç´¢å¼•ã€‚</strong></p><p><strong>ä¸€å¼ æ•°æ®è¡¨æœ‰åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œå¹¶ä¸”ä¸»é”®ä¸èƒ½ä¸ºnullï¼Œä¸èƒ½é‡å¤ã€‚</strong></p><p>åœ¨mysqlçš„InnoDBçš„è¡¨ä¸­ï¼Œå½“æ²¡æœ‰æ˜¾ç¤ºçš„æŒ‡å®šè¡¨çš„ä¸»é”®æ—¶ï¼ŒInnoDBä¼šè‡ªåŠ¨å…ˆæ£€æŸ¥è¡¨ä¸­æ˜¯å¦æœ‰å”¯ä¸€ç´¢å¼•çš„å­—æ®µï¼Œå¦‚æœæœ‰ï¼Œåˆ™é€‰æ‹©è¯¥å­—æ®µä¸ºé»˜è®¤çš„ä¸»é”®ï¼Œå¦åˆ™InnoDBå°†ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª6Byteçš„è‡ªå¢ä¸»é”®ã€‚</p><h4 id="äºŒçº§ç´¢å¼•-è¾…åŠ©ç´¢å¼•"><a href="#äºŒçº§ç´¢å¼•-è¾…åŠ©ç´¢å¼•" class="headerlink" title="äºŒçº§ç´¢å¼•(è¾…åŠ©ç´¢å¼•)"></a>äºŒçº§ç´¢å¼•(è¾…åŠ©ç´¢å¼•)</h4><p><strong>äºŒçº§ç´¢å¼•åˆç§°ä¸ºè¾…åŠ©ç´¢å¼•ï¼Œæ˜¯å› ä¸ºäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®æ˜¯ä¸»é”®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡äºŒçº§ç´¢å¼•ï¼Œå¯ä»¥å®šä½ä¸»é”®çš„ä½ç½®ã€‚</strong></p><p>å”¯ä¸€ç´¢å¼•ï¼Œæ™®é€šç´¢å¼•ï¼Œå‰ç¼€ç´¢å¼•ç­‰ç´¢å¼•å±äºäºŒçº§ç´¢å¼•ã€‚</p><ol><li><p><strong>å”¯ä¸€ç´¢å¼•(Unique Key)</strong> ï¼šå”¯ä¸€ç´¢å¼•ä¹Ÿæ˜¯ä¸€ç§çº¦æŸã€‚<strong>å”¯ä¸€ç´¢å¼•çš„å±æ€§åˆ—ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ï¼Œä½†æ˜¯å…è®¸æ•°æ®ä¸ºNULLï¼Œä¸€å¼ è¡¨å…è®¸åˆ›å»ºå¤šä¸ªå”¯ä¸€ç´¢å¼•ã€‚</strong>å»ºç«‹å”¯ä¸€ç´¢å¼•çš„ç›®çš„å¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯ä¸ºäº†è¯¥å±æ€§åˆ—çš„æ•°æ®çš„å”¯ä¸€æ€§ï¼Œè€Œä¸æ˜¯ä¸ºäº†æŸ¥è¯¢æ•ˆç‡ã€‚</p></li><li><p><strong>æ™®é€šç´¢å¼•(Index)</strong> ï¼š<strong>æ™®é€šç´¢å¼•çš„å”¯ä¸€ä½œç”¨å°±æ˜¯ä¸ºäº†å¿«é€ŸæŸ¥è¯¢æ•°æ®ï¼Œä¸€å¼ è¡¨å…è®¸åˆ›å»ºå¤šä¸ªæ™®é€šç´¢å¼•ï¼Œå¹¶å…è®¸æ•°æ®é‡å¤å’ŒNULLã€‚</strong></p></li><li><p><strong>å‰ç¼€ç´¢å¼•(Prefix)</strong> ï¼šå‰ç¼€ç´¢å¼•åªé€‚ç”¨äºå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ã€‚å‰ç¼€ç´¢å¼•æ˜¯å¯¹æ–‡æœ¬çš„å‰å‡ ä¸ªå­—ç¬¦åˆ›å»ºç´¢å¼•ï¼Œç›¸æ¯”æ™®é€šç´¢å¼•å»ºç«‹çš„æ•°æ®æ›´å°ï¼Œ å› ä¸ºåªå–å‰å‡ ä¸ªå­—ç¬¦ã€‚</p></li><li><p><strong>å…¨æ–‡ç´¢å¼•(Full Text)</strong> ï¼šå…¨æ–‡ç´¢å¼•ä¸»è¦æ˜¯ä¸ºäº†æ£€ç´¢å¤§æ–‡æœ¬æ•°æ®ä¸­çš„å…³é”®å­—çš„ä¿¡æ¯ï¼Œæ˜¯ç›®å‰æœç´¢å¼•æ“æ•°æ®åº“ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ã€‚Mysql5.6ä¹‹å‰åªæœ‰MYISAMå¼•æ“æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œ5.6ä¹‹åInnoDBä¹Ÿæ”¯æŒäº†å…¨æ–‡ç´¢å¼•ã€‚</p></li></ol><h3 id="èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•"><a href="#èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•" class="headerlink" title="èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•"></a>èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•</h3><h4 id="èšé›†ç´¢å¼•"><a href="#èšé›†ç´¢å¼•" class="headerlink" title="èšé›†ç´¢å¼•"></a>èšé›†ç´¢å¼•</h4><p><strong>èšé›†ç´¢å¼•å³ç´¢å¼•ç»“æ„å’Œæ•°æ®ä¸€èµ·å­˜æ”¾çš„ç´¢å¼•ã€‚ä¸»é”®ç´¢å¼•å±äºèšé›†ç´¢å¼•ã€‚</strong></p><p>åœ¨ Mysql ä¸­ï¼ŒInnoDBå¼•æ“çš„è¡¨çš„ <code>.ibd</code>æ–‡ä»¶å°±åŒ…å«äº†è¯¥è¡¨çš„ç´¢å¼•å’Œæ•°æ®ï¼Œå¯¹äº InnoDB å¼•æ“è¡¨æ¥è¯´ï¼Œè¯¥è¡¨çš„ç´¢å¼•(B+æ ‘)çš„æ¯ä¸ªéå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•å’Œç´¢å¼•å¯¹åº”çš„æ•°æ®ã€‚</p><p><code>èšé›†ç´¢å¼•çš„ä¼˜ç‚¹</code></p><p>èšé›†ç´¢å¼•çš„æŸ¥è¯¢é€Ÿåº¦éå¸¸çš„å¿«ï¼Œå› ä¸ºæ•´ä¸ªB+æ ‘æœ¬èº«å°±æ˜¯ä¸€é¢—å¤šå‰å¹³è¡¡æ ‘ï¼Œå¶å­èŠ‚ç‚¹ä¹Ÿéƒ½æ˜¯æœ‰åºçš„ï¼Œå®šä½åˆ°ç´¢å¼•çš„èŠ‚ç‚¹ï¼Œå°±ç›¸å½“äºå®šä½åˆ°äº†æ•°æ®ã€‚</p><p><code>èšé›†ç´¢å¼•çš„ç¼ºç‚¹</code></p><ol><li><strong>ä¾èµ–äºæœ‰åºçš„æ•°æ®</strong> ï¼šå› ä¸ºB+æ ‘æ˜¯å¤šè·¯å¹³è¡¡æ ‘ï¼Œå¦‚æœç´¢å¼•çš„æ•°æ®ä¸æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨æ’å…¥æ—¶æ’åºï¼Œå¦‚æœæ•°æ®æ˜¯æ•´å‹è¿˜å¥½ï¼Œå¦åˆ™ç±»ä¼¼äºå­—ç¬¦ä¸²æˆ–UUIDè¿™ç§åˆé•¿åˆéš¾æ¯”è¾ƒçš„æ•°æ®ï¼Œæ’å…¥æˆ–æŸ¥æ‰¾çš„é€Ÿåº¦è‚¯å®šæ¯”è¾ƒæ…¢ã€‚</li><li><strong>æ›´æ–°ä»£ä»·å¤§</strong> ï¼š å¦‚æœå¯¹ç´¢å¼•åˆ—çš„æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œé‚£ä¹ˆå¯¹åº”çš„ç´¢å¼•ä¹Ÿå°†ä¼šè¢«ä¿®æ”¹ï¼Œ è€Œä¸”å†µèšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹è¿˜å­˜æ”¾ç€æ•°æ®ï¼Œä¿®æ”¹ä»£ä»·è‚¯å®šæ˜¯è¾ƒå¤§çš„ï¼Œ æ‰€ä»¥å¯¹äºä¸»é”®ç´¢å¼•æ¥è¯´ï¼Œä¸»é”®ä¸€èˆ¬éƒ½æ˜¯ä¸å¯è¢«ä¿®æ”¹çš„ã€‚</li></ol><h4 id="éèšé›†ç´¢å¼•"><a href="#éèšé›†ç´¢å¼•" class="headerlink" title="éèšé›†ç´¢å¼•"></a>éèšé›†ç´¢å¼•</h4><p><strong>éèšé›†ç´¢å¼•å³ç´¢å¼•ç»“æ„å’Œæ•°æ®åˆ†å¼€å­˜æ”¾çš„ç´¢å¼•ã€‚</strong></p><p><strong>äºŒçº§ç´¢å¼•å±äºéèšé›†ç´¢å¼•ã€‚</strong></p><p>éèšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®+åˆ—å€¼ï¼Œ éœ€è¦æ ¹æ®ä¸»é”®å†å›è¡¨æŸ¥æ•°æ®ã€‚</p><p><code>éèšé›†ç´¢å¼•çš„ä¼˜ç‚¹</code></p><p><strong>æ›´æ–°ä»£ä»·æ¯”èšé›†ç´¢å¼•è¦å°</strong>,å› ä¸ºéèšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸å­˜æ”¾æ•°æ®çš„</p><p><code>éèšé›†ç´¢å¼•çš„ç¼ºç‚¹</code></p><ol><li>è·Ÿèšé›†ç´¢å¼•ä¸€æ ·ï¼Œéèšé›†ç´¢å¼•ä¹Ÿä¾èµ–äºæœ‰åºçš„æ•°æ®</li><li><strong>å¯èƒ½ä¼šäºŒæ¬¡æŸ¥è¯¢(å›è¡¨)</strong> :è¿™åº”è¯¥æ˜¯éèšé›†ç´¢å¼•æœ€å¤§çš„ç¼ºç‚¹äº†ã€‚ å½“æŸ¥åˆ°ç´¢å¼•å¯¹åº”çš„æŒ‡é’ˆæˆ–ä¸»é”®åï¼Œå¯èƒ½è¿˜éœ€è¦æ ¹æ®æŒ‡é’ˆæˆ–ä¸»é”®å†åˆ°æ•°æ®æ–‡ä»¶æˆ–è¡¨ä¸­æŸ¥è¯¢ã€‚</li></ol><h4 id="éèšé›†ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—-è¦†ç›–ç´¢å¼•"><a href="#éèšé›†ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—-è¦†ç›–ç´¢å¼•" class="headerlink" title="éèšé›†ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—(è¦†ç›–ç´¢å¼•)?"></a>éèšé›†ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—(è¦†ç›–ç´¢å¼•)?</h4><p><strong>éèšé›†ç´¢å¼•ä¸ä¸€å®šå›è¡¨æŸ¥è¯¢ã€‚</strong></p><blockquote><p>è¯•æƒ³ä¸€ç§æƒ…å†µï¼Œç”¨æˆ·å‡†å¤‡ä½¿ç”¨SQLæŸ¥è¯¢ç”¨æˆ·åï¼Œè€Œç”¨æˆ·åå­—æ®µæ­£å¥½å»ºç«‹äº†ç´¢å¼•ã€‚</p></blockquote><pre><code class="sql"> SELECT name FROM table WHERE username=&#39;guang19&#39;;</code></pre><blockquote><p>é‚£ä¹ˆè¿™ä¸ªç´¢å¼•çš„keyæœ¬èº«å°±æ˜¯nameï¼ŒæŸ¥åˆ°å¯¹åº”çš„nameç›´æ¥è¿”å›å°±è¡Œäº†ï¼Œæ— éœ€å›è¡¨æŸ¥è¯¢ã€‚</p></blockquote><p><strong>å³ä½¿æ˜¯MYISAMä¹Ÿæ˜¯è¿™æ ·ï¼Œè™½ç„¶MYISAMçš„ä¸»é”®ç´¢å¼•ç¡®å®éœ€è¦å›è¡¨ï¼Œ å› ä¸ºå®ƒçš„ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯æŒ‡é’ˆã€‚ä½†æ˜¯å¦‚æœSQLæŸ¥çš„å°±æ˜¯ä¸»é”®å‘¢?</strong></p><pre><code class="sql">SELECT id FROM table WHERE id=1;</code></pre><p>ä¸»é”®ç´¢å¼•æœ¬èº«çš„keyå°±æ˜¯ä¸»é”®ï¼ŒæŸ¥åˆ°è¿”å›å°±è¡Œäº†ã€‚è¿™ç§æƒ…å†µå°±ç§°ä¹‹ä¸ºè¦†ç›–ç´¢å¼•äº†ã€‚</p><h4 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h4><p>å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆæˆ–è€…è¯´è¦†ç›–ï¼‰æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºâ€œè¦†ç›–ç´¢å¼•â€ã€‚æˆ‘ä»¬çŸ¥é“åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œå¦‚æœä¸æ˜¯ä¸»é”®ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®+åˆ—å€¼ã€‚æœ€ç»ˆè¿˜æ˜¯è¦â€œå›è¡¨â€ï¼Œä¹Ÿå°±æ˜¯è¦é€šè¿‡ä¸»é”®å†æŸ¥æ‰¾ä¸€æ¬¡ã€‚è¿™æ ·å°±ä¼šæ¯”è¾ƒæ…¢è¦†ç›–ç´¢å¼•å°±æ˜¯æŠŠè¦æŸ¥è¯¢å‡ºçš„åˆ—å’Œç´¢å¼•æ˜¯å¯¹åº”çš„ï¼Œä¸åšå›è¡¨æ“ä½œï¼</p><p><strong>è¦†ç›–ç´¢å¼•å³éœ€è¦æŸ¥è¯¢çš„å­—æ®µæ­£å¥½æ˜¯ç´¢å¼•çš„å­—æ®µï¼Œé‚£ä¹ˆç›´æ¥æ ¹æ®è¯¥ç´¢å¼•ï¼Œå°±å¯ä»¥æŸ¥åˆ°æ•°æ®äº†ï¼Œ è€Œæ— éœ€å›è¡¨æŸ¥è¯¢ã€‚</strong></p><blockquote><p>å¦‚ä¸»é”®ç´¢å¼•ï¼Œå¦‚æœä¸€æ¡SQLéœ€è¦æŸ¥è¯¢ä¸»é”®ï¼Œé‚£ä¹ˆæ­£å¥½æ ¹æ®ä¸»é”®ç´¢å¼•å°±å¯ä»¥æŸ¥åˆ°ä¸»é”®ã€‚</p><p>å†å¦‚æ™®é€šç´¢å¼•ï¼Œå¦‚æœä¸€æ¡SQLéœ€è¦æŸ¥è¯¢nameï¼Œnameå­—æ®µæ­£å¥½æœ‰ç´¢å¼•ï¼Œ é‚£ä¹ˆç›´æ¥æ ¹æ®è¿™ä¸ªç´¢å¼•å°±å¯ä»¥æŸ¥åˆ°æ•°æ®ï¼Œä¹Ÿæ— éœ€å›è¡¨ã€‚</p></blockquote><hr><h3 id="ç´¢å¼•åˆ›å»ºåŸåˆ™"><a href="#ç´¢å¼•åˆ›å»ºåŸåˆ™" class="headerlink" title="ç´¢å¼•åˆ›å»ºåŸåˆ™"></a>ç´¢å¼•åˆ›å»ºåŸåˆ™</h3><h4 id="æœ€å·¦å‰ç¼€åŸåˆ™"><a href="#æœ€å·¦å‰ç¼€åŸåˆ™" class="headerlink" title="æœ€å·¦å‰ç¼€åŸåˆ™"></a>æœ€å·¦å‰ç¼€åŸåˆ™</h4><p>mysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€betweenã€like)å°±åœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚a = 1 and b = 2 and c &gt; 3 and d = 4 å¦‚æœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ï¼Œå¦‚æœå»ºç«‹(a,b,d,c)çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚ æ‰€ä»¥åœ¨åˆ›å»ºè”åˆç´¢å¼•æ—¶ï¼Œå°½é‡æŠŠæŸ¥è¯¢æœ€é¢‘ç¹çš„é‚£ä¸ªå­—æ®µä½œä¸ºæœ€å·¦(ç¬¬ä¸€ä¸ª)å­—æ®µã€‚æŸ¥è¯¢çš„æ—¶å€™ä¹Ÿå°½é‡ä»¥è¿™ä¸ªå­—æ®µä¸ºç¬¬ä¸€æ¡ä»¶ã€‚</p><h4 id="æ³¨æ„é¿å…å†—ä½™ç´¢å¼•"><a href="#æ³¨æ„é¿å…å†—ä½™ç´¢å¼•" class="headerlink" title="æ³¨æ„é¿å…å†—ä½™ç´¢å¼•"></a>æ³¨æ„é¿å…å†—ä½™ç´¢å¼•</h4><p>å†—ä½™ç´¢å¼•æŒ‡çš„æ˜¯ç´¢å¼•çš„åŠŸèƒ½ç›¸åŒï¼Œèƒ½å¤Ÿå‘½ä¸­ å°±è‚¯å®šèƒ½å‘½ä¸­ ï¼Œé‚£ä¹ˆ å°±æ˜¯å†—ä½™ç´¢å¼•å¦‚ï¼ˆname,city ï¼‰å’Œï¼ˆname ï¼‰è¿™ä¸¤ä¸ªç´¢å¼•å°±æ˜¯å†—ä½™ç´¢å¼•ï¼Œèƒ½å¤Ÿå‘½ä¸­åè€…çš„æŸ¥è¯¢è‚¯å®šæ˜¯èƒ½å¤Ÿå‘½ä¸­å‰è€…çš„ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½åº”è¯¥å°½é‡æ‰©å±•å·²æœ‰çš„ç´¢å¼•è€Œä¸æ˜¯åˆ›å»ºæ–°ç´¢å¼•ã€‚</p><h3 id="ç´¢å¼•ä¸é€‚åˆå“ªäº›åœºæ™¯"><a href="#ç´¢å¼•ä¸é€‚åˆå“ªäº›åœºæ™¯" class="headerlink" title="ç´¢å¼•ä¸é€‚åˆå“ªäº›åœºæ™¯"></a><strong>ç´¢å¼•ä¸é€‚åˆå“ªäº›åœºæ™¯</strong></h3><ul><li>æ•°æ®é‡å°‘çš„ä¸é€‚åˆåŠ ç´¢å¼•</li><li>æ›´æ–°æ¯”è¾ƒé¢‘ç¹çš„ä¹Ÿä¸é€‚åˆåŠ ç´¢å¼•</li><li>åŒºåˆ†åº¦ä½çš„å­—æ®µä¸é€‚åˆåŠ ç´¢å¼•ï¼ˆå¦‚æ€§åˆ«ï¼‰ å¯¹æ¯” éƒ¨ä»¶è¡¨ rest_status_id å°±ä¸éœ€è¦æ·»åŠ ç´¢å¼•ã€‚</li></ul><p>â€‹    ç´¢å¼•åŒºåˆ†åº¦è¶Šæ˜æ˜¾ï¼ŒæŸ¥è¯¢æ•ˆç‡è¶Šé«˜</p><hr><h2 id="ä¸€æ¡SQLè¯­å¥æ‰§è¡Œå¾—å¾ˆæ…¢çš„åŸå› æœ‰å“ªäº›ï¼Ÿ"><a href="#ä¸€æ¡SQLè¯­å¥æ‰§è¡Œå¾—å¾ˆæ…¢çš„åŸå› æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ä¸€æ¡SQLè¯­å¥æ‰§è¡Œå¾—å¾ˆæ…¢çš„åŸå› æœ‰å“ªäº›ï¼Ÿ"></a>ä¸€æ¡SQLè¯­å¥æ‰§è¡Œå¾—å¾ˆæ…¢çš„åŸå› æœ‰å“ªäº›ï¼Ÿ</h2><h3 id="å¤§å¤šæ•°æƒ…å†µæ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯å¶å°”ä¼šå‡ºç°å¾ˆæ…¢çš„æƒ…å†µã€‚"><a href="#å¤§å¤šæ•°æƒ…å†µæ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯å¶å°”ä¼šå‡ºç°å¾ˆæ…¢çš„æƒ…å†µã€‚" class="headerlink" title="å¤§å¤šæ•°æƒ…å†µæ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯å¶å°”ä¼šå‡ºç°å¾ˆæ…¢çš„æƒ…å†µã€‚"></a>å¤§å¤šæ•°æƒ…å†µæ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯å¶å°”ä¼šå‡ºç°å¾ˆæ…¢çš„æƒ…å†µã€‚</h3><h4 id="æ•°æ®åº“åœ¨åˆ·æ–°è„é¡µï¼ˆflushï¼‰æˆ‘ä¹Ÿæ— å¥ˆå•Š"><a href="#æ•°æ®åº“åœ¨åˆ·æ–°è„é¡µï¼ˆflushï¼‰æˆ‘ä¹Ÿæ— å¥ˆå•Š" class="headerlink" title="æ•°æ®åº“åœ¨åˆ·æ–°è„é¡µï¼ˆflushï¼‰æˆ‘ä¹Ÿæ— å¥ˆå•Š"></a>æ•°æ®åº“åœ¨åˆ·æ–°è„é¡µï¼ˆflushï¼‰æˆ‘ä¹Ÿæ— å¥ˆå•Š</h4><p>å½“æˆ‘ä»¬è¦å¾€æ•°æ®åº“æ’å…¥ä¸€æ¡æ•°æ®ã€æˆ–è€…è¦æ›´æ–°ä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“æ•°æ®åº“ä¼šåœ¨<strong>å†…å­˜</strong>ä¸­æŠŠå¯¹åº”å­—æ®µçš„æ•°æ®æ›´æ–°äº†ï¼Œä½†æ˜¯æ›´æ–°ä¹‹åï¼Œè¿™äº›æ›´æ–°çš„å­—æ®µå¹¶ä¸ä¼šé©¬ä¸ŠåŒæ­¥æŒä¹…åŒ–åˆ°<strong>ç£ç›˜</strong>ä¸­å»ï¼Œè€Œæ˜¯æŠŠè¿™äº›æ›´æ–°çš„è®°å½•å†™å…¥åˆ° redo log æ—¥è®°ä¸­å»ï¼Œç­‰åˆ°ç©ºé—²çš„æ—¶å€™ï¼Œåœ¨é€šè¿‡ redo log é‡Œçš„æ—¥è®°æŠŠæœ€æ–°çš„æ•°æ®åŒæ­¥åˆ°<strong>ç£ç›˜</strong>ä¸­å»ã€‚</p><blockquote><p>å½“å†…å­˜æ•°æ®é¡µè·Ÿç£ç›˜æ•°æ®é¡µå†…å®¹ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªå†…å­˜é¡µä¸ºâ€œè„é¡µâ€ã€‚å†…å­˜æ•°æ®å†™å…¥åˆ°ç£ç›˜åï¼Œå†…å­˜å’Œç£ç›˜ä¸Šçš„æ•°æ®é¡µçš„å†…å®¹å°±ä¸€è‡´äº†ï¼Œç§°ä¸ºâ€œå¹²å‡€é¡µâ€ã€‚</p></blockquote><p><strong>åˆ·è„é¡µæœ‰ä¸‹é¢4ç§åœºæ™¯ï¼ˆåä¸¤ç§ä¸ç”¨å¤ªå…³æ³¨â€œæ€§èƒ½â€é—®é¢˜ï¼‰ï¼š</strong></p><ul><li><strong>redologå†™æ»¡äº†ï¼š</strong>redo log é‡Œçš„å®¹é‡æ˜¯æœ‰é™çš„ï¼Œå¦‚æœæ•°æ®åº“ä¸€ç›´å¾ˆå¿™ï¼Œæ›´æ–°åˆå¾ˆé¢‘ç¹ï¼Œè¿™ä¸ªæ—¶å€™ redo log å¾ˆå¿«å°±ä¼šè¢«å†™æ»¡äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±æ²¡åŠæ³•ç­‰åˆ°ç©ºé—²çš„æ—¶å€™å†æŠŠæ•°æ®åŒæ­¥åˆ°ç£ç›˜çš„ï¼Œåªèƒ½æš‚åœå…¶ä»–æ“ä½œï¼Œå…¨èº«å¿ƒæ¥æŠŠæ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸­å»çš„ï¼Œè€Œè¿™ä¸ªæ—¶å€™ï¼Œ<strong>å°±ä¼šå¯¼è‡´æˆ‘ä»¬å¹³æ—¶æ­£å¸¸çš„SQLè¯­å¥çªç„¶æ‰§è¡Œçš„å¾ˆæ…¢</strong>ï¼Œæ‰€ä»¥è¯´ï¼Œæ•°æ®åº“åœ¨åœ¨åŒæ­¥æ•°æ®åˆ°ç£ç›˜çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´æˆ‘ä»¬çš„SQLè¯­å¥æ‰§è¡Œçš„å¾ˆæ…¢äº†ã€‚</li><li><strong>å†…å­˜ä¸å¤Ÿç”¨äº†ï¼š</strong>å¦‚æœä¸€æ¬¡æŸ¥è¯¢è¾ƒå¤šçš„æ•°æ®ï¼Œæ°å¥½ç¢°åˆ°æ‰€æŸ¥æ•°æ®é¡µä¸åœ¨å†…å­˜ä¸­æ—¶ï¼Œéœ€è¦ç”³è¯·å†…å­˜ï¼Œè€Œæ­¤æ—¶æ°å¥½å†…å­˜ä¸è¶³çš„æ—¶å€™å°±éœ€è¦æ·˜æ±°ä¸€éƒ¨åˆ†å†…å­˜æ•°æ®é¡µï¼Œå¦‚æœæ˜¯å¹²å‡€é¡µï¼Œå°±ç›´æ¥é‡Šæ”¾ï¼Œå¦‚æœæ°å¥½æ˜¯è„é¡µå°±éœ€è¦åˆ·è„é¡µã€‚</li></ul><h4 id="æ‹¿ä¸åˆ°é”æˆ‘èƒ½æ€ä¹ˆåŠ"><a href="#æ‹¿ä¸åˆ°é”æˆ‘èƒ½æ€ä¹ˆåŠ" class="headerlink" title="æ‹¿ä¸åˆ°é”æˆ‘èƒ½æ€ä¹ˆåŠ"></a>æ‹¿ä¸åˆ°é”æˆ‘èƒ½æ€ä¹ˆåŠ</h4><p>è¿™ä¸ªå°±æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°äº†ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œçš„è¿™æ¡è¯­å¥ï¼Œåˆšå¥½è¿™æ¡è¯­å¥æ¶‰åŠåˆ°çš„<strong>è¡¨</strong>ï¼Œåˆ«äººåœ¨ç”¨ï¼Œå¹¶ä¸”åŠ é”äº†ï¼Œæˆ‘ä»¬æ‹¿ä¸åˆ°é”ï¼Œåªèƒ½æ…¢æ…¢ç­‰å¾…åˆ«äººé‡Šæ”¾é”äº†ã€‚æˆ–è€…ï¼Œè¡¨æ²¡æœ‰åŠ é”ï¼Œä½†è¦ä½¿ç”¨åˆ°çš„æŸä¸ªä¸€è¡Œè¢«åŠ é”äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä¹Ÿæ²¡åŠæ³•å•Šã€‚</p><h3 id="åœ¨æ•°æ®é‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œè¿™æ¡SQLè¯­å¥ä¸€ç›´ä»¥æ¥éƒ½æ‰§è¡Œçš„å¾ˆæ…¢ã€‚"><a href="#åœ¨æ•°æ®é‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œè¿™æ¡SQLè¯­å¥ä¸€ç›´ä»¥æ¥éƒ½æ‰§è¡Œçš„å¾ˆæ…¢ã€‚" class="headerlink" title="åœ¨æ•°æ®é‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œè¿™æ¡SQLè¯­å¥ä¸€ç›´ä»¥æ¥éƒ½æ‰§è¡Œçš„å¾ˆæ…¢ã€‚"></a>åœ¨æ•°æ®é‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œè¿™æ¡SQLè¯­å¥ä¸€ç›´ä»¥æ¥éƒ½æ‰§è¡Œçš„å¾ˆæ…¢ã€‚</h3><h4 id="æ²¡ç”¨åˆ°ç´¢å¼•"><a href="#æ²¡ç”¨åˆ°ç´¢å¼•" class="headerlink" title="æ²¡ç”¨åˆ°ç´¢å¼•"></a>æ²¡ç”¨åˆ°ç´¢å¼•</h4><p><strong>ï¼ˆ1ï¼‰ã€å­—æ®µæ²¡æœ‰ç´¢å¼•</strong></p><p><strong>ï¼ˆ2ï¼‰ã€å­—æ®µæœ‰ç´¢å¼•ï¼Œä½†å´æ²¡æœ‰ç”¨ç´¢å¼•</strong></p><ul><li>ä»¥â€œ%â€å¼€å¤´çš„LIKEè¯­å¥ï¼Œæ¨¡ç³ŠåŒ¹é…</li><li>ORè¯­å¥å‰åæ²¡æœ‰åŒæ—¶ä½¿ç”¨ç´¢å¼•</li></ul><h4 id="å‘µå‘µï¼Œæ•°æ®åº“è‡ªå·±é€‰é”™ç´¢å¼•äº†"><a href="#å‘µå‘µï¼Œæ•°æ®åº“è‡ªå·±é€‰é”™ç´¢å¼•äº†" class="headerlink" title="å‘µå‘µï¼Œæ•°æ®åº“è‡ªå·±é€‰é”™ç´¢å¼•äº†"></a>å‘µå‘µï¼Œæ•°æ®åº“è‡ªå·±é€‰é”™ç´¢å¼•äº†</h4><p>æˆ‘ä»¬åœ¨è¿›è¡ŒæŸ¥è¯¢æ“ä½œçš„æ—¶å€™ï¼Œä¾‹å¦‚</p><pre><code>select * from t where 100 &lt; c and c &lt; 100000;</code></pre><p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•æ˜¯æœ‰åŒºåˆ«çš„ï¼Œä¸»é”®ç´¢å¼•å­˜æ”¾çš„å€¼æ˜¯<strong>æ•´è¡Œå­—æ®µçš„æ•°æ®</strong>ï¼Œè€Œéä¸»é”®ç´¢å¼•ä¸Šå­˜æ”¾çš„å€¼ä¸æ˜¯æ•´è¡Œå­—æ®µçš„æ•°æ®ï¼Œè€Œä¸”å­˜æ”¾<strong>ä¸»é”®å­—æ®µçš„å€¼</strong>.ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¦‚æœèµ° c è¿™ä¸ªå­—æ®µçš„ç´¢å¼•çš„è¯ï¼Œæœ€åä¼šæŸ¥è¯¢åˆ°å¯¹åº”ä¸»é”®çš„å€¼ï¼Œç„¶åï¼Œå†æ ¹æ®ä¸»é”®çš„å€¼èµ°ä¸»é”®ç´¢å¼•ï¼ŒæŸ¥è¯¢åˆ°æ•´è¡Œæ•°æ®è¿”å›ã€‚</p><p>å¥½å§æ‰¯äº†è¿™ä¹ˆå¤šï¼Œå…¶å®æˆ‘å°±æ˜¯æƒ³å‘Šè¯‰ä½ ï¼Œå°±ç®—ä½ åœ¨ c å­—æ®µä¸Šæœ‰ç´¢å¼•ï¼Œç³»ç»Ÿä¹Ÿå¹¶ä¸ä¸€å®šä¼šèµ° c è¿™ä¸ªå­—æ®µä¸Šçš„ç´¢å¼•ï¼Œè€Œæ˜¯æœ‰å¯èƒ½ä¼šç›´æ¥æ‰«ææ‰«æå…¨è¡¨ï¼Œæ‰¾å‡ºæ‰€æœ‰ç¬¦åˆ 100 &lt; c and c &lt; 100000 çš„æ•°æ®ã€‚</p><p><strong>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ</strong></p><p>å…¶å®æ˜¯è¿™æ ·çš„ï¼Œç³»ç»Ÿåœ¨æ‰§è¡Œè¿™æ¡è¯­å¥çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œé¢„æµ‹ï¼šç©¶ç«Ÿæ˜¯èµ° c ç´¢å¼•æ‰«æçš„è¡Œæ•°å°‘ï¼Œè¿˜æ˜¯ç›´æ¥æ‰«æå…¨è¡¨æ‰«æçš„è¡Œæ•°å°‘å‘¢ï¼Ÿæ˜¾ç„¶ï¼Œæ‰«æè¡Œæ•°è¶Šå°‘å½“ç„¶è¶Šå¥½äº†ï¼Œå› ä¸ºæ‰«æè¡Œæ•°è¶Šå°‘ï¼Œæ„å‘³ç€I/Oæ“ä½œçš„æ¬¡æ•°è¶Šå°‘ã€‚</p><p>å¦‚æœæ˜¯æ‰«æå…¨è¡¨çš„è¯ï¼Œé‚£ä¹ˆæ‰«æçš„æ¬¡æ•°å°±æ˜¯è¿™ä¸ªè¡¨çš„æ€»è¡Œæ•°äº†ï¼Œå‡è®¾ä¸º nï¼›è€Œå¦‚æœèµ°ç´¢å¼• c çš„è¯ï¼Œæˆ‘ä»¬é€šè¿‡ç´¢å¼• c æ‰¾åˆ°ä¸»é”®ä¹‹åï¼Œè¿˜å¾—å†é€šè¿‡ä¸»é”®ç´¢å¼•æ¥æ‰¾æˆ‘ä»¬æ•´è¡Œçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦èµ°ä¸¤æ¬¡ç´¢å¼•ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬ä¹Ÿä¸çŸ¥é“ç¬¦åˆ 100 c &lt; and c &lt; 10000 è¿™ä¸ªæ¡ä»¶çš„æ•°æ®æœ‰å¤šå°‘è¡Œï¼Œä¸‡ä¸€è¿™ä¸ªè¡¨æ˜¯å…¨éƒ¨æ•°æ®éƒ½ç¬¦åˆå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™æ„å‘³ç€ï¼Œèµ° c ç´¢å¼•ä¸ä»…æ‰«æçš„è¡Œæ•°æ˜¯ nï¼ŒåŒæ—¶è¿˜å¾—æ¯è¡Œæ•°æ®èµ°ä¸¤æ¬¡ç´¢å¼•ã€‚</p><p><strong>æ‰€ä»¥å‘¢ï¼Œç³»ç»Ÿæ˜¯æœ‰å¯èƒ½èµ°å…¨è¡¨æ‰«æè€Œä¸èµ°ç´¢å¼•çš„ã€‚é‚£ç³»ç»Ÿæ˜¯æ€ä¹ˆåˆ¤æ–­å‘¢ï¼Ÿ</strong></p><p>åˆ¤æ–­æ¥æºäºç³»ç»Ÿçš„é¢„æµ‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¦èµ° c å­—æ®µç´¢å¼•çš„è¯ï¼Œç³»ç»Ÿä¼šé¢„æµ‹èµ° c å­—æ®µç´¢å¼•å¤§æ¦‚éœ€è¦æ‰«æå¤šå°‘è¡Œã€‚å¦‚æœé¢„æµ‹åˆ°è¦æ‰«æçš„è¡Œæ•°å¾ˆå¤šï¼Œå®ƒå¯èƒ½å°±ä¸èµ°ç´¢å¼•è€Œç›´æ¥æ‰«æå…¨è¡¨äº†ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ<strong>ç³»ç»Ÿæ˜¯æ€ä¹ˆé¢„æµ‹åˆ¤æ–­çš„å‘¢ï¼Ÿ</strong></p><p>å±…ç„¶æ˜¯é‡‡æ ·ï¼Œé‚£å°±æœ‰å¯èƒ½å‡ºç°<strong>å¤±è¯¯</strong>çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œc è¿™ä¸ªç´¢å¼•çš„åŸºæ•°å®é™…ä¸Šæ˜¯å¾ˆå¤§çš„ï¼Œä½†æ˜¯é‡‡æ ·çš„æ—¶å€™ï¼Œå´å¾ˆä¸å¹¸ï¼ŒæŠŠè¿™ä¸ªç´¢å¼•çš„åŸºæ•°é¢„æµ‹æˆå¾ˆå°ã€‚ä¾‹å¦‚ä½ é‡‡æ ·çš„é‚£ä¸€éƒ¨åˆ†æ•°æ®åˆšå¥½åŸºæ•°å¾ˆå°ï¼Œç„¶åå°±è¯¯ä»¥ä¸ºç´¢å¼•çš„åŸºæ•°å¾ˆå°ã€‚<strong>ç„¶åå°±å‘µå‘µï¼Œç³»ç»Ÿå°±ä¸èµ° c ç´¢å¼•äº†ï¼Œç›´æ¥èµ°å…¨éƒ¨æ‰«æäº†</strong>ã€‚</p><p>æ‰€ä»¥å‘¢ï¼Œè¯´äº†è¿™ä¹ˆå¤šï¼Œå¾—å‡ºç»“è®ºï¼š<strong>ç”±äºç»Ÿè®¡çš„å¤±è¯¯ï¼Œå¯¼è‡´ç³»ç»Ÿæ²¡æœ‰èµ°ç´¢å¼•ï¼Œè€Œæ˜¯èµ°äº†å…¨è¡¨æ‰«æ</strong>ï¼Œè€Œè¿™ï¼Œä¹Ÿæ˜¯å¯¼è‡´æˆ‘ä»¬ SQL è¯­å¥æ‰§è¡Œçš„å¾ˆæ…¢çš„åŸå› ã€‚</p><blockquote><p>è¿™é‡Œæˆ‘å£°æ˜ä¸€ä¸‹ï¼Œç³»ç»Ÿåˆ¤æ–­æ˜¯å¦èµ°ç´¢å¼•ï¼Œæ‰«æè¡Œæ•°çš„é¢„æµ‹å…¶å®åªæ˜¯åŸå› ä¹‹ä¸€ï¼Œè¿™æ¡æŸ¥è¯¢è¯­å¥æ˜¯å¦éœ€è¦ä½¿ç”¨ä½¿ç”¨ä¸´æ—¶è¡¨ã€æ˜¯å¦éœ€è¦æ’åºç­‰ä¹Ÿæ˜¯ä¼šå½±å“ç³»ç»Ÿçš„é€‰æ‹©çš„ã€‚</p></blockquote><p>ä¸è¿‡å‘¢ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿå¯ä»¥é€šè¿‡å¼ºåˆ¶èµ°ç´¢å¼•çš„æ–¹å¼æ¥æŸ¥è¯¢ï¼Œä¾‹å¦‚</p><pre><code class="sql">select * from t force index(a) where c &lt; 100 and c &lt; 100000;</code></pre><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡</p><pre><code class="sql">show index from t;</code></pre><p>æ¥æŸ¥è¯¢ç´¢å¼•çš„åŸºæ•°å’Œå®é™…æ˜¯å¦ç¬¦åˆï¼Œå¦‚æœå’Œå®é™…å¾ˆä¸ç¬¦åˆçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ¥ç»Ÿè®¡ç´¢å¼•çš„åŸºæ•°ï¼Œå¯ä»¥ç”¨è¿™æ¡å‘½ä»¤</p><pre><code class="sql">analyze table t;</code></pre><p>æ¥é‡æ–°ç»Ÿè®¡åˆ†æã€‚</p><p><strong>æ—¢ç„¶ä¼šé¢„æµ‹é”™ç´¢å¼•çš„åŸºæ•°ï¼Œè¿™ä¹Ÿæ„å‘³ç€ï¼Œå½“æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œç³»ç»Ÿæœ‰å¯èƒ½ä¹Ÿä¼šé€‰é”™ç´¢å¼•å“¦</strong>ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯ SQL æ‰§è¡Œçš„å¾ˆæ…¢çš„ä¸€ä¸ªåŸå› ã€‚</p><h2 id="ä¸€æ¡SQLè¯­å¥åœ¨MySQLä¸­å¦‚ä½•æ‰§è¡Œçš„"><a href="#ä¸€æ¡SQLè¯­å¥åœ¨MySQLä¸­å¦‚ä½•æ‰§è¡Œçš„" class="headerlink" title="ä¸€æ¡SQLè¯­å¥åœ¨MySQLä¸­å¦‚ä½•æ‰§è¡Œçš„"></a>ä¸€æ¡SQLè¯­å¥åœ¨MySQLä¸­å¦‚ä½•æ‰§è¡Œçš„</h2><p><strong>â€¢è¿æ¥å™¨ï¼š</strong> èº«ä»½è®¤è¯å’Œæƒé™ç›¸å…³(ç™»å½• MySQL çš„æ—¶å€™)ã€‚</p><p>â€¢<strong>æŸ¥è¯¢ç¼“å­˜:</strong> æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL 8.0 ç‰ˆæœ¬åç§»é™¤ï¼Œå› ä¸ºè¿™ä¸ªåŠŸèƒ½ä¸å¤ªå®ç”¨ï¼‰ã€‚</p><p>â€¢<strong>åˆ†æå™¨:</strong> æ²¡æœ‰å‘½ä¸­ç¼“å­˜çš„è¯ï¼ŒSQL è¯­å¥å°±ä¼šç»è¿‡åˆ†æå™¨ï¼Œåˆ†æå™¨è¯´ç™½äº†å°±æ˜¯è¦å…ˆçœ‹ä½ çš„ SQL è¯­å¥è¦å¹²å˜›ï¼Œå†æ£€æŸ¥ä½ çš„ SQL è¯­å¥è¯­æ³•æ˜¯å¦æ­£ç¡®ã€‚</p><p>â€¢<strong>ä¼˜åŒ–å™¨ï¼š</strong> æŒ‰ç…§ MySQL è®¤ä¸ºæœ€ä¼˜çš„æ–¹æ¡ˆå»æ‰§è¡Œã€‚</p><p>â€¢<strong>æ‰§è¡Œå™¨:</strong> æ‰§è¡Œè¯­å¥ï¼Œç„¶åä»å­˜å‚¨å¼•æ“è¿”å›æ•°æ®ã€‚</p><p><img alt="image-20200527193005072" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf78hg9f9yj30mw0pztdv.jpg" class="lazyload"></p><h2 id="MySQLé«˜æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#MySQLé«˜æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="MySQLé«˜æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>MySQLé«˜æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2><hr><h3 id="æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ"><a href="#æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ" class="headerlink" title="æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ"></a>æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ</h3><h4 id="æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨-Innodb-å­˜å‚¨å¼•æ“"><a href="#æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨-Innodb-å­˜å‚¨å¼•æ“" class="headerlink" title="æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨ Innodb å­˜å‚¨å¼•æ“"></a>æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨ Innodb å­˜å‚¨å¼•æ“</h4><p>æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼ˆå³ Innodb æ— æ³•æ»¡è¶³çš„åŠŸèƒ½å¦‚ï¼šåˆ—å­˜å‚¨ï¼Œå­˜å‚¨ç©ºé—´æ•°æ®ç­‰ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨ Innodb å­˜å‚¨å¼•æ“ï¼ˆMySQL5.5 ä¹‹å‰é»˜è®¤ä½¿ç”¨ Myisamï¼Œ5.6 ä»¥åé»˜è®¤çš„ä¸º Innodbï¼‰ã€‚</p><p>Innodb æ”¯æŒäº‹åŠ¡ï¼Œæ”¯æŒè¡Œçº§é”ï¼Œæ›´å¥½çš„æ¢å¤æ€§ï¼Œé«˜å¹¶å‘ä¸‹æ€§èƒ½æ›´å¥½ã€‚</p><h4 id="æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨-UTF8"><a href="#æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨-UTF8" class="headerlink" title="æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨ UTF8"></a>æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨ UTF8</h4><p>å…¼å®¹æ€§æ›´å¥½ï¼Œç»Ÿä¸€å­—ç¬¦é›†å¯ä»¥é¿å…ç”±äºå­—ç¬¦é›†è½¬æ¢äº§ç”Ÿçš„ä¹±ç ï¼Œä¸åŒçš„å­—ç¬¦é›†è¿›è¡Œæ¯”è¾ƒå‰éœ€è¦è¿›è¡Œè½¬æ¢ä¼šé€ æˆç´¢å¼•å¤±æ•ˆï¼Œå¦‚æœæ•°æ®åº“ä¸­æœ‰å­˜å‚¨ emoji è¡¨æƒ…çš„éœ€è¦ï¼Œå­—ç¬¦é›†éœ€è¦é‡‡ç”¨ utf8mb4 å­—ç¬¦é›†ã€‚</p><h4 id="å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°-å»ºè®®æ§åˆ¶åœ¨-500-ä¸‡ä»¥å†…ã€‚"><a href="#å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°-å»ºè®®æ§åˆ¶åœ¨-500-ä¸‡ä»¥å†…ã€‚" class="headerlink" title="å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°,å»ºè®®æ§åˆ¶åœ¨ 500 ä¸‡ä»¥å†…ã€‚"></a>å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°,å»ºè®®æ§åˆ¶åœ¨ 500 ä¸‡ä»¥å†…ã€‚</h4><p>500 ä¸‡å¹¶ä¸æ˜¯ MySQL æ•°æ®åº“çš„é™åˆ¶ï¼Œè¿‡å¤§ä¼šé€ æˆä¿®æ”¹è¡¨ç»“æ„ï¼Œå¤‡ä»½ï¼Œæ¢å¤éƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚</p><p>å¯ä»¥ç”¨å†å²æ•°æ®å½’æ¡£ï¼ˆåº”ç”¨äºæ—¥å¿—æ•°æ®ï¼‰ï¼Œåˆ†åº“åˆ†è¡¨ï¼ˆåº”ç”¨äºä¸šåŠ¡æ•°æ®ï¼‰ç­‰æ‰‹æ®µæ¥æ§åˆ¶æ•°æ®é‡å¤§å°</p><h4 id="ç¦æ­¢ä»å¼€å‘ç¯å¢ƒ-æµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿæˆç¯å¢ƒæ•°æ®åº“"><a href="#ç¦æ­¢ä»å¼€å‘ç¯å¢ƒ-æµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿæˆç¯å¢ƒæ•°æ®åº“" class="headerlink" title="ç¦æ­¢ä»å¼€å‘ç¯å¢ƒ,æµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿæˆç¯å¢ƒæ•°æ®åº“"></a>ç¦æ­¢ä»å¼€å‘ç¯å¢ƒ,æµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿæˆç¯å¢ƒæ•°æ®åº“</h4><hr><h3 id="æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ"><a href="#æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ" class="headerlink" title="æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ"></a>æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ</h3><h4 id="ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹"><a href="#ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹" class="headerlink" title="ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹"></a>ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹</h4><p><strong>a.å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—ç±»å‹å­˜å‚¨,å¦‚:å°† IP åœ°å€è½¬æ¢æˆæ•´å½¢æ•°æ®</strong></p><p>MySQL æä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç† ip åœ°å€</p><p>â€¢inet_aton æŠŠ ip è½¬ä¸ºæ— ç¬¦å·æ•´å‹ (4-8 ä½)â€¢inet_ntoa æŠŠæ•´å‹çš„ ip è½¬ä¸ºåœ°å€</p><p>æ’å…¥æ•°æ®å‰ï¼Œå…ˆç”¨ inet_aton æŠŠ ip åœ°å€è½¬ä¸ºæ•´å‹ï¼Œå¯ä»¥èŠ‚çœç©ºé—´ï¼Œæ˜¾ç¤ºæ•°æ®æ—¶ï¼Œä½¿ç”¨ inet_ntoa æŠŠæ•´å‹çš„ ip åœ°å€è½¬ä¸ºåœ°å€æ˜¾ç¤ºå³å¯ã€‚</p><p><strong>b.å¯¹äºéè´Ÿå‹çš„æ•°æ® (å¦‚è‡ªå¢ ID,æ•´å‹ IP) æ¥è¯´,è¦ä¼˜å…ˆä½¿ç”¨æ— ç¬¦å·æ•´å‹æ¥å­˜å‚¨</strong></p><p><strong>åŸå› ï¼š</strong></p><p>æ— ç¬¦å·ç›¸å¯¹äºæœ‰ç¬¦å·å¯ä»¥å¤šå‡ºä¸€å€çš„å­˜å‚¨ç©ºé—´</p><pre><code>SIGNED INT -2147483648~2147483647UNSIGNED INT 0~429496729</code></pre><h4 id="å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º-NOT-NULL"><a href="#å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º-NOT-NULL" class="headerlink" title="å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º NOT NULL"></a>å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º NOT NULL</h4><p><strong>åŸå› ï¼š</strong></p><p>ç´¢å¼• NULL åˆ—éœ€è¦é¢å¤–çš„ç©ºé—´æ¥ä¿å­˜ï¼Œæ‰€ä»¥è¦å ç”¨æ›´å¤šçš„ç©ºé—´</p><p>è¿›è¡Œæ¯”è¾ƒå’Œè®¡ç®—æ—¶è¦å¯¹ NULL å€¼åšç‰¹åˆ«çš„å¤„ç†</p><h3 id="6-åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨-decimal-ç±»å‹"><a href="#6-åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨-decimal-ç±»å‹" class="headerlink" title="6. åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨ decimal ç±»å‹"></a>6. åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨ decimal ç±»å‹</h3><p>â€¢éç²¾å‡†æµ®ç‚¹ï¼šfloat,double</p><p>â€¢ç²¾å‡†æµ®ç‚¹ï¼šdecimal</p><p>Decimal ç±»å‹ä¸ºç²¾å‡†æµ®ç‚¹æ•°ï¼Œåœ¨è®¡ç®—æ—¶ä¸ä¼šä¸¢å¤±ç²¾åº¦</p><p>å¯ç”¨äºå­˜å‚¨æ¯” bigint æ›´å¤§çš„æ•´å‹æ•°æ®</p><hr><h3 id="ç´¢å¼•è®¾è®¡è§„èŒƒ"><a href="#ç´¢å¼•è®¾è®¡è§„èŒƒ" class="headerlink" title="ç´¢å¼•è®¾è®¡è§„èŒƒ"></a>ç´¢å¼•è®¾è®¡è§„èŒƒ</h3><h4 id="é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡-å»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡-5-ä¸ª"><a href="#é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡-å»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡-5-ä¸ª" class="headerlink" title="é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡,å»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡ 5 ä¸ª"></a>é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡,å»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡ 5 ä¸ª</h4><p>ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼ç´¢å¼•å¯ä»¥æé«˜æ•ˆç‡åŒæ ·å¯ä»¥é™ä½æ•ˆç‡ã€‚</p><p>ç´¢å¼•å¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ï¼Œä½†åŒæ ·ä¹Ÿä¼šé™ä½æ’å…¥å’Œæ›´æ–°çš„æ•ˆç‡ï¼Œç”šè‡³æœ‰äº›æƒ…å†µä¸‹ä¼šé™ä½æŸ¥è¯¢æ•ˆç‡ã€‚</p><h4 id="æ¯ä¸ªInnodbè¡¨å¿…é¡»æœ‰ä¸ªä¸»é”®"><a href="#æ¯ä¸ªInnodbè¡¨å¿…é¡»æœ‰ä¸ªä¸»é”®" class="headerlink" title="æ¯ä¸ªInnodbè¡¨å¿…é¡»æœ‰ä¸ªä¸»é”®"></a>æ¯ä¸ªInnodbè¡¨å¿…é¡»æœ‰ä¸ªä¸»é”®</h4><p><strong>Innodb</strong> æ˜¯ä¸€ç§ç´¢å¼•ç»„ç»‡è¡¨ï¼šæ•°æ®çš„å­˜å‚¨çš„é€»è¾‘é¡ºåºå’Œç´¢å¼•çš„é¡ºåºæ˜¯ç›¸åŒçš„ã€‚æ¯ä¸ªè¡¨éƒ½å¯ä»¥æœ‰å¤šä¸ªç´¢å¼•ï¼Œä½†æ˜¯è¡¨çš„å­˜å‚¨é¡ºåºåªèƒ½æœ‰ä¸€ç§ã€‚</p><p><strong>Innodb</strong> æ˜¯æŒ‰ç…§ä¸»é”®ç´¢å¼•çš„é¡ºåºæ¥ç»„ç»‡è¡¨çš„</p><p>â€¢ä¸è¦ä½¿ç”¨æ›´æ–°é¢‘ç¹çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œä¸é€‚ç”¨å¤šåˆ—ä¸»é”®ï¼ˆç›¸å½“äºè”åˆç´¢å¼•ï¼‰</p><p>â€¢ä¸è¦ä½¿ç”¨ UUID,MD5,HASH,å­—ç¬¦ä¸²åˆ—ä½œä¸ºä¸»é”®ï¼ˆæ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºå¢é•¿ï¼‰</p><p>â€¢ä¸»é”®å»ºè®®ä½¿ç”¨è‡ªå¢ ID å€¼</p><hr><h4 id="å¸¸è§ç´¢å¼•åˆ—å»ºè®®"><a href="#å¸¸è§ç´¢å¼•åˆ—å»ºè®®" class="headerlink" title="å¸¸è§ç´¢å¼•åˆ—å»ºè®®"></a>å¸¸è§ç´¢å¼•åˆ—å»ºè®®</h4><p>1ã€æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œéå¸¸é‡è¦çš„åŸåˆ™ï¼Œmysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€betweenã€like)å°±åœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚a = 1 and b = 2 and c &gt; 3 and d = 4 å¦‚æœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ï¼Œå¦‚æœå»ºç«‹(a,b,d,c)çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚ </p><p>2ã€=å’Œinå¯ä»¥ä¹±åºï¼Œæ¯”å¦‚a = 1 and b = 2 and c = 3 å»ºç«‹(a,b,c)ç´¢å¼•å¯ä»¥ä»»æ„é¡ºåºï¼Œmysqlçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå¸®ä½ ä¼˜åŒ–æˆç´¢å¼•å¯ä»¥è¯†åˆ«çš„å½¢å¼ ã€‚</p><hr><h4 id="é¿å…å»ºç«‹å†—ä½™ç´¢å¼•ï¼ˆå¢åŠ äº†æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼‰"><a href="#é¿å…å»ºç«‹å†—ä½™ç´¢å¼•ï¼ˆå¢åŠ äº†æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼‰" class="headerlink" title="é¿å…å»ºç«‹å†—ä½™ç´¢å¼•ï¼ˆå¢åŠ äº†æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼‰"></a>é¿å…å»ºç«‹å†—ä½™ç´¢å¼•ï¼ˆå¢åŠ äº†æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼‰</h4><p>å†—ä½™ç´¢å¼•æŒ‡çš„æ˜¯ç´¢å¼•çš„åŠŸèƒ½ç›¸åŒï¼Œèƒ½å¤Ÿå‘½ä¸­ å°±è‚¯å®šèƒ½å‘½ä¸­ ï¼Œé‚£ä¹ˆ å°±æ˜¯å†—ä½™ç´¢å¼•å¦‚ï¼ˆname,city ï¼‰å’Œï¼ˆname ï¼‰è¿™ä¸¤ä¸ªç´¢å¼•å°±æ˜¯å†—ä½™ç´¢å¼•ï¼Œèƒ½å¤Ÿå‘½ä¸­åè€…çš„æŸ¥è¯¢è‚¯å®šæ˜¯èƒ½å¤Ÿå‘½ä¸­å‰è€…çš„ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½åº”è¯¥å°½é‡æ‰©å±•å·²æœ‰çš„ç´¢å¼•è€Œä¸æ˜¯åˆ›å»ºæ–°ç´¢å¼•ã€‚</p><hr><h4 id="ç´¢å¼•-SET-è§„èŒƒ"><a href="#ç´¢å¼•-SET-è§„èŒƒ" class="headerlink" title="ç´¢å¼• SET è§„èŒƒ"></a>ç´¢å¼• SET è§„èŒƒ</h4><p><strong>å°½é‡é¿å…ä½¿ç”¨å¤–é”®çº¦æŸ</strong></p><p>â€¢ä¸å»ºè®®ä½¿ç”¨å¤–é”®çº¦æŸï¼ˆforeign keyï¼‰ï¼Œä½†ä¸€å®šè¦åœ¨è¡¨ä¸è¡¨ä¹‹é—´çš„å…³è”é”®ä¸Šå»ºç«‹ç´¢å¼•â€¢å¤–é”®å¯ç”¨äºä¿è¯æ•°æ®çš„å‚ç…§å®Œæ•´æ€§ï¼Œä½†å»ºè®®åœ¨ä¸šåŠ¡ç«¯å®ç°â€¢å¤–é”®ä¼šå½±å“çˆ¶è¡¨å’Œå­è¡¨çš„å†™æ“ä½œä»è€Œé™ä½æ€§èƒ½</p><hr><h3 id="æ•°æ®åº“-SQL-å¼€å‘è§„èŒƒ"><a href="#æ•°æ®åº“-SQL-å¼€å‘è§„èŒƒ" class="headerlink" title="æ•°æ®åº“ SQL å¼€å‘è§„èŒƒ"></a>æ•°æ®åº“ SQL å¼€å‘è§„èŒƒ</h3><h4 id="é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º-join-æ“ä½œ"><a href="#é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º-join-æ“ä½œ" class="headerlink" title="é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º join æ“ä½œ"></a>é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º join æ“ä½œ</h4><p>é€šå¸¸å­æŸ¥è¯¢åœ¨ in å­å¥ä¸­ï¼Œä¸”å­æŸ¥è¯¢ä¸­ä¸ºç®€å• SQL(ä¸åŒ…å« unionã€group byã€order byã€limit ä»å¥) æ—¶,æ‰å¯ä»¥æŠŠå­æŸ¥è¯¢è½¬åŒ–ä¸ºå…³è”æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚</p><p><strong>å­æŸ¥è¯¢æ€§èƒ½å·®çš„åŸå› ï¼š</strong></p><p>å­æŸ¥è¯¢çš„ç»“æœé›†æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œé€šå¸¸å­æŸ¥è¯¢çš„ç»“æœé›†ä¼šè¢«å­˜å‚¨åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½ä¸ä¼šå­˜åœ¨ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚ç‰¹åˆ«æ˜¯å¯¹äºè¿”å›ç»“æœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚</p><p>ç”±äºå­æŸ¥è¯¢ä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶è¡¨ä¹Ÿæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—è¿‡å¤šçš„ CPU å’Œ IO èµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚</p><h4 id="æ‹†åˆ†å¤æ‚çš„å¤§-SQL-ä¸ºå¤šä¸ªå°-SQL"><a href="#æ‹†åˆ†å¤æ‚çš„å¤§-SQL-ä¸ºå¤šä¸ªå°-SQL" class="headerlink" title="æ‹†åˆ†å¤æ‚çš„å¤§ SQL ä¸ºå¤šä¸ªå° SQL"></a>æ‹†åˆ†å¤æ‚çš„å¤§ SQL ä¸ºå¤šä¸ªå° SQL</h4><p>å¤§ SQL é€»è¾‘ä¸Šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å ç”¨å¤§é‡ CPU è¿›è¡Œè®¡ç®—çš„ SQLâ€¢MySQL ä¸­ï¼Œä¸€ä¸ª SQL åªèƒ½ä½¿ç”¨ä¸€ä¸ª CPU è¿›è¡Œè®¡ç®—â€¢SQL æ‹†åˆ†åå¯ä»¥é€šè¿‡å¹¶è¡Œæ‰§è¡Œæ¥æé«˜å¤„ç†æ•ˆç‡</p><h2 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h2><ul><li><a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/database-shard.md" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨ï¼ˆè®¾è®¡é«˜å¹¶å‘ç³»ç»Ÿçš„æ—¶å€™ï¼Œæ•°æ®åº“å±‚é¢è¯¥å¦‚ä½•è®¾è®¡ï¼‰ï¼Ÿç”¨è¿‡å“ªäº›åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶ï¼Ÿä¸åŒçš„åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶éƒ½æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿä½ ä»¬å…·ä½“æ˜¯å¦‚ä½•å¯¹æ•°æ®åº“å¦‚ä½•è¿›è¡Œå‚ç›´æ‹†åˆ†æˆ–æ°´å¹³æ‹†åˆ†çš„ï¼Ÿ</a></li><li><a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/database-shard-method.md" target="_blank" rel="noopener">ç°åœ¨æœ‰ä¸€ä¸ªæœªåˆ†åº“åˆ†è¡¨çš„ç³»ç»Ÿï¼Œæœªæ¥è¦åˆ†åº“åˆ†è¡¨ï¼Œå¦‚ä½•è®¾è®¡æ‰å¯ä»¥è®©ç³»ç»Ÿä»æœªåˆ†åº“åˆ†è¡¨åŠ¨æ€åˆ‡æ¢åˆ°åˆ†åº“åˆ†è¡¨ä¸Šï¼Ÿ</a></li><li><a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/database-shard-dynamic-expand.md" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡å¯ä»¥åŠ¨æ€æ‰©å®¹ç¼©å®¹çš„åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆï¼Ÿ</a></li><li><a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/database-shard-global-id-generate.md" target="_blank" rel="noopener">åˆ†åº“åˆ†è¡¨ä¹‹åï¼Œid ä¸»é”®å¦‚ä½•å¤„ç†ï¼Ÿ</a></li></ul><h2 id="binlogä¸»ä»åŒæ­¥ï¼ˆä¸»ä»ä¸ä¸€è‡´é—®é¢˜è§£å†³ï¼‰"><a href="#binlogä¸»ä»åŒæ­¥ï¼ˆä¸»ä»ä¸ä¸€è‡´é—®é¢˜è§£å†³ï¼‰" class="headerlink" title="binlogä¸»ä»åŒæ­¥ï¼ˆä¸»ä»ä¸ä¸€è‡´é—®é¢˜è§£å†³ï¼‰"></a>binlogä¸»ä»åŒæ­¥ï¼ˆä¸»ä»ä¸ä¸€è‡´é—®é¢˜è§£å†³ï¼‰</h2><h3 id="mysqlå¤åˆ¶çš„ç±»å‹"><a href="#mysqlå¤åˆ¶çš„ç±»å‹" class="headerlink" title="mysqlå¤åˆ¶çš„ç±»å‹"></a>mysqlå¤åˆ¶çš„ç±»å‹</h3><p>1.åŸºäºè¯­å¥çš„å¤åˆ¶ ï¼šä¸»åº“æŠŠsqlè¯­å¥å†™å…¥åˆ°bin logä¸­ï¼Œå®Œæˆå¤åˆ¶<br> 2.åŸºäºè¡Œæ•°æ®çš„å¤åˆ¶ï¼šä¸»åº“æŠŠæ¯ä¸€è¡Œæ•°æ®å˜åŒ–çš„ä¿¡æ¯ä½œä¸ºäº‹ä»¶ï¼Œå†™å…¥åˆ°bin logï¼Œå®Œæˆå¤åˆ¶<br> 3.æ··åˆå¤åˆ¶ï¼šä¸Šé¢ä¸¤ä¸ªç»“åˆä½“ï¼Œé»˜è®¤ç”¨è¯­å¥å¤åˆ¶ï¼Œå‡ºé—®é¢˜æ—¶å€™è‡ªåŠ¨åˆ‡æ¢æˆè¡Œæ•°æ®å¤åˆ¶</p><h3 id="ä¸»ä»å¤åˆ¶å·¥ä½œåŸç†å‰–æ"><a href="#ä¸»ä»å¤åˆ¶å·¥ä½œåŸç†å‰–æ" class="headerlink" title="ä¸»ä»å¤åˆ¶å·¥ä½œåŸç†å‰–æ"></a>ä¸»ä»å¤åˆ¶å·¥ä½œåŸç†å‰–æ</h3><p>1ã€Master æ•°æ®åº“åªè¦å‘ç”Ÿå˜åŒ–ï¼Œç«‹é©¬è®°å½•åˆ°Binary log æ—¥å¿—æ–‡ä»¶ä¸­<br>2ã€Slaveæ•°æ®åº“å¯åŠ¨ä¸€ä¸ªI/O threadè¿æ¥Masteræ•°æ®åº“ï¼Œè¯·æ±‚Masterå˜åŒ–çš„äºŒè¿›åˆ¶æ—¥å¿—<br>3ã€Slave I/Oè·å–åˆ°çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œä¿å­˜åˆ°è‡ªå·±çš„Relay log æ—¥å¿—æ–‡ä»¶ä¸­ã€‚<br>4ã€Slave æœ‰ä¸€ä¸ª SQL çº¿ç¨‹å®šæ—¶æ£€æŸ¥Realy logæ˜¯å¦å˜åŒ–ï¼Œå˜åŒ–é‚£ä¹ˆå°±æ›´æ–°æ•°æ®ã€‚</p><p><img alt="image-20200811095721600" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghmn10h564j30sg0k0dos.jpg" class="lazyload"></p><h3 id="ä¸»ä»å¤åˆ¶å»¶è¿ŸåŸå› "><a href="#ä¸»ä»å¤åˆ¶å»¶è¿ŸåŸå› " class="headerlink" title="ä¸»ä»å¤åˆ¶å»¶è¿ŸåŸå› "></a>ä¸»ä»å¤åˆ¶å»¶è¿ŸåŸå› </h3><p>ä»åº“ä»ä¸»åº“é€šè¿‡çš„è¿‡ç¨‹æ˜¯ä¸²è¡ŒåŒ–çš„ï¼ˆå†™binlogã€è¯»å–åˆ°relaylogï¼‰ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œä¸º<code>ä¸»ä»å»¶è¿Ÿ</code>ã€‚ç»éªŒæ¥è¯´ï¼Œä¸»åº“å†™å¹¶å‘ä¸º1000ï¼Œä»åº“å»¶è¿Ÿä¸ºå‡ æ¯«ç§’ï¼Œå†™å¹¶å‘ä¸º2000ï¼Œä»åº“å»¶è¿Ÿä¸ºå‡ åæ¯«ç§’ï¼Œå†™å¹¶å‘ä¸º6000-8000ï¼Œä»åº“å»¶è¿Ÿä¸ºå‡ ç§’ï¼Œæ­¤æ—¶ä¸»åº“å¿«å´©æºƒäº†ã€‚</p><h3 id="ä¸»ä»å¤åˆ¶æ•°æ®ä¸¢å¤±é—®é¢˜ï¼ŒåŠåŒæ­¥å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶æ•°æ®ä¸¢å¤±é—®é¢˜ï¼ŒåŠåŒæ­¥å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶æ•°æ®ä¸¢å¤±é—®é¢˜ï¼ŒåŠåŒæ­¥å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶æ•°æ®ä¸¢å¤±é—®é¢˜ï¼ŒåŠåŒæ­¥å¤åˆ¶</h3><p><code>åŠåŒæ­¥å¤åˆ¶</code>é˜²æ­¢ä¸»æ•°æ®åº“downäº†é€ æˆæ•°æ®ä¸¢å¤±ï¼Œè‡³å°‘ä¸€ä¸ªä»åº“å†™å…¥åˆ°relaylogæ—¥å¿—é‡Œï¼Œä¸»åº“æ‰ä¼šè®¤ä¸ºå†™å…¥æˆåŠŸäº†ã€‚</p><h3 id="ç¼“è§£ä¸»ä»å¤åˆ¶å»¶è¿Ÿé—®é¢˜"><a href="#ç¼“è§£ä¸»ä»å¤åˆ¶å»¶è¿Ÿé—®é¢˜" class="headerlink" title="ç¼“è§£ä¸»ä»å¤åˆ¶å»¶è¿Ÿé—®é¢˜"></a>ç¼“è§£ä¸»ä»å¤åˆ¶å»¶è¿Ÿé—®é¢˜</h3><p><code>é—®é¢˜ç°è±¡ï¼š</code></p><p>æ’å…¥ä¸€æ¡æ•°æ®ï¼ŒæŸ¥å‡ºè¿™æ¡æ•°æ®ï¼Œæ›´æ–°è¿™æ¡æ•°æ®ã€‚é«˜å³°æœŸæ¯ç§’2000å¤šå†™å¹¶å‘ï¼Œé€ æˆä»åº“æ²¡æŸ¥åˆ°ã€‚</p><p><code>è§£å†³ï¼š</code></p><p>1ã€å†™relayLogæ—¥å¿—éœ€å¤šä¸ªçº¿ç¨‹ã€‚</p><p>2ã€<code>å¹¶è¡Œå¤åˆ¶</code>mysql5.7å¯å¼€å¯å¤šä¸ªsqlçº¿ç¨‹ä»relayæ—¥å¿—å»è¯»å–ï¼Œç¼“è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜ã€‚</p><p>3ã€å°†ä¸€ä¸ªä¸»åº“æ‹†åˆ†ä¸ºå¤šä¸ªä¸»åº“ï¼Œé™ä½ä¸»åº“çš„å†™å¹¶å‘ã€‚</p><p>4ã€å¯ä»¥å°†æ ¸å¿ƒä¸šåŠ¡çš„æŸ¥æ“ä½œç›´è¿ä¸»åº“ï¼Œä½†æ˜¯ä¸å¤ªå»ºè®®è¿™ç‚¹ï¼Œè¿èƒŒäº†è¯»å†™åˆ†ç¦»çš„åˆè¡·ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dubbo</title>
      <link href="/2020/01/15/7.%20%E5%88%86%E5%B8%83%E5%BC%8F/Dubbo/"/>
      <url>/2020/01/15/7.%20%E5%88%86%E5%B8%83%E5%BC%8F/Dubbo/</url>
      
        <content type="html"><![CDATA[<h2 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h2><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><p><a href="https://mp.weixin.qq.com/s/PdWRHgm83XwPYP08KnkIsw" target="_blank" rel="noopener">dubboé¢è¯•é¢˜</a></p></li><li><p><a href="https://juejin.im/post/5e9591dee51d4546cf7785ca?utm_source=gold_browser_extension" target="_blank" rel="noopener">åˆ†å¸ƒå¼ç›¸å…³é¢è¯•é¢˜</a></p></li><li><p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/system-design/data-communication/dubbo.md" target="_blank" rel="noopener">Dubbo æ€»ç»“ï¼šå…³äº Dubbo çš„é‡è¦çŸ¥è¯†ç‚¹</a></p></li></ul><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="ä¸ºä»€ä¹ˆè¦ç”¨-Dubboï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨-Dubboï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨ Dubboï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ç”¨ Dubboï¼Ÿ</h3><ul><li>éšç€æœåŠ¡åŒ–çš„è¿›ä¸€æ­¥å‘å±•ï¼ŒæœåŠ¡è¶Šæ¥è¶Šå¤šï¼ŒæœåŠ¡ä¹‹é—´çš„è°ƒç”¨å’Œä¾èµ–å…³ç³»ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œè¯ç”Ÿäº†é¢å‘æœåŠ¡çš„æ¶æ„ä½“ç³»(SOA)ï¼Œä¹Ÿå› æ­¤è¡ç”Ÿå‡ºäº†ä¸€ç³»åˆ—ç›¸åº”çš„æŠ€æœ¯ï¼Œå¦‚å¯¹æœåŠ¡æä¾›ã€æœåŠ¡è°ƒç”¨ã€è¿æ¥å¤„ç†ã€é€šä¿¡åè®®ã€åºåˆ—åŒ–æ–¹å¼ã€æœåŠ¡å‘ç°ã€æœåŠ¡è·¯ç”±ã€æ—¥å¿—è¾“å‡ºç­‰è¡Œä¸ºè¿›è¡Œå°è£…çš„æœåŠ¡æ¡†æ¶ã€‚å°±è¿™æ ·ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„æœåŠ¡æ²»ç†æ¡†æ¶å°±å‡ºç°äº†ï¼ŒDubbo ä¹Ÿå°±è¿™æ ·äº§ç”Ÿäº†ã€‚</li></ul><h3 id="Dubbo-æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ"><a href="#Dubbo-æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Dubbo æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ"></a>Dubbo æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ</h3><p><img alt="image-20200612152236892" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfpj8vnukjj30sg0lr0wx.jpg" class="lazyload"></p><ul><li>Providerï¼šæš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹</li><li>Consumerï¼šè°ƒç”¨è¿œç¨‹æœåŠ¡æ¶ˆè´¹æ–¹</li><li>Registryï¼šæœåŠ¡æ³¨å†Œä¸å‘ç°æ³¨å†Œä¸­å¿ƒ</li><li>Monitorï¼šç›‘æ§ä¸­å¿ƒå’Œè®¿é—®è°ƒç”¨ç»Ÿè®¡</li><li>Containerï¼šæœåŠ¡è¿è¡Œå®¹å™¨</li></ul><h3 id="Dubbo-æœåŠ¡å™¨æ³¨å†Œä¸å‘ç°çš„æµç¨‹ï¼Ÿ"><a href="#Dubbo-æœåŠ¡å™¨æ³¨å†Œä¸å‘ç°çš„æµç¨‹ï¼Ÿ" class="headerlink" title="Dubbo æœåŠ¡å™¨æ³¨å†Œä¸å‘ç°çš„æµç¨‹ï¼Ÿ"></a>Dubbo æœåŠ¡å™¨æ³¨å†Œä¸å‘ç°çš„æµç¨‹ï¼Ÿ</h3><ul><li>æœåŠ¡å®¹å™¨Containerè´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚</li><li>æœåŠ¡æä¾›è€…Provideråœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚</li><li>æœåŠ¡æ¶ˆè´¹è€…Consumeråœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚</li><li>æ³¨å†Œä¸­å¿ƒRegistryè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚</li><li>æœåŠ¡æ¶ˆè´¹è€…Consumerï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚</li><li>æœåŠ¡æ¶ˆè´¹è€…Consumerå’Œæä¾›è€…Providerï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒMonitorã€‚</li></ul><h3 id="è¯´è¯´-Dubbo-æœåŠ¡æš´éœ²çš„è¿‡ç¨‹"><a href="#è¯´è¯´-Dubbo-æœåŠ¡æš´éœ²çš„è¿‡ç¨‹" class="headerlink" title="è¯´è¯´ Dubbo æœåŠ¡æš´éœ²çš„è¿‡ç¨‹"></a>è¯´è¯´ Dubbo æœåŠ¡æš´éœ²çš„è¿‡ç¨‹</h3><p>dubboé‡‡ç”¨çš„nioå¼‚æ­¥çš„é€šä¿¡ï¼Œé€šä¿¡åè®®é»˜è®¤ä¸º netty,å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹© mina,grizzyã€‚åœ¨æœåŠ¡ç«¯ï¼ˆproviderï¼‰åœ¨å¯åŠ¨æ—¶ä¸»è¦æ˜¯å¼€å¯nettyç›‘å¬ï¼Œåœ¨zookeeperä¸Šæ³¨å†ŒæœåŠ¡èŠ‚ç‚¹ï¼Œå¤„ç†æ¶ˆè´¹è€…è¯·æ±‚ï¼Œè¿”å›å¤„ç†åçš„æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨æœåŠ¡æ—¶ä¸»è¦æ˜¯è®¢é˜…æœåŠ¡çš„èŠ‚ç‚¹ï¼Œç›‘å¬zookeeperèŠ‚ç‚¹ç›®å½•ï¼ŒæœåŠ¡ç«¯çš„å˜åŒ–æ—¶zookeeperä¼šæ¨é€ç»™æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…é‡æ–°ç¼“å­˜æœåŠ¡åœ°å€ç­‰ã€‚æœåŠ¡è€…ã€æ¶ˆè´¹è€…ã€zookeeperä¸‰è€…ä¹‹é—´éƒ½æ˜¯é•¿è¿æ¥ã€‚</p><hr><h4 id="ç®€æ˜“çš„æš´éœ²æµç¨‹"><a href="#ç®€æ˜“çš„æš´éœ²æµç¨‹" class="headerlink" title="ç®€æ˜“çš„æš´éœ²æµç¨‹"></a>ç®€æ˜“çš„æš´éœ²æµç¨‹</h4><ol><li><p>Springå°†dubboæ ‡ç­¾è§£æï¼Œæ³¨å…¥åˆ°ServiceConfigå±æ€§ä¸­</p></li><li><p>æœåŠ¡æš´éœ²çš„å…¥å£æ˜¯ï¼š<code>ServiceConfig</code>çš„<code>export</code> æ–¹æ³•ï¼Œé‡Œé¢åˆ¤æ–­æ˜¯å¦å»¶è¿Ÿæš´éœ²ï¼Œæœ€ç»ˆè°ƒç”¨<code>doExport</code></p></li><li><p><code>doExport</code>ä¼šå¯¹è§£æå®Œçš„é…ç½®å†åšä¸€æ¬¡æ£€æŸ¥ï¼Œæ‰€æœ‰çš„æ£€æŸ¥é€šè¿‡ä¹‹åï¼Œä¼šè°ƒç”¨ <code>doExportUrls</code> æ–¹æ³•ï¼Œå› ä¸ºdubboæ”¯æŒå¤šé€šä¿¡åè®®æ—¶ï¼Œéƒ½è¿›è¡Œæš´éœ²ï¼Œé‡Œé¢è°ƒç”¨<code>doExportUrlsFor1Protocol</code></p></li><li><p><code>doExportUrlsFor1Protocol</code>ä¸­ä¸»è¦å°†æ‰€æœ‰çš„é…ç½®è½¬åŒ–æˆmapï¼Œç„¶åå°†mapè½¬åŒ–æˆdubboçš„ç»Ÿä¸€URLï¼Œæœ€ç»ˆæš´éœ²çš„dubboæœåŠ¡ä¹Ÿå°±æ˜¯è¿™ä¸ªç»Ÿä¸€çš„urlï¼Œè¿™ä¸ªurlä¹Ÿä¼šæ³¨å†Œåˆ°zookeeperçš„èŠ‚ç‚¹ä¸Šã€‚ç„¶åå°†æ‰€æœ‰æœåŠ¡çš„å®ç°å°è£…æˆä¸€ä¸ª<code>invoker</code>ï¼Œå¹¶ç¼“å­˜èµ·æ¥ï¼Œç¼“å­˜é‡Œä½¿ç”¨Invokerçš„urlä½œä¸ºkeyã€‚ä»£ç æ ¸å¿ƒæš´éœ²çš„ä¸€è¡Œä»£ç ä¸ºï¼š<strong>protocol.export(invoker);</strong> </p></li><li><p><code>RegistryProtocol.exprot</code>ä¸»è¦åšä¸¤ä»¶äº‹æƒ…ï¼š1ã€å¼€å¯nettyæœåŠ¡ç«¯å¹¶ç›‘å¬  ã€‚2ã€åˆ›å»ºzookeeperæœåŠ¡ä¸´æ—¶èŠ‚ç‚¹ã€‚</p></li><li><p>å¯åŠ¨æ³¨å†Œæ˜¯è°ƒç”¨doRegisteræ–¹æ³•ï¼Œä¸åŒåè®®é‡å†™äº†æ­¤æ–¹æ³•ã€‚å…¶å®ä»ä¸Šé¢å·²ç»å¯ä»¥çœ‹åˆ° åœ¨zookeeperä¸Šé¢åˆ›å»º èŠ‚ç‚¹äº†ï¼Œé»˜è®¤ä¸åˆ†ç»„çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç»“æ„å¦‚ä¸‹ï¼š/dubbo/XXXXservice/consumersã€providers<img alt="image-20200612172041457" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfpmnqvwh9j30et03h0sz.jpg" class="lazyload"></p></li><li><p>æœåŠ¡ç«¯Serverå¯åŠ¨ï¼Œç›‘å¬ç«¯å£ã€‚ï¼ˆè¯·æ±‚æ¥åˆ°æ—¶ï¼Œæ ¹æ®è¯·æ±‚ä¿¡æ¯ç”Ÿæˆkeyï¼Œåˆ°ç¼“å­˜æŸ¥æ‰¾Exporterï¼Œå°±æ‰¾åˆ°äº†Invokerï¼Œå°±å¯ä»¥å®Œæˆè°ƒç”¨ã€‚ï¼‰</p></li></ol><h4 id="ç»“åˆæºç "><a href="#ç»“åˆæºç " class="headerlink" title="ç»“åˆæºç "></a>ç»“åˆæºç </h4><p>ä¸‹é¢çœ‹dubboæºç æ¥çœ‹æœåŠ¡æš´éœ²çš„è¿‡ç¨‹ï¼ŒæœåŠ¡æš´éœ²çš„å…¥å£ä¸ºï¼š<code>com.alibaba.dubbo.config.ServiceConfig</code>#<code>export</code> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="java">//æ˜¯å¦å»¶æ—¶æš´éœ²if (delay != null &amp;&amp; delay &gt; 0) {  Thread thread = new Thread(new Runnable() {    public void run() {      try {        Thread.sleep(delay);      } catch (Throwable e) {      }      doExport();    }  });  thread.setDaemon(true);  thread.setName(&quot;DelayExportServiceThread&quot;);  thread.start();} else {  //ä¸å»¶æ—¶æš´éœ²ï¼Œåˆ™ç›´æ¥æš´éœ²  doExport();}</code></pre><p>ä¸Šåœ¨ä»£ç æ— è®ºæ˜¯å»¶æ—¶æš´éœ²æˆ–ç›´æ¥æš´éœ²è°ƒç”¨çš„æ–¹æ³•æ˜¯ï¼š<code>doExport()</code>,doExportä¼šå¯¹è§£æå®Œçš„é…ç½®å†åšä¸€æ¬¡æ£€æŸ¥ï¼Œæ ¸å¿ƒä»£ç å¤§å®¶å¯ä»¥æŸ¥çœ‹dubboçš„æºç ï¼Œä¸‹é¢åˆ—å‡ºä¸€å°éƒ¨åˆ†</p><pre><code class="java">/*     æ£€æŸ¥é»˜è®¤è®¾ç½®,å¦‚æœxmlä¸­æ²¡æœ‰é…ç½®&lt;dubbo:provider     ä¸»è¦æ˜¯ä»ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­å¯»æ‰¾æ˜¯å¦æœ‰ç›¸åº”çš„providerçš„é…ç½®  */ checkDefault(); //ä¸‹é¢è®¾ç½®çš„å†…å®¹å¦‚æœæ²¡æœ‰é…ç½®&lt;dubbo:provideræ—¶åŸºæœ¬ä¸Šéƒ½æ˜¯Null if (provider != null) {     if (application == null) {         application = provider.getApplication();     }     if (module == null) {         module = provider.getModule();     }     if (registries == null) {         registries = provider.getRegistries();     }     if (monitor == null) {         monitor = provider.getMonitor();     }     if (protocols == null) {         protocols = provider.getProtocols();     } } if (module != null) {     //registriesä¸€èˆ¬éƒ½ä¼šé…ç½®     if (registries == null) {         registries = module.getRegistries();     }     if (monitor == null) {         monitor = module.getMonitor();     } } if (application != null) {     //applicationä¸€èˆ¬ä¹Ÿä¼šé…ç½®     if (registries == null) {         registries = application.getRegistries();     }     if (monitor == null) {         monitor = application.getMonitor();     } } //æ˜¯å¦æ³›åŒ–è°ƒç”¨ if (ref instanceof GenericService) {     interfaceClass = GenericService.class;     if (StringUtils.isEmpty(generic)) {         generic = Boolean.TRUE.toString();     } } else {     try {         interfaceClass = Class.forName(interfaceName, true, Thread.currentThread()                 .getContextClassLoader());     } catch (ClassNotFoundException e) {         throw new IllegalStateException(e.getMessage(), e);     }     /*         æ£€æŸ¥å³å°†æš´éœ²çš„æ¥å£çš„æ–¹æ³•é…ç½®,æ£€æŸ¥æ–¹æ³•æ˜¯å¦åœ¨æ¥å£ä¸­å­˜åœ¨         ä¸€èˆ¬ä¸ä¼šé…ç½®æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹methodsä¸ºnull         &lt;dubbo:service  &gt; &lt;dubbo:method /&gt; &lt;/dubbo:serivce&gt;      */     checkInterfaceAndMethods(interfaceClass, methods);     /*         æ£€æŸ¥æ¥å£çš„å¼•ç”¨ä¸ä¸ºç©º,å¹¶ä¸”å¿…é¡»å®ç°çš„æ˜¯è¦æš´éœ²çš„æ¥å£      */     checkRef();     generic = Boolean.FALSE.toString(); }</code></pre><p>æ‰€æœ‰çš„æ£€æŸ¥é€šè¿‡ä¹‹åï¼Œä¼šè°ƒç”¨ ï¼š<code>com.alibaba.dubbo.config.ServiceConfig</code>#<code>doExportUrls</code> æ–¹æ³•ï¼Œå› ä¸ºdubboæ”¯æŒå¤šé€šä¿¡åè®®æ—¶ï¼Œéƒ½è¿›è¡Œæš´éœ²ï¼Œæ‰€ä»¥åœ¨ä»£ç ä¸­å¯ä»¥çœ‹åˆ°</p><pre><code class="java">/*    å°†æ³¨å†Œåè®®è½¬åŒ–æˆurl    registry://45.119.68.23:2181/com.alibaba.dubbo.registry.RegistryService?    application=test-dubbo&amp;dubbo=2.5.3&amp;pid=7648&amp;registry=zookeeperÃ—tamp=1462349748801 */List&lt;URL&gt; registryURLs = loadRegistries(true);//é…ç½®å¤šé€šä¿¡åè®®æ—¶ï¼Œéƒ½è¿›è¡Œæš´éœ²for (ProtocolConfig protocolConfig : protocols) {    doExportUrlsFor1Protocol(protocolConfig, registryURLs);}</code></pre><p><code>doExportUrlsFor1Protocol</code>ä¸­ä¸»è¦å°†æ‰€æœ‰çš„é…ç½®è½¬åŒ–æˆmapï¼Œç„¶åå°†mapè½¬åŒ–æˆdubboçš„ç»Ÿä¸€URLï¼Œæœ€ç»ˆæš´éœ²çš„dubboæœåŠ¡ä¹Ÿå°±æ˜¯è¿™ä¸ªç»Ÿä¸€çš„urlï¼Œè¿™ä¸ªurlä¹Ÿä¼šæ³¨å†Œåˆ°zookeeperçš„èŠ‚ç‚¹ä¸Šï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="java">/*    å°†ä¸ä¸ºnullçš„é…ç½®å¯¹è±¡ä¸­çš„å±æ€§è®¾ç½®åˆ° map ä¸­    å³å°† xml é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®è®¾ç½®çš„å€¼å…¨è½¬åŒ–æˆä¸ºmap    {side=provider, application=alijk-dubbo, accepts=1000,        dubbo=2.5.3, threads=100, pid=7236, interface=cn.eoncloud.account.sdk.export.AccountService,        threadpool=fixed, version=1.0.0, timeout=500, anyhost=true, timestamp=1462347843960} */appendParameters(map, application);appendParameters(map, module);appendParameters(map, provider, Constants.DEFAULT_KEY);appendParameters(map, protocolConfig);appendParameters(map, this);ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚/*    å°†é…ç½®ä¿¡æ¯è½¬åŒ–æˆ url ,ä¸»è¦æ ¹æ®ä¹‹å‰mapé‡Œçš„æ•°æ®ç»„è£…æˆurl    è°ƒç”¨ URL#buildStringæ–¹æ³•    dubbo://10.6.13.137:9998/cn.eoncloud.account.sdk.export.AccountService    ?accepts=1000&amp;anyhost=true&amp;application=test-dubbo&amp;dubbo=2.5.3    &amp;interface=cn.eoncloud.account.sdk.export.AccountService    &amp;methods=getAccountName,getAllTest&amp;pid=7236&amp;revision=1.0.0&amp;side=provider    &amp;threadpool=fixed&amp;threads=100&amp;timeout=500Ã—tamp=1462347843960&amp;version=1.0.0 */URL url = new URL(name, host, port, (contextPath == null || contextPath.length() == 0 ? &quot;&quot; : contextPath + &quot;/&quot;) + path, map);if (ExtensionLoader.getExtensionLoader(ConfiguratorFactory.class)        .hasExtension(url.getProtocol())) {    url = ExtensionLoader.getExtensionLoader(ConfiguratorFactory.class)            .getExtension(url.getProtocol()).getConfigurator(url).configure(url);}ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚Invoker&lt;?&gt; invoker = proxyFactory.getInvoker(ref, (Class) interfaceClass, registryURL.addParameterAndEncoded(Constants.EXPORT_KEY, url.toFullString()));//com.alibaba.dubbo.registry.integration.RegistryProtocol#export å³å°†è¿›è¡Œæš´éœ²Exporter&lt;?&gt; exporter = protocol.export(invoker);</code></pre><p>ä¸Šé¢çš„ä»£ç æ ¸å¿ƒæš´éœ²çš„ä¸€è¡Œä»£ç ä¸ºï¼šprotocol.export(invoker); è¿™ä¸ªprotocolçš„å€¼ä¸ºï¼šRegistryProtocolï¼Œä¹Ÿå°±æ˜¯æš´éœ²ä¼šè·³åˆ°ï¼šRegistryProtocol.exprotä¸­å»å¤„ç†ï¼ŒRegistryProtocol.exprotä¸»è¦åšä¸¤ä»¶äº‹æƒ…ï¼š1ã€å¼€å¯nettyæœåŠ¡ç«¯  ã€‚2ã€åˆ›å»ºzookeeperæœåŠ¡èŠ‚ç‚¹ã€‚ä¸‹é¢æ¥çœ‹RegistryProtocol.export æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="java">public &lt;T&gt; Exporter&lt;T&gt; export(final Invoker&lt;T&gt; originInvoker) throws RpcException {        //export invoker doLocalExportè°ƒç”¨dubboProtocol.exportå¼€å¯nettyæœåŠ¡ç›‘å¬        final ExporterChangeableWrapper&lt;T&gt; exporter = doLocalExport(originInvoker);        //registry provider        final Registry registry = getRegistry(originInvoker);        final URL registedProviderUrl = getRegistedProviderUrl(originInvoker);        //è°ƒç”¨zodoRegisterçš„doRegister åˆ›å»ºzookeeperçš„æœåŠ¡èŠ‚ç‚¹        registry.register(registedProviderUrl);        // è®¢é˜…overrideæ•°æ®        // FIXME æä¾›è€…è®¢é˜…æ—¶ï¼Œä¼šå½±å“åŒä¸€JVMå³æš´éœ²æœåŠ¡ï¼Œåˆå¼•ç”¨åŒä¸€æœåŠ¡çš„çš„åœºæ™¯ï¼Œå› ä¸ºsubscribedä»¥æœåŠ¡åä¸ºç¼“å­˜çš„keyï¼Œå¯¼è‡´è®¢é˜…ä¿¡æ¯è¦†ç›–ã€‚        final URL overrideSubscribeUrl = getSubscribedOverrideUrl(registedProviderUrl);        final OverrideListener overrideSubscribeListener = new OverrideListener(overrideSubscribeUrl);        overrideListeners.put(overrideSubscribeUrl, overrideSubscribeListener);        //è®¢é˜…        registry.subscribe(overrideSubscribeUrl, overrideSubscribeListener);        //ä¿è¯æ¯æ¬¡exportéƒ½è¿”å›ä¸€ä¸ªæ–°çš„exporterå®ä¾‹        return new Exporter&lt;T&gt;() {            public Invoker&lt;T&gt; getInvoker() {                return exporter.getInvoker();            }            public void unexport() {                try {                    exporter.unexport();                } catch (Throwable t) {                    logger.warn(t.getMessage(), t);                }                try {                    registry.unregister(registedProviderUrl);                } catch (Throwable t) {                    logger.warn(t.getMessage(), t);                }                try {                    overrideListeners.remove(overrideSubscribeUrl);                    registry.unsubscribe(overrideSubscribeUrl, overrideSubscribeListener);                } catch (Throwable t) {                    logger.warn(t.getMessage(), t);                }            }        };    }</code></pre><p>ä¸Šé¢çš„ä»£ç é‡Œæœ‰ä¸€æ®µç‰¹åˆ«é‡è¦ï¼Œå…³é”®æ€§çš„ä»£ç åœ¨doLocalExportä¸­ï¼š</p><pre><code class="java">final Invoker&lt;?&gt; invokerDelegete = new InvokerDelegete&lt;T&gt;(originInvoker, getProviderUrl(originInvoker));//æ­¤å¤„protolä¸ºdubboProtocolexporter = new ExporterChangeableWrapper&lt;T&gt;((Exporter&lt;T&gt;)protocol.export(invokerDelegete), originInvoker);</code></pre><p>ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ä¼šè°ƒç”¨dubboProtocolçš„exportå¯¹æœåŠ¡è¿›è¡Œæš´éœ²ï¼Œè¿™ä¸ªexportæœ€ç»ˆç›®çš„å°±æ˜¯å¼€å¯nettyçš„ç›‘å¬ï¼Œä¸‹é¢æ¥çœ‹dubboæ˜¯å¦‚ä½•ä¸€æ­¥ä¸€æ­¥å¼€å¯nettyçš„</p><pre><code class="java"> private void openServer(URL url) {        // find server. ip:port        String key = url.getAddress();        //client ä¹Ÿå¯ä»¥æš´éœ²ä¸€ä¸ªåªæœ‰serverå¯ä»¥è°ƒç”¨çš„æœåŠ¡ã€‚        boolean isServer = url.getParameter(Constants.IS_SERVER_KEY,true);        if (isServer) {            ExchangeServer server = serverMap.get(key);            if (server == null) {                //åˆ›å»º Server                serverMap.put(key, createServer(url));            } else {                //serveræ”¯æŒreset,é…åˆoverrideåŠŸèƒ½ä½¿ç”¨                server.reset(url);            }        }    }private ExchangeServer createServer(URL url) {    //é»˜è®¤å¼€å¯serverå…³é—­æ—¶å‘é€readonlyäº‹ä»¶    url = url.addParameterIfAbsent(Constants.CHANNEL_READONLYEVENT_SENT_KEY, Boolean.TRUE.toString());    //é»˜è®¤å¼€å¯heartbeat    url = url.addParameterIfAbsent(Constants.HEARTBEAT_KEY, String.valueOf(Constants.DEFAULT_HEARTBEAT));    //é»˜è®¤ä½¿ç”¨netty    String str = url.getParameter(Constants.SERVER_KEY, Constants.DEFAULT_REMOTING_SERVER);    if (str != null &amp;&amp; str.length() &gt; 0 &amp;&amp; ! ExtensionLoader.getExtensionLoader(Transporter.class).hasExtension(str))        throw new RpcException(&quot;Unsupported server type: &quot; + str + &quot;, url: &quot; + url);    //é»˜è®¤ä½¿ç”¨dubboåè®®ç¼–ç     url = url.addParameter(Constants.CODEC_KEY, Version.isCompatibleVersion() ? COMPATIBLE_CODEC_NAME : DubboCodec.NAME);    ExchangeServer server;    try {        //HeaderExchangeServer åœ¨æ­¤å¤„å·²ç»å¼€å¯äº†Netty Server è¿›è¡Œç›‘å¬        server = Exchangers.bind(url, requestHandler);    } catch (RemotingException e) {        throw new RpcException(&quot;Fail to start server(url: &quot; + url + &quot;) &quot; + e.getMessage(), e);    }    str = url.getParameter(Constants.CLIENT_KEY);    if (str != null &amp;&amp; str.length() &gt; 0) {        Set&lt;String&gt; supportedTypes = ExtensionLoader.getExtensionLoader(Transporter.class).getSupportedExtensions();        if (!supportedTypes.contains(str)) {            throw new RpcException(&quot;Unsupported client type: &quot; + str);        }    }    return server;}</code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼šExchangers.bind(url, requestHandler)  é»˜è®¤ä¸ºï¼šHeaderExchanger.bind()</p><pre><code class="java">public ExchangeServer bind(URL url, ExchangeHandler handler) throws RemotingException {        //Transportersé»˜è®¤ä¸ºNettyTransporter        return new HeaderExchangeServer(Transporters.bind(url, new DecodeHandler(new HeaderExchangeHandler(handler))));    }</code></pre><p>ä»£ç è¿è¡Œåˆ°è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¼ è¾“æ–¹å¼äº†ï¼Œdubboé»˜è®¤é‡‡ç”¨çš„é€šä¿¡æ–¹å¼ä¸º NettyTransporter ï¼Œå†æ¥çœ‹NettyTransporter.bindæ–¹æ³•</p><pre><code class="java">public static final String NAME = &quot;netty&quot;;public Server bind(URL url, ChannelHandler listener) throws RemotingException {    return new NettyServer(url, listener);}</code></pre><p>å·²ç»èƒ½çœ‹åˆ°NettyServeräº†ï¼Œdubboåœ¨æš´éœ²æœåŠ¡æœ€ç»ˆå¼€å¯çš„nettyæœåŠ¡ç›‘å¬ï¼Œç›‘å¬æ¶ˆè´¹è€…å‘é€çš„è¯·æ±‚ï¼Œé€šè¿‡åå°„è°ƒç”¨æ–¹æ³•å¾—åˆ°ç»“æœé€šè¿‡ tcp/ip ç½‘ç»œä¼ è¾“è¿”å›ç»™æ¶ˆè´¹è€…ã€‚å†è¿›å…¥åˆ°NettyServerä¸­æˆ‘ä»¬å°±èƒ½çœ‹åˆ°éå¸¸ä¼ ç»Ÿçš„å¼€å¯NettyæœåŠ¡çš„ä»£ç äº†</p><pre><code class="java">   protected void doOpen() throws Throwable {        NettyHelper.setNettyLoggerFactory();        ExecutorService boss = Executors.newCachedThreadPool(new NamedThreadFactory(&quot;NettyServerBoss&quot;, true));        ExecutorService worker = Executors.newCachedThreadPool(new NamedThreadFactory(&quot;NettyServerWorker&quot;, true));        //æœ€åä¸€ä¸ªå‚æ•°ä¸º NIO æœ€å¤§å·¥ä½œçº¿ç¨‹æ•°        ChannelFactory channelFactory = new NioServerSocketChannelFactory(boss, worker, getUrl().getPositiveParameter(Constants.IO_THREADS_KEY, Constants.DEFAULT_IO_THREADS));        //netty server å¯åŠ¨å™¨        bootstrap = new ServerBootstrap(channelFactory);   final NettyHandler nettyHandler = new NettyHandler(getUrl(), this);    channels = nettyHandler.getChannels();    // https://issues.jboss.org/browse/NETTY-365    // https://issues.jboss.org/browse/NETTY-379    // final Timer timer = new HashedWheelTimer(new NamedThreadFactory(&quot;NettyIdleTimer&quot;, true));    bootstrap.setPipelineFactory(new ChannelPipelineFactory() {        public ChannelPipeline getPipeline() {            NettyCodecAdapter adapter = new NettyCodecAdapter(getCodec() ,getUrl(), NettyServer.this);            ChannelPipeline pipeline = Channels.pipeline();            /*int idleTimeout = getIdleTimeout();            if (idleTimeout &gt; 10000) {                pipeline.addLast(&quot;timer&quot;, new IdleStateHandler(timer, idleTimeout / 1000, 0, 0));            }*/            pipeline.addLast(&quot;decoder&quot;, adapter.getDecoder());            pipeline.addLast(&quot;encoder&quot;, adapter.getEncoder());            pipeline.addLast(&quot;handler&quot;, nettyHandler);            return pipeline;        }    });    // åˆ›å»ºä¸€ä¸ªç»‘å®šåˆ°æŒ‡å®šåœ°å€çš„æ–°é€šé“ï¼Œä¹Ÿå°±æ˜¯ç»‘å®šIPã€ç«¯å£ä¾›å®¢æˆ·ç«¯è¿æ¥    channel = bootstrap.bind(getBindAddress());}</code></pre><p>ä¸Šé¢çš„ä»£ç æ‰§è¡Œå®Œæˆåï¼Œnettyçš„æœåŠ¡ç«¯å°±å·²ç»å¼€å¯äº†ï¼Œå¯ä»¥æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥äº†ï¼Œä½†å®¢æˆ·ç«¯è¿æ¥ä¸Šæ¥è¦æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæ¶ˆæ¯æ¥æ”¶ã€å‘é€æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæ‰€æœ‰çš„å¤„ç†éƒ½åœ¨ä¸Šé¢ä»£ç çš„ NettyHandlerç±»ä¸­ï¼ŒNettyhandlerç»§æ‰¿äº†NettyåŒ…ä¸­çš„çš„SimpleChannelHandler</p><p>ä»å‰é¢çŸ¥é“,å¼€å¯nettyæœåŠ¡æ˜¯åœ¨<code>RegistryProtocol.export</code> çš„ <code>doLocalExport</code> ä¸­ï¼Œåœ¨å¼€å¯äº†nettyæœåŠ¡åï¼Œå°±æ˜¯åœ¨zookeeperä¸Šæ³¨å†ŒæœåŠ¡èŠ‚ç‚¹äº†ï¼Œæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æœåŠ¡æ—¶ä¼šæ ¹æ®æ¶ˆè´¹çš„æ¥å£åæ‰¾åˆ°å¯¹åº”çš„<strong>zookeeperèŠ‚ç‚¹ç›®å½•</strong>ï¼Œå¯¹ç›®å½•è¿›è¡Œç›‘å¬ï¼Œæ¥æ”¶æ¨é€</p><pre><code class="java">//registry providerfinal Registry registry = getRegistry(originInvoker);final URL registedProviderUrl = getRegistedProviderUrl(originInvoker);//è°ƒç”¨zodoRegisterçš„doRegister åˆ›å»ºzookeeperçš„æœåŠ¡èŠ‚ç‚¹registry.register(registedProviderUrl);// è®¢é˜…overrideæ•°æ®// FIXME æä¾›è€…è®¢é˜…æ—¶ï¼Œä¼šå½±å“åŒä¸€JVMå³æš´éœ²æœåŠ¡ï¼Œåˆå¼•ç”¨åŒä¸€æœåŠ¡çš„çš„åœºæ™¯ï¼Œå› ä¸ºsubscribedä»¥æœåŠ¡åä¸ºç¼“å­˜çš„keyï¼Œå¯¼è‡´è®¢é˜…ä¿¡æ¯è¦†ç›–ã€‚final URL overrideSubscribeUrl = getSubscribedOverrideUrl(registedProviderUrl);final OverrideListener overrideSubscribeListener = new OverrideListener(overrideSubscribeUrl);overrideListeners.put(overrideSubscribeUrl, overrideSubscribeListener);//è®¢é˜…registry.subscribe(overrideSubscribeUrl, overrideSubscribeListener);</code></pre><p>dubboæœåŠ¡åœ¨zookeeperä¸Šçš„èŠ‚ç‚¹æ³¨å†Œæ˜¯ï¼š<code>com.alibaba.dubbo.registry.support.FailbackRegistry</code>#<code>register</code></p><pre><code class="java">@Override    public void register(URL url) {        super.register(url);        failedRegistered.remove(url);        failedUnregistered.remove(url);        try {            // å‘æœåŠ¡å™¨ç«¯å‘é€æ³¨å†Œè¯·æ±‚            doRegister(url);</code></pre><p>å› ä¸ºdoRegisteræ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ–¹æ³•ï¼ŒæŸ¥çœ‹ä»–çš„å®ç°å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾ï¼š</p><p><img alt="image-20200612170609349" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfpm8lvqxcj30rx057aaz.jpg" class="lazyload"></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°doRegisterå®ç°æœ‰ dubboã€redisã€zookeeperï¼Œè¿™ä¹Ÿæ˜¯åœ¨æˆ‘ä»¬é…ç½®æ—¶ç»å¸¸çœ‹åˆ°çš„ æ³¨å†Œåè®®çš„é…ç½® ï¼Œæœ€ä¸ºå¸¸ç”¨çš„å°±æ˜¯ zookeeperäº†ï¼Œæ‰€ä»¥å†çœ‹ZookeeperRegistryçš„ä»£ç ï¼Œçœ‹ä»–çš„doRegistryå¹²ä»€ä¹ˆäº†å¦‚ä¸‹</p><pre><code class="java">protected void doRegister(URL url) {        try {            zkClient.create(toUrlPath(url), url.getParameter(Constants.DYNAMIC_KEY, true));        } catch (Throwable e) {            throw new RpcException(&quot;Failed to register &quot; + url + &quot; to zookeeper &quot; + getUrl() + &quot;, cause: &quot; + e.getMessage(), e);        }    }</code></pre><p>å…¶å®ä»ä¸Šé¢å·²ç»å¯ä»¥çœ‹åˆ° åœ¨zookeeperä¸Šé¢åˆ›å»º èŠ‚ç‚¹äº†ï¼Œé»˜è®¤ä¸åˆ†ç»„çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç»“æ„å¦‚ä¸‹ï¼š/dubbo/XXXXservice/consumersã€providers</p><p>è‡³æ­¤ï¼Œdubboçš„æš´éœ²åŸºæœ¬ä¸Šå·²ç»å®Œæˆï¼Œå¼€å¯äº†nettyæœåŠ¡ï¼Œæ³¨å†Œäº†zookeeperçš„èŠ‚ç‚¹ï¼Œå°±ç­‰ç€æ¶ˆè´¹è€…è¿æ¥ä¸Šæ¥ä½¿ç”¨äº†ã€‚</p><p>æœåŠ¡ç«¯Serverå¯åŠ¨ï¼Œç›‘å¬ç«¯å£ã€‚ï¼ˆè¯·æ±‚æ¥åˆ°æ—¶ï¼Œæ ¹æ®è¯·æ±‚ä¿¡æ¯ç”Ÿæˆkeyï¼Œåˆ°ç¼“å­˜æŸ¥æ‰¾Exporterï¼Œå°±æ‰¾åˆ°äº†Invokerï¼Œå°±å¯ä»¥å®Œæˆè°ƒç”¨ã€‚ï¼‰</p><hr><h3 id="Dubbo-çš„æ•´ä½“æ¶æ„è®¾è®¡æœ‰å“ªäº›åˆ†å±‚"><a href="#Dubbo-çš„æ•´ä½“æ¶æ„è®¾è®¡æœ‰å“ªäº›åˆ†å±‚" class="headerlink" title="Dubbo çš„æ•´ä½“æ¶æ„è®¾è®¡æœ‰å“ªäº›åˆ†å±‚?"></a>Dubbo çš„æ•´ä½“æ¶æ„è®¾è®¡æœ‰å“ªäº›åˆ†å±‚?</h3><p><img alt="image-20200612152536404" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfpjc4lhm1j30sb0l8dxf.jpg" class="lazyload"></p><ul><li>ç¬¬ä¸€å±‚ï¼š<strong>serviceå±‚</strong>ï¼Œæ¥å£å±‚ï¼Œç»™æœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…æ¥å®ç°çš„</li><li>ç¬¬äºŒå±‚ï¼š<strong>configå±‚</strong>ï¼Œé…ç½®å±‚ï¼Œä¸»è¦æ˜¯å¯¹dubboè¿›è¡Œå„ç§é…ç½®çš„</li><li>ç¬¬ä¸‰å±‚ï¼š<strong>proxyå±‚</strong>ï¼ŒæœåŠ¡æ¥å£é€æ˜ä»£ç†ï¼Œç”ŸæˆæœåŠ¡çš„å®¢æˆ·ç«¯ Stub å’ŒæœåŠ¡å™¨ç«¯ Skeleton</li><li>ç¬¬å››å±‚ï¼š<strong>registryå±‚</strong>ï¼ŒæœåŠ¡æ³¨å†Œå±‚ï¼Œè´Ÿè´£æœåŠ¡çš„æ³¨å†Œä¸å‘ç°</li><li>ç¬¬äº”å±‚ï¼š<strong>clusterå±‚</strong>ï¼Œé›†ç¾¤å±‚ï¼Œå°è£…å¤šä¸ªæœåŠ¡æä¾›è€…çš„è·¯ç”±ä»¥åŠè´Ÿè½½å‡è¡¡ï¼Œå°†å¤šä¸ªå®ä¾‹ç»„åˆæˆä¸€ä¸ªæœåŠ¡</li><li>ç¬¬å…­å±‚ï¼š<strong>monitorå±‚</strong>ï¼Œç›‘æ§å±‚ï¼Œå¯¹rpcæ¥å£çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´è¿›è¡Œç›‘æ§</li><li>ç¬¬ä¸ƒå±‚ï¼š<strong>protocolå±‚</strong>ï¼Œè¿œç¨‹è°ƒç”¨å±‚ï¼Œå°è£…rpcè°ƒç”¨</li><li>ç¬¬å…«å±‚ï¼š<strong>exchangeå±‚</strong>ï¼Œä¿¡æ¯äº¤æ¢å±‚ï¼Œå°è£…è¯·æ±‚å“åº”æ¨¡å¼ï¼ŒåŒæ­¥è½¬å¼‚æ­¥</li><li>ç¬¬ä¹å±‚ï¼š<strong>transportå±‚</strong>ï¼Œç½‘ç»œä¼ è¾“å±‚ï¼ŒæŠ½è±¡minaå’Œnettyä¸ºç»Ÿä¸€æ¥å£</li><li>ç¬¬åå±‚ï¼š<strong>serializeå±‚</strong>ï¼Œæ•°æ®åºåˆ—åŒ–å±‚ï¼Œç½‘ç»œä¼ è¾“éœ€è¦</li></ul><h3 id="Dubbo-æœ‰å“ªäº›æ³¨å†Œä¸­å¿ƒï¼Ÿ"><a href="#Dubbo-æœ‰å“ªäº›æ³¨å†Œä¸­å¿ƒï¼Ÿ" class="headerlink" title="Dubbo æœ‰å“ªäº›æ³¨å†Œä¸­å¿ƒï¼Ÿ"></a>Dubbo æœ‰å“ªäº›æ³¨å†Œä¸­å¿ƒï¼Ÿ</h3><ul><li>Multicast æ³¨å†Œä¸­å¿ƒï¼šMulticast æ³¨å†Œä¸­å¿ƒä¸éœ€è¦ä»»ä½•ä¸­å¿ƒèŠ‚ç‚¹ï¼Œåªè¦å¹¿æ’­åœ°å€ï¼Œå°±èƒ½è¿›è¡ŒæœåŠ¡æ³¨å†Œå’Œå‘ç°,åŸºäºç½‘ç»œä¸­ç»„æ’­ä¼ è¾“å®ç°ã€‚</li><li>Zookeeper æ³¨å†Œä¸­å¿ƒï¼šåŸºäºåˆ†å¸ƒå¼åè°ƒç³»ç»Ÿ Zookeeper å®ç°ï¼Œé‡‡ç”¨ Zookeeper çš„ watch æœºåˆ¶å®ç°æ•°æ®å˜æ›´ã€‚</li><li>Redis æ³¨å†Œä¸­å¿ƒï¼šåŸºäº Redis å®ç°ï¼Œé‡‡ç”¨ key/map å­˜å‚¨ï¼Œkey å­˜å‚¨æœåŠ¡åå’Œç±»å‹ï¼Œmap ä¸­ key å­˜å‚¨æœåŠ¡ urlï¼Œvalue æœåŠ¡è¿‡æœŸæ—¶é—´ã€‚åŸºäº Redis çš„å‘å¸ƒ/è®¢é˜…æ¨¡å¼é€šçŸ¥æ•°æ®å˜æ›´ã€‚</li><li>Simple æ³¨å†Œä¸­å¿ƒã€‚</li><li>æ¨èä½¿ç”¨ Zookeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒ</li></ul><h2 id="åˆ†å¸ƒå¼æ¡†æ¶"><a href="#åˆ†å¸ƒå¼æ¡†æ¶" class="headerlink" title="åˆ†å¸ƒå¼æ¡†æ¶"></a>åˆ†å¸ƒå¼æ¡†æ¶</h2><h3 id="Dubbo-å’Œ-Spring-Cloud-æœ‰ä»€ä¹ˆå“ªäº›åŒºåˆ«ï¼Ÿ"><a href="#Dubbo-å’Œ-Spring-Cloud-æœ‰ä»€ä¹ˆå“ªäº›åŒºåˆ«ï¼Ÿ" class="headerlink" title="Dubbo å’Œ Spring Cloud æœ‰ä»€ä¹ˆå“ªäº›åŒºåˆ«ï¼Ÿ"></a>Dubbo å’Œ Spring Cloud æœ‰ä»€ä¹ˆå“ªäº›åŒºåˆ«ï¼Ÿ</h3><ul><li><p>ä¸¤ä¸ªæ²¡å…³è”ï¼Œå¦‚æœç¡¬è¦è¯´åŒºåˆ«ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ã€‚</p><p>1ï¼‰é€šä¿¡æ–¹å¼ä¸åŒ</p><p>Dubbo ä½¿ç”¨çš„æ˜¯ RPC é€šä¿¡ï¼Œè€Œ Spring Cloud ä½¿ç”¨çš„æ˜¯ HTTP RESTFul æ–¹å¼ã€‚</p><p>2ï¼‰ç»„æˆéƒ¨åˆ†ä¸åŒ</p><p><img alt="image-20200612160758890" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfpkk2qjefj30if0dqq6j.jpg" class="lazyload"></p></li></ul><h2 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h2><h3 id="Dubboé›†ç¾¤æä¾›äº†å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ"><a href="#Dubboé›†ç¾¤æä¾›äº†å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ" class="headerlink" title="Dubboé›†ç¾¤æä¾›äº†å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ"></a>Dubboé›†ç¾¤æä¾›äº†å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ</h3><ul><li>Random LoadBalance: <code>éšæœº</code>é€‰å–æä¾›è€…ç­–ç•¥ï¼Œæœ‰åˆ©äºåŠ¨æ€è°ƒæ•´æä¾›è€…æƒé‡ã€‚æˆªé¢ç¢°æ’ç‡é«˜ï¼Œè°ƒç”¨æ¬¡æ•°è¶Šå¤šï¼Œåˆ†å¸ƒè¶Šå‡åŒ€ã€‚</li><li>RoundRobin LoadBalance: <code>è½®å¾ª</code>é€‰å–æä¾›è€…ç­–ç•¥ï¼Œå¹³å‡åˆ†å¸ƒï¼Œä½†æ˜¯å­˜åœ¨è¯·æ±‚ç´¯ç§¯çš„é—®é¢˜ã€‚</li><li>LeastActive LoadBalance: <code>æœ€å°‘æ´»è·ƒ</code>è°ƒç”¨ç­–ç•¥ï¼Œè§£å†³æ…¢æä¾›è€…æ¥æ”¶æ›´å°‘çš„è¯·æ±‚ã€‚</li><li>ConstantHash LoadBalance: <code>ä¸€è‡´æ€§ Hash</code> ç­–ç•¥ï¼Œä½¿ç›¸åŒå‚æ•°è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ï¼Œä¸€å°æœºå™¨å®•æœºï¼Œå¯ä»¥åŸºäºè™šæ‹ŸèŠ‚ç‚¹ï¼Œåˆ†æ‘Šè‡³å…¶ä»–æä¾›è€…ï¼Œé¿å…å¼•èµ·æä¾›è€…çš„å‰§çƒˆå˜åŠ¨ã€‚</li></ul><pre><code>é»˜è®¤ä¸º Random éšæœºè°ƒç”¨ã€‚</code></pre><h3 id="Dubboçš„é›†ç¾¤å®¹é”™æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ6ç§"><a href="#Dubboçš„é›†ç¾¤å®¹é”™æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ6ç§" class="headerlink" title="Dubboçš„é›†ç¾¤å®¹é”™æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ6ç§"></a>Dubboçš„é›†ç¾¤å®¹é”™æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ6ç§</h3><ul><li>Failfast Clusterï¼šå¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œ<strong>å¤±è´¥ç«‹å³æŠ¥é”™</strong>ã€‚é€šå¸¸ç”¨äºéå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢è®°å½•ã€‚</li><li>Failsafe Clusterï¼šå¤±è´¥å®‰å…¨ï¼Œå‡ºç°å¼‚å¸¸æ—¶ï¼Œ<strong>ç›´æ¥å¿½ç•¥</strong>ã€‚é€šå¸¸ç”¨äº<strong>å†™å…¥å®¡è®¡æ—¥å¿—</strong>ç­‰æ“ä½œã€‚</li><li>Failover Clusterï¼šå¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“å‡ºç°å¤±è´¥ï¼Œ<strong>é‡è¯•</strong>å…¶å®ƒæœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äºè¯»æ“ä½œï¼Œä½†é‡è¯•ä¼šå¸¦æ¥æ›´é•¿å»¶è¿Ÿã€‚</li><li>Failback Clusterï¼šå¤±è´¥è‡ªåŠ¨æ¢å¤ï¼Œåå°<strong>è®°å½•å¤±è´¥è¯·æ±‚</strong>ï¼Œ<strong>å®šæ—¶é‡å‘</strong>ã€‚é€šå¸¸ç”¨äºæ¶ˆæ¯é€šçŸ¥æ“ä½œã€‚</li><li>Forking Clusterï¼š<strong>å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›</strong>ã€‚é€šå¸¸ç”¨äºå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡ forks=â€2â€³ æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ã€‚</li><li>Broadcast Clusterï¼š<strong>å¹¿æ’­è°ƒç”¨</strong>æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œ<strong>ä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™</strong> ã€‚é€šå¸¸ç”¨äºé€šçŸ¥æ‰€æœ‰æ¶ˆè´¹è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚</li></ul><pre><code>é»˜è®¤çš„å®¹é”™æ–¹æ¡ˆæ˜¯ Failover Clusterã€‚è¯»æ“ä½œå»ºè®®ä½¿ç”¨ Failover å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼Œé»˜è®¤é‡è¯•ä¸¤æ¬¡å…¶ä»–æœåŠ¡å™¨ã€‚å†™æ“ä½œå»ºè®®ä½¿ç”¨ Failfast å¿«é€Ÿå¤±è´¥ï¼Œå‘ä¸€æ¬¡è°ƒç”¨å¤±è´¥å°±ç«‹å³æŠ¥é”™ã€‚</code></pre><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="Dubbo-å¦‚ä½•ä¼˜é›…åœæœºï¼Ÿ"><a href="#Dubbo-å¦‚ä½•ä¼˜é›…åœæœºï¼Ÿ" class="headerlink" title="Dubbo å¦‚ä½•ä¼˜é›…åœæœºï¼Ÿ"></a>Dubbo å¦‚ä½•ä¼˜é›…åœæœºï¼Ÿ</h3><ul><li>Dubbo æ˜¯é€šè¿‡ JDK çš„ ShutdownHook æ¥å®Œæˆä¼˜é›…åœæœºçš„ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨kill -9 PID ç­‰å¼ºåˆ¶å…³é—­æŒ‡ä»¤ï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œä¼˜é›…åœæœºçš„ï¼Œåªæœ‰é€šè¿‡ kill PID æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œã€‚</li></ul><h3 id="Dubbo-SPI-å’Œ-Java-SPI-åŒºåˆ«ï¼Ÿ"><a href="#Dubbo-SPI-å’Œ-Java-SPI-åŒºåˆ«ï¼Ÿ" class="headerlink" title="Dubbo SPI å’Œ Java SPI åŒºåˆ«ï¼Ÿ"></a>Dubbo SPI å’Œ Java SPI åŒºåˆ«ï¼Ÿ</h3><h4 id="SPIæ˜¯ä»€ä¹ˆ"><a href="#SPIæ˜¯ä»€ä¹ˆ" class="headerlink" title="SPIæ˜¯ä»€ä¹ˆ"></a>SPIæ˜¯ä»€ä¹ˆ</h4><p>SPI å…¨ç§°ä¸º Service Provider Interfaceï¼Œæ˜¯ä¸€ç§<strong>æœåŠ¡å‘ç°æœºåˆ¶</strong>ã€‚SPI çš„æœ¬è´¨æ˜¯å°†æ¥å£å®ç°ç±»çš„å…¨é™å®šåé…ç½®åœ¨æ–‡ä»¶ä¸­ï¼Œå¹¶ç”±æœåŠ¡åŠ è½½å™¨è¯»å–é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½å®ç°ç±»ã€‚è¿™æ ·å¯ä»¥åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€ä¸ºæ¥å£æ›¿æ¢å®ç°ç±»ã€‚æ­£å› æ­¤ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„é€šè¿‡ SPI æœºåˆ¶ä¸ºæˆ‘ä»¬çš„ç¨‹åºæä¾›æ‹“å±•åŠŸèƒ½ã€‚SPI æœºåˆ¶åœ¨ç¬¬ä¸‰æ–¹æ¡†æ¶ä¸­ä¹Ÿæœ‰æ‰€åº”ç”¨ï¼Œæ¯”å¦‚ Dubbo å°±æ˜¯é€šè¿‡ SPI æœºåˆ¶åŠ è½½æ‰€æœ‰çš„ç»„ä»¶ã€‚ä¸è¿‡ï¼ŒDubbo å¹¶æœªä½¿ç”¨ Java åŸç”Ÿçš„ SPI æœºåˆ¶ï¼Œè€Œæ˜¯å¯¹å…¶è¿›è¡Œäº†å¢å¼ºï¼Œä½¿å…¶èƒ½å¤Ÿæ›´å¥½çš„æ»¡è¶³éœ€æ±‚ã€‚</p><p>æ•´ä½“æœºåˆ¶å›¾å¦‚ä¸‹ï¼š</p><p><img alt="image-20200612154610708" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfpjxeeqldj30wx0av0yt.jpg" class="lazyload"></p><p><code>æ€»ç»“ï¼š</code></p><p>SPI å…¨ç§°ä¸º Service Provider Interfaceï¼Œæ˜¯ä¸€ç§<strong>æœåŠ¡æä¾›æ¥å£</strong>ã€‚å®é™…ä¸Šæ˜¯â€œ<strong>åŸºäºæ¥å£çš„ç¼–ç¨‹ï¼‹ç­–ç•¥æ¨¡å¼ï¼‹é…ç½®æ–‡ä»¶</strong>â€ç»„åˆå®ç°çš„åŠ¨æ€åŠ è½½æœºåˆ¶ï¼Œä¸éœ€è¦æ”¹åŠ¨Dubboæºç ï¼ŒåŠ¨æ€æ ¹æ®é…ç½®æ–‡ä»¶åŠ è½½éœ€è¦çš„æœåŠ¡å®ç°ç±»ã€‚Dubboåœ¨JDK SPIçš„åŸºç¡€ä¸Šåšäº†ä¼˜åŒ–ï¼š</p><p>1ã€å»¶è¿ŸåŠ è½½ï¼Œå¯ä»¥ä¸€æ¬¡åªåŠ è½½è‡ªå·±æƒ³è¦åŠ è½½çš„æ‰©å±•å®ç°ã€‚ </p><p>2ã€å¢åŠ äº†å¯¹ IOC å’Œ AOP çš„æ”¯æŒï¼Œä¸€ä¸ªæ‰©å±•ç‚¹å¯ä»¥ç›´æ¥ setter æ³¨å…¥å…¶å®ƒæ‰©å±•ç‚¹ã€‚</p><ul><li><p>JDK SPIï¼š</p><p>JDK æ ‡å‡†çš„ SPI ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„æ‰©å±•å®ç°ï¼Œå¦‚æœæœ‰çš„æ‰©å±•å¾ˆè€—æ—¶ï¼Œä½†ä¹Ÿæ²¡ç”¨ä¸Šï¼Œå¾ˆæµªè´¹èµ„æºã€‚æ‰€ä»¥åªå¸Œæœ›åŠ è½½æŸä¸ªçš„å®ç°ï¼Œå°±ä¸ç°å®äº†</p></li><li><p>DUBBO SPIï¼š</p><p>1ã€å¯¹ Dubbo è¿›è¡Œæ‰©å±•ï¼Œä¸éœ€è¦æ”¹åŠ¨ Dubbo çš„æºç </p><p>2ã€å»¶è¿ŸåŠ è½½ï¼Œå¯ä»¥ä¸€æ¬¡åªåŠ è½½è‡ªå·±æƒ³è¦åŠ è½½çš„æ‰©å±•å®ç°ã€‚</p><p>3ã€å¢åŠ äº†å¯¹æ‰©å±•ç‚¹ IOC å’Œ AOP çš„æ”¯æŒï¼Œä¸€ä¸ªæ‰©å±•ç‚¹å¯ä»¥ç›´æ¥ setter æ³¨å…¥å…¶å®ƒæ‰©å±•ç‚¹ã€‚</p><p>4ã€Dubbo çš„æ‰©å±•æœºåˆ¶èƒ½å¾ˆå¥½çš„æ”¯æŒç¬¬ä¸‰æ–¹ IoC å®¹å™¨ï¼Œé»˜è®¤æ”¯æŒ Spring Beanã€‚</p></li></ul><h3 id="æœåŠ¡è°ƒç”¨æ˜¯é˜»å¡çš„å—ï¼Ÿ"><a href="#æœåŠ¡è°ƒç”¨æ˜¯é˜»å¡çš„å—ï¼Ÿ" class="headerlink" title="æœåŠ¡è°ƒç”¨æ˜¯é˜»å¡çš„å—ï¼Ÿ"></a>æœåŠ¡è°ƒç”¨æ˜¯é˜»å¡çš„å—ï¼Ÿ</h3><ul><li>é»˜è®¤æ˜¯é˜»å¡çš„ï¼Œå¯ä»¥å¼‚æ­¥è°ƒç”¨ï¼Œæ²¡æœ‰è¿”å›å€¼çš„å¯ä»¥è¿™ä¹ˆåšã€‚Dubbo æ˜¯åŸºäº NIO çš„éé˜»å¡å®ç°å¹¶è¡Œè°ƒç”¨ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å¯åŠ¨å¤šçº¿ç¨‹å³å¯å®Œæˆå¹¶è¡Œè°ƒç”¨å¤šä¸ªè¿œç¨‹æœåŠ¡ï¼Œç›¸å¯¹å¤šçº¿ç¨‹å¼€é”€è¾ƒå°ï¼Œå¼‚æ­¥è°ƒç”¨ä¼šè¿”å›ä¸€ä¸ª Future å¯¹è±¡ã€‚</li></ul><h3 id="Dubbo-å¯ä»¥å¯¹ç»“æœè¿›è¡Œç¼“å­˜å—ï¼Ÿ"><a href="#Dubbo-å¯ä»¥å¯¹ç»“æœè¿›è¡Œç¼“å­˜å—ï¼Ÿ" class="headerlink" title="Dubbo å¯ä»¥å¯¹ç»“æœè¿›è¡Œç¼“å­˜å—ï¼Ÿ"></a>Dubbo å¯ä»¥å¯¹ç»“æœè¿›è¡Œç¼“å­˜å—ï¼Ÿ</h3><ul><li>ä¸ºäº†æé«˜æ•°æ®è®¿é—®çš„é€Ÿåº¦ã€‚Dubbo æä¾›äº†å£°æ˜å¼ç¼“å­˜ï¼Œä»¥å‡å°‘ç”¨æˆ·åŠ ç¼“å­˜çš„å·¥ä½œé‡&lt;dubbo:reference cache=â€œtrueâ€ /&gt;</li><li>å…¶å®æ¯”æ™®é€šçš„é…ç½®æ–‡ä»¶å°±å¤šäº†ä¸€ä¸ªæ ‡ç­¾ cache=â€œtrueâ€</li></ul><h3 id="Dubboçš„ç®¡ç†æ§åˆ¶å°èƒ½åšä»€ä¹ˆï¼Ÿ"><a href="#Dubboçš„ç®¡ç†æ§åˆ¶å°èƒ½åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="Dubboçš„ç®¡ç†æ§åˆ¶å°èƒ½åšä»€ä¹ˆï¼Ÿ"></a>Dubboçš„ç®¡ç†æ§åˆ¶å°èƒ½åšä»€ä¹ˆï¼Ÿ</h3><p>ç®¡ç†æ§åˆ¶å°ä¸»è¦åŒ…å«ï¼šè·¯ç”±è§„åˆ™ï¼ŒåŠ¨æ€é…ç½®ï¼ŒæœåŠ¡é™çº§ï¼Œè®¿é—®æ§åˆ¶ï¼Œæƒé‡è°ƒæ•´ï¼Œè´Ÿè½½å‡è¡¡ç­‰ç®¡ç†åŠŸèƒ½ã€‚</p><h2 id="åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­éƒ½é‡åˆ°äº†äº›ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­éƒ½é‡åˆ°äº†äº›ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­éƒ½é‡åˆ°äº†äº›ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­éƒ½é‡åˆ°äº†äº›ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2><p>1ã€Dubbo çš„è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†æ»¡è¶³é«˜å¹¶å‘å°æ•°æ®é‡çš„ rpc è°ƒç”¨ï¼Œåœ¨å¤§æ•°æ®é‡ä¸‹çš„æ€§èƒ½è¡¨ç°å¹¶ä¸å¥½ï¼Œå»ºè®®ä½¿ç”¨ rmi æˆ– webservice åè®®ã€‚</p><p>2ã€dubbo ç¼ºçœä¼šåœ¨å¯åŠ¨æ—¶æ£€æŸ¥ä¾èµ–æ˜¯å¦å¯ç”¨ï¼Œä¸å¯ç”¨å°±æŠ›å‡ºå¼‚å¸¸ï¼Œé˜»æ­¢ spring åˆå§‹åŒ–å®Œæˆï¼Œcheck å±æ€§é»˜è®¤ä¸º trueã€‚</p><p>æµ‹è¯•æ—¶æœ‰äº›æœåŠ¡ä¸å…³å¿ƒæˆ–è€…å‡ºç°äº†å¾ªç¯ä¾èµ–ï¼Œå°† check è®¾ç½®ä¸º false</p><h2 id="Dubbo-ä¸­çš„åºåˆ—åŒ–"><a href="#Dubbo-ä¸­çš„åºåˆ—åŒ–" class="headerlink" title="Dubbo ä¸­çš„åºåˆ—åŒ–"></a>Dubbo ä¸­çš„åºåˆ—åŒ–</h2><p>Dubbo ä¸­æ”¯æŒçš„åºåˆ—åŒ–æ–¹å¼ï¼š</p><ul><li>dubbo åºåˆ—åŒ–ï¼šé˜¿é‡Œå°šæœªå¼€å‘æˆç†Ÿçš„é«˜æ•ˆ java åºåˆ—åŒ–å®ç°ï¼Œé˜¿é‡Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å®ƒ</li><li>hessian2 åºåˆ—åŒ–ï¼šhessian æ˜¯ä¸€ç§è·¨è¯­è¨€çš„é«˜æ•ˆäºŒè¿›åˆ¶åºåˆ—åŒ–æ–¹å¼ã€‚ä½†è¿™é‡Œå®é™…ä¸æ˜¯åŸç”Ÿçš„ hessian2 åºåˆ—åŒ–ï¼Œè€Œæ˜¯é˜¿é‡Œä¿®æ”¹è¿‡çš„ hessian liteï¼Œå®ƒæ˜¯ dubbo RPC é»˜è®¤å¯ç”¨çš„åºåˆ—åŒ–æ–¹å¼</li><li>json åºåˆ—åŒ–ï¼šç›®å‰æœ‰ä¸¤ç§å®ç°ï¼Œä¸€ç§æ˜¯é‡‡ç”¨çš„é˜¿é‡Œçš„ fastjson åº“ï¼Œå¦ä¸€ç§æ˜¯é‡‡ç”¨ dubbo ä¸­è‡ªå·±å®ç°çš„ç®€å• json åº“ï¼Œä½†å…¶å®ç°éƒ½ä¸æ˜¯ç‰¹åˆ«æˆç†Ÿï¼Œè€Œä¸” json è¿™ç§æ–‡æœ¬åºåˆ—åŒ–æ€§èƒ½ä¸€èˆ¬ä¸å¦‚ä¸Šé¢ä¸¤ç§äºŒè¿›åˆ¶åºåˆ—åŒ–ã€‚</li><li>java åºåˆ—åŒ–ï¼šä¸»è¦æ˜¯é‡‡ç”¨ JDK è‡ªå¸¦çš„ Java åºåˆ—åŒ–å®ç°ï¼Œæ€§èƒ½å¾ˆä¸ç†æƒ³ã€‚</li></ul><p>åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™å››ç§ä¸»è¦åºåˆ—åŒ–æ–¹å¼çš„æ€§èƒ½ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡é€’å‡ã€‚å¯¹äº dubbo RPC è¿™ç§è¿½æ±‚é«˜æ€§èƒ½çš„è¿œç¨‹è°ƒç”¨æ–¹å¼æ¥è¯´ï¼Œå®é™…ä¸Šåªæœ‰ 1ã€2 ä¸¤ç§é«˜æ•ˆåºåˆ—åŒ–æ–¹å¼æ¯”è¾ƒèˆ¬é…ï¼Œè€Œç¬¬ 1 ä¸ª dubbo åºåˆ—åŒ–ç”±äºè¿˜ä¸æˆç†Ÿï¼Œæ‰€ä»¥å®é™…åªå‰©ä¸‹ 2 å¯ç”¨ï¼Œæ‰€ä»¥ dubbo RPC é»˜è®¤é‡‡ç”¨ hessian2 åºåˆ—åŒ–ã€‚</p><p>æœ€è¿‘å‡ å¹´ï¼Œå„ç§æ–°çš„é«˜æ•ˆåºåˆ—åŒ–æ–¹å¼å±‚å‡ºä¸ç©·ï¼Œä¸æ–­åˆ·æ–°åºåˆ—åŒ–æ€§èƒ½çš„ä¸Šé™ï¼Œæœ€å…¸å‹çš„åŒ…æ‹¬ï¼š</p><ul><li>ä¸“é—¨é’ˆå¯¹ Java è¯­è¨€çš„ï¼šKryoï¼ŒFST ç­‰ç­‰</li><li>è·¨è¯­è¨€çš„ï¼šProtostuffï¼ŒProtoBufï¼ŒThriftï¼ŒAvroï¼ŒMsgPack ç­‰ç­‰</li></ul><p>å…¶ä¸­ï¼ŒKryo æ˜¯ä¸€ç§éå¸¸æˆç†Ÿçš„åºåˆ—åŒ–å®ç°ï¼Œå·²ç»åœ¨ Twitterã€Grouponã€Yahoo ä»¥åŠå¤šä¸ªè‘—åå¼€æºé¡¹ç›®ï¼ˆå¦‚ Hiveã€Stormï¼‰ä¸­å¹¿æ³›çš„ä½¿ç”¨ã€‚è€Œ FST æ˜¯ä¸€ç§è¾ƒæ–°çš„åºåˆ—åŒ–å®ç°ï¼Œç›®å‰è¿˜ç¼ºä¹è¶³å¤Ÿå¤šçš„æˆç†Ÿä½¿ç”¨æ¡ˆä¾‹ã€‚</p><p><strong>åœ¨é¢å‘ç”Ÿäº§ç¯å¢ƒçš„åº”ç”¨ä¸­ï¼Œç›®å‰æ›´ä¼˜å…ˆé€‰æ‹© Kryoã€‚</strong></p><p>å…·ä½“å®ç°ï¼š</p><p><a href="https://www.jianshu.com/p/4317532e779a" target="_blank" rel="noopener">https://www.jianshu.com/p/4317532e779a</a></p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dubbo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…¨å±€å¼‚å¸¸å¤„ç†</title>
      <link href="/2020/01/15/1.%20Java%E5%9F%BA%E7%A1%80/%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"/>
      <url>/2020/01/15/1.%20Java%E5%9F%BA%E7%A1%80/%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a><strong>èƒŒæ™¯</strong></h1><p>è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…çš„æ˜¯éœ€è¦å¤„ç†å„ç§å¼‚å¸¸ï¼Œå°±æˆ‘è‡ªå·±æ¥è¯´ï¼Œè‡³å°‘æœ‰ä¸€åŠä»¥ä¸Šçš„æ—¶é—´éƒ½æ˜¯åœ¨å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µï¼Œæ‰€ä»¥ä»£ç ä¸­å°±ä¼šå‡ºç°å¤§é‡çš„<code>try {...} catch {...} finally {...}</code> ä»£ç å—ï¼Œä¸ä»…æœ‰å¤§é‡çš„å†—ä½™ä»£ç ï¼Œè€Œä¸”è¿˜å½±å“ä»£ç çš„å¯è¯»æ€§ã€‚æ¯”è¾ƒä¸‹é¢ä¸¤å¼ å›¾ï¼Œçœ‹çœ‹æ‚¨ç°åœ¨ç¼–å†™çš„ä»£ç å±äºå“ªä¸€ç§é£æ ¼ï¼Ÿç„¶åå“ªç§ç¼–ç é£æ ¼æ‚¨æ›´å–œæ¬¢ï¼Ÿ</p><p>ä¸‘é™‹çš„ try catch ä»£ç å—</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsgqduDKIAmIibeDmTvPssaDQS6AZagVnNseg1OUbsiadgRwGdicoicmYys49ZiadT47nGLj6wVTvDpibFWQ/640?wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload">ä¼˜é›…çš„Controller</p><p><img alt="img" data-src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsgqduDKIAmIibeDmTvPssaDQxcuGb3IjKB8loibofWf6GDAmKox1Vl6REOQfLHjlHia22NWic0XQJ5Vvw/640?wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload">ä¸Šé¢çš„ç¤ºä¾‹ï¼Œè¿˜åªæ˜¯åœ¨<code>Controller</code>å±‚ï¼Œå¦‚æœæ˜¯åœ¨<code>Service</code>å±‚ï¼Œå¯èƒ½ä¼šæœ‰æ›´å¤šçš„<code>try catch</code>ä»£ç å—ã€‚è¿™å°†ä¼šä¸¥é‡å½±å“ä»£ç çš„å¯è¯»æ€§ã€â€œç¾è§‚æ€§â€ã€‚</p><p>æ‰€ä»¥å¦‚æœæ˜¯æˆ‘çš„è¯ï¼Œæˆ‘è‚¯å®šåå‘äºç¬¬äºŒç§ï¼Œæˆ‘å¯ä»¥æŠŠæ›´å¤šçš„ç²¾åŠ›æ”¾åœ¨ä¸šåŠ¡ä»£ç çš„å¼€å‘ï¼ŒåŒæ—¶ä»£ç ä¹Ÿä¼šå˜å¾—æ›´åŠ ç®€æ´ã€‚</p><p>æ—¢ç„¶ä¸šåŠ¡ä»£ç ä¸æ˜¾å¼åœ°å¯¹å¼‚å¸¸è¿›è¡Œæ•è·ã€å¤„ç†ï¼Œè€Œå¼‚å¸¸è‚¯å®šè¿˜æ˜¯å¤„ç†çš„ï¼Œä¸ç„¶ç³»ç»Ÿå²‚ä¸æ˜¯åŠ¨ä¸åŠ¨å°±å´©æºƒäº†ï¼Œæ‰€ä»¥å¿…é¡»å¾—æœ‰å…¶ä»–åœ°æ–¹æ•è·å¹¶å¤„ç†è¿™äº›å¼‚å¸¸ã€‚å…¬ä¼—å·ï¼ˆJavaåç«¯ï¼‰è¿˜å‘å¸ƒè¿‡å¾ˆå¤šç¼–ç¨‹æŠ€å·§æ–‡ç« ï¼Œå…³æ³¨ã€ŒJavaåç«¯ã€å›å¤ 666 ä¸‹è½½ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•ä¼˜é›…çš„å¤„ç†å„ç§å¼‚å¸¸ï¼Ÿ</p><h2 id="ä»€ä¹ˆæ˜¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#ä»€ä¹ˆæ˜¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="ä»€ä¹ˆæ˜¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a><strong>ä»€ä¹ˆæ˜¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†</strong></h2><p><code>Spring</code>åœ¨3.2ç‰ˆæœ¬å¢åŠ äº†ä¸€ä¸ªæ³¨è§£<code>@ControllerAdvice</code>ï¼Œå¯ä»¥ä¸<code>@ExceptionHandler</code>ã€<code>@InitBinder</code>ã€<code>@ModelAttribute</code> ç­‰æ³¨è§£æ³¨è§£é…å¥—ä½¿ç”¨ï¼Œå¯¹äºè¿™å‡ ä¸ªæ³¨è§£çš„ä½œç”¨ï¼Œè¿™é‡Œä¸åšè¿‡å¤šèµ˜è¿°ï¼Œè‹¥æœ‰ä¸äº†è§£çš„ï¼Œå¯ä»¥å‚è€ƒSpring3.2æ–°æ³¨è§£@ControllerAdviceï¼Œå…ˆå¤§æ¦‚æœ‰ä¸ªäº†è§£ã€‚</p><p>ä¸è¿‡è·Ÿå¼‚å¸¸å¤„ç†ç›¸å…³çš„åªæœ‰æ³¨è§£<code>@ExceptionHandler</code>ï¼Œä»å­—é¢ä¸Šçœ‹ï¼Œå°±æ˜¯ <strong>å¼‚å¸¸å¤„ç†å™¨</strong> çš„æ„æ€ï¼Œå…¶å®é™…ä½œç”¨ä¹Ÿæ˜¯ï¼šè‹¥åœ¨æŸä¸ª<code>Controller</code>ç±»å®šä¹‰ä¸€ä¸ªå¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•ä¸Šæ·»åŠ è¯¥æ³¨è§£ï¼Œé‚£ä¹ˆå½“å‡ºç°æŒ‡å®šçš„å¼‚å¸¸æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥å¤„ç†å¼‚å¸¸çš„æ–¹æ³•ï¼Œå…¶å¯ä»¥ä½¿ç”¨springmvcæä¾›çš„æ•°æ®ç»‘å®šï¼Œæ¯”å¦‚æ³¨å…¥HttpServletRequestç­‰ï¼Œè¿˜å¯ä»¥æ¥å—ä¸€ä¸ªå½“å‰æŠ›å‡ºçš„Throwableå¯¹è±¡ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±å¿…é¡»åœ¨æ¯ä¸€ä¸ª<code>Controller</code>ç±»éƒ½å®šä¹‰ä¸€å¥—è¿™æ ·çš„å¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œå› ä¸ºå¼‚å¸¸å¯ä»¥æ˜¯å„ç§å„æ ·ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±ä¼šé€ æˆå¤§é‡çš„å†—ä½™ä»£ç ï¼Œè€Œä¸”è‹¥éœ€è¦æ–°å¢ä¸€ç§å¼‚å¸¸çš„å¤„ç†é€»è¾‘ï¼Œå°±å¿…é¡»ä¿®æ”¹æ‰€æœ‰<code>Controller</code>ç±»äº†ï¼Œå¾ˆä¸ä¼˜é›…ã€‚</p><p>å½“ç„¶ä½ å¯èƒ½ä¼šè¯´ï¼Œé‚£å°±å®šä¹‰ä¸ªç±»ä¼¼<code>BaseController</code>çš„åŸºç±»ï¼Œè¿™æ ·æ€»è¡Œäº†å§ã€‚</p><p>è¿™ç§åšæ³•è™½ç„¶æ²¡é”™ï¼Œä½†ä»ä¸å°½å–„å°½ç¾ï¼Œå› ä¸ºè¿™æ ·çš„ä»£ç æœ‰ä¸€å®šçš„ä¾µå…¥æ€§å’Œè€¦åˆæ€§ã€‚ç®€ç®€å•å•çš„<code>Controller</code>ï¼Œæˆ‘ä¸ºå•¥éå¾—ç»§æ‰¿è¿™æ ·ä¸€ä¸ªç±»å‘¢ï¼Œä¸‡ä¸€å·²ç»ç»§æ‰¿å…¶ä»–åŸºç±»äº†å‘¢ã€‚å¤§å®¶éƒ½çŸ¥é“<code>Java</code>åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ã€‚</p><p>é‚£æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ¡ˆï¼Œæ—¢ä¸éœ€è¦è·Ÿ<code>Controller</code>è€¦åˆï¼Œä¹Ÿå¯ä»¥å°†å®šä¹‰çš„ <strong>å¼‚å¸¸å¤„ç†å™¨</strong> åº”ç”¨åˆ°æ‰€æœ‰æ§åˆ¶å™¨å‘¢ï¼Ÿæ‰€ä»¥æ³¨è§£<code>@ControllerAdvice</code>å‡ºç°äº†ï¼Œç®€å•çš„è¯´ï¼Œè¯¥æ³¨è§£å¯ä»¥æŠŠå¼‚å¸¸å¤„ç†å™¨åº”ç”¨åˆ°æ‰€æœ‰æ§åˆ¶å™¨ï¼Œè€Œä¸æ˜¯å•ä¸ªæ§åˆ¶å™¨ã€‚å€ŸåŠ©è¯¥æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ï¼šåœ¨ç‹¬ç«‹çš„æŸä¸ªåœ°æ–¹ï¼Œæ¯”å¦‚å•ç‹¬ä¸€ä¸ªç±»ï¼Œå®šä¹‰ä¸€å¥—å¯¹å„ç§å¼‚å¸¸çš„å¤„ç†æœºåˆ¶ï¼Œç„¶ååœ¨ç±»çš„ç­¾ååŠ ä¸Šæ³¨è§£<code>@ControllerAdvice</code>ï¼Œç»Ÿä¸€å¯¹ <code>ä¸åŒé˜¶æ®µçš„</code>ã€<code>ä¸åŒå¼‚å¸¸</code> è¿›è¡Œå¤„ç†ã€‚è¿™å°±æ˜¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„åŸç†ã€‚</p><p>æ³¨æ„åˆ°ä¸Šé¢å¯¹å¼‚å¸¸æŒ‰é˜¶æ®µè¿›è¡Œåˆ†ç±»ï¼Œå¤§ä½“å¯ä»¥åˆ†æˆï¼šè¿›å…¥<code>Controller</code>å‰çš„å¼‚å¸¸ å’Œ <code>Service</code> å±‚å¼‚å¸¸ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>ä¸åŒé˜¶æ®µçš„å¼‚å¸¸</p><h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a><strong>ç›®æ ‡</strong></h2><p>æ¶ˆç­95%ä»¥ä¸Šçš„ <code>try catch</code> ä»£ç å—ï¼Œä»¥ä¼˜é›…çš„ <code>Assert</code>(æ–­è¨€) æ–¹å¼æ¥æ ¡éªŒä¸šåŠ¡çš„å¼‚å¸¸æƒ…å†µï¼Œåªå…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸ç”¨èŠ±è´¹å¤§é‡ç²¾åŠ›å†™å†—ä½™çš„ <code>try catch</code> ä»£ç å—ã€‚</p><h2 id="ç»Ÿä¸€å¼‚å¸¸å¤„ç†å®æˆ˜"><a href="#ç»Ÿä¸€å¼‚å¸¸å¤„ç†å®æˆ˜" class="headerlink" title="ç»Ÿä¸€å¼‚å¸¸å¤„ç†å®æˆ˜"></a><strong>ç»Ÿä¸€å¼‚å¸¸å¤„ç†å®æˆ˜</strong></h2><p>åœ¨å®šä¹‰ç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±»ä¹‹å‰ï¼Œå…ˆæ¥ä»‹ç»ä¸€ä¸‹å¦‚ä½•ä¼˜é›…çš„åˆ¤å®šå¼‚å¸¸æƒ…å†µå¹¶æŠ›å¼‚å¸¸ã€‚</p><h3 id="ç”¨-Assert-æ–­è¨€-æ›¿æ¢-throw-exception"><a href="#ç”¨-Assert-æ–­è¨€-æ›¿æ¢-throw-exception" class="headerlink" title="ç”¨ Assert(æ–­è¨€) æ›¿æ¢ throw exception"></a><strong>ç”¨ Assert(æ–­è¨€) æ›¿æ¢ throw exception</strong></h3><p>æƒ³å¿… <code>Assert(æ–­è¨€)</code> å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ï¼Œæ¯”å¦‚ <code>Spring</code> å®¶æ—çš„ <code>org.springframework.util.Assert</code>ï¼Œåœ¨æˆ‘ä»¬å†™æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ç»å¸¸ä¼šç”¨åˆ°ï¼Œä½¿ç”¨æ–­è¨€èƒ½è®©æˆ‘ä»¬ç¼–ç çš„æ—¶å€™æœ‰ä¸€ç§éä¸€èˆ¬ä¸æ»‘çš„æ„Ÿè§‰ï¼Œæ¯”å¦‚ï¼š</p><pre><code class="java">@Test    public void test1() {        ...        User user = userDao.selectById(userId);        Assert.notNull(user, &quot;ç”¨æˆ·ä¸å­˜åœ¨.&quot;);        ...    }    @Test    public void test2() {        // å¦ä¸€ç§å†™æ³•        User user = userDao.selectById(userId);        if (user == null) {            throw new IllegalArgumentException(&quot;ç”¨æˆ·ä¸å­˜åœ¨.&quot;);        }    }</code></pre><p>æœ‰æ²¡æœ‰æ„Ÿè§‰ç¬¬ä¸€ç§åˆ¤å®šéç©ºçš„å†™æ³•å¾ˆä¼˜é›…ï¼Œç¬¬äºŒç§å†™æ³•åˆ™æ˜¯ç›¸å¯¹ä¸‘é™‹çš„ <code>if {...}</code> ä»£ç å—ã€‚é‚£ä¹ˆ<br>ç¥å¥‡çš„ <code>Assert.notNull()</code> èƒŒååˆ°åº•åšäº†ä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢æ˜¯ <code>Assert</code> çš„éƒ¨åˆ†æºç ï¼š</p><pre><code>public abstract class Assert {    public Assert() {    }    public static void notNull(@Nullable Object object, String message) {        if (object == null) {            throw new IllegalArgumentException(message);        }    }}</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>Assert</code> å…¶å®å°±æ˜¯å¸®æˆ‘ä»¬æŠŠ <code>if {...}</code> å°è£…äº†ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ã€‚è™½ç„¶å¾ˆç®€å•ï¼Œä½†ä¸å¯å¦è®¤çš„æ˜¯ç¼–ç ä½“éªŒè‡³å°‘æå‡äº†ä¸€ä¸ªæ¡£æ¬¡ã€‚é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½æ¨¡ä»¿<code>org.springframework.util.Assert</code>ï¼Œä¹Ÿå†™ä¸€ä¸ªæ–­è¨€ç±»ï¼Œä¸è¿‡æ–­è¨€å¤±è´¥åæŠ›å‡ºçš„å¼‚å¸¸ä¸æ˜¯<code>IllegalArgumentException</code> è¿™äº›å†…ç½®å¼‚å¸¸ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å¼‚å¸¸ã€‚ä¸‹é¢è®©æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹ã€‚</p><pre><code>Assertpublic interface Assert {    /**     * åˆ›å»ºå¼‚å¸¸     * @param args     * @return     */    BaseException newException(Object... args);    /**     * åˆ›å»ºå¼‚å¸¸     * @param t     * @param args     * @return     */    BaseException newException(Throwable t, Object... args);    /**     * &lt;p&gt;æ–­è¨€å¯¹è±¡&lt;code&gt;obj&lt;/code&gt;éç©ºã€‚å¦‚æœå¯¹è±¡&lt;code&gt;obj&lt;/code&gt;ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸     *     * @param obj å¾…åˆ¤æ–­å¯¹è±¡     */    default void assertNotNull(Object obj) {        if (obj == null) {            throw newException(obj);        }    }    /**     * &lt;p&gt;æ–­è¨€å¯¹è±¡&lt;code&gt;obj&lt;/code&gt;éç©ºã€‚å¦‚æœå¯¹è±¡&lt;code&gt;obj&lt;/code&gt;ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸     * &lt;p&gt;å¼‚å¸¸ä¿¡æ¯&lt;code&gt;message&lt;/code&gt;æ”¯æŒä¼ é€’å‚æ•°æ–¹å¼ï¼Œé¿å…åœ¨åˆ¤æ–­ä¹‹å‰è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ     *     * @param obj å¾…åˆ¤æ–­å¯¹è±¡     * @param args messageå ä½ç¬¦å¯¹åº”çš„å‚æ•°åˆ—è¡¨     */    default void assertNotNull(Object obj, Object... args) {        if (obj == null) {            throw newException(args);        }    }}</code></pre><p>ä¸Šé¢çš„<code>Assert</code>æ–­è¨€æ–¹æ³•æ˜¯ä½¿ç”¨æ¥å£çš„é»˜è®¤æ–¹æ³•å®šä¹‰çš„ï¼Œç„¶åæœ‰æ²¡æœ‰å‘ç°å½“æ–­è¨€å¤±è´¥åï¼ŒæŠ›å‡ºçš„å¼‚å¸¸ä¸æ˜¯å…·ä½“çš„æŸä¸ªå¼‚å¸¸ï¼Œè€Œæ˜¯äº¤ç”±2ä¸ª<code>newException</code>æ¥å£æ–¹æ³•æä¾›ã€‚å› ä¸ºä¸šåŠ¡é€»è¾‘ä¸­å‡ºç°çš„å¼‚å¸¸åŸºæœ¬éƒ½æ˜¯å¯¹åº”ç‰¹å®šçš„åœºæ™¯ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·idè·å–ç”¨æˆ·ä¿¡æ¯ï¼ŒæŸ¥è¯¢ç»“æœä¸º<code>null</code>ï¼Œæ­¤æ—¶æŠ›å‡ºçš„å¼‚å¸¸å¯èƒ½ä¸º<code>UserNotFoundException</code>ï¼Œå¹¶ä¸”æœ‰ç‰¹å®šçš„å¼‚å¸¸ç ï¼ˆæ¯”å¦‚7001ï¼‰å’Œå¼‚å¸¸ä¿¡æ¯â€œç”¨æˆ·ä¸å­˜åœ¨â€ã€‚æ‰€ä»¥å…·ä½“æŠ›å‡ºä»€ä¹ˆå¼‚å¸¸ï¼Œæœ‰<code>Assert</code>çš„å®ç°ç±»å†³å®šã€‚ï¼ˆæ­¤å¤„æ¨èä¸€ä¸‹å‰æ—¥çš„æ–‡ç«  å»æ‰çƒ¦äººçš„ !=nullï¼‰</p><p>çœ‹åˆ°è¿™é‡Œï¼Œæ‚¨å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼ŒæŒ‰ç…§ä¸Šé¢çš„è¯´æ³•ï¼Œé‚£å²‚ä¸æ˜¯æœ‰å¤šå°‘å¼‚å¸¸æƒ…å†µï¼Œå°±å¾—æœ‰å®šä¹‰ç­‰é‡çš„æ–­è¨€ç±»å’Œå¼‚å¸¸ç±»ï¼Œè¿™æ˜¾ç„¶æ˜¯åäººç±»çš„ï¼Œè¿™ä¹Ÿæ²¡æƒ³è±¡ä¸­é«˜æ˜å˜›ã€‚åˆ«æ€¥ï¼Œä¸”å¬æˆ‘ç»†ç»†é“æ¥ã€‚</p><h4 id="å–„è§£äººæ„çš„Enum"><a href="#å–„è§£äººæ„çš„Enum" class="headerlink" title="å–„è§£äººæ„çš„Enum"></a><strong>å–„è§£äººæ„çš„Enum</strong></h4><p>è‡ªå®šä¹‰å¼‚å¸¸<code>BaseException</code>æœ‰2ä¸ªå±æ€§ï¼Œå³<code>code</code>ã€<code>message</code>ï¼Œè¿™æ ·ä¸€å¯¹å±æ€§ï¼Œæœ‰æ²¡æœ‰æƒ³åˆ°ä»€ä¹ˆç±»ä¸€èˆ¬ä¹Ÿä¼šå®šä¹‰è¿™2ä¸ªå±æ€§ï¼Ÿæ²¡é”™ï¼Œå°±æ˜¯æšä¸¾ç±»ã€‚ä¸”çœ‹æˆ‘å¦‚ä½•å°† <code>Enum</code> å’Œ <code>Assert</code> ç»“åˆèµ·æ¥ï¼Œç›¸ä¿¡æˆ‘ä¸€å®šä¼šè®©ä½ çœ¼å‰ä¸€äº®ã€‚å¦‚ä¸‹ï¼š</p><pre><code>public interface IResponseEnum {    int getCode();    String getMessage();}/** * &lt;p&gt;ä¸šåŠ¡å¼‚å¸¸&lt;/p&gt; * &lt;p&gt;ä¸šåŠ¡å¤„ç†æ—¶ï¼Œå‡ºç°å¼‚å¸¸ï¼Œå¯ä»¥æŠ›å‡ºè¯¥å¼‚å¸¸&lt;/p&gt; */public class BusinessException extends  BaseException {    private static final long serialVersionUID = 1L;    public BusinessException(IResponseEnum responseEnum, Object[] args, String message) {        super(responseEnum, args, message);    }    public BusinessException(IResponseEnum responseEnum, Object[] args, String message, Throwable cause) {        super(responseEnum, args, message, cause);    }}public interface BusinessExceptionAssert extends IResponseEnum, Assert {    @Override    default BaseException newException(Object... args) {        String msg = MessageFormat.format(this.getMessage(), args);        return new BusinessException(this, args, msg);    }    @Override    default BaseException newException(Throwable t, Object... args) {        String msg = MessageFormat.format(this.getMessage(), args);        return new BusinessException(this, args, msg, t);    }}@Getter@AllArgsConstructorpublic enum ResponseEnum implements BusinessExceptionAssert {    /**     * Bad licence type     */    BAD_LICENCE_TYPE(7001, &quot;Bad licence type.&quot;),    /**     * Licence not found     */    LICENCE_NOT_FOUND(7002, &quot;Licence not found.&quot;)    ;    /**     * è¿”å›ç      */    private int code;    /**     * è¿”å›æ¶ˆæ¯     */    private String message;}</code></pre><p>çœ‹åˆ°è¿™é‡Œï¼Œæœ‰æ²¡æœ‰çœ¼å‰ä¸€äº®çš„æ„Ÿè§‰ï¼Œä»£ç ç¤ºä¾‹ä¸­å®šä¹‰äº†ä¸¤ä¸ªæšä¸¾å®ä¾‹ï¼š<code>BAD_LICENCE_TYPE</code>ã€<code>LICENCE_NOT_FOUND</code>ï¼Œåˆ†åˆ«å¯¹åº”äº†<code>BadLicenceTypeException</code>ã€<code>LicenceNotFoundException</code>ä¸¤ç§å¼‚å¸¸ã€‚ä»¥åæ¯å¢åŠ ä¸€ç§å¼‚å¸¸æƒ…å†µï¼Œåªéœ€å¢åŠ ä¸€ä¸ªæšä¸¾å®ä¾‹å³å¯ï¼Œå†ä¹Ÿä¸ç”¨æ¯ä¸€ç§å¼‚å¸¸éƒ½å®šä¹‰ä¸€ä¸ªå¼‚å¸¸ç±»äº†ã€‚ç„¶åå†æ¥çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨ï¼Œå‡è®¾<code>LicenceService</code>æœ‰æ ¡éªŒ<code>Licence</code>æ˜¯å¦å­˜åœ¨çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>/**     * æ ¡éªŒ{@link Licence}å­˜åœ¨     * @param licence     */    private void checkNotNull(Licence licence) {        ResponseEnum.LICENCE_NOT_FOUND.assertNotNull(licence);    }</code></pre><p>è‹¥ä¸ä½¿ç”¨æ–­è¨€ï¼Œä»£ç å¯èƒ½å¦‚ä¸‹ï¼š</p><pre><code>private void checkNotNull(Licence licence) {        if (licence == null) {            throw new LicenceNotFoundException();            // æˆ–è€…è¿™æ ·            throw new BusinessException(7001, &quot;Bad licence type.&quot;);        }    }</code></pre><p>ä½¿ç”¨æšä¸¾ç±»ç»“åˆ(ç»§æ‰¿)<code>Assert</code>ï¼Œåªéœ€æ ¹æ®ç‰¹å®šçš„å¼‚å¸¸æƒ…å†µå®šä¹‰ä¸åŒçš„æšä¸¾å®ä¾‹ï¼Œå¦‚ä¸Šé¢çš„<code>BAD_LICENCE_TYPE</code>ã€<code>LICENCE_NOT_FOUND</code>ï¼Œå°±èƒ½å¤Ÿé’ˆå¯¹ä¸åŒæƒ…å†µæŠ›å‡ºç‰¹å®šçš„å¼‚å¸¸ï¼ˆè¿™é‡ŒæŒ‡æºå¸¦ç‰¹å®šçš„å¼‚å¸¸ç å’Œå¼‚å¸¸æ¶ˆæ¯ï¼‰ï¼Œè¿™æ ·æ—¢ä¸ç”¨å®šä¹‰å¤§é‡çš„å¼‚å¸¸ç±»ï¼ŒåŒæ—¶è¿˜å…·å¤‡äº†æ–­è¨€çš„è‰¯å¥½å¯è¯»æ€§ï¼Œå½“ç„¶è¿™ç§æ–¹æ¡ˆçš„å¥½å¤„è¿œä¸æ­¢è¿™äº›ï¼Œè¯·ç»§ç»­é˜…è¯»åæ–‡ï¼Œæ…¢æ…¢ä½“ä¼šã€‚</p><blockquote><p>æ³¨ï¼šä¸Šé¢ä¸¾çš„ä¾‹å­æ˜¯é’ˆå¯¹ç‰¹å®šçš„ä¸šåŠ¡ï¼Œè€Œæœ‰éƒ¨åˆ†å¼‚å¸¸æƒ…å†µæ˜¯é€šç”¨çš„ï¼Œæ¯”å¦‚ï¼šæœåŠ¡å™¨ç¹å¿™ã€ç½‘ç»œå¼‚å¸¸ã€æœåŠ¡å™¨å¼‚å¸¸ã€å‚æ•°æ ¡éªŒå¼‚å¸¸ã€404ç­‰ï¼Œæ‰€ä»¥æœ‰<code>CommonResponseEnum</code>ã€<code>ArgumentResponseEnum</code>ã€<code>ServletResponseEnum</code>ï¼Œå…¶ä¸­ <code>ServletResponseEnum</code> ä¼šåœ¨åæ–‡è¯¦ç»†è¯´æ˜ã€‚</p></blockquote><h3 id="å®šä¹‰ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨ç±»"><a href="#å®šä¹‰ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨ç±»" class="headerlink" title="å®šä¹‰ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨ç±»"></a>å®šä¹‰ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨ç±»</h3><pre><code>@Slf4j@Component@ControllerAdvice@ConditionalOnWebApplication@ConditionalOnMissingBean(UnifiedExceptionHandler.class)public class UnifiedExceptionHandler {    /**     * ç”Ÿäº§ç¯å¢ƒ     */    private final static String ENV_PROD = &quot;prod&quot;;    @Autowired    private UnifiedMessageSource unifiedMessageSource;    /**     * å½“å‰ç¯å¢ƒ     */    @Value(&quot;${spring.profiles.active}&quot;)    private String profile;    /**     * è·å–å›½é™…åŒ–æ¶ˆæ¯     *     * @param e å¼‚å¸¸     * @return     */    public String getMessage(BaseException e) {        String code = &quot;response.&quot; + e.getResponseEnum().toString();        String message = unifiedMessageSource.getMessage(code, e.getArgs());        if (message == null || message.isEmpty()) {            return e.getMessage();        }        return message;    }    /**     * ä¸šåŠ¡å¼‚å¸¸     *     * @param e å¼‚å¸¸     * @return å¼‚å¸¸ç»“æœ     */    @ExceptionHandler(value = BusinessException.class)    @ResponseBody    public ErrorResponse handleBusinessException(BaseException e) {        log.error(e.getMessage(), e);        return new ErrorResponse(e.getResponseEnum().getCode(), getMessage(e));    }    /**     * è‡ªå®šä¹‰å¼‚å¸¸     *     * @param e å¼‚å¸¸     * @return å¼‚å¸¸ç»“æœ     */    @ExceptionHandler(value = BaseException.class)    @ResponseBody    public ErrorResponse handleBaseException(BaseException e) {        log.error(e.getMessage(), e);        return new ErrorResponse(e.getResponseEnum().getCode(), getMessage(e));    }    /**     * Controllerä¸Šä¸€å±‚ç›¸å…³å¼‚å¸¸     *     * @param e å¼‚å¸¸     * @return å¼‚å¸¸ç»“æœ     */    @ExceptionHandler({            NoHandlerFoundException.class,            HttpRequestMethodNotSupportedException.class,            HttpMediaTypeNotSupportedException.class,            MissingPathVariableException.class,            MissingServletRequestParameterException.class,            TypeMismatchException.class,            HttpMessageNotReadableException.class,            HttpMessageNotWritableException.class,            // BindException.class,            // MethodArgumentNotValidException.class            HttpMediaTypeNotAcceptableException.class,            ServletRequestBindingException.class,            ConversionNotSupportedException.class,            MissingServletRequestPartException.class,            AsyncRequestTimeoutException.class    })    @ResponseBody    public ErrorResponse handleServletException(Exception e) {        log.error(e.getMessage(), e);        int code = CommonResponseEnum.SERVER_ERROR.getCode();        try {            ServletResponseEnum servletExceptionEnum = ServletResponseEnum.valueOf(e.getClass().getSimpleName());            code = servletExceptionEnum.getCode();        } catch (IllegalArgumentException e1) {            log.error(&quot;class [{}] not defined in enum {}&quot;, e.getClass().getName(), ServletResponseEnum.class.getName());        }        if (ENV_PROD.equals(profile)) {            // å½“ä¸ºç”Ÿäº§ç¯å¢ƒ, ä¸é€‚åˆæŠŠå…·ä½“çš„å¼‚å¸¸ä¿¡æ¯å±•ç¤ºç»™ç”¨æˆ·, æ¯”å¦‚404.            code = CommonResponseEnum.SERVER_ERROR.getCode();            BaseException baseException = new BaseException(CommonResponseEnum.SERVER_ERROR);            String message = getMessage(baseException);            return new ErrorResponse(code, message);        }        return new ErrorResponse(code, e.getMessage());    }    /**     * å‚æ•°ç»‘å®šå¼‚å¸¸     *     * @param e å¼‚å¸¸     * @return å¼‚å¸¸ç»“æœ     */    @ExceptionHandler(value = BindException.class)    @ResponseBody    public ErrorResponse handleBindException(BindException e) {        log.error(&quot;å‚æ•°ç»‘å®šæ ¡éªŒå¼‚å¸¸&quot;, e);        return wrapperBindingResult(e.getBindingResult());    }    /**     * å‚æ•°æ ¡éªŒå¼‚å¸¸ï¼Œå°†æ ¡éªŒå¤±è´¥çš„æ‰€æœ‰å¼‚å¸¸ç»„åˆæˆä¸€æ¡é”™è¯¯ä¿¡æ¯     *     * @param e å¼‚å¸¸     * @return å¼‚å¸¸ç»“æœ     */    @ExceptionHandler(value = MethodArgumentNotValidException.class)    @ResponseBody    public ErrorResponse handleValidException(MethodArgumentNotValidException e) {        log.error(&quot;å‚æ•°ç»‘å®šæ ¡éªŒå¼‚å¸¸&quot;, e);        return wrapperBindingResult(e.getBindingResult());    }    /**     * åŒ…è£…ç»‘å®šå¼‚å¸¸ç»“æœ     *     * @param bindingResult ç»‘å®šç»“æœ     * @return å¼‚å¸¸ç»“æœ     */    private ErrorResponse wrapperBindingResult(BindingResult bindingResult) {        StringBuilder msg = new StringBuilder();        for (ObjectError error : bindingResult.getAllErrors()) {            msg.append(&quot;, &quot;);            if (error instanceof FieldError) {                msg.append(((FieldError) error).getField()).append(&quot;: &quot;);            }            msg.append(error.getDefaultMessage() == null ? &quot;&quot; : error.getDefaultMessage());        }        return new ErrorResponse(ArgumentResponseEnum.VALID_ERROR.getCode(), msg.substring(2));    }    /**     * æœªå®šä¹‰å¼‚å¸¸     *     * @param e å¼‚å¸¸     * @return å¼‚å¸¸ç»“æœ     */    @ExceptionHandler(value = Exception.class)    @ResponseBody    public ErrorResponse handleException(Exception e) {        log.error(e.getMessage(), e);        if (ENV_PROD.equals(profile)) {            // å½“ä¸ºç”Ÿäº§ç¯å¢ƒ, ä¸é€‚åˆæŠŠå…·ä½“çš„å¼‚å¸¸ä¿¡æ¯å±•ç¤ºç»™ç”¨æˆ·, æ¯”å¦‚æ•°æ®åº“å¼‚å¸¸ä¿¡æ¯.            int code = CommonResponseEnum.SERVER_ERROR.getCode();            BaseException baseException = new BaseException(CommonResponseEnum.SERVER_ERROR);            String message = getMessage(baseException);            return new ErrorResponse(code, message);        }        return new ErrorResponse(CommonResponseEnum.SERVER_ERROR.getCode(), e.getMessage());    }}</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢å°†å¼‚å¸¸åˆ†æˆå‡ ç±»ï¼Œå®é™…ä¸Šåªæœ‰ä¸¤å¤§ç±»ï¼Œä¸€ç±»æ˜¯<code>ServletException</code>ã€<code>ServiceException</code>ï¼Œè¿˜è®°å¾—ä¸Šæ–‡æåˆ°çš„ <strong>æŒ‰é˜¶æ®µåˆ†ç±»</strong> å—ï¼Œå³å¯¹åº” è¿›å…¥<code>Controller</code>å‰çš„å¼‚å¸¸ å’Œ <code>Service</code> å±‚å¼‚å¸¸ï¼›ç„¶å <code>ServiceException</code> å†åˆ†æˆè‡ªå®šä¹‰å¼‚å¸¸ã€æœªçŸ¥å¼‚å¸¸ã€‚å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p><ul><li>è¿›å…¥<code>Controller</code>å‰çš„å¼‚å¸¸: handleServletExceptionã€handleBindExceptionã€handleValidException</li><li>è‡ªå®šä¹‰å¼‚å¸¸: handleBusinessExceptionã€handleBaseException</li><li>æœªçŸ¥å¼‚å¸¸: handleException</li></ul><p>æ¥ä¸‹æ¥åˆ†åˆ«å¯¹è¿™å‡ ç§å¼‚å¸¸å¤„ç†å™¨åšè¯¦ç»†è¯´æ˜ã€‚</p><h4 id="å¼‚å¸¸å¤„ç†å™¨è¯´æ˜"><a href="#å¼‚å¸¸å¤„ç†å™¨è¯´æ˜" class="headerlink" title="å¼‚å¸¸å¤„ç†å™¨è¯´æ˜"></a><strong>å¼‚å¸¸å¤„ç†å™¨è¯´æ˜</strong></h4><h5 id="handleServletException"><a href="#handleServletException" class="headerlink" title="handleServletException"></a><strong>handleServletException</strong></h5><p>ä¸€ä¸ª<code>http</code>è¯·æ±‚ï¼Œåœ¨åˆ°è¾¾<code>Controller</code>å‰ï¼Œä¼šå¯¹è¯¥è¯·æ±‚çš„è¯·æ±‚ä¿¡æ¯ä¸ç›®æ ‡æ§åˆ¶å™¨ä¿¡æ¯åšä¸€ç³»åˆ—æ ¡éªŒã€‚è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ï¼š</p><p>NoHandlerFoundExceptionï¼šé¦–å…ˆæ ¹æ®è¯·æ±‚<code>Url</code>æŸ¥æ‰¾æœ‰æ²¡æœ‰å¯¹åº”çš„æ§åˆ¶å™¨ï¼Œè‹¥æ²¡æœ‰åˆ™ä¼šæŠ›è¯¥å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶éå¸¸ç†Ÿæ‚‰çš„<code>404</code>å¼‚å¸¸ï¼›</p><p>HttpRequestMethodNotSupportedExceptionï¼šè‹¥åŒ¹é…åˆ°äº†ï¼ˆåŒ¹é…ç»“æœæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œä¸åŒçš„æ˜¯<code>http</code>æ–¹æ³•ä¸åŒï¼Œå¦‚ï¼šGetã€Postç­‰ï¼‰ï¼Œåˆ™å°è¯•å°†è¯·æ±‚çš„<code>http</code>æ–¹æ³•ä¸åˆ—è¡¨çš„æ§åˆ¶å™¨åšåŒ¹é…ï¼Œè‹¥æ²¡æœ‰å¯¹åº”<code>http</code>æ–¹æ³•çš„æ§åˆ¶å™¨ï¼Œåˆ™æŠ›è¯¥å¼‚å¸¸ï¼›</p><p>HttpMediaTypeNotSupportedExceptionï¼šç„¶åå†å¯¹è¯·æ±‚å¤´ä¸æ§åˆ¶å™¨æ”¯æŒçš„åšæ¯”è¾ƒï¼Œæ¯”å¦‚<code>content-type</code>è¯·æ±‚å¤´ï¼Œè‹¥æ§åˆ¶å™¨çš„å‚æ•°ç­¾ååŒ…å«æ³¨è§£<code>@RequestBody</code>ï¼Œä½†æ˜¯è¯·æ±‚çš„<code>content-type</code>è¯·æ±‚å¤´çš„å€¼æ²¡æœ‰åŒ…å«<code>application/json</code>ï¼Œé‚£ä¹ˆä¼šæŠ›è¯¥å¼‚å¸¸ï¼ˆå½“ç„¶ï¼Œä¸æ­¢è¿™ç§æƒ…å†µä¼šæŠ›è¿™ä¸ªå¼‚å¸¸ï¼‰ï¼›</p><p>MissingPathVariableExceptionï¼šæœªæ£€æµ‹åˆ°è·¯å¾„å‚æ•°ã€‚æ¯”å¦‚urlä¸ºï¼š<code>/licence/{licenceId}</code>ï¼Œå‚æ•°ç­¾ååŒ…å«<code>@PathVariable(&quot;licenceId&quot;)</code>ï¼Œå½“è¯·æ±‚çš„urlä¸º<code>/licence</code>ï¼Œåœ¨æ²¡æœ‰æ˜ç¡®å®šä¹‰urlä¸º<code>/licence</code>çš„æƒ…å†µä¸‹ï¼Œä¼šè¢«åˆ¤å®šä¸ºï¼šç¼ºå°‘è·¯å¾„å‚æ•°ï¼›</p><p>MissingServletRequestParameterExceptionï¼šç¼ºå°‘è¯·æ±‚å‚æ•°ã€‚æ¯”å¦‚å®šä¹‰äº†å‚æ•°@RequestParam(â€œlicenceIdâ€) String licenceIdï¼Œä½†å‘èµ·è¯·æ±‚æ—¶ï¼Œæœªæºå¸¦è¯¥å‚æ•°ï¼Œåˆ™ä¼šæŠ›è¯¥å¼‚å¸¸ï¼›</p><p>TypeMismatchException: å‚æ•°ç±»å‹åŒ¹é…å¤±è´¥ã€‚æ¯”å¦‚ï¼šæ¥æ”¶å‚æ•°ä¸ºLongå‹ï¼Œä½†ä¼ å…¥çš„å€¼ç¡®æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå°†ä¼šå‡ºç°ç±»å‹è½¬æ¢å¤±è´¥çš„æƒ…å†µï¼Œè¿™æ—¶ä¼šæŠ›è¯¥å¼‚å¸¸ï¼›</p><p>HttpMessageNotReadableExceptionï¼šä¸ä¸Šé¢çš„<code>HttpMediaTypeNotSupportedException</code>ä¸¾çš„ä¾‹å­å®Œå…¨ç›¸åï¼Œå³è¯·æ±‚å¤´æºå¸¦äº†<code>&quot;content-type: application/json;charset=UTF-8&quot;</code>ï¼Œä½†æ¥æ”¶å‚æ•°å´æ²¡æœ‰æ·»åŠ æ³¨è§£<code>@RequestBody</code>ï¼Œæˆ–è€…è¯·æ±‚ä½“æºå¸¦çš„ json ä¸²ååºåˆ—åŒ–æˆ pojo çš„è¿‡ç¨‹ä¸­å¤±è´¥äº†ï¼Œä¹Ÿä¼šæŠ›è¯¥å¼‚å¸¸ï¼›</p><p>HttpMessageNotWritableExceptionï¼šè¿”å›çš„ pojo åœ¨åºåˆ—åŒ–æˆ json è¿‡ç¨‹å¤±è´¥äº†ï¼Œé‚£ä¹ˆæŠ›è¯¥å¼‚å¸¸ï¼›</p><h5 id="handleBindException"><a href="#handleBindException" class="headerlink" title="handleBindException"></a><strong>handleBindException</strong></h5><p>å‚æ•°æ ¡éªŒå¼‚å¸¸ï¼Œåæ–‡è¯¦ç»†è¯´æ˜ã€‚</p><h5 id="handleValidException"><a href="#handleValidException" class="headerlink" title="handleValidException"></a><strong>handleValidException</strong></h5><p>å‚æ•°æ ¡éªŒå¼‚å¸¸ï¼Œåæ–‡è¯¦ç»†è¯´æ˜ã€‚</p><h5 id="handleBusinessExceptionã€handleBaseException"><a href="#handleBusinessExceptionã€handleBaseException" class="headerlink" title="handleBusinessExceptionã€handleBaseException"></a><strong>handleBusinessExceptionã€handleBaseException</strong></h5><p>å¤„ç†è‡ªå®šä¹‰çš„ä¸šåŠ¡å¼‚å¸¸ï¼Œåªæ˜¯<code>handleBaseException</code>å¤„ç†çš„æ˜¯é™¤äº† <code>BusinessException</code> æ„å¤–çš„æ‰€æœ‰ä¸šåŠ¡å¼‚å¸¸ã€‚å°±ç›®å‰æ¥çœ‹ï¼Œè¿™2ä¸ªæ˜¯å¯ä»¥åˆå¹¶æˆä¸€ä¸ªçš„ã€‚</p><h5 id="handleException"><a href="#handleException" class="headerlink" title="handleException"></a><strong>handleException</strong></h5><p>å¤„ç†æ‰€æœ‰æœªçŸ¥çš„å¼‚å¸¸ï¼Œæ¯”å¦‚æ“ä½œæ•°æ®åº“å¤±è´¥çš„å¼‚å¸¸ã€‚</p><blockquote><p>æ³¨ï¼šä¸Šé¢çš„<code>handleServletException</code>ã€<code>handleException</code> è¿™ä¸¤ä¸ªå¤„ç†å™¨ï¼Œè¿”å›çš„å¼‚å¸¸ä¿¡æ¯ï¼Œä¸åŒç¯å¢ƒè¿”å›çš„å¯èƒ½ä¸ä¸€æ ·ï¼Œä»¥ä¸ºè¿™äº›å¼‚å¸¸ä¿¡æ¯éƒ½æ˜¯æ¡†æ¶è‡ªå¸¦çš„å¼‚å¸¸ä¿¡æ¯ï¼Œä¸€èˆ¬éƒ½æ˜¯è‹±æ–‡çš„ï¼Œä¸å¤ªå¥½ç›´æ¥å±•ç¤ºç»™ç”¨æˆ·çœ‹ï¼Œæ‰€ä»¥ç»Ÿä¸€è¿”å›<code>SERVER_ERROR</code>ä»£è¡¨çš„å¼‚å¸¸ä¿¡æ¯ã€‚</p></blockquote><h4 id="å¼‚äºå¸¸äººçš„404"><a href="#å¼‚äºå¸¸äººçš„404" class="headerlink" title="å¼‚äºå¸¸äººçš„404"></a><strong>å¼‚äºå¸¸äººçš„404</strong></h4><p>ä¸Šæ–‡æåˆ°ï¼Œå½“è¯·æ±‚æ²¡æœ‰åŒ¹é…åˆ°æ§åˆ¶å™¨çš„æƒ…å†µä¸‹ï¼Œä¼šæŠ›å‡º<code>NoHandlerFoundException</code>å¼‚å¸¸ï¼Œä½†å…¶å®é»˜è®¤æƒ…å†µä¸‹ä¸æ˜¯è¿™æ ·ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šå‡ºç°ç±»ä¼¼å¦‚ä¸‹é¡µé¢ï¼š</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>Whitelabel Error Page</p><p>è¿™ä¸ªé¡µé¢æ˜¯å¦‚ä½•å‡ºç°çš„å‘¢ï¼Ÿå®é™…ä¸Šï¼Œå½“å‡ºç°404çš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯ä¸æŠ›å¼‚å¸¸çš„ï¼Œè€Œæ˜¯ <code>forward</code>è·³è½¬åˆ°<code>/error</code>æ§åˆ¶å™¨ï¼Œ<code>spring</code>ä¹Ÿæä¾›äº†é»˜è®¤çš„<code>error</code>æ§åˆ¶å™¨ï¼Œå¦‚ä¸‹ï¼š</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>é‚£ä¹ˆï¼Œå¦‚ä½•è®©404ä¹ŸæŠ›å‡ºå¼‚å¸¸å‘¢ï¼Œåªéœ€åœ¨<code>properties</code>æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®å³å¯ï¼š</p><pre><code>spring.mvc.throw-exception-if-no-handler-found=truespring.resources.add-mappings=false</code></pre><p>å¦‚æ­¤ï¼Œå°±å¯ä»¥å¼‚å¸¸å¤„ç†å™¨ä¸­æ•è·å®ƒäº†ï¼Œç„¶åå‰ç«¯åªè¦æ•è·åˆ°ç‰¹å®šçš„çŠ¶æ€ç ï¼Œç«‹å³è·³è½¬åˆ°404é¡µé¢å³å¯</p><p><strong>æ•è·404å¯¹åº”çš„å¼‚å¸¸</strong></p><h4 id="ç»Ÿä¸€è¿”å›ç»“æœ"><a href="#ç»Ÿä¸€è¿”å›ç»“æœ" class="headerlink" title="ç»Ÿä¸€è¿”å›ç»“æœ"></a><strong>ç»Ÿä¸€è¿”å›ç»“æœ</strong></h4><p>åœ¨éªŒè¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨ä¹‹å‰ï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ç»Ÿä¸€è¿”å›ç»“æœã€‚è¯´ç™½äº†ï¼Œå…¶å®æ˜¯ç»Ÿä¸€ä¸€ä¸‹è¿”å›ç»“æœçš„æ•°æ®ç»“æ„ã€‚<code>code</code>ã€<code>message</code> æ˜¯æ‰€æœ‰è¿”å›ç»“æœä¸­å¿…æœ‰çš„å­—æ®µï¼Œè€Œå½“éœ€è¦è¿”å›æ•°æ®æ—¶ï¼Œåˆ™éœ€è¦å¦ä¸€ä¸ªå­—æ®µ <code>data</code> æ¥è¡¨ç¤ºã€‚</p><p>æ‰€ä»¥é¦–å…ˆå®šä¹‰ä¸€ä¸ª <code>BaseResponse</code> æ¥ä½œä¸ºæ‰€æœ‰è¿”å›ç»“æœçš„åŸºç±»ï¼›</p><p>ç„¶åå®šä¹‰ä¸€ä¸ªé€šç”¨è¿”å›ç»“æœç±»<code>CommonResponse</code>ï¼Œç»§æ‰¿ <code>BaseResponse</code>ï¼Œè€Œä¸”å¤šäº†å­—æ®µ <code>data</code>ï¼›</p><p>ä¸ºäº†åŒºåˆ†æˆåŠŸå’Œå¤±è´¥è¿”å›ç»“æœï¼Œäºæ˜¯å†å®šä¹‰ä¸€ä¸ª <code>ErrorResponse</code></p><p>æœ€åè¿˜æœ‰ä¸€ç§å¸¸è§çš„è¿”å›ç»“æœï¼Œå³è¿”å›çš„æ•°æ®å¸¦æœ‰åˆ†é¡µä¿¡æ¯ï¼Œå› ä¸ºè¿™ç§æ¥å£æ¯”è¾ƒå¸¸è§ï¼Œæ‰€ä»¥æœ‰å¿…è¦å•ç‹¬å®šä¹‰ä¸€ä¸ªè¿”å›ç»“æœç±» <code>QueryDataResponse</code>ï¼Œè¯¥ç±»ç»§æ‰¿è‡ª <code>CommonResponse</code>ï¼Œåªæ˜¯æŠŠ <code>data</code>å­—æ®µçš„ç±»å‹é™åˆ¶ä¸º <code>QueryDdata</code>ï¼Œ<code>QueryDdata</code>ä¸­å®šä¹‰äº†åˆ†é¡µä¿¡æ¯ç›¸åº”çš„å­—æ®µï¼Œå³<code>totalCount</code>ã€<code>pageNo</code>ã€ <code>pageSize</code>ã€<code>records</code>ã€‚</p><p>å…¶ä¸­æ¯”è¾ƒå¸¸ç”¨çš„åªæœ‰ <code>CommonResponse</code> å’Œ <code>QueryDataResponse</code>ï¼Œä½†æ˜¯åå­—åˆè´¼é¬¼æ­»é•¿ï¼Œä½•ä¸å®šä¹‰2ä¸ªåå­—è¶…ç®€å•çš„ç±»æ¥æ›¿ä»£å‘¢ï¼Ÿäºæ˜¯ <code>R</code> å’Œ <code>QR</code> è¯ç”Ÿäº†ï¼Œä»¥åè¿”å›ç»“æœçš„æ—¶å€™åªéœ€è¿™æ ·å†™ï¼š<code>new R&lt;&gt;(data)</code>ã€<code>new QR&lt;&gt;(queryData)</code>ã€‚</p><p>æ‰€æœ‰çš„è¿”å›ç»“æœç±»çš„å®šä¹‰è¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†</p><h4 id="éªŒè¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#éªŒè¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="éªŒè¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a><strong>éªŒè¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†</strong></h4><p>å› ä¸ºè¿™ä¸€å¥—ç»Ÿä¸€å¼‚å¸¸å¤„ç†å¯ä»¥è¯´æ˜¯é€šç”¨çš„ï¼Œæ‰€æœ‰å¯ä»¥è®¾è®¡æˆä¸€ä¸ª <code>common</code>åŒ…ï¼Œä»¥åæ¯ä¸€ä¸ªæ–°é¡¹ç›®/æ¨¡å—åªéœ€å¼•å…¥è¯¥åŒ…å³å¯ã€‚æ‰€ä»¥ä¸ºäº†éªŒè¯ï¼Œéœ€è¦æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶å¼•å…¥è¯¥ <code>common</code>åŒ…ã€‚</p><h5 id="ä¸»è¦ä»£ç "><a href="#ä¸»è¦ä»£ç " class="headerlink" title="ä¸»è¦ä»£ç "></a>ä¸»è¦ä»£ç </h5><p>ä¸‹é¢æ˜¯ç”¨äºéªŒè¯çš„ä¸»è¦æºç ï¼š</p><pre><code>@Servicepublic class LicenceService extends ServiceImpl&lt;LicenceMapper, Licence&gt; {    @Autowired    private OrganizationClient organizationClient;    /**     * æŸ¥è¯¢{@link Licence} è¯¦æƒ…     * @param licenceId     * @return     */    public LicenceDTO queryDetail(Long licenceId) {        Licence licence = this.getById(licenceId);        checkNotNull(licence);        OrganizationDTO org = ClientUtil.execute(() -&gt; organizationClient.getOrganization(licence.getOrganizationId()));        return toLicenceDTO(licence, org);    }    /**     * åˆ†é¡µè·å–     * @param licenceParam åˆ†é¡µæŸ¥è¯¢å‚æ•°     * @return     */    public QueryData&lt;SimpleLicenceDTO&gt; getLicences(LicenceParam licenceParam) {        String licenceType = licenceParam.getLicenceType();        LicenceTypeEnum licenceTypeEnum = LicenceTypeEnum.parseOfNullable(licenceType);        // æ–­è¨€, éç©º        ResponseEnum.BAD_LICENCE_TYPE.assertNotNull(licenceTypeEnum);        LambdaQueryWrapper&lt;Licence&gt; wrapper = new LambdaQueryWrapper&lt;&gt;();        wrapper.eq(Licence::getLicenceType, licenceType);        IPage&lt;Licence&gt; page = this.page(new QueryPage&lt;&gt;(licenceParam), wrapper);        return new QueryData&lt;&gt;(page, this::toSimpleLicenceDTO);    }    /**     * æ–°å¢{@link Licence}     * @param request è¯·æ±‚ä½“     * @return     */    @Transactional(rollbackFor = Throwable.class)    public LicenceAddRespData addLicence(LicenceAddRequest request) {        Licence licence = new Licence();        licence.setOrganizationId(request.getOrganizationId());        licence.setLicenceType(request.getLicenceType());        licence.setProductName(request.getProductName());        licence.setLicenceMax(request.getLicenceMax());        licence.setLicenceAllocated(request.getLicenceAllocated());        licence.setComment(request.getComment());        this.save(licence);        return new LicenceAddRespData(licence.getLicenceId());    }    /**     * entity -&gt; simple dto     * @param licence {@link Licence} entity     * @return {@link SimpleLicenceDTO}     */    private SimpleLicenceDTO toSimpleLicenceDTO(Licence licence) {        // çœç•¥    }    /**     * entity -&gt; dto     * @param licence {@link Licence} entity     * @param org {@link OrganizationDTO}     * @return {@link LicenceDTO}     */    private LicenceDTO toLicenceDTO(Licence licence, OrganizationDTO org) {        // çœç•¥    }    /**     * æ ¡éªŒ{@link Licence}å­˜åœ¨     * @param licence     */    private void checkNotNull(Licence licence) {        ResponseEnum.LICENCE_NOT_FOUND.assertNotNull(licence);    }}</code></pre><p>PS: è¿™é‡Œä½¿ç”¨çš„DAOæ¡†æ¶æ˜¯<code>mybatis-plus</code>ã€‚<br>å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨æ’å…¥çš„æ•°æ®ä¸ºï¼š</p><pre><code>-- licenceINSERT INTO licence (licence_id, organization_id, licence_type, product_name, licence_max, licence_allocated)VALUES (1, 1, &#39;user&#39;,&#39;CustomerPro&#39;, 100,5);INSERT INTO licence (licence_id, organization_id, licence_type, product_name, licence_max, licence_allocated)VALUES (2, 1, &#39;user&#39;,&#39;suitability-plus&#39;, 200,189);INSERT INTO licence (licence_id, organization_id, licence_type, product_name, licence_max, licence_allocated)VALUES (3, 2, &#39;user&#39;,&#39;HR-PowerSuite&#39;, 100,4);INSERT INTO licence (licence_id, organization_id, licence_type, product_name, licence_max, licence_allocated)VALUES (4, 2, &#39;core-prod&#39;,&#39;WildCat Application Gateway&#39;, 16,16);-- organizationsINSERT INTO organization (id, name, contact_name, contact_email, contact_phone)VALUES (1, &#39;customer-crm-co&#39;, &#39;Mark Balster&#39;, &#39;mark.balster@custcrmco.com&#39;, &#39;823-555-1212&#39;);INSERT INTO organization (id, name, contact_name, contact_email, contact_phone)VALUES (2, &#39;HR-PowerSuite&#39;, &#39;Doug Drewry&#39;,&#39;doug.drewry@hr.com&#39;, &#39;920-555-1212&#39;);</code></pre><h5 id="å¼€å§‹éªŒè¯"><a href="#å¼€å§‹éªŒè¯" class="headerlink" title="å¼€å§‹éªŒè¯"></a><strong>å¼€å§‹éªŒè¯</strong></h5><h6 id="æ•è·è‡ªå®šä¹‰å¼‚å¸¸"><a href="#æ•è·è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="æ•è·è‡ªå®šä¹‰å¼‚å¸¸"></a><strong>æ•è·è‡ªå®šä¹‰å¼‚å¸¸</strong></h6><p>\1. è·å–ä¸å­˜åœ¨çš„ <code>licence</code> è¯¦æƒ…ï¼š<a href="http://localhost:10000/licence/5ã€‚æˆåŠŸå“åº”çš„è¯·æ±‚ï¼šlicenceId=1" target="_blank" rel="noopener">http://localhost:10000/licence/5ã€‚æˆåŠŸå“åº”çš„è¯·æ±‚ï¼šlicenceId=1</a></p><p>æ£€éªŒéç©º</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>æ•è· Licence not found å¼‚å¸¸<img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>Licence not found</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload">2. æ ¹æ®ä¸å­˜åœ¨çš„ <code>licence type</code> è·å– <code>licence</code> åˆ—è¡¨ï¼š<a href="http://localhost:10000/licence/list?licenceType=dddã€‚å¯é€‰çš„" target="_blank" rel="noopener">http://localhost:10000/licence/list?licenceType=dddã€‚å¯é€‰çš„</a> <code>licence type</code> ä¸ºï¼šuserã€core-prod ã€‚</p><p>æ ¡éªŒéç©º</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>æ•è· Bad licence type å¼‚å¸¸<img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>Bad licence type</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"><strong>æ•è·è¿›å…¥ Controller å‰çš„å¼‚å¸¸</strong></p><p>\1. è®¿é—®ä¸å­˜åœ¨çš„æ¥å£ï¼š<a href="http://localhost:10000/licence/list/ddd" target="_blank" rel="noopener">http://localhost:10000/licence/list/ddd</a></p><p>æ•è·404å¼‚å¸¸</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>\2. http æ–¹æ³•ä¸æ”¯æŒï¼š<a href="http://localhost:10000/licence" target="_blank" rel="noopener">http://localhost:10000/licence</a></p><p>PostMapping</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>æ•è· Request method not supported å¼‚å¸¸</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>Request method not supported</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>\3. æ ¡éªŒå¼‚å¸¸1ï¼š<a href="http://localhost:10000/licence/list?licenceType=" target="_blank" rel="noopener">http://localhost:10000/licence/list?licenceType=</a></p><p>getLicences</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>LicenceParam</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>æ•è·å‚æ•°ç»‘å®šæ ¡éªŒå¼‚å¸¸</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>licence type cannot be empty</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload">4. æ ¡éªŒå¼‚å¸¸2ï¼špost è¯·æ±‚ï¼Œè¿™é‡Œä½¿ç”¨postmanæ¨¡æ‹Ÿã€‚</p><p>addLicence</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>LicenceAddRequest</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>è¯·æ±‚urlå³ç»“æœ</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>æ•è·å‚æ•°ç»‘å®šæ ¡éªŒå¼‚å¸¸<img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>æ³¨ï¼šå› ä¸ºå‚æ•°ç»‘å®šæ ¡éªŒå¼‚å¸¸çš„å¼‚å¸¸ä¿¡æ¯çš„è·å–æ–¹å¼ä¸å…¶å®ƒå¼‚å¸¸ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ‰æŠŠè¿™2ç§æƒ…å†µçš„å¼‚å¸¸ä» <strong>è¿›å…¥ Controller å‰çš„å¼‚å¸¸</strong> å•ç‹¬æ‹†å‡ºæ¥ï¼Œä¸‹é¢æ˜¯å¼‚å¸¸ä¿¡æ¯çš„æ”¶é›†é€»è¾‘ï¼š</p><p>å¼‚å¸¸ä¿¡æ¯çš„æ”¶é›†</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><h6 id="æ•è·æœªçŸ¥å¼‚å¸¸"><a href="#æ•è·æœªçŸ¥å¼‚å¸¸" class="headerlink" title="æ•è·æœªçŸ¥å¼‚å¸¸"></a><strong>æ•è·æœªçŸ¥å¼‚å¸¸</strong></h6><p>å‡è®¾æˆ‘ä»¬ç°åœ¨éšä¾¿å¯¹ <code>Licence</code> æ–°å¢ä¸€ä¸ªå­—æ®µ <code>test</code>ï¼Œä½†ä¸ä¿®æ”¹æ•°æ®åº“è¡¨ç»“æ„ï¼Œç„¶åè®¿é—®ï¼š<a href="http://localhost:10000/licence/1ã€‚" target="_blank" rel="noopener">http://localhost:10000/licence/1ã€‚</a></p><p>å¢åŠ testå­—æ®µ</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>æ•è·æ•°æ®åº“å¼‚å¸¸</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>Error querying database</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a><strong>å°ç»“</strong></h4><p>å¯ä»¥çœ‹åˆ°ï¼Œæµ‹è¯•çš„å¼‚å¸¸éƒ½èƒ½å¤Ÿè¢«æ•è·ï¼Œç„¶åä»¥ <code>code</code>ã€<code>message</code> çš„å½¢å¼è¿”å›ã€‚æ¯ä¸€ä¸ªé¡¹ç›®/æ¨¡å—ï¼Œåœ¨å®šä¹‰ä¸šåŠ¡å¼‚å¸¸çš„æ—¶å€™ï¼Œåªéœ€å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œç„¶åå®ç°æ¥å£ <code>BusinessExceptionAssert</code>ï¼Œæœ€åä¸ºæ¯ä¸€ç§ä¸šåŠ¡å¼‚å¸¸å®šä¹‰å¯¹åº”çš„æšä¸¾å®ä¾‹å³å¯ï¼Œè€Œä¸ç”¨å®šä¹‰è®¸å¤šå¼‚å¸¸ç±»ã€‚ä½¿ç”¨çš„æ—¶å€™ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œç”¨æ³•ç±»ä¼¼æ–­è¨€ã€‚</p><h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a><strong>æ‰©å±•</strong></h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œè‹¥æ•è·åˆ° <strong>æœªçŸ¥å¼‚å¸¸</strong> æˆ–è€… <code>ServletException</code>ï¼Œå› ä¸ºéƒ½æ˜¯ä¸€é•¿ä¸²çš„å¼‚å¸¸ä¿¡æ¯ï¼Œè‹¥ç›´æ¥å±•ç¤ºç»™ç”¨æˆ·çœ‹ï¼Œæ˜¾å¾—ä¸å¤Ÿä¸“ä¸šï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼šå½“æ£€æµ‹åˆ°å½“å‰ç¯å¢ƒæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œé‚£ä¹ˆç›´æ¥è¿”å› â€œç½‘ç»œå¼‚å¸¸â€ã€‚</p><p>ç”Ÿäº§ç¯å¢ƒè¿”å›â€œç½‘ç»œå¼‚å¸¸â€</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¿®æ”¹å½“å‰ç¯å¢ƒï¼š</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>ä¿®æ”¹å½“å‰ç¯å¢ƒä¸ºç”Ÿäº§ç¯å¢ƒ</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h2><p>ä½¿ç”¨ <strong>æ–­è¨€</strong> å’Œ <strong>æšä¸¾ç±»</strong> ç›¸ç»“åˆçš„æ–¹å¼ï¼Œå†é…åˆç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼ŒåŸºæœ¬å¤§éƒ¨åˆ†çš„å¼‚å¸¸éƒ½èƒ½å¤Ÿè¢«æ•è·ã€‚ä¸ºä»€ä¹ˆè¯´å¤§éƒ¨åˆ†å¼‚å¸¸ï¼Œå› ä¸ºå½“å¼•å…¥ <code>spring cloud security</code> åï¼Œè¿˜ä¼šæœ‰è®¤è¯/æˆæƒå¼‚å¸¸ï¼Œç½‘å…³çš„æœåŠ¡é™çº§å¼‚å¸¸ã€è·¨æ¨¡å—è°ƒç”¨å¼‚å¸¸ã€è¿œç¨‹è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸ç­‰ï¼Œè¿™äº›å¼‚å¸¸çš„æ•è·æ–¹å¼ä¸æœ¬æ–‡ä»‹ç»çš„ä¸å¤ªä¸€æ ·ï¼Œä¸è¿‡é™äºç¯‡å¹…ï¼Œè¿™é‡Œä¸åšè¯¦ç»†è¯´æ˜ï¼Œä»¥åä¼šæœ‰å•ç‹¬çš„æ–‡ç« ä»‹ç»ã€‚</p><p>å¦å¤–ï¼Œå½“éœ€è¦è€ƒè™‘å›½é™…åŒ–çš„æ—¶å€™ï¼Œæ•è·å¼‚å¸¸åçš„å¼‚å¸¸ä¿¡æ¯ä¸€èˆ¬ä¸èƒ½ç›´æ¥è¿”å›ï¼Œéœ€è¦è½¬æ¢æˆå¯¹åº”çš„è¯­è¨€ï¼Œä¸è¿‡æœ¬æ–‡å·²è€ƒè™‘åˆ°äº†è¿™ä¸ªï¼Œè·å–æ¶ˆæ¯çš„æ—¶å€™å·²ç»åšäº†å›½é™…åŒ–æ˜ å°„ï¼Œé€»è¾‘å¦‚ä¸‹ï¼š</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p><strong>è·å–å›½é™…åŒ–æ¶ˆæ¯</strong></p><p>æœ€åæ€»ç»“ï¼Œå…¨å±€å¼‚å¸¸å±äºè€ç”Ÿé•¿è°ˆçš„è¯é¢˜ï¼Œå¸Œæœ›è¿™æ¬¡é€šè¿‡æ‰‹æœºçš„é¡¹ç›®å¯¹å¤§å®¶æœ‰ç‚¹æŒ‡å¯¼æ€§çš„å­¦ä¹ ã€‚å¤§å®¶æ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œä¿®æ”¹ã€‚</p><p>ä¹Ÿå¯ä»¥é‡‡ç”¨ä»¥ä¸‹çš„jsonResultå¯¹è±¡çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œä¹Ÿè´´å‡ºæ¥ä»£ç .</p><pre><code>@Slf4j@RestControllerAdvicepublic class GlobalExceptionHandler {    /**     * æ²¡æœ‰ç™»å½•     * @param request     * @param response     * @param e     * @return     */    @ExceptionHandler(NoLoginException.class)    public Object noLoginExceptionHandler(HttpServletRequest request,HttpServletResponse response,Exception e)    {        log.error(&quot;[GlobalExceptionHandler][noLoginExceptionHandler] exception&quot;,e);        JsonResult jsonResult = new JsonResult();        jsonResult.setCode(JsonResultCode.NO_LOGIN);        jsonResult.setMessage(&quot;ç”¨æˆ·ç™»å½•å¤±æ•ˆæˆ–è€…ç™»å½•è¶…æ—¶,è¯·å…ˆç™»å½•&quot;);        return jsonResult;    }    /**     * ä¸šåŠ¡å¼‚å¸¸     * @param request     * @param response     * @param e     * @return     */    @ExceptionHandler(ServiceException.class)    public Object businessExceptionHandler(HttpServletRequest request,HttpServletResponse response,Exception e)    {        log.error(&quot;[GlobalExceptionHandler][businessExceptionHandler] exception&quot;,e);        JsonResult jsonResult = new JsonResult();        jsonResult.setCode(JsonResultCode.FAILURE);        jsonResult.setMessage(&quot;ä¸šåŠ¡å¼‚å¸¸,è¯·è”ç³»ç®¡ç†å‘˜&quot;);        return jsonResult;    }    /**     * å…¨å±€å¼‚å¸¸å¤„ç†     * @param request     * @param response     * @param e     * @return     */    @ExceptionHandler(Exception.class)    public Object exceptionHandler(HttpServletRequest request,HttpServletResponse response,Exception e)    {        log.error(&quot;[GlobalExceptionHandler][exceptionHandler] exception&quot;,e);        JsonResult jsonResult = new JsonResult();        jsonResult.setCode(JsonResultCode.FAILURE);        jsonResult.setMessage(&quot;ç³»ç»Ÿé”™è¯¯,è¯·è”ç³»ç®¡ç†å‘˜&quot;);        return jsonResult;    }}</code></pre><blockquote><p> åŸæ–‡é“¾æ¥ï¼šcnblogs.com/jurendage/p/11255197.html</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> JavaåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼‚å¸¸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQ å…¥é—¨</title>
      <link href="/2020/01/15/4.%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ%E5%85%A5%E9%97%A8/"/>
      <url>/2020/01/15/4.%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="RabbitMQ-å…¥é—¨å…¨æ”»ç•¥"><a href="#RabbitMQ-å…¥é—¨å…¨æ”»ç•¥" class="headerlink" title="RabbitMQ å…¥é—¨å…¨æ”»ç•¥"></a>RabbitMQ å…¥é—¨å…¨æ”»ç•¥</h2><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><p>[TOC]</p><h2 id="RabbitMQ-ä»‹ç»"><a href="#RabbitMQ-ä»‹ç»" class="headerlink" title="RabbitMQ ä»‹ç»"></a>RabbitMQ ä»‹ç»</h2><p>è¿™éƒ¨åˆ†å‚è€ƒäº† ã€ŠRabbitMQå®æˆ˜æŒ‡å—ã€‹è¿™æœ¬ä¹¦çš„ç¬¬ 1 ç« å’Œç¬¬ 2 ç« ã€‚</p><h3 id="RabbitMQ-ç®€ä»‹"><a href="#RabbitMQ-ç®€ä»‹" class="headerlink" title="RabbitMQ ç®€ä»‹"></a>RabbitMQ ç®€ä»‹</h3><p>RabbitMQ æ˜¯é‡‡ç”¨ Erlang è¯­è¨€å®ç° AMQP(Advanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ƒæœ€åˆèµ·æºäºé‡‘èç³»ç»Ÿï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­˜å‚¨è½¬å‘æ¶ˆæ¯ã€‚</p><p>RabbitMQ å‘å±•åˆ°ä»Šå¤©ï¼Œè¢«è¶Šæ¥è¶Šå¤šçš„äººè®¤å¯ï¼Œè¿™å’Œå®ƒåœ¨æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ã€å¯é æ€§å’Œé«˜å¯ç”¨æ€§ç­‰æ–¹é¢çš„å“è‘—è¡¨ç°æ˜¯åˆ†ä¸å¼€çš„ã€‚RabbitMQ çš„å…·ä½“ç‰¹ç‚¹å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><strong>å¯é æ€§ï¼š</strong> RabbitMQä½¿ç”¨ä¸€äº›æœºåˆ¶æ¥ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Œå¦‚æŒä¹…åŒ–ã€ä¼ è¾“ç¡®è®¤åŠå‘å¸ƒç¡®è®¤ç­‰ã€‚</li><li><strong>çµæ´»çš„è·¯ç”±ï¼š</strong> åœ¨æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—ä¹‹å‰ï¼Œé€šè¿‡äº¤æ¢å™¨æ¥è·¯ç”±æ¶ˆæ¯ã€‚å¯¹äºå…¸å‹çš„è·¯ç”±åŠŸèƒ½ï¼ŒRabbitMQ å·±ç»æä¾›äº†ä¸€äº›å†…ç½®çš„äº¤æ¢å™¨æ¥å®ç°ã€‚é’ˆå¯¹æ›´å¤æ‚çš„è·¯ç”±åŠŸèƒ½ï¼Œå¯ä»¥å°†å¤šä¸ªäº¤æ¢å™¨ç»‘å®šåœ¨ä¸€èµ·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ’ä»¶æœºåˆ¶æ¥å®ç°è‡ªå·±çš„äº¤æ¢å™¨ã€‚è¿™ä¸ªåé¢ä¼šåœ¨æˆ‘ä»¬å°† RabbitMQ æ ¸å¿ƒæ¦‚å¿µçš„æ—¶å€™è¯¦ç»†ä»‹ç»åˆ°ã€‚</li><li><strong>æ‰©å±•æ€§ï¼š</strong> å¤šä¸ªRabbitMQèŠ‚ç‚¹å¯ä»¥ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µåŠ¨æ€åœ°æ‰©å±•é›†ç¾¤ä¸­èŠ‚ç‚¹ã€‚</li><li><strong>é«˜å¯ç”¨æ€§ï¼š</strong> é˜Ÿåˆ—å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„æœºå™¨ä¸Šè®¾ç½®é•œåƒï¼Œä½¿å¾—åœ¨éƒ¨åˆ†èŠ‚ç‚¹å‡ºç°é—®é¢˜çš„æƒ…å†µä¸‹é˜Ÿåˆ—ä»ç„¶å¯ç”¨ã€‚</li><li><strong>æ”¯æŒå¤šç§åè®®ï¼š</strong> RabbitMQ é™¤äº†åŸç”Ÿæ”¯æŒ AMQP åè®®ï¼Œè¿˜æ”¯æŒ STOMPã€MQTT ç­‰å¤šç§æ¶ˆæ¯ä¸­é—´ä»¶åè®®ã€‚</li><li><strong>å¤šè¯­è¨€å®¢æˆ·ç«¯ï¼š</strong> RabbitMQå‡ ä¹æ”¯æŒæ‰€æœ‰å¸¸ç”¨è¯­è¨€ï¼Œæ¯”å¦‚ Javaã€Pythonã€Rubyã€PHPã€C#ã€JavaScriptç­‰ã€‚</li><li><strong>æ˜“ç”¨çš„ç®¡ç†ç•Œé¢ï¼š</strong> RabbitMQæä¾›äº†ä¸€ä¸ªæ˜“ç”¨çš„ç”¨æˆ·ç•Œé¢ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ç›‘æ§å’Œç®¡ç†æ¶ˆæ¯ã€é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ç­‰ã€‚åœ¨å®‰è£… RabbitMQ çš„æ—¶å€™ä¼šä»‹ç»åˆ°ï¼Œå®‰è£…å¥½ RabbitMQ å°±è‡ªå¸¦ç®¡ç†ç•Œé¢ã€‚</li><li><strong>æ’ä»¶æœºåˆ¶ï¼š</strong> RabbitMQ æä¾›äº†è®¸å¤šæ’ä»¶ï¼Œä»¥å®ç°ä»å¤šæ–¹é¢è¿›è¡Œæ‰©å±•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„æ’ä»¶ã€‚æ„Ÿè§‰è¿™ä¸ªæœ‰ç‚¹ç±»ä¼¼ Dubbo çš„ SPIæœºåˆ¶ã€‚</li></ul><h3 id="RabbitMQ-æ ¸å¿ƒæ¦‚å¿µ"><a href="#RabbitMQ-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="RabbitMQ æ ¸å¿ƒæ¦‚å¿µ"></a>RabbitMQ æ ¸å¿ƒæ¦‚å¿µ</h3><p>RabbitMQ æ•´ä½“ä¸Šæ˜¯ä¸€ä¸ªç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å‹ï¼Œä¸»è¦è´Ÿè´£æ¥æ”¶ã€å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯ã€‚å¯ä»¥æŠŠæ¶ˆæ¯ä¼ é€’çš„è¿‡ç¨‹æƒ³è±¡æˆï¼šå½“ä½ å°†ä¸€ä¸ªåŒ…è£¹é€åˆ°é‚®å±€ï¼Œé‚®å±€ä¼šæš‚å­˜å¹¶æœ€ç»ˆå°†é‚®ä»¶é€šè¿‡é‚®é€’å‘˜é€åˆ°æ”¶ä»¶äººçš„æ‰‹ä¸Šï¼ŒRabbitMQå°±å¥½æ¯”ç”±é‚®å±€ã€é‚®ç®±å’Œé‚®é€’å‘˜ç»„æˆçš„ä¸€ä¸ªç³»ç»Ÿã€‚ä»è®¡ç®—æœºæœ¯è¯­å±‚é¢æ¥è¯´ï¼ŒRabbitMQ æ¨¡å‹æ›´åƒæ˜¯ä¸€ç§äº¤æ¢æœºæ¨¡å‹ã€‚</p><p>ä¸‹é¢å†æ¥çœ‹çœ‹å›¾1â€”â€” RabbitMQ çš„æ•´ä½“æ¨¡å‹æ¶æ„ã€‚</p><p><a href="https://camo.githubusercontent.com/e4dfa61a9297b9a679fe5f66ad1543787c759770/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f39363338383534362e6a7067" target="_blank" rel="noopener"><img alt="å›¾1-RabbitMQ çš„æ•´ä½“æ¨¡å‹æ¶æ„" data-src="https://camo.githubusercontent.com/e4dfa61a9297b9a679fe5f66ad1543787c759770/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f39363338383534362e6a7067" class="lazyload"></a></p><p>ä¸‹é¢æˆ‘ä¼šä¸€ä¸€ä»‹ç»ä¸Šå›¾ä¸­çš„ä¸€äº›æ¦‚å¿µã€‚</p><h4 id="Producer-å’Œ-Consumer"><a href="#Producer-å’Œ-Consumer" class="headerlink" title="Producer å’Œ Consumer"></a>Producer å’Œ Consumer</h4><ul><li><strong>Producer(ç”Ÿäº§è€…)</strong> :ç”Ÿäº§æ¶ˆæ¯çš„ä¸€æ–¹ï¼ˆé‚®ä»¶æŠ•é€’è€…ï¼‰</li><li><strong>Consumer(æ¶ˆè´¹è€…)</strong> :æ¶ˆè´¹æ¶ˆæ¯çš„ä¸€æ–¹ï¼ˆé‚®ä»¶æ”¶ä»¶äººï¼‰</li></ul><p>æ¶ˆæ¯ä¸€èˆ¬ç”± 2 éƒ¨åˆ†ç»„æˆï¼š<strong>æ¶ˆæ¯å¤´</strong>ï¼ˆæˆ–è€…è¯´æ˜¯æ ‡ç­¾ Labelï¼‰å’Œ <strong>æ¶ˆæ¯ä½“</strong>ã€‚æ¶ˆæ¯ä½“ä¹Ÿå¯ä»¥ç§°ä¸º payLoad ,æ¶ˆæ¯ä½“æ˜¯ä¸é€æ˜çš„ï¼Œè€Œæ¶ˆæ¯å¤´åˆ™ç”±ä¸€ç³»åˆ—çš„å¯é€‰å±æ€§ç»„æˆï¼Œè¿™äº›å±æ€§åŒ…æ‹¬ routing-keyï¼ˆè·¯ç”±é”®ï¼‰ã€priorityï¼ˆç›¸å¯¹äºå…¶ä»–æ¶ˆæ¯çš„ä¼˜å…ˆæƒï¼‰ã€delivery-modeï¼ˆæŒ‡å‡ºè¯¥æ¶ˆæ¯å¯èƒ½éœ€è¦æŒä¹…æ€§å­˜å‚¨ï¼‰ç­‰ã€‚ç”Ÿäº§è€…æŠŠæ¶ˆæ¯äº¤ç”± RabbitMQ åï¼ŒRabbitMQ ä¼šæ ¹æ®æ¶ˆæ¯å¤´æŠŠæ¶ˆæ¯å‘é€ç»™æ„Ÿå…´è¶£çš„ Consumer(æ¶ˆè´¹è€…)ã€‚</p><h4 id="Exchange-äº¤æ¢å™¨"><a href="#Exchange-äº¤æ¢å™¨" class="headerlink" title="Exchange(äº¤æ¢å™¨)"></a>Exchange(äº¤æ¢å™¨)</h4><p>åœ¨ RabbitMQ ä¸­ï¼Œæ¶ˆæ¯å¹¶ä¸æ˜¯ç›´æ¥è¢«æŠ•é€’åˆ° <strong>Queue(æ¶ˆæ¯é˜Ÿåˆ—)</strong> ä¸­çš„ï¼Œä¸­é—´è¿˜å¿…é¡»ç»è¿‡ <strong>Exchange(äº¤æ¢å™¨)</strong> è¿™ä¸€å±‚ï¼Œ<strong>Exchange(äº¤æ¢å™¨)</strong> ä¼šæŠŠæˆ‘ä»¬çš„æ¶ˆæ¯åˆ†é…åˆ°å¯¹åº”çš„ <strong>Queue(æ¶ˆæ¯é˜Ÿåˆ—)</strong> ä¸­ã€‚</p><p><strong>Exchange(äº¤æ¢å™¨)</strong> ç”¨æ¥æ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯å¹¶å°†è¿™äº›æ¶ˆæ¯è·¯ç”±ç»™æœåŠ¡å™¨ä¸­çš„é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœè·¯ç”±ä¸åˆ°ï¼Œæˆ–è®¸ä¼šè¿”å›ç»™ <strong>Producer(ç”Ÿäº§è€…)</strong> ï¼Œæˆ–è®¸ä¼šè¢«ç›´æ¥ä¸¢å¼ƒæ‰ ã€‚è¿™é‡Œå¯ä»¥å°†RabbitMQä¸­çš„äº¤æ¢å™¨çœ‹ä½œä¸€ä¸ªç®€å•çš„å®ä½“ã€‚</p><p><strong>RabbitMQ çš„ Exchange(äº¤æ¢å™¨) æœ‰4ç§ç±»å‹ï¼Œä¸åŒçš„ç±»å‹å¯¹åº”ç€ä¸åŒçš„è·¯ç”±ç­–ç•¥</strong>ï¼š<strong>direct(é»˜è®¤)</strong>ï¼Œ<strong>fanout</strong>, <strong>topic</strong>, å’Œ <strong>headers</strong>ï¼Œä¸åŒç±»å‹çš„Exchangeè½¬å‘æ¶ˆæ¯çš„ç­–ç•¥æœ‰æ‰€åŒºåˆ«ã€‚è¿™ä¸ªä¼šåœ¨ä»‹ç» <strong>Exchange Types(äº¤æ¢å™¨ç±»å‹)</strong> çš„æ—¶å€™ä»‹ç»åˆ°ã€‚</p><p>Exchange(äº¤æ¢å™¨) ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><a href="https://camo.githubusercontent.com/f8c9661d91d632c2744bea0649333a5d0f2ce898/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f32343030373839392e6a7067" target="_blank" rel="noopener"><img alt="Exchange(äº¤æ¢å™¨) ç¤ºæ„å›¾" data-src="https://camo.githubusercontent.com/f8c9661d91d632c2744bea0649333a5d0f2ce898/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f32343030373839392e6a7067" class="lazyload"></a></p><p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘ç»™äº¤æ¢å™¨çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šæŒ‡å®šä¸€ä¸ª <code>RoutingKey(è·¯ç”±é”®)</code>*<em>ï¼Œç”¨æ¥æŒ‡å®šè¿™ä¸ªæ¶ˆæ¯çš„è·¯ç”±è§„åˆ™ï¼Œè€Œè¿™ä¸ª *</em>RoutingKey éœ€è¦ä¸äº¤æ¢å™¨ç±»å‹å’Œç»‘å®šé”®(<code>BindingKey</code>)è”åˆä½¿ç”¨æ‰èƒ½æœ€ç»ˆç”Ÿæ•ˆã€‚</p><p>RabbitMQ ä¸­é€šè¿‡ <strong>Binding(ç»‘å®š)</strong> å°† <strong>Exchange(äº¤æ¢å™¨)</strong> ä¸ <strong>Queue(æ¶ˆæ¯é˜Ÿåˆ—)</strong> å…³è”èµ·æ¥ï¼Œåœ¨ç»‘å®šçš„æ—¶å€™ä¸€èˆ¬ä¼šæŒ‡å®šä¸€ä¸ª <strong>BindingKey(ç»‘å®šå»º)</strong> ,è¿™æ · RabbitMQ å°±çŸ¥é“å¦‚ä½•æ­£ç¡®å°†æ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ—äº†,å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä¸€ä¸ªç»‘å®šå°±æ˜¯åŸºäºè·¯ç”±é”®å°†äº¤æ¢å™¨å’Œæ¶ˆæ¯é˜Ÿåˆ—è¿æ¥èµ·æ¥çš„è·¯ç”±è§„åˆ™ï¼Œæ‰€ä»¥å¯ä»¥å°†äº¤æ¢å™¨ç†è§£æˆä¸€ä¸ªç”±ç»‘å®šæ„æˆçš„è·¯ç”±è¡¨ã€‚Exchange å’Œ Queue çš„ç»‘å®šå¯ä»¥æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚</p><p>Binding(ç»‘å®š) ç¤ºæ„å›¾ï¼š</p><p><a href="https://camo.githubusercontent.com/effb1066045c449b5439ef94412bef331e912644/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f37303535333133342e6a7067" target="_blank" rel="noopener"><img alt="Binding(ç»‘å®š) ç¤ºæ„å›¾" data-src="https://camo.githubusercontent.com/effb1066045c449b5439ef94412bef331e912644/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f37303535333133342e6a7067" class="lazyload"></a></p><p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢å™¨æ—¶ï¼Œ==éœ€è¦ä¸€ä¸ªRoutingKey,å½“ BindingKey å’Œ RoutingKey ç›¸åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­==ã€‚åœ¨ç»‘å®šå¤šä¸ªé˜Ÿåˆ—åˆ°åŒä¸€ä¸ªäº¤æ¢å™¨çš„æ—¶å€™ï¼Œè¿™äº›ç»‘å®šå…è®¸ä½¿ç”¨ç›¸åŒçš„ BindingKeyã€‚BindingKey å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰çš„æƒ…å†µä¸‹éƒ½ç”Ÿæ•ˆï¼Œå®ƒä¾èµ–äºäº¤æ¢å™¨ç±»å‹ï¼Œæ¯”å¦‚fanoutç±»å‹çš„äº¤æ¢å™¨å°±ä¼šæ— è§†ï¼Œè€Œæ˜¯å°†æ¶ˆæ¯è·¯ç”±åˆ°æ‰€æœ‰ç»‘å®šåˆ°è¯¥äº¤æ¢å™¨çš„é˜Ÿåˆ—ä¸­ã€‚</p><h4 id="channel"><a href="#channel" class="headerlink" title="channel"></a>channel</h4><p>ç®€å•ç†è§£ï¼š==ä¿¡é“æ˜¯connectionåŸºäºNIOçš„ä¼˜åŒ–å‡çº§ï¼Œå®ç°è¿æ¥å¤ç”¨==ã€‚</p><p>ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­æœ‰å¾ˆå¤šä¸ªçº¿ç¨‹éœ€è¦ä»RabbitMQ ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œæˆ–è€…ç”Ÿäº§æ¶ˆæ¯ï¼Œé‚£ä¹ˆå¿…ç„¶éœ€è¦å»ºç«‹å¾ˆå¤šä¸ªConnection ï¼Œä¹Ÿå°±æ˜¯è®¸å¤šä¸ªTCP è¿æ¥ã€‚ç„¶è€Œå¯¹äºæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå»ºç«‹å’Œé”€æ¯TCP è¿æ¥æ˜¯éå¸¸æ˜‚è´µçš„å¼€é”€ï¼Œå¦‚æœé‡åˆ°ä½¿ç”¨é«˜å³°ï¼Œæ€§èƒ½ç“¶é¢ˆä¹Ÿéšä¹‹æ˜¾ç°ã€‚RabbitMQ é‡‡ç”¨ç±»ä¼¼NIOâ€™ (Non-blocking 1/0) çš„åšæ³•ï¼Œé€‰æ‹©TCP è¿æ¥å¤ç”¨ï¼Œä¸ä»…å¯ä»¥å‡å°‘æ€§èƒ½å¼€é”€ï¼ŒåŒæ—¶ä¹Ÿä¾¿äºç®¡ç†ã€‚</p><p>æ¯ä¸ªçº¿ç¨‹æŠŠæŒä¸€ä¸ªä¿¡é“ï¼Œæ‰€ä»¥ä¿¡é“å¤ç”¨äº†Connection çš„TCP è¿æ¥ã€‚åŒæ—¶RabbitMQ å¯ä»¥ç¡®ä¿æ¯ä¸ªçº¿ç¨‹çš„ç§å¯†æ€§ï¼Œå°±åƒæ‹¥æœ‰ç‹¬ç«‹çš„è¿æ¥ä¸€æ ·ã€‚å½“æ¯ä¸ªä¿¡é“çš„æµé‡ä¸æ˜¯å¾ˆå¤§æ—¶ï¼Œå¤ç”¨å•ä¸€çš„Connection å¯ä»¥åœ¨äº§ç”Ÿæ€§èƒ½ç“¶é¢ˆçš„æƒ…å†µä¸‹æœ‰æ•ˆåœ°èŠ‚çœTCP è¿æ¥èµ„æºã€‚ä½†æ˜¯å½“ä¿¡é“æœ¬èº«çš„æµé‡å¾ˆå¤§æ—¶ï¼Œè¿™æ—¶å€™å¤šä¸ªä¿¡é“å¤ç”¨ä¸€ä¸ªConnection å°±ä¼šäº§ç”Ÿæ€§èƒ½ç“¶é¢ˆï¼Œè¿›è€Œä½¿æ•´ä½“çš„æµé‡è¢«é™åˆ¶äº†ã€‚æ­¤æ—¶å°±éœ€è¦å¼€è¾Ÿå¤šä¸ªConnection ï¼Œå°†è¿™äº›ä¿¡é“å‡æ‘Šåˆ°è¿™äº›Connection ä¸­ï¼Œ è‡³äºè¿™äº›ç›¸å…³çš„è°ƒä¼˜ç­–ç•¥éœ€è¦æ ¹æ®ä¸šåŠ¡è‡ªèº«çš„å®é™…æƒ…å†µè¿›è¡Œè°ƒèŠ‚ã€‚</p><p><strong>RabbitMQ ä¸ºä»€ä¹ˆéœ€è¦ä¿¡é“ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯TCPç›´æ¥é€šä¿¡ï¼Ÿ</strong></p><ol><li><p>TCPçš„åˆ›å»ºå’Œé”€æ¯ï¼Œå¼€é”€å¤§ï¼Œåˆ›å»ºéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œé”€æ¯éœ€è¦å››æ¬¡åˆ†æ‰‹</p></li><li><p>å¦‚æœä¸ä½¿ç”¨ä¿¡é“ï¼Œé‚£ä¹ˆå¼•ç”¨ç¨‹åºå°±ä¼šä½¿ç”¨TCPçš„æ–¹å¼è¿æ¥åˆ°rabbitmqï¼Œé«˜å³°æ—¶æ¯ç§’æˆåƒä¸Šä¸‡æ¡è¿æ¥ä¼šé€ æˆèµ„æºçš„å·¨å¤§æµªè´¹(ä¸€æ¡tcpæ¶ˆè€—èµ„æºï¼Œæˆåƒä¸Šä¸‡çš„tcpä¼šéå¸¸æ¶ˆè€—èµ„æº)ï¼Œè€Œä¸”æ“ä½œç³»ç»Ÿæ¯ç§’å¤„ç†TCPè¿æ¥æ•°é‡ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå¿…å®šä¼šé€ æˆæ€§èƒ½ç“¶é¢ˆ</p></li><li><p>ä¿¡é“çš„åŸç†æ˜¯ä¸€æ¡çº¿ç¨‹ä¸€æ¡ä¿¡é“ï¼Œå¤šæ¡çº¿ç¨‹å¤šæ¡ä¿¡é“å…±åŒä½¿ç”¨ä¸€æ¡TCPè¿æ¥ã€‚ä¸€æ¡TCPè¿æ¥å¯ä»¥å®¹çº³æ— é™çš„ä¿¡é“ï¼ŒåŠæ—¶æ¯ç§’é€ æˆæˆåƒä¸Šä¸‡çš„è¯·æ±‚ä¹Ÿä¸ä¼šé€ æˆæ€§èƒ½ç“¶é¢ˆ</p></li></ol><h4 id="Queue-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#Queue-æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="Queue(æ¶ˆæ¯é˜Ÿåˆ—)"></a>Queue(æ¶ˆæ¯é˜Ÿåˆ—)</h4><p><strong>Queue(æ¶ˆæ¯é˜Ÿåˆ—)</strong> ç”¨æ¥ä¿å­˜æ¶ˆæ¯ç›´åˆ°å‘é€ç»™æ¶ˆè´¹è€…ã€‚å®ƒæ˜¯æ¶ˆæ¯çš„å®¹å™¨ï¼Œä¹Ÿæ˜¯æ¶ˆæ¯çš„ç»ˆç‚¹ã€‚ä¸€ä¸ªæ¶ˆæ¯å¯æŠ•å…¥ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚æ¶ˆæ¯ä¸€ç›´åœ¨é˜Ÿåˆ—é‡Œé¢ï¼Œç­‰å¾…æ¶ˆè´¹è€…è¿æ¥åˆ°è¿™ä¸ªé˜Ÿåˆ—å°†å…¶å–èµ°ã€‚</p><p><strong>RabbitMQ</strong> ä¸­æ¶ˆæ¯åªèƒ½å­˜å‚¨åœ¨ <strong>é˜Ÿåˆ—</strong> ä¸­ï¼Œè¿™ä¸€ç‚¹å’Œ <strong>Kafka</strong> è¿™ç§æ¶ˆæ¯ä¸­é—´ä»¶ç›¸åã€‚Kafka å°†æ¶ˆæ¯å­˜å‚¨åœ¨ <strong>topicï¼ˆä¸»é¢˜ï¼‰</strong> è¿™ä¸ªé€»è¾‘å±‚é¢ï¼Œè€Œç›¸å¯¹åº”çš„é˜Ÿåˆ—é€»è¾‘åªæ˜¯topicå®é™…å­˜å‚¨æ–‡ä»¶ä¸­çš„ä½ç§»æ ‡è¯†ã€‚ RabbitMQ çš„ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯å¹¶æœ€ç»ˆæŠ•é€’åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…å¯ä»¥ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯å¹¶æ¶ˆè´¹ã€‚</p><p><strong>å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…åŒä¸€ä¸ªé˜Ÿåˆ—</strong>ï¼Œè¿™æ—¶é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šè¢«å¹³å‡åˆ†æ‘Šï¼ˆRound-Robinï¼Œå³è½®è¯¢ï¼‰ç»™å¤šä¸ªæ¶ˆè´¹è€…è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯æ¯ä¸ªæ¶ˆè´¹è€…éƒ½æ”¶åˆ°æ‰€æœ‰çš„æ¶ˆæ¯å¹¶å¤„ç†ï¼Œè¿™æ ·é¿å…çš„æ¶ˆæ¯è¢«é‡å¤æ¶ˆè´¹ã€‚</p><p><strong>RabbitMQ</strong> ä¸æ”¯æŒé˜Ÿåˆ—å±‚é¢çš„å¹¿æ’­æ¶ˆè´¹,å¦‚æœæœ‰å¹¿æ’­æ¶ˆè´¹çš„éœ€æ±‚ï¼Œéœ€è¦åœ¨å…¶ä¸Šè¿›è¡ŒäºŒæ¬¡å¼€å‘,è¿™æ ·ä¼šå¾ˆéº»çƒ¦ï¼Œä¸å»ºè®®è¿™æ ·åšã€‚</p><h4 id="Brokerï¼ˆæ¶ˆæ¯ä¸­é—´ä»¶çš„æœåŠ¡èŠ‚ç‚¹ï¼‰"><a href="#Brokerï¼ˆæ¶ˆæ¯ä¸­é—´ä»¶çš„æœåŠ¡èŠ‚ç‚¹ï¼‰" class="headerlink" title="Brokerï¼ˆæ¶ˆæ¯ä¸­é—´ä»¶çš„æœåŠ¡èŠ‚ç‚¹ï¼‰"></a>Brokerï¼ˆæ¶ˆæ¯ä¸­é—´ä»¶çš„æœåŠ¡èŠ‚ç‚¹ï¼‰</h4><p>å¯¹äº RabbitMQ æ¥è¯´ï¼Œä¸€ä¸ª RabbitMQ Broker å¯ä»¥ç®€å•åœ°çœ‹ä½œä¸€ä¸ª RabbitMQ æœåŠ¡èŠ‚ç‚¹ï¼Œæˆ–è€…RabbitMQæœåŠ¡å®ä¾‹ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ä¹Ÿå¯ä»¥å°†ä¸€ä¸ª RabbitMQ Broker çœ‹ä½œä¸€å° RabbitMQ æœåŠ¡å™¨ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†ç”Ÿäº§è€…å°†æ¶ˆæ¯å­˜å…¥ RabbitMQ Broker,ä»¥åŠæ¶ˆè´¹è€…ä»Brokerä¸­æ¶ˆè´¹æ•°æ®çš„æ•´ä¸ªæµç¨‹ã€‚</p><p><a href="https://camo.githubusercontent.com/6f3125fb04c98886209d26d4e904ce4c4c7343ad/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f36373935323932322e6a7067" target="_blank" rel="noopener"><img alt="æ¶ˆæ¯é˜Ÿåˆ—çš„è¿è½¬è¿‡ç¨‹" data-src="https://camo.githubusercontent.com/6f3125fb04c98886209d26d4e904ce4c4c7343ad/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f36373935323932322e6a7067" class="lazyload"></a></p><p>è¿™æ ·å›¾1ä¸­çš„ä¸€äº›å…³äº RabbitMQ çš„åŸºæœ¬æ¦‚å¿µæˆ‘ä»¬å°±ä»‹ç»å®Œæ¯•äº†ï¼Œä¸‹é¢å†æ¥ä»‹ç»ä¸€ä¸‹ <strong>Exchange Types(äº¤æ¢å™¨ç±»å‹)</strong> ã€‚</p><h4 id="vhost-è™šæ‹Ÿä¸»æœº"><a href="#vhost-è™šæ‹Ÿä¸»æœº" class="headerlink" title="vhost(è™šæ‹Ÿä¸»æœº)"></a>vhost(è™šæ‹Ÿä¸»æœº)</h4><p>è™šæ‹Ÿä¸»æœºï¼Œä¸€ä¸ªæ¶ˆæ¯ä»£ç†ï¼ˆBrokerï¼‰é‡Œå¯ä»¥å¼€è®¾å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ï¼Œç”¨ä½œä¸åŒç”¨æˆ·çš„æƒé™åˆ†ç¦»ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå­æ•°æ®åº“</p><h4 id="Exchange-Types-äº¤æ¢å™¨ç±»å‹"><a href="#Exchange-Types-äº¤æ¢å™¨ç±»å‹" class="headerlink" title="Exchange Types(äº¤æ¢å™¨ç±»å‹)"></a>Exchange Types(äº¤æ¢å™¨ç±»å‹)</h4><p>RabbitMQ å¸¸ç”¨çš„ Exchange Type æœ‰ <strong>fanout</strong>ã€<strong>direct</strong>ã€<strong>topic</strong>ã€<strong>headers</strong> è¿™å››ç§ï¼ˆAMQPè§„èŒƒé‡Œè¿˜æåˆ°ä¸¤ç§ Exchange Typeï¼Œåˆ†åˆ«ä¸º system ä¸ è‡ªå®šä¹‰ï¼Œè¿™é‡Œä¸äºˆä»¥æè¿°ï¼‰ã€‚</p><h5 id="â‘ -fanoutï¼ˆå¹¿æ’­ï¼‰"><a href="#â‘ -fanoutï¼ˆå¹¿æ’­ï¼‰" class="headerlink" title="â‘  fanoutï¼ˆå¹¿æ’­ï¼‰"></a>â‘  fanoutï¼ˆå¹¿æ’­ï¼‰</h5><p>fanout ç±»å‹çš„Exchangeè·¯ç”±è§„åˆ™éå¸¸ç®€å•ï¼Œå®ƒä¼šæŠŠæ‰€æœ‰å‘é€åˆ°è¯¥Exchangeçš„æ¶ˆæ¯è·¯ç”±åˆ°æ‰€æœ‰ä¸å®ƒç»‘å®šçš„Queueä¸­ï¼Œä¸éœ€è¦åšä»»ä½•åˆ¤æ–­æ“ä½œï¼Œæ‰€ä»¥ fanout ç±»å‹æ˜¯æ‰€æœ‰çš„äº¤æ¢æœºç±»å‹é‡Œé¢é€Ÿåº¦æœ€å¿«çš„ã€‚fanout ç±»å‹å¸¸ç”¨æ¥<code>å¹¿æ’­</code>æ¶ˆæ¯ã€‚</p><h5 id="â‘¡-directï¼ˆç²¾å‡†å®šå‘ï¼‰"><a href="#â‘¡-directï¼ˆç²¾å‡†å®šå‘ï¼‰" class="headerlink" title="â‘¡ directï¼ˆç²¾å‡†å®šå‘ï¼‰"></a>â‘¡ directï¼ˆç²¾å‡†å®šå‘ï¼‰</h5><p>direct ç±»å‹çš„Exchangeè·¯ç”±è§„åˆ™ä¹Ÿå¾ˆç®€å•ï¼Œå®ƒä¼šæŠŠæ¶ˆæ¯è·¯ç”±åˆ°é‚£äº› Bindingkey ä¸ RoutingKey å®Œå…¨åŒ¹é…çš„ Queue ä¸­ã€‚</p><p><a href="https://camo.githubusercontent.com/7177328efe9e95372a9b7fb8b51022312d2e601b/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f33373030383032312e6a7067" target="_blank" rel="noopener"><img alt="direct ç±»å‹äº¤æ¢å™¨" data-src="https://camo.githubusercontent.com/7177328efe9e95372a9b7fb8b51022312d2e601b/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f33373030383032312e6a7067" class="lazyload"></a></p><p>ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå¦‚æœå‘é€æ¶ˆæ¯çš„æ—¶å€™è®¾ç½®è·¯ç”±é”®ä¸ºâ€œwarningâ€,é‚£ä¹ˆæ¶ˆæ¯ä¼šè·¯ç”±åˆ° Queue1 å’Œ Queue2ã€‚å¦‚æœåœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™è®¾ç½®è·¯ç”±é”®ä¸ºâ€Infoâ€æˆ–è€…â€debugâ€ï¼Œæ¶ˆæ¯åªä¼šè·¯ç”±åˆ°Queue2ã€‚å¦‚æœä»¥å…¶ä»–çš„è·¯ç”±é”®å‘é€æ¶ˆæ¯ï¼Œåˆ™æ¶ˆæ¯ä¸ä¼šè·¯ç”±åˆ°è¿™ä¸¤ä¸ªé˜Ÿåˆ—ä¸­ã€‚</p><p>direct ç±»å‹å¸¸ç”¨åœ¨<code>å¤„ç†æœ‰ä¼˜å…ˆçº§çš„ä»»åŠ¡</code>ï¼Œæ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§æŠŠæ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ï¼Œè¿™æ ·å¯ä»¥æŒ‡æ´¾æ›´å¤šçš„èµ„æºå»å¤„ç†é«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ã€‚</p><h5 id="â‘¢-topicï¼ˆæ¨¡ç³Šç±»å‹ï¼‰"><a href="#â‘¢-topicï¼ˆæ¨¡ç³Šç±»å‹ï¼‰" class="headerlink" title="â‘¢ topicï¼ˆæ¨¡ç³Šç±»å‹ï¼‰"></a>â‘¢ topicï¼ˆæ¨¡ç³Šç±»å‹ï¼‰</h5><p>å‰é¢è®²åˆ°directç±»å‹çš„äº¤æ¢å™¨è·¯ç”±è§„åˆ™æ˜¯å®Œå…¨åŒ¹é… BindingKey å’Œ RoutingKey ï¼Œå®ƒä¸ direct ç±»å‹çš„äº¤æ¢å™¨ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯å°†æ¶ˆæ¯è·¯ç”±åˆ° BindingKey å’Œ RoutingKey ç›¸åŒ¹é…çš„é˜Ÿåˆ—ä¸­ï¼Œä½†è¿™é‡Œçš„åŒ¹é…è§„åˆ™æœ‰äº›ä¸åŒï¼Œå®ƒçº¦å®šï¼š</p><ul><li>RoutingKey ä¸ºä¸€ä¸ªç‚¹å·â€œï¼â€åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ˆè¢«ç‚¹å·â€œï¼â€åˆ†éš”å¼€çš„æ¯ä¸€æ®µç‹¬ç«‹çš„å­—ç¬¦ä¸²ç§°ä¸ºä¸€ä¸ªå•è¯ï¼‰ï¼Œå¦‚ â€œcom.rabbitmq.clientâ€ã€â€œjava.util.concurrentâ€ã€â€œcom.hidden.clientâ€;</li><li>BindingKey å’Œ RoutingKey ä¸€æ ·ä¹Ÿæ˜¯ç‚¹å·â€œï¼â€åˆ†éš”çš„å­—ç¬¦ä¸²ï¼›</li><li>BindingKey ä¸­å¯ä»¥å­˜åœ¨ä¸¤ç§ç‰¹æ®Šå­—ç¬¦ä¸²â€œ*â€å’Œâ€œ#â€ï¼Œç”¨äºåšæ¨¡ç³ŠåŒ¹é…ï¼Œå…¶ä¸­â€œ*â€ç”¨äºåŒ¹é…ä¸€ä¸ªå•è¯ï¼Œâ€œ#â€ç”¨äºåŒ¹é…å¤šä¸ªå•è¯(å¯ä»¥æ˜¯é›¶ä¸ª)ã€‚</li></ul><p><a href="https://camo.githubusercontent.com/ad72829eb75cde62383a48361e3a77708a80f955/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f37333834332e6a7067" target="_blank" rel="noopener"><img alt="topic ç±»å‹äº¤æ¢å™¨" data-src="https://camo.githubusercontent.com/ad72829eb75cde62383a48361e3a77708a80f955/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f37333834332e6a7067" class="lazyload"></a></p><p>ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼š</p><ul><li>è·¯ç”±é”®ä¸º â€œcom.rabbitmq.clientâ€ çš„æ¶ˆæ¯ä¼šåŒæ—¶è·¯ç”±åˆ° Queuel å’Œ Queue2;</li><li>è·¯ç”±é”®ä¸º â€œcom.hidden.clientâ€ çš„æ¶ˆæ¯åªä¼šè·¯ç”±åˆ° Queue2 ä¸­ï¼›</li><li>è·¯ç”±é”®ä¸º â€œcom.hidden.demoâ€ çš„æ¶ˆæ¯åªä¼šè·¯ç”±åˆ° Queue2 ä¸­ï¼›</li><li>è·¯ç”±é”®ä¸º â€œjava.rabbitmq.demoâ€ çš„æ¶ˆæ¯åªä¼šè·¯ç”±åˆ°Queuelä¸­ï¼›</li><li>è·¯ç”±é”®ä¸º â€œjava.util.concurrentâ€ çš„æ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒæˆ–è€…è¿”å›ç»™ç”Ÿäº§è€…ï¼ˆéœ€è¦è®¾ç½® mandatory å‚æ•°ï¼‰ï¼Œå› ä¸ºå®ƒæ²¡æœ‰åŒ¹é…ä»»ä½•è·¯ç”±é”®ã€‚</li></ul><h5 id="â‘£-headers-ä¸æ¨è"><a href="#â‘£-headers-ä¸æ¨è" class="headerlink" title="â‘£ headers(ä¸æ¨è)"></a>â‘£ headers(ä¸æ¨è)</h5><p>headers ç±»å‹çš„äº¤æ¢å™¨ä¸ä¾èµ–äºè·¯ç”±é”®çš„åŒ¹é…è§„åˆ™æ¥è·¯ç”±æ¶ˆæ¯ï¼Œè€Œæ˜¯æ ¹æ®å‘é€çš„æ¶ˆæ¯å†…å®¹ä¸­çš„ headers å±æ€§è¿›è¡ŒåŒ¹é…ã€‚åœ¨ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢å™¨æ—¶åˆ¶å®šä¸€ç»„é”®å€¼å¯¹ï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢å™¨æ—¶ï¼ŒRabbitMQä¼šè·å–åˆ°è¯¥æ¶ˆæ¯çš„ headersï¼ˆä¹Ÿæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„å½¢å¼)â€™å¯¹æ¯”å…¶ä¸­çš„é”®å€¼å¯¹æ˜¯å¦å®Œå…¨åŒ¹é…é˜Ÿåˆ—å’Œäº¤æ¢å™¨ç»‘å®šæ—¶æŒ‡å®šçš„é”®å€¼å¯¹ï¼Œå¦‚æœå®Œå…¨åŒ¹é…åˆ™æ¶ˆæ¯ä¼šè·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ï¼Œå¦åˆ™ä¸ä¼šè·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚headers ç±»å‹çš„äº¤æ¢å™¨æ€§èƒ½ä¼šå¾ˆå·®ï¼Œè€Œä¸”ä¹Ÿä¸å®ç”¨ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šçœ‹åˆ°å®ƒçš„å­˜åœ¨ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>1ã€ä¿¡é“æ‰æ˜¯rabbité€šä¿¡æœ¬è´¨ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½æ˜¯é€šè¿‡ä¿¡é“å®Œæˆæ¶ˆæ¯ç”Ÿäº§æ¶ˆè´¹çš„ã€‚</p><p>2ã€äº¤æ¢å™¨æœ¬è´¨æ˜¯ä¸€å¼ è·¯ç”±æŸ¥è¯¢è¡¨ï¼ˆåç§°å’Œé˜Ÿåˆ—idï¼Œç±»ä¼¼äºhashè¡¨ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿå‡ºæ¥çš„ä¸œè¥¿ï¼Œå¹¶ä¸å­˜åœ¨çœŸå®çš„äº¤æ¢å™¨ã€‚</p><p>3ã€æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸï¼šç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯A äº¤ç”±ä¿¡é“ï¼Œä¿¡é“é€šè¿‡æ¶ˆæ¯ï¼ˆæ¶ˆæ¯ç”±è½½ä½“å’Œæ ‡ç­¾ï¼‰çš„æ ‡ç­¾ï¼ˆè·¯ç”±é”®ï¼‰æ”¾åˆ°äº¤æ¢å™¨å‘é€åˆ°é˜Ÿåˆ—ä¸Šï¼ˆå…¶å®å°±æ˜¯æŸ¥è¯¢åŒ¹é…ï¼Œä¸€æ—¦åŒ¹é…åˆ°äº†è§„åˆ™ï¼Œä¿¡é“å°±ç›´æ¥å’Œé˜Ÿåˆ—äº§ç”Ÿè¿æ¥ï¼Œç„¶åå°†æ¶ˆæ¯å‘é€è¿‡å»ï¼‰</p><p>4ã€Channelæ˜¯æˆ‘ä»¬ä¸RabbitMQæ‰“äº¤é“çš„æœ€é‡è¦çš„ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¤§éƒ¨åˆ†çš„ä¸šåŠ¡æ“ä½œæ˜¯åœ¨Channelè¿™ä¸ªæ¥å£ä¸­å®Œæˆçš„ï¼ŒåŒ…æ‹¬å®šä¹‰Queueã€å®šä¹‰Exchangeã€ç»‘å®šQueueä¸Exchangeã€å‘å¸ƒæ¶ˆæ¯ç­‰ã€‚</p><h2 id="å®‰è£…-RabbitMq"><a href="#å®‰è£…-RabbitMq" class="headerlink" title="å®‰è£… RabbitMq"></a>å®‰è£… RabbitMq</h2><p>é€šè¿‡ Docker å®‰è£…éå¸¸æ–¹ä¾¿ï¼Œåªéœ€è¦å‡ æ¡å‘½ä»¤å°±å¥½äº†ï¼Œæˆ‘è¿™é‡Œæ˜¯åªè¯´ä¸€ä¸‹å¸¸è§„å®‰è£…æ–¹æ³•ã€‚</p><p>å‰é¢æåˆ°äº† RabbitMQ æ˜¯ç”± Erlangè¯­è¨€ç¼–å†™çš„ï¼Œä¹Ÿæ­£å› å¦‚æ­¤ï¼Œåœ¨å®‰è£…RabbitMQ ä¹‹å‰éœ€è¦å®‰è£… Erlangã€‚</p><p>æ³¨æ„ï¼šåœ¨å®‰è£… RabbitMQ çš„æ—¶å€™éœ€è¦æ³¨æ„ RabbitMQ å’Œ Erlang çš„ç‰ˆæœ¬å…³ç³»ï¼Œå¦‚æœä¸æ³¨æ„çš„è¯ä¼šå¯¼è‡´å‡ºé”™ï¼Œä¸¤è€…å¯¹åº”å…³ç³»å¦‚ä¸‹:</p><p><a href="https://camo.githubusercontent.com/4c0efb8ab3642847c70512cdd91e3aac49c4ef52/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d332f5261626269744d512d45726c616e672e706e67" target="_blank" rel="noopener"><img alt="RabbitMQ å’Œ Erlang çš„ç‰ˆæœ¬å…³ç³»" data-src="https://camo.githubusercontent.com/4c0efb8ab3642847c70512cdd91e3aac49c4ef52/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d332f5261626269744d512d45726c616e672e706e67" class="lazyload"></a></p><h3 id="å®‰è£…-erlang"><a href="#å®‰è£…-erlang" class="headerlink" title="å®‰è£… erlang"></a>å®‰è£… erlang</h3><p><strong>1 ä¸‹è½½ erlang å®‰è£…åŒ…</strong></p><p>åœ¨å®˜ç½‘ä¸‹è½½ç„¶åä¸Šä¼ åˆ° Linux ä¸Šæˆ–è€…ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬ã€‚</p><pre><code class="powershell">[root@SnailClimb local]#wget http://erlang.org/download/otp_src_19.3.tar.gz</code></pre><p>erlang å®˜ç½‘ä¸‹è½½ï¼š<a href="http://www.erlang.org/downloads" target="_blank" rel="noopener">http://www.erlang.org/downloads</a></p><p><strong>2 è§£å‹ erlang å®‰è£…åŒ…</strong></p><pre><code>[root@SnailClimb local]#tar -xvzf otp_src_19.3.tar.gz</code></pre><p><strong>3 åˆ é™¤ erlang å®‰è£…åŒ…</strong></p><pre><code>[root@SnailClimb local]#rm -rf otp_src_19.3.tar.gz</code></pre><p><strong>4 å®‰è£… erlang çš„ä¾èµ–å·¥å…·</strong></p><pre><code class="shell">[root@SnailClimb local]#yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel openssl-devel unixODBC-devel</code></pre><p><strong>5 è¿›å…¥erlang å®‰è£…åŒ…è§£å‹æ–‡ä»¶å¯¹ erlang è¿›è¡Œå®‰è£…ç¯å¢ƒçš„é…ç½®</strong></p><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</p><pre><code class="shell">[root@SnailClimb local]# mkdir /usr/local/erlang</code></pre><p>å¯¹ erlang è¿›è¡Œå®‰è£…ç¯å¢ƒçš„é…ç½®</p><pre><code class="shell">[root@SnailClimb otp_src_19.3]# ./configure --prefix=/usr/local/erlang --without-javac</code></pre><p><strong>6 ç¼–è¯‘å®‰è£…</strong></p><pre><code class="shell">[root@SnailClimb otp_src_19.3]# make &amp;&amp; make install</code></pre><p><strong>7 éªŒè¯ä¸€ä¸‹ erlang æ˜¯å¦å®‰è£…æˆåŠŸäº†</strong></p><pre><code>[root@SnailClimb otp_src_19.3]# ./bin/erl</code></pre><p>è¿è¡Œä¸‹é¢çš„è¯­å¥è¾“å‡ºâ€œhello worldâ€</p><pre><code> io:format(&quot;hello world~n&quot;, []).</code></pre><p><a href="https://camo.githubusercontent.com/30edcba9ad0d03b29f5e35991f758378d18a4a73/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31322f34393537303534312e6a7067" target="_blank" rel="noopener"><img alt="è¾“å‡ºâ€œhello worldâ€" data-src="https://camo.githubusercontent.com/30edcba9ad0d03b29f5e35991f758378d18a4a73/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31322f34393537303534312e6a7067" class="lazyload"></a></p><p>å¤§åŠŸå‘Šæˆï¼Œæˆ‘ä»¬çš„ erlang å·²ç»å®‰è£…å®Œæˆã€‚</p><p><strong>8 é…ç½® erlang ç¯å¢ƒå˜é‡</strong></p><pre><code>[root@SnailClimb etc]# vim profile</code></pre><p>è¿½åŠ ä¸‹åˆ—ç¯å¢ƒå˜é‡åˆ°æ–‡ä»¶æœ«å°¾</p><pre><code>#erlangERL_HOME=/usr/local/erlangPATH=$ERL_HOME/bin:$PATHexport ERL_HOME PATH</code></pre><p>è¿è¡Œä¸‹åˆ—å‘½ä»¤ä½¿é…ç½®æ–‡ä»¶<code>profile</code>ç”Ÿæ•ˆ</p><pre><code>[root@SnailClimb etc]# source /etc/profile</code></pre><p>è¾“å…¥ erl æŸ¥çœ‹ erlang ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æ­£ç¡®</p><pre><code>[root@SnailClimb etc]# erl</code></pre><p><a href="https://camo.githubusercontent.com/6762285cc92cf37942eaa086269654106518e087/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31322f36323530343234362e6a7067" target="_blank" rel="noopener"><img alt="è¾“å…¥ erl æŸ¥çœ‹ erlang ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æ­£ç¡®" data-src="https://camo.githubusercontent.com/6762285cc92cf37942eaa086269654106518e087/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31322f36323530343234362e6a7067" class="lazyload"></a></p><h3 id="å®‰è£…-RabbitMQ"><a href="#å®‰è£…-RabbitMQ" class="headerlink" title="å®‰è£… RabbitMQ"></a>å®‰è£… RabbitMQ</h3><p><strong>1. ä¸‹è½½rpm</strong></p><pre><code>wget https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.8/rabbitmq-server-3.6.8-1.el7.noarch.rpm</code></pre><p>æˆ–è€…ç›´æ¥åœ¨å®˜ç½‘ä¸‹è½½</p><p><a href="https://www.rabbitmq.com/install-rpm.html" target="_blank" rel="noopener">https://www.rabbitmq.com/install-rpm.html</a></p><p><strong>2. å®‰è£…rpm</strong></p><pre><code>rpm --import https://www.rabbitmq.com/rabbitmq-release-signing-key.asc# å®‰è£…socatyum -y install socat ##æ­¤æ—¶ä¼šæŠ¥é”™æ²¡æœ‰socatåŒ…æˆ–æ˜¯æ‰¾ä¸åˆ°socatåŒ…ï¼Œè§£å†³æ–¹æ³•å®‰è£…centosçš„epelçš„æ‰©å±•æºyum -y install epel-release  ##ä¹‹åé‡æ–°å®‰è£…socatyum -y install socat</code></pre><p>ç´§æ¥ç€æ‰§è¡Œï¼š</p><pre><code>yum install rabbitmq-server-3.6.8-1.el7.noarch.rpm</code></pre><p>ä¸­é€”éœ€è¦ä½ è¾“å…¥â€yâ€æ‰èƒ½ç»§ç»­å®‰è£…ã€‚</p><p><strong>3 å¼€å¯ web ç®¡ç†æ’ä»¶</strong></p><pre><code>rabbitmq-plugins enable rabbitmq_management</code></pre><p>å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p><p><img alt="image-20200523105232373" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf271s1sjsj317m0bc42d.jpg" class="lazyload"></p><p>é‡å¯è§£å†³</p><p>service rabbitmq-server restart </p><p>4 è®¾ç½®å¼€æœºå¯åŠ¨</p><pre><code>chkconfig rabbitmq-server on</code></pre><p>5 å¯åŠ¨æœåŠ¡</p><pre><code>service rabbitmq-server start</code></pre><p>6 æŸ¥çœ‹æœåŠ¡çŠ¶æ€</p><pre><code>service rabbitmq-server status</code></pre><p><strong>7. è®¿é—® RabbitMQ æ§åˆ¶å°</strong></p><p>æµè§ˆå™¨è®¿é—®ï¼š<a href="http://xn--ip-0p3ck01akcu41v:15672/" target="_blank" rel="noopener">http://ä½ çš„ipåœ°å€:15672/</a></p><p>é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼š guest/guest;ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼šguestuestç”¨æˆ·åªæ˜¯è¢«å®¹è®¸ä»localhostè®¿é—®ã€‚å®˜ç½‘æ–‡æ¡£æè¿°å¦‚ä¸‹ï¼š</p><pre><code>â€œguestâ€ user can only connect via localhost</code></pre><p><strong>è§£å†³è¿œç¨‹è®¿é—® RabbitMQ è¿œç¨‹è®¿é—®å¯†ç é”™è¯¯</strong></p><p>æ–°å»ºç”¨æˆ·å¹¶æˆæƒ</p><pre><code>[root@SnailClimb rabbitmq]# rabbitmqctl add_user root rootCreating user &quot;root&quot; ...[root@SnailClimb rabbitmq]# rabbitmqctl set_user_tags root administratorSetting tags for user &quot;root&quot; to [administrator] ...[root@SnailClimb rabbitmq]# [root@SnailClimb rabbitmq]# rabbitmqctl set_permissions -p / root &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;Setting permissions for user &quot;root&quot; in vhost &quot;/&quot; ...</code></pre><p>å†æ¬¡è®¿é—®:<a href="http://xn--ip-0p3ck01akcu41v:15672/" target="_blank" rel="noopener">http://ä½ çš„ipåœ°å€:15672/</a> ,è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼šroot root</p><p><a href="https://camo.githubusercontent.com/7baff40cce00e7196515229aed0cfada49e186bb/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31322f34353833353333322e6a7067" target="_blank" rel="noopener"><img alt="RabbitMQæ§åˆ¶å°" data-src="https://camo.githubusercontent.com/7baff40cce00e7196515229aed0cfada49e186bb/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31322f34353833353333322e6a7067" class="lazyload"></a></p><h3 id="åˆ›å»ºVirtual-Hosts"><a href="#åˆ›å»ºVirtual-Hosts" class="headerlink" title="åˆ›å»ºVirtual Hosts"></a>åˆ›å»ºVirtual Hosts</h3><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf2gws378yj31gt0hxdh0.jpg" class="lazyload"></p><p>é€‰ä¸­Adminç”¨æˆ·ï¼Œè®¾ç½®æƒé™ï¼š</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf2gwxsgi1j31fy0mvgmh.jpg" class="lazyload">çœ‹åˆ°æƒé™å·²åŠ ï¼š</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf2gx47a7ij31f70m1q46.jpg" class="lazyload"></p><h3 id="ç®¡ç†ç•Œé¢ä¸­çš„åŠŸèƒ½"><a href="#ç®¡ç†ç•Œé¢ä¸­çš„åŠŸèƒ½" class="headerlink" title="ç®¡ç†ç•Œé¢ä¸­çš„åŠŸèƒ½"></a>ç®¡ç†ç•Œé¢ä¸­çš„åŠŸèƒ½</h3><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf2gx9cfevj30nq0da0th.jpg" class="lazyload"></p><h2 id="å­¦ä¹ äº”ç§é˜Ÿåˆ—"><a href="#å­¦ä¹ äº”ç§é˜Ÿåˆ—" class="headerlink" title="å­¦ä¹ äº”ç§é˜Ÿåˆ—"></a>å­¦ä¹ äº”ç§é˜Ÿåˆ—</h2><h3 id="ç®€å•é˜Ÿåˆ—"><a href="#ç®€å•é˜Ÿåˆ—" class="headerlink" title="ç®€å•é˜Ÿåˆ—"></a>ç®€å•é˜Ÿåˆ—</h3><p><img alt="image-20200523163811355" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf2h1cyledj30j806g3yy.jpg" class="lazyload"></p><p>Pï¼šæ¶ˆæ¯çš„ç”Ÿäº§è€…<br>Cï¼šæ¶ˆæ¯çš„æ¶ˆè´¹è€…<br>çº¢è‰²ï¼šé˜Ÿåˆ—</p><p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚</p><p>ç”Ÿäº§è€…ä¸€ä¸€å¯¹åº”æ¶ˆè´¹è€…</p><h4 id="å¯¼å…¥RabbitMQçš„å®¢æˆ·ç«¯ä¾èµ–"><a href="#å¯¼å…¥RabbitMQçš„å®¢æˆ·ç«¯ä¾èµ–" class="headerlink" title="å¯¼å…¥RabbitMQçš„å®¢æˆ·ç«¯ä¾èµ–"></a>å¯¼å…¥RabbitMQçš„å®¢æˆ·ç«¯ä¾èµ–</h4><pre><code class="xml">&lt;dependency&gt;   &lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;   &lt;artifactId&gt;amqp-client&lt;/artifactId&gt;   &lt;version&gt;3.4.1&lt;/version&gt;&lt;/dependency&gt;</code></pre><h4 id="è·å–MQçš„è¿æ¥"><a href="#è·å–MQçš„è¿æ¥" class="headerlink" title="è·å–MQçš„è¿æ¥"></a>è·å–MQçš„è¿æ¥</h4><pre><code class="java">package com.zpc.rabbitmq.util;import com.rabbitmq.client.ConnectionFactory;import com.rabbitmq.client.Connection;public class ConnectionUtil {    public static Connection getConnection() throws Exception {        //å®šä¹‰è¿æ¥å·¥å‚        ConnectionFactory factory = new ConnectionFactory();        //è®¾ç½®æœåŠ¡åœ°å€        factory.setHost(&quot;localhost&quot;);        //ç«¯å£        factory.setPort(5672);        //è®¾ç½®è´¦å·ä¿¡æ¯ï¼Œç”¨æˆ·åã€å¯†ç ã€vhost        factory.setVirtualHost(&quot;testhost&quot;);        factory.setUsername(&quot;admin&quot;);        factory.setPassword(&quot;admin&quot;);        // é€šè¿‡å·¥ç¨‹è·å–è¿æ¥        Connection connection = factory.newConnection();        return connection;    }}</code></pre><h4 id="ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—"><a href="#ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—" class="headerlink" title="ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—"></a>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—</h4><pre><code class="java">public class Send {    private final static String QUEUE_NAME = &quot;q_test_01&quot;;    public static void main(String[] argv) throws Exception {        // è·å–åˆ°è¿æ¥ä»¥åŠmqé€šé“        Connection connection = ConnectionUtil.getConnection();        // ä»è¿æ¥ä¸­åˆ›å»ºé€šé“        Channel channel = connection.createChannel();        // å£°æ˜ï¼ˆåˆ›å»ºï¼‰é˜Ÿåˆ—        channel.queueDeclare(QUEUE_NAME, false, false, false, null);        // æ¶ˆæ¯å†…å®¹        String message = &quot;Hello World!&quot;;        channel.basicPublish(&quot;&quot;, QUEUE_NAME, null, message.getBytes());        System.out.println(&quot; [x] Sent &#39;&quot; + message + &quot;&#39;&quot;);        //å…³é—­é€šé“å’Œè¿æ¥        channel.close();        connection.close();    }}</code></pre><p>ç®¡ç†å·¥å…·ä¸­æŸ¥çœ‹æ¶ˆæ¯</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf2p37jt4aj30ro0dmwf3.jpg" class="lazyload"></p><p>ç‚¹å‡»ä¸Šé¢çš„é˜Ÿåˆ—åç§°ï¼ŒæŸ¥è¯¢å…·ä½“çš„é˜Ÿåˆ—ä¸­çš„ä¿¡æ¯ï¼š</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf2p3ehzytj30n10h7mxl.jpg" class="lazyload"></p><p>æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯</p><pre><code class="java">public class Recv {    private final static String QUEUE_NAME = &quot;q_test_01&quot;;    public static void main(String[] argv) throws Exception {        // è·å–åˆ°è¿æ¥ä»¥åŠmqé€šé“        Connection connection = ConnectionUtil.getConnection();        // ä»è¿æ¥ä¸­åˆ›å»ºé€šé“        Channel channel = connection.createChannel();        // å£°æ˜é˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—è¿æ¥åˆ°ä¿¡é“ä¸Šï¼‰        channel.queueDeclare(QUEUE_NAME, false, false, false, null);        // å£°æ˜consumer        DefaultConsumer consumer=new DefaultConsumer(channel){            @Override            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {                String msg = new String(body);                System.out.println(msg);            }        };        //  å¯åŠ¨æ¶ˆè´¹è€…ç›‘å¬é˜Ÿåˆ—        channel.basicConsume(QUEUE_NAME, true, consumer);    }}</code></pre><h3 id="WorkQueue-è½®è¯¢åˆ†å‘"><a href="#WorkQueue-è½®è¯¢åˆ†å‘" class="headerlink" title="WorkQueue(è½®è¯¢åˆ†å‘)"></a>WorkQueue(è½®è¯¢åˆ†å‘)</h3><p><img alt="image-20200524085511793" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf399wtve5j30js08agn8.jpg" class="lazyload"></p><p>ä¸€ä¸ªç”Ÿäº§è€…ã€2ä¸ªæ¶ˆè´¹è€…ã€‚ä¸€ä¸ªæ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…è·å–ã€‚</p><h4 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h4><p>å‘é˜Ÿåˆ—ä¸­å‘é€50æ¡æ¶ˆæ¯ã€‚</p><pre><code class="java">public class WorkSend {    private final static String QUEUE_NAME = &quot;test_queue_work&quot;;    public static void main(String[] argv) throws Exception {        // è·å–åˆ°è¿æ¥ä»¥åŠmqé€šé“        Connection connection = ConnectionUtil.getConnection();        Channel channel = connection.createChannel();        // å£°æ˜é˜Ÿåˆ—        channel.queueDeclare(QUEUE_NAME, false, false, false, null);        for (int i = 0; i &lt; 50; i++) {            // æ¶ˆæ¯å†…å®¹            String message = &quot;&quot; + i;            channel.basicPublish(&quot;&quot;, QUEUE_NAME, null, message.getBytes());            System.out.println(&quot; [x] Sent &#39;&quot; + message + &quot;&#39;&quot;);            Thread.sleep(i * 10);        }        channel.close();        connection.close();    }}</code></pre><h4 id="æ¶ˆè´¹è€…1"><a href="#æ¶ˆè´¹è€…1" class="headerlink" title="æ¶ˆè´¹è€…1"></a>æ¶ˆè´¹è€…1</h4><pre><code class="java">public class WorkRecv1 {    private final static String QUEUE_NAME = &quot;test_queue_work&quot;;    public static void main(String[] argv) throws Exception {        // è·å–åˆ°è¿æ¥ä»¥åŠmqé€šé“        Connection connection = ConnectionUtil.getConnection();        Channel channel = connection.createChannel();        // å£°æ˜é˜Ÿåˆ—        channel.queueDeclare(QUEUE_NAME, false, false, false, null);        // å®šä¹‰ä¸€ä¸ªæ¶ˆè´¹è€…        Consumer consumer=new DefaultConsumer(channel){            @Override            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {                String msg = new String(body);                System.out.println(&quot;[1] Recv msg : &quot; + msg);                try {                    // æ¨¡æ‹Ÿå¤„ç†æ¶ˆæ¯ï¼ŒèŠ±è´¹2S                    Thread.sleep(2000);                } catch (InterruptedException e) {                    e.printStackTrace();                }finally {                    System.out.println(&quot;[1] done!&quot;);                }            }        };        //  å¯åŠ¨æ¶ˆè´¹è€…ç›‘å¬é˜Ÿåˆ—        channel.basicConsume(QUEUE_NAME, true, consumer);    }}</code></pre><h4 id="æ¶ˆè´¹è€…2"><a href="#æ¶ˆè´¹è€…2" class="headerlink" title="æ¶ˆè´¹è€…2"></a>æ¶ˆè´¹è€…2</h4><pre><code class="java">public class WorkRecv2 {    private final static String QUEUE_NAME = &quot;test_queue_work&quot;;    public static void main(String[] argv) throws Exception {        // è·å–åˆ°è¿æ¥ä»¥åŠmqé€šé“        Connection connection = ConnectionUtil.getConnection();        Channel channel = connection.createChannel();        // å£°æ˜é˜Ÿåˆ—        channel.queueDeclare(QUEUE_NAME, false, false, false, null);        // å®šä¹‰ä¸€ä¸ªæ¶ˆè´¹è€…        Consumer consumer=new DefaultConsumer(channel){            @Override            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {                String msg = new String(body);                System.out.println(&quot;[2] Recv msg : &quot; + msg);                try {                    // æ¨¡æ‹Ÿå¤„ç†æ¶ˆæ¯ï¼ŒèŠ±è´¹1S                    Thread.sleep(1000);                } catch (InterruptedException e) {                    e.printStackTrace();                }finally {                    System.out.println(&quot;[2] done!&quot;);                }            }        };        //  å¯åŠ¨æ¶ˆè´¹è€…ç›‘å¬é˜Ÿåˆ—        channel.basicConsume(QUEUE_NAME, true, consumer);    }}</code></pre><h4 id="æµ‹è¯•åŠç»“æœåˆ†æ"><a href="#æµ‹è¯•åŠç»“æœåˆ†æ" class="headerlink" title="æµ‹è¯•åŠç»“æœåˆ†æ"></a>æµ‹è¯•åŠç»“æœåˆ†æ</h4><p>æµ‹è¯•ç»“æœï¼š<br>    1ã€æ¶ˆè´¹è€…1å’Œæ¶ˆè´¹è€…2è·å–åˆ°çš„æ¶ˆæ¯å†…å®¹æ˜¯ä¸åŒçš„ï¼ŒåŒä¸€ä¸ªæ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…è·å–ã€‚<br>    2ã€æ¶ˆè´¹è€…1å’Œæ¶ˆè´¹è€…2è·å–åˆ°çš„æ¶ˆæ¯çš„æ•°é‡æ˜¯ç›¸åŒçš„ï¼Œä¸€ä¸ªæ˜¯æ¶ˆè´¹å¥‡æ•°å·æ¶ˆæ¯ï¼Œä¸€ä¸ªæ˜¯å¶æ•°ã€‚</p><p>å…¶å®ï¼Œè¿™æ ·æ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºæ¶ˆè´¹è€…1çº¿ç¨‹åœé¡¿çš„æ—¶é—´çŸ­ã€‚åº”è¯¥æ˜¯æ¶ˆè´¹è€…1è¦æ¯”æ¶ˆè´¹è€…2è·å–åˆ°çš„æ¶ˆæ¯å¤šæ‰å¯¹ã€‚<br>RabbitMQ é»˜è®¤å°†æ¶ˆæ¯é¡ºåºå‘é€ç»™ä¸‹ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè¿™æ ·ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…ä¼šå¾—åˆ°ç›¸åŒæ•°é‡çš„æ¶ˆæ¯ã€‚å³<code>è½®è¯¢ï¼ˆround-robinï¼‰åˆ†å‘</code>æ¶ˆæ¯ã€‚</p><p>æ€æ ·æ‰èƒ½åšåˆ°æŒ‰ç…§æ¯ä¸ªæ¶ˆè´¹è€…çš„èƒ½åŠ›åˆ†é…æ¶ˆæ¯å‘¢ï¼Ÿ</p><p>â€‹        è”åˆä½¿ç”¨ Qos å’Œ Acknowledge å°±å¯ä»¥åšåˆ°ã€‚<br>â€‹        <code>basicQosæ–¹æ³•</code>è®¾ç½®äº†å½“å‰ä¿¡é“æœ€å¤§é¢„è·å–ï¼ˆprefetchï¼‰æ¶ˆæ¯æ•°é‡ä¸º1ã€‚æ¶ˆæ¯ä»é˜Ÿåˆ—å¼‚æ­¥æ¨é€ç»™æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…çš„ ack ä¹Ÿæ˜¯å¼‚æ­¥å‘é€ç»™é˜Ÿåˆ—ï¼Œä»é˜Ÿåˆ—çš„è§†è§’å»çœ‹ï¼Œæ€»æ˜¯ä¼šæœ‰ä¸€æ‰¹æ¶ˆæ¯å·²æ¨é€ä½†å°šæœªè·å¾— ack ç¡®è®¤ï¼ŒQos çš„ <code>prefetchCount</code> å‚æ•°å°±æ˜¯ç”¨æ¥é™åˆ¶è¿™æ‰¹æœªç¡®è®¤æ¶ˆæ¯æ•°é‡çš„ã€‚è®¾ä¸º1æ—¶ï¼Œ<strong>é˜Ÿåˆ—åªæœ‰åœ¨æ”¶åˆ°æ¶ˆè´¹è€…å‘å›çš„ä¸Šä¸€æ¡æ¶ˆæ¯ ack ç¡®è®¤åï¼Œæ‰ä¼šå‘è¯¥æ¶ˆè´¹è€…å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯</strong>ã€‚prefetchCount çš„é»˜è®¤å€¼ä¸º0ï¼Œå³æ²¡æœ‰é™åˆ¶ï¼Œé˜Ÿåˆ—ä¼šå°†æ‰€æœ‰æ¶ˆæ¯å°½å¿«å‘ç»™æ¶ˆè´¹è€…ã€‚</p><p>2ä¸ªæ¦‚å¿µ</p><p><code>è½®è¯¢åˆ†å‘</code> ï¼šä½¿ç”¨ä»»åŠ¡é˜Ÿåˆ—çš„ä¼˜ç‚¹ä¹‹ä¸€å°±æ˜¯å¯ä»¥è½»æ˜“çš„å¹¶è¡Œå·¥ä½œã€‚å¦‚æœæˆ‘ä»¬ç§¯å‹äº†å¥½å¤šå·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ å·¥ä½œè€…ï¼ˆæ¶ˆè´¹è€…ï¼‰æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œä½¿å¾—ç³»ç»Ÿçš„ä¼¸ç¼©æ€§æ›´åŠ å®¹æ˜“ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQå°†é€ä¸ªå‘é€æ¶ˆæ¯åˆ°åœ¨åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªæ¶ˆè´¹è€…(è€Œä¸è€ƒè™‘æ¯ä¸ªä»»åŠ¡çš„æ—¶é•¿ç­‰ç­‰ï¼Œä¸”æ˜¯æå‰ä¸€æ¬¡æ€§åˆ†é…ï¼Œå¹¶éä¸€ä¸ªä¸€ä¸ªåˆ†é…)ã€‚å¹³å‡æ¯ä¸ªæ¶ˆè´¹è€…è·å¾—ç›¸åŒæ•°é‡çš„æ¶ˆæ¯ã€‚è¿™ç§æ–¹å¼åˆ†å‘æ¶ˆæ¯æœºåˆ¶ç§°ä¸ºRound-Robinï¼ˆè½®è¯¢ï¼‰ã€‚</p><p><code>å…¬å¹³åˆ†å‘</code> ï¼šè™½ç„¶ä¸Šé¢çš„åˆ†é…æ³•æ–¹å¼ä¹Ÿè¿˜è¡Œï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜å°±æ˜¯ï¼šæ¯”å¦‚ï¼šç°åœ¨æœ‰2ä¸ªæ¶ˆè´¹è€…ï¼Œæ‰€æœ‰çš„å¥‡æ•°çš„æ¶ˆæ¯éƒ½æ˜¯ç¹å¿™çš„ï¼Œè€Œå¶æ•°åˆ™æ˜¯è½»æ¾çš„ã€‚æŒ‰ç…§è½®è¯¢çš„æ–¹å¼ï¼Œå¥‡æ•°çš„ä»»åŠ¡äº¤ç»™äº†ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ‰€ä»¥ä¸€ç›´åœ¨å¿™ä¸ªä¸åœã€‚å¶æ•°çš„ä»»åŠ¡äº¤ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œåˆ™ç«‹å³å®Œæˆä»»åŠ¡ï¼Œç„¶åé—²å¾—ä¸è¡Œã€‚è€ŒRabbitMQåˆ™æ˜¯ä¸äº†è§£è¿™äº›çš„ã€‚è¿™æ˜¯å› ä¸ºå½“æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—ï¼ŒRabbitMQå°±ä¼šåˆ†æ´¾æ¶ˆæ¯ã€‚å®ƒä¸çœ‹æ¶ˆè´¹è€…ä¸ºåº”ç­”çš„æ•°ç›®ï¼Œåªæ˜¯ç›²ç›®çš„å°†æ¶ˆæ¯å‘ç»™è½®è¯¢æŒ‡å®šçš„æ¶ˆè´¹è€…ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨basicQos( prefetchCount = 1)æ–¹æ³•ï¼Œæ¥é™åˆ¶RabbitMQåªå‘ä¸è¶…è¿‡1æ¡çš„æ¶ˆæ¯ç»™åŒä¸€ä¸ªæ¶ˆè´¹è€…ã€‚å½“æ¶ˆæ¯å¤„ç†å®Œæ¯•åï¼Œæœ‰äº†åé¦ˆï¼Œæ‰ä¼šè¿›è¡Œç¬¬äºŒæ¬¡å‘é€ã€‚<br>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œä½¿ç”¨å…¬å¹³åˆ†å‘ï¼Œå¿…é¡»å…³é—­è‡ªåŠ¨åº”ç­”ï¼Œæ”¹ä¸ºæ‰‹åŠ¨åº”ç­”ã€‚</p><h3 id="Workæ¨¡å¼çš„â€œèƒ½è€…å¤šåŠ³â€"><a href="#Workæ¨¡å¼çš„â€œèƒ½è€…å¤šåŠ³â€" class="headerlink" title="Workæ¨¡å¼çš„â€œèƒ½è€…å¤šåŠ³â€"></a>Workæ¨¡å¼çš„â€œèƒ½è€…å¤šåŠ³â€</h3><p>æ‰“å¼€ä¸Šè¿°ä»£ç çš„æ³¨é‡Šï¼š</p><pre><code class="java">// åŒä¸€æ—¶åˆ»æœåŠ¡å™¨åªä¼šå‘ä¸€æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…channel.basicQos(1);//å¼€å¯è¿™è¡Œ è¡¨ç¤ºä½¿ç”¨æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);// ç›‘å¬é˜Ÿåˆ—ï¼Œfalseè¡¨ç¤ºæ‰‹åŠ¨è¿”å›å®ŒæˆçŠ¶æ€ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨channel.basicConsume(QUEUE_NAME, false, consumer);</code></pre><p>æµ‹è¯•ï¼š<br>æ¶ˆè´¹è€…1æ¯”æ¶ˆè´¹è€…2è·å–çš„æ¶ˆæ¯æ›´å¤šã€‚</p><h4 id="æ¶ˆæ¯çš„ç¡®è®¤æ¨¡å¼"><a href="#æ¶ˆæ¯çš„ç¡®è®¤æ¨¡å¼" class="headerlink" title="æ¶ˆæ¯çš„ç¡®è®¤æ¨¡å¼"></a>æ¶ˆæ¯çš„ç¡®è®¤æ¨¡å¼</h4><p>æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯å¦‚ä½•çŸ¥é“æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹å‘¢ï¼Ÿ</p><p>æ¨¡å¼1ï¼šè‡ªåŠ¨ç¡®è®¤<br>åªè¦æ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­è·å–ï¼Œæ— è®ºæ¶ˆè´¹è€…è·å–åˆ°æ¶ˆæ¯åæ˜¯å¦æˆåŠŸæ¶ˆæ¯ï¼Œéƒ½è®¤ä¸ºæ˜¯æ¶ˆæ¯å·²ç»æˆåŠŸæ¶ˆè´¹ã€‚<br>æ¨¡å¼2ï¼šæ‰‹åŠ¨ç¡®è®¤<br>æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯åï¼ŒæœåŠ¡å™¨ä¼šå°†è¯¥æ¶ˆæ¯æ ‡è®°ä¸ºä¸å¯ç”¨çŠ¶æ€ï¼Œç­‰å¾…æ¶ˆè´¹è€…çš„åé¦ˆï¼Œå¦‚æœæ¶ˆè´¹è€…ä¸€ç›´æ²¡æœ‰åé¦ˆï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°†ä¸€ç›´å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚</p><p>æ‰‹åŠ¨æ¨¡å¼ï¼š</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4glg31ixj30o50bfgma.jpg" class="lazyload"></p><p>è‡ªåŠ¨æ¨¡å¼ï¼š</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4glk5mlrj30nk088wev.jpg" class="lazyload"></p><h3 id="è®¢é˜…æ¨¡å¼-fanout-Exchange"><a href="#è®¢é˜…æ¨¡å¼-fanout-Exchange" class="headerlink" title="è®¢é˜…æ¨¡å¼(fanout Exchange)"></a>è®¢é˜…æ¨¡å¼(fanout Exchange)</h3><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4glwdnkjj30da05ajrh.jpg" class="lazyload"></p><p>è§£è¯»ï¼š<br>1ã€1ä¸ªç”Ÿäº§è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…<br>2ã€æ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ªé˜Ÿåˆ—<br>3ã€ç”Ÿäº§è€…æ²¡æœ‰å°†æ¶ˆæ¯ç›´æ¥å‘é€åˆ°é˜Ÿåˆ—ï¼Œè€Œæ˜¯å‘é€åˆ°äº†äº¤æ¢æœº<br>4ã€æ¯ä¸ªé˜Ÿåˆ—éƒ½è¦ç»‘å®šåˆ°äº¤æ¢æœº<br>5ã€ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œç»è¿‡äº¤æ¢æœºï¼Œåˆ°è¾¾é˜Ÿåˆ—ï¼Œå®ç°ï¼Œä¸€ä¸ªæ¶ˆæ¯è¢«å¤šä¸ªæ¶ˆè´¹è€…è·å–çš„ç›®çš„<br>æ³¨æ„ï¼šä¸€ä¸ªæ¶ˆè´¹è€…é˜Ÿåˆ—å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹ä¼šæ¶ˆè´¹</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4ngyyrtdj30cl08m0t2.jpg" class="lazyload"></p><p>5.6.2.æ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼ˆçœ‹ä½œæ˜¯åå°ç³»ç»Ÿï¼‰<br>å‘äº¤æ¢æœºä¸­å‘é€æ¶ˆæ¯ã€‚</p><pre><code class="java">package com.zpc.rabbitmq.subscribe;import com.zpc.rabbitmq.util.ConnectionUtil;import com.rabbitmq.client.Channel;import com.rabbitmq.client.Connection;public class Send {    private final static String EXCHANGE_NAME = &quot;test_exchange_fanout&quot;;    public static void main(String[] argv) throws Exception {        // è·å–åˆ°è¿æ¥ä»¥åŠmqé€šé“        Connection connection = ConnectionUtil.getConnection();        Channel channel = connection.createChannel();        // å£°æ˜exchange        channel.exchangeDeclare(EXCHANGE_NAME, &quot;fanout&quot;);        // æ¶ˆæ¯å†…å®¹        String message = &quot;Hello World!&quot;;        channel.basicPublish(EXCHANGE_NAME, &quot;&quot;, null, message.getBytes());        System.out.println(&quot; [x] Sent &#39;&quot; + message + &quot;&#39;&quot;);        channel.close();        connection.close();    }}</code></pre><p>æ³¨æ„ï¼šæ¶ˆæ¯å‘é€åˆ°æ²¡æœ‰é˜Ÿåˆ—ç»‘å®šçš„äº¤æ¢æœºæ—¶ï¼Œæ¶ˆæ¯å°†ä¸¢å¤±ï¼Œå› ä¸ºï¼Œäº¤æ¢æœºæ²¡æœ‰å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œæ¶ˆæ¯åªèƒ½å­˜åœ¨åœ¨é˜Ÿåˆ—ä¸­ã€‚<br>5.6.3.æ¶ˆè´¹è€…1ï¼ˆçœ‹ä½œæ˜¯å‰å°ç³»ç»Ÿï¼‰</p><pre><code class="java">package com.zpc.rabbitmq.subscribe;import com.rabbitmq.client.Channel;import com.rabbitmq.client.Connection;import com.rabbitmq.client.QueueingConsumer;import com.zpc.rabbitmq.util.ConnectionUtil;public class Recv {    private final static String QUEUE_NAME = &quot;test_queue_work1&quot;;    private final static String EXCHANGE_NAME = &quot;test_exchange_fanout&quot;;    public static void main(String[] argv) throws Exception {        // è·å–åˆ°è¿æ¥ä»¥åŠmqé€šé“        Connection connection = ConnectionUtil.getConnection();        Channel channel = connection.createChannel();        // å£°æ˜é˜Ÿåˆ—        channel.queueDeclare(QUEUE_NAME, false, false, false, null);        // ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;&quot;);        // åŒä¸€æ—¶åˆ»æœåŠ¡å™¨åªä¼šå‘ä¸€æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…        channel.basicQos(1);        // å®šä¹‰é˜Ÿåˆ—çš„æ¶ˆè´¹è€…        QueueingConsumer consumer = new QueueingConsumer(channel);        // ç›‘å¬é˜Ÿåˆ—ï¼Œæ‰‹åŠ¨è¿”å›å®Œæˆ        channel.basicConsume(QUEUE_NAME, false, consumer);        // è·å–æ¶ˆæ¯        while (true) {            QueueingConsumer.Delivery delivery = consumer.nextDelivery();            String message = new String(delivery.getBody());            System.out.println(&quot; [Recv] Received &#39;&quot; + message + &quot;&#39;&quot;);            Thread.sleep(10);            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);        }    }}</code></pre><p>5.6.4.æ¶ˆè´¹è€…2ï¼ˆçœ‹ä½œæ˜¯æœç´¢ç³»ç»Ÿï¼‰</p><pre><code class="java">package com.zpc.rabbitmq.subscribe;import com.rabbitmq.client.Channel;import com.rabbitmq.client.Connection;import com.rabbitmq.client.QueueingConsumer;import com.zpc.rabbitmq.util.ConnectionUtil;public class Recv2 {    private final static String QUEUE_NAME = &quot;test_queue_work2&quot;;    private final static String EXCHANGE_NAME = &quot;test_exchange_fanout&quot;;    public static void main(String[] argv) throws Exception {        // è·å–åˆ°è¿æ¥ä»¥åŠmqé€šé“        Connection connection = ConnectionUtil.getConnection();        Channel channel = connection.createChannel();        // å£°æ˜é˜Ÿåˆ—        channel.queueDeclare(QUEUE_NAME, false, false, false, null);        // ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;&quot;);        // åŒä¸€æ—¶åˆ»æœåŠ¡å™¨åªä¼šå‘ä¸€æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…        channel.basicQos(1);        // å®šä¹‰é˜Ÿåˆ—çš„æ¶ˆè´¹è€…        QueueingConsumer consumer = new QueueingConsumer(channel);        // ç›‘å¬é˜Ÿåˆ—ï¼Œæ‰‹åŠ¨è¿”å›å®Œæˆ        channel.basicConsume(QUEUE_NAME, false, consumer);        // è·å–æ¶ˆæ¯        while (true) {            QueueingConsumer.Delivery delivery = consumer.nextDelivery();            String message = new String(delivery.getBody());            System.out.println(&quot; [Recv2] Received &#39;&quot; + message + &quot;&#39;&quot;);            Thread.sleep(10);            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);        }    }}</code></pre><p>æµ‹è¯•<br>æµ‹è¯•ç»“æœï¼š<br>åŒä¸€ä¸ªæ¶ˆæ¯è¢«å¤šä¸ªæ¶ˆè´¹è€…è·å–ã€‚ä¸€ä¸ªæ¶ˆè´¹è€…é˜Ÿåˆ—å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹ä¼šæ¶ˆè´¹åˆ°æ¶ˆæ¯ã€‚</p><p>åœ¨ç®¡ç†å·¥å…·ä¸­æŸ¥çœ‹é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®šå…³ç³»ï¼š</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4nmbp25lj30t90lk0tg.jpg" class="lazyload"></p><h3 id="è·¯ç”±æ¨¡å¼-diect-Exchange"><a href="#è·¯ç”±æ¨¡å¼-diect-Exchange" class="headerlink" title="è·¯ç”±æ¨¡å¼(diect Exchange)"></a>è·¯ç”±æ¨¡å¼(diect Exchange)</h3><p>äº¤æ¢æœºæ ¹æ®åŒ¹é…è§„åˆ™è·¯ç”±åˆ°æŒ‡å®šç¬¦åˆçš„é˜Ÿåˆ—ä¸­</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4noqkxcsj30cl07ijrn.jpg" class="lazyload"></p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4np44hdjj30ut093taa.jpg" class="lazyload"></p><p>ç”Ÿäº§è€…</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4nq1mleij30q60cjgmg.jpg" class="lazyload"></p><p>æ¶ˆè´¹è€…1(å‡è®¾æ˜¯å‰å°ç³»ç»Ÿ)</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4nq89ipmj30p40emdgt.jpg" class="lazyload"></p><p>æ¶ˆè´¹2ï¼ˆå‡è®¾æ˜¯æœç´¢ç³»ç»Ÿï¼‰</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4nr21netj30oi0eojse.jpg" class="lazyload"></p><h3 id="Topic-ä¸»é¢˜-é€šé…ç¬¦æ¨¡å¼"><a href="#Topic-ä¸»é¢˜-é€šé…ç¬¦æ¨¡å¼" class="headerlink" title="Topic(ä¸»é¢˜\é€šé…ç¬¦æ¨¡å¼)"></a>Topic(ä¸»é¢˜\é€šé…ç¬¦æ¨¡å¼)</h3><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4nshrcitj30u702zdfq.jpg" class="lazyload"></p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4nsp7itfj30f9087t9w.jpg" class="lazyload"></p><p>åŒä¸€ä¸ªæ¶ˆæ¯è¢«å¤šä¸ªæ¶ˆè´¹è€…è·å–ã€‚ä¸€ä¸ªæ¶ˆè´¹è€…é˜Ÿåˆ—å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹ä¼šæ¶ˆè´¹åˆ°æ¶ˆæ¯ã€‚</p><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf4nsy77jbj30sw07f75m.jpg" class="lazyload"></p><p>ç”Ÿäº§è€…</p><pre><code class="java">public class Send {    private final static String EXCHANGE_NAME = &quot;test_exchange_topic&quot;;    public static void main(String[] argv) throws Exception {        // è·å–åˆ°è¿æ¥ä»¥åŠmqé€šé“        Connection connection = ConnectionUtil.getConnection();        Channel channel = connection.createChannel();        // å£°æ˜exchange        channel.exchangeDeclare(EXCHANGE_NAME, &quot;topic&quot;);        // æ¶ˆæ¯å†…å®¹        String message = &quot;Hello World!!&quot;;        channel.basicPublish(EXCHANGE_NAME, &quot;routekey.1&quot;, null, message.getBytes());        System.out.println(&quot; [x] Sent &#39;&quot; + message + &quot;&#39;&quot;);        channel.close();        connection.close();    }}</code></pre><p>æ¶ˆè´¹è€…1ï¼ˆå‰å°ç³»ç»Ÿï¼‰</p><pre><code class="java">public class Recv {    private final static String QUEUE_NAME = &quot;test_queue_topic_work_1&quot;;    private final static String EXCHANGE_NAME = &quot;test_exchange_topic&quot;;    public static void main(String[] argv) throws Exception {        // è·å–åˆ°è¿æ¥ä»¥åŠmqé€šé“        Connection connection = ConnectionUtil.getConnection();        Channel channel = connection.createChannel();        // å£°æ˜é˜Ÿåˆ—        channel.queueDeclare(QUEUE_NAME, false, false, false, null);        // ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;routekey.*&quot;);        // åŒä¸€æ—¶åˆ»æœåŠ¡å™¨åªä¼šå‘ä¸€æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…        channel.basicQos(1);        // å®šä¹‰é˜Ÿåˆ—çš„æ¶ˆè´¹è€…        QueueingConsumer consumer = new QueueingConsumer(channel);        // ç›‘å¬é˜Ÿåˆ—ï¼Œæ‰‹åŠ¨è¿”å›å®Œæˆ        channel.basicConsume(QUEUE_NAME, false, consumer);        // è·å–æ¶ˆæ¯        while (true) {            QueueingConsumer.Delivery delivery = consumer.nextDelivery();            String message = new String(delivery.getBody());            System.out.println(&quot; [Recv_x] Received &#39;&quot; + message + &quot;&#39;&quot;);            Thread.sleep(10);            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);        }    }}</code></pre><p>æ¶ˆè´¹è€…2ï¼ˆæœç´¢ç³»ç»Ÿï¼‰</p><pre><code class="java">public class Recv2 {    private final static String QUEUE_NAME = &quot;test_queue_topic_work_2&quot;;    private final static String EXCHANGE_NAME = &quot;test_exchange_topic&quot;;    public static void main(String[] argv) throws Exception {        // è·å–åˆ°è¿æ¥ä»¥åŠmqé€šé“        Connection connection = ConnectionUtil.getConnection();        Channel channel = connection.createChannel();        // å£°æ˜é˜Ÿåˆ—        channel.queueDeclare(QUEUE_NAME, false, false, false, null);        // ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;*.*&quot;);        // åŒä¸€æ—¶åˆ»æœåŠ¡å™¨åªä¼šå‘ä¸€æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…        channel.basicQos(1);        // å®šä¹‰é˜Ÿåˆ—çš„æ¶ˆè´¹è€…        QueueingConsumer consumer = new QueueingConsumer(channel);        // ç›‘å¬é˜Ÿåˆ—ï¼Œæ‰‹åŠ¨è¿”å›å®Œæˆ        channel.basicConsume(QUEUE_NAME, false, consumer);        // è·å–æ¶ˆæ¯        while (true) {            QueueingConsumer.Delivery delivery = consumer.nextDelivery();            String message = new String(delivery.getBody());            System.out.println(&quot; [Recv2_x] Received &#39;&quot; + message + &quot;&#39;&quot;);            Thread.sleep(10);            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);        }    }}</code></pre><h2 id="Springé›†æˆRabbitMQ"><a href="#Springé›†æˆRabbitMQ" class="headerlink" title="Springé›†æˆRabbitMQ"></a>Springé›†æˆRabbitMQ</h2><p>å‚è€ƒé“¾æ¥,è¿™é‡Œä¸åšæ¼”ç¤º:</p><p><a href="https://blog.csdn.net/hellozpc/article/details/81436980" target="_blank" rel="noopener">https://blog.csdn.net/hellozpc/article/details/81436980</a></p><h2 id="SpringBooté›†æˆRabbitMQ"><a href="#SpringBooté›†æˆRabbitMQ" class="headerlink" title="SpringBooté›†æˆRabbitMQ"></a>SpringBooté›†æˆRabbitMQ</h2><h3 id="å¼•å…¥rabbitmq"><a href="#å¼•å…¥rabbitmq" class="headerlink" title="å¼•å…¥rabbitmq"></a>å¼•å…¥rabbitmq</h3><p>1ã€é…ç½®pomæ–‡ä»¶ï¼Œä¸»è¦æ˜¯æ·»åŠ spring-boot-starter-amqpçš„æ”¯æŒ</p><pre><code class="xml">&lt;dependency&gt;   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;   &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><p>2ã€é…ç½®application.propertiesæ–‡ä»¶,é…ç½®rabbitmqçš„å®‰è£…åœ°å€ã€ç«¯å£ä»¥åŠè´¦æˆ·ä¿¡æ¯,æ•°æ®åº“ä¿¡æ¯</p><pre><code class="properties">spring.application.name=spirng-boot-rabbitmqspring.rabbitmq.host=172.16.219.215spring.rabbitmq.port=5672spring.rabbitmq.username=rootspring.rabbitmq.password=rootspring.rabbitmq.virtual-host=testhost</code></pre><h3 id="ç®€å•é˜Ÿåˆ—-1"><a href="#ç®€å•é˜Ÿåˆ—-1" class="headerlink" title="ç®€å•é˜Ÿåˆ—"></a>ç®€å•é˜Ÿåˆ—</h3><p>1ã€é…ç½®é˜Ÿåˆ—</p><pre><code class="java">import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;@Configurationpublic class RabbitConfig {    @Bean    public Queue helloQueue() {        return new Queue(&quot;hello3&quot;);    }    @Bean    public Queue neoQueue() {        return new Queue(&quot;neo&quot;);    }    @Bean    public Queue objectQueue() {        return new Queue(&quot;object&quot;);    }}</code></pre><p>2ã€å‘é€è€…</p><pre><code class="java">package com.neo.rabbit.hello;import org.springframework.amqp.core.AmqpTemplate;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;import java.util.Date;@Componentpublic class HelloSender {    @Autowired    private AmqpTemplate rabbitTemplate;    public void send()   {        String context = &quot;hello &quot; + new Date();        System.out.println(&quot;Sender : &quot; + context);        this.rabbitTemplate.convertAndSend(&quot;hello3&quot;, context);    }}</code></pre><p>3ã€æ¶ˆè´¹è€…</p><pre><code class="java">package com.neo.rabbit.hello;import org.springframework.amqp.rabbit.annotation.RabbitHandler;import org.springframework.amqp.rabbit.annotation.RabbitListener;import org.springframework.stereotype.Component;@Component@RabbitListener(queues = &quot;hello3&quot;)public class HelloReceiver {    @RabbitHandler    public void process(String hello) {        System.out.println(&quot;Receiver  : &quot; + hello);    }}</code></pre><p>4ã€æµ‹è¯•</p><pre><code class="java">package com.neo.rabbitmq;import com.neo.rabbit.hello.HelloSender;import org.junit.Test;import org.junit.runner.RunWith;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.test.context.junit4.SpringRunner;@RunWith(SpringRunner.class)@SpringBootTestpublic class HelloTest {    @Autowired    private HelloSender helloSender;    @Test    public void hello() throws Exception {        helloSender.send();        // ç­‰å¾…ä¸‰ç§’ï¼Œä½¿æ¶ˆè´¹è€…ç¡®å®šå¯ä»¥æ¶ˆè´¹åˆ°æ•°æ®        Thread.sleep(3000);        System.out.println(&quot;exit&quot;);    }}</code></pre><p><strong>å…¶ä»–è§è‡ªå·±çš„å·¥ç¨‹spring-boot-rabbitmq</strong></p><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“:"></a>æ€»ç»“:</h2><p>å¸¸ç”¨é˜Ÿåˆ—å½¢å¼:</p><p>1ã€1å¯¹1</p><ul><li>ç®€å•é˜Ÿåˆ—: sender â€“&gt; queue â€“&gt; consumer</li><li>exchangeçš„diectæ¨¡å¼:sender â€“&gt; exchange â€“&gt; queue â€“&gt; consumer</li></ul><p>2ã€1å¯¹å¤š</p><ul><li>ç®€å•é˜Ÿåˆ—: sender â€“&gt; queue â€“&gt; å¤šä¸ªconsumer(é»˜è®¤è½®è¯¢)</li><li>ç®€å•é˜Ÿåˆ—: sender â€“&gt; queue â€“&gt; å¤šä¸ªconsumer(èƒ½è€…å¤šåŠ³,å…³é—­è‡ªåŠ¨ack)</li><li>exchangeçš„è®¢é˜…æ¨¡å¼(fanout Exchange)</li><li>exchangeçš„Topic(ä¸»é¢˜\é€šé…ç¬¦æ¨¡å¼)</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¶ˆæ¯é˜Ÿåˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¶ˆæ¯é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rediså·¥å…·ç±»</title>
      <link href="/2020/01/15/3.%20redis/redisUtil/"/>
      <url>/2020/01/15/3.%20redis/redisUtil/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>æœ€å…¨çš„Javaæ“ä½œRedisçš„å·¥å…·ç±»ï¼Œä½¿ç”¨StringRedisTemplateå®ç°ï¼Œå°è£…äº†å¯¹Redisäº”ç§åŸºæœ¬ç±»å‹çš„å„ç§æ“ä½œï¼ŒåŠ›æ±‚ç¬¦åˆRedisçš„åŸç”Ÿæ“ä½œï¼<br>åˆ†ä¸ºå…­ä¸ªéƒ¨åˆ†ï¼š<a href="https://gitee.com/nmwork/RedisUtil#ä¸€keysç›¸å…³å‘½ä»¤" target="_blank" rel="noopener">keyså‘½ä»¤æ“ä½œ</a>ã€<a href="https://gitee.com/nmwork/RedisUtil#äºŒstringæ•°æ®ç±»å‹æ“ä½œ" target="_blank" rel="noopener">Stringæ•°æ®æ“ä½œ</a>ã€<a href="https://gitee.com/nmwork/RedisUtil#ä¸‰hashç›¸å…³çš„æ“ä½œ" target="_blank" rel="noopener">Hashæ•°æ®æ“ä½œ</a>ã€<a href="https://gitee.com/nmwork/RedisUtil#å››listç›¸å…³çš„æ“ä½œ" target="_blank" rel="noopener">Listæ•°æ®æ“ä½œ</a>ã€<a href="https://gitee.com/nmwork/RedisUtil#äº”setç›¸å…³çš„æ“ä½œ" target="_blank" rel="noopener">Setæ•°æ®æ“ä½œ</a>ã€<a href="https://gitee.com/nmwork/RedisUtil#å…­zsetæ•°æ®ç±»å‹æ“ä½œ" target="_blank" rel="noopener">zSetæ•°æ®æ“ä½œ</a>ã€‚ </p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>å¦‚æœä½ æ¯”è¾ƒå…³å¿ƒä¸ºä»€ä¹ˆå®ƒæ²¡æœ‰æä¾›å­˜å‚¨Objectçš„æ–¹æ³•ï¼Œè¯·çœ‹è¿™é‡Œä»‹ç»<a href="https://gitee.com/nmwork/RedisUtil#äºŒredistemplateå’Œstringredistemplate" target="_blank" rel="noopener">å­˜Objectä¸ºä»€ä¹ˆä¸å¥½ï¼Ÿ</a>  </p><h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><h3 id="ä¸€ã€keysç›¸å…³å‘½ä»¤"><a href="#ä¸€ã€keysç›¸å…³å‘½ä»¤" class="headerlink" title="ä¸€ã€keysç›¸å…³å‘½ä»¤"></a>ä¸€ã€keysç›¸å…³å‘½ä»¤</h3><table><thead><tr><th>åºå·</th><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>1</td><td>void delete(String key)</td><td>key å­˜åœ¨æ—¶åˆ é™¤ key</td></tr><tr><td>2</td><td>void delete(Collection keys)</td><td>æ‰¹é‡åˆ é™¤key</td></tr><tr><td>3</td><td>byte[] dump(String key)</td><td>åºåˆ—åŒ–ç»™å®š key ï¼Œå¹¶è¿”å›è¢«åºåˆ—åŒ–çš„å€¼</td></tr><tr><td>4</td><td>Boolean hasKey(String key)</td><td>æ£€æŸ¥ç»™å®š key æ˜¯å¦å­˜åœ¨</td></tr><tr><td>5</td><td>Boolean expire(String key, long timeout, TimeUnit unit)</td><td>è®¾ç½®è¿‡æœŸæ—¶é—´</td></tr><tr><td>6</td><td>Boolean expireAt(String key, Date date)</td><td>è®¾ç½®è¿‡æœŸæ—¶é—´</td></tr><tr><td>7</td><td>Set keys(String pattern)</td><td>æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼( pattern)çš„ key</td></tr><tr><td>8</td><td>Boolean move(String key, int dbIndex)</td><td>å°†å½“å‰æ•°æ®åº“çš„ key ç§»åŠ¨åˆ°ç»™å®šçš„æ•°æ®åº“ db å½“ä¸­</td></tr><tr><td>9</td><td>Boolean persist(String key)</td><td>ç§»é™¤ key çš„è¿‡æœŸæ—¶é—´ï¼Œkey å°†æŒä¹…ä¿æŒ</td></tr><tr><td>10</td><td>Long getExpire(String key, TimeUnit unit)</td><td>è¿”å› key çš„å‰©ä½™çš„è¿‡æœŸæ—¶é—´</td></tr><tr><td>11</td><td>Long getExpire(String key)</td><td>è¿”å› key çš„å‰©ä½™çš„è¿‡æœŸæ—¶é—´</td></tr><tr><td>12</td><td>String randomKey()</td><td>ä»å½“å‰æ•°æ®åº“ä¸­éšæœºè¿”å›ä¸€ä¸ª key</td></tr><tr><td>13</td><td>void rename(String oldKey, String newKey)</td><td>ä¿®æ”¹ key çš„åç§°</td></tr><tr><td>14</td><td>Boolean renameIfAbsent(String oldKey, String newKey)</td><td>ä»…å½“ newkey ä¸å­˜åœ¨æ—¶ï¼Œå°† oldKey æ”¹åä¸º newkey</td></tr><tr><td>15</td><td>DataType type(String key)</td><td>è¿”å› key æ‰€å‚¨å­˜çš„å€¼çš„ç±»å‹</td></tr></tbody></table><hr><h3 id="äºŒã€Stringæ•°æ®ç±»å‹æ“ä½œ"><a href="#äºŒã€Stringæ•°æ®ç±»å‹æ“ä½œ" class="headerlink" title="äºŒã€Stringæ•°æ®ç±»å‹æ“ä½œ"></a>äºŒã€Stringæ•°æ®ç±»å‹æ“ä½œ</h3><table><thead><tr><th>åºå·</th><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>1</td><td>String get(String key)</td><td>è·å–æŒ‡å®š key çš„å€¼</td></tr><tr><td>2</td><td>String getRange(String key, long start, long end)</td><td>è¿”å› key ä¸­å­—ç¬¦ä¸²å€¼çš„å­å­—ç¬¦</td></tr><tr><td>3</td><td>String getAndSet(String key, String value)</td><td>å°†ç»™å®š key çš„å€¼è®¾ä¸º value ï¼Œå¹¶è¿”å›key çš„æ—§å€¼(old value)</td></tr><tr><td>4</td><td>Boolean getBit(String key, long offset)</td><td>å¯¹ key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè·å–æŒ‡å®šåç§» é‡ä¸Šçš„ä½(bit)</td></tr><tr><td>5</td><td>List multiGet(Collection keys)</td><td>æ‰¹é‡è·å–</td></tr><tr><td>6</td><td>void set(String key, String value)</td><td>è®¾ç½®æŒ‡å®š key çš„å€¼</td></tr><tr><td>7</td><td>boolean setBit(String key, long offset, boolean value)</td><td>è®¾ç½®ASCIIç , å­—ç¬¦ä¸²â€™aâ€™çš„ASCIIç æ˜¯97, è½¬ ä¸ºäºŒè¿›åˆ¶æ˜¯â€™01100001â€™, æ­¤æ–¹æ³•æ˜¯å°† äºŒè¿›åˆ¶ç¬¬offsetä½å€¼å˜ä¸ºvalue</td></tr><tr><td>8</td><td>void setEx(String key, String value, long timeout, TimeUnit unit)</td><td>å°†å€¼ value å…³è”åˆ° key ï¼Œå¹¶å°† key çš„è¿‡æœŸ æ—¶é—´è®¾ä¸º timeout,unit:æ—¶é—´å•ä½, å¤©:TimeUnit.DAYS å°æ—¶:TimeUnit.HOURS åˆ†é’Ÿ:TimeUnit.MINUTES, ç§’:TimeUnit.SECONDS æ¯«ç§’:TimeUnit.MILLISECONDS</td></tr><tr><td>9</td><td>boolean setIfAbsent(String key, String value)</td><td>åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶è®¾ç½® key çš„å€¼</td></tr><tr><td>10</td><td>void setRange(String key, String value, long offset)</td><td>ç”¨ value å‚æ•°è¦†å†™ç»™å®š key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸² å€¼ï¼Œä»åç§»é‡ offset å¼€å§‹</td></tr><tr><td>11</td><td>void multiSet(Map&lt;String,String&gt; maps)</td><td>æ‰¹é‡æ·»åŠ </td></tr><tr><td>12</td><td>boolean multiSetIfAbsent(Map&lt;String,String&gt; maps)</td><td>åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ï¼Œå½“ä¸”ä»… å½“æ‰€æœ‰ç»™å®š key éƒ½ä¸å­˜åœ¨</td></tr><tr><td>13</td><td>Integer append(String key, String value)</td><td>è¿½åŠ åˆ°æœ«å°¾</td></tr><tr><td>14</td><td>Long incrBy(String key, long increment)</td><td>å¢åŠ (è‡ªå¢é•¿), è´Ÿæ•°åˆ™ä¸ºè‡ªå‡</td></tr><tr><td>15</td><td>Double incrByFloat(String key, double increment)</td><td>å¢åŠ (è‡ªå¢é•¿), è´Ÿæ•°åˆ™ä¸ºè‡ªå‡</td></tr><tr><td>16</td><td>Long size(String key)</td><td>è·å–å­—ç¬¦ä¸²çš„é•¿åº¦</td></tr></tbody></table><hr><h3 id="ä¸‰ã€Hashç›¸å…³çš„æ“ä½œ"><a href="#ä¸‰ã€Hashç›¸å…³çš„æ“ä½œ" class="headerlink" title="ä¸‰ã€Hashç›¸å…³çš„æ“ä½œ"></a>ä¸‰ã€Hashç›¸å…³çš„æ“ä½œ</h3><table><thead><tr><th>åºå·</th><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>1</td><td>Object hGet(String key, String field)</td><td>è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼</td></tr><tr><td>2</td><td>Map hGetAll(String key)</td><td>è·å–æ‰€æœ‰ç»™å®šå­—æ®µçš„å€¼</td></tr><tr><td>3</td><td>List hMultiGet(String key, Collection fields)</td><td>è·å–æ‰€æœ‰ç»™å®šå­—æ®µçš„å€¼</td></tr><tr><td>4</td><td>void hPut(String key, String hashKey, String value)</td><td>æ·»åŠ å­—æ®µ</td></tr><tr><td>5</td><td>void hPutAll(String key, Map maps)</td><td>æ·»åŠ å¤šä¸ªå­—æ®µ</td></tr><tr><td>6</td><td>Boolean hPutIfAbsent(String key, String hashKey, String value)</td><td>ä»…å½“hashKeyä¸å­˜åœ¨æ—¶æ‰è®¾ç½®</td></tr><tr><td>7</td><td>Long hDelete(String key, Objectâ€¦ fields)</td><td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå“ˆå¸Œè¡¨å­—æ®µ</td></tr><tr><td>8</td><td>boolean hExists(String key, String field)</td><td>æŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼ŒæŒ‡å®šçš„å­—æ®µæ˜¯ å¦å­˜åœ¨</td></tr><tr><td>9</td><td>Long hIncrBy(String key, Object field, long increment)</td><td>ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„æŒ‡å®šå­—æ®µçš„æ•´æ•° å€¼åŠ ä¸Šå¢é‡ increment</td></tr><tr><td>10</td><td>Double hIncrByFloat(String key, Object field, double delta)</td><td>ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„æŒ‡å®šå­—æ®µçš„æ•´æ•° å€¼åŠ ä¸Šå¢é‡ increment</td></tr><tr><td>11</td><td>Set hKeys(String key)</td><td>è·å–æ‰€æœ‰å“ˆå¸Œè¡¨ä¸­çš„å­—æ®µ</td></tr><tr><td>12</td><td>Long hSize(String key)</td><td>è·å–å“ˆå¸Œè¡¨ä¸­å­—æ®µçš„æ•°é‡</td></tr><tr><td>13</td><td>List hValues(String key)</td><td>è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å€¼</td></tr><tr><td>14</td><td>Cursor hScan(String key, ScanOptions options)</td><td>è¿­ä»£å“ˆå¸Œè¡¨ä¸­çš„é”®å€¼å¯¹</td></tr></tbody></table><hr><h3 id="å››ã€Listç›¸å…³çš„æ“ä½œ"><a href="#å››ã€Listç›¸å…³çš„æ“ä½œ" class="headerlink" title="å››ã€Listç›¸å…³çš„æ“ä½œ"></a>å››ã€Listç›¸å…³çš„æ“ä½œ</h3><table><thead><tr><th>åºå·</th><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>1</td><td>String lIndex(String key, long index)</td><td>é€šè¿‡ç´¢å¼•è·å–åˆ—è¡¨ä¸­çš„å…ƒç´ </td></tr><tr><td>2</td><td>List lRange(String key, long start, long end)</td><td>è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ </td></tr><tr><td></td><td></td><td></td></tr><tr><td>3</td><td>Long lLeftPush(String key, String value)</td><td>å­˜å‚¨åœ¨listå¤´éƒ¨</td></tr><tr><td>4</td><td>Long lLeftPushAll(String key, Stringâ€¦ value)</td><td>å­˜å‚¨åœ¨listå¤´éƒ¨</td></tr><tr><td>5</td><td>Long lLeftPushAll(String key, Collection value)</td><td>å­˜å‚¨åœ¨listå¤´éƒ¨</td></tr><tr><td>6</td><td>Long lLeftPushIfPresent(String key, String value)</td><td>å½“listå­˜åœ¨çš„æ—¶å€™æ‰åŠ å…¥</td></tr><tr><td>7</td><td>lLeftPush(String key, String pivot, String value)</td><td>å¦‚æœpivotå­˜åœ¨,å†pivotå‰é¢æ·»åŠ </td></tr><tr><td></td><td></td><td></td></tr><tr><td>8</td><td>Long lRightPush(String key, String value)</td><td>å­˜å‚¨åœ¨listå°¾éƒ¨</td></tr><tr><td>9</td><td>Long lRightPushAll(String key, Stringâ€¦ value)</td><td>å­˜å‚¨åœ¨listå°¾éƒ¨</td></tr><tr><td>10</td><td>Long lRightPushAll(String key, Collection value)</td><td>å­˜å‚¨åœ¨listå°¾éƒ¨</td></tr><tr><td>11</td><td>Long lRightPushIfPresent(String key, String value)</td><td>å½“listå­˜åœ¨çš„æ—¶å€™æ‰åŠ å…¥</td></tr><tr><td>12</td><td>lRightPush(String key, String pivot, String value)</td><td>åœ¨pivotå…ƒç´ çš„å³è¾¹æ·»åŠ å€¼</td></tr><tr><td></td><td></td><td></td></tr><tr><td>13</td><td>void lSet(String key, long index, String value)</td><td>é€šè¿‡ç´¢å¼•è®¾ç½®åˆ—è¡¨å…ƒç´ çš„å€¼</td></tr><tr><td></td><td></td><td></td></tr><tr><td>14</td><td>String lLeftPop(String key)</td><td>ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>15</td><td>String lBLeftPop(String key, long timeout, TimeUnit unit)</td><td>ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ å¦‚æœåˆ— è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ– å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢</td></tr><tr><td></td><td></td><td></td></tr><tr><td>16</td><td>String lRightPop(String key)</td><td>ç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ </td></tr><tr><td>17</td><td>String lBRightPop(String key, long timeout, TimeUnit unit)</td><td>ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ å¦‚ æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶ æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢</td></tr><tr><td>18</td><td>String lRightPopAndLeftPush(String sourceKey, String destinationKey)</td><td>ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ å¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨å¹¶è¿”å›</td></tr><tr><td>19</td><td>String lBRightPopAndLeftPush(String sourceKey, String destinationKey,,long timeout, TimeUnit unit)</td><td>ä»åˆ—è¡¨ä¸­å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå°†å¼¹å‡ºçš„å…ƒç´ æ’å…¥åˆ° å¦å¤–ä¸€ä¸ªåˆ—è¡¨ä¸­å¹¶è¿”å›å®ƒï¼› å¦‚æœåˆ—è¡¨æ²¡ æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡º å…ƒç´ ä¸ºæ­¢</td></tr><tr><td></td><td></td><td></td></tr><tr><td>20</td><td>Long lRemove(String key, long index, String value)</td><td>åˆ é™¤é›†åˆä¸­å€¼ç­‰äºvalueå¾—å…ƒç´ </td></tr><tr><td>21</td><td>void lTrim(String key, long start, long end)</td><td>è£å‰ªlist</td></tr><tr><td>22</td><td>Long lLen(String key)</td><td>è·å–åˆ—è¡¨é•¿åº¦</td></tr></tbody></table><hr><h3 id="äº”ã€Setç›¸å…³çš„æ“ä½œ"><a href="#äº”ã€Setç›¸å…³çš„æ“ä½œ" class="headerlink" title="äº”ã€Setç›¸å…³çš„æ“ä½œ"></a>äº”ã€Setç›¸å…³çš„æ“ä½œ</h3><h4 id="1-æ·»åŠ æ“ä½œï¼š"><a href="#1-æ·»åŠ æ“ä½œï¼š" class="headerlink" title="1.æ·»åŠ æ“ä½œï¼š"></a>1.æ·»åŠ æ“ä½œï¼š</h4><pre><code>//æ·»åŠ Long sAdd(String key, String... values);</code></pre><h4 id="2-è·å–æ“ä½œï¼š"><a href="#2-è·å–æ“ä½œï¼š" class="headerlink" title="2.è·å–æ“ä½œï¼š"></a>2.è·å–æ“ä½œï¼š</h4><pre><code class="java">//è·å–é›†åˆæ‰€æœ‰å…ƒç´ Set&lt;String&gt; sMembers(String key);//è·å–é›†åˆå¤§å°Long sSize(String key);//åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«valueBoolean sIsMember(String key, Object value);//éšæœºè·å–é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ String sRandomMember(String key);//éšæœºè·å–é›†åˆcountä¸ªå…ƒç´ List&lt;String&gt; sRandomMembers(String key, long count);//éšæœºè·å–é›†åˆä¸­countä¸ªå…ƒç´ å¹¶ä¸”å»é™¤é‡å¤çš„Set&lt;String&gt; sDistinctRandomMembers(String key, long count);//ä½¿ç”¨è¿­ä»£å™¨è·å–å…ƒç´ Cursor&lt;String&gt; sScan(String key, ScanOptions options);//-------------------------------------------------------------------------------------//è·å–ä¸¤ä¸ªé›†åˆçš„äº¤é›†Set&lt;String&gt; sIntersect(String key, String otherKey);//è·å–keyé›†åˆä¸å¤šä¸ªé›†åˆçš„äº¤é›†Set&lt;String&gt; sIntersect(String key, Collection&lt;String&gt; otherKeys);//keyé›†åˆä¸destKeyé›†åˆçš„äº¤é›†å­˜å‚¨åˆ°destKeyé›†åˆä¸­Long sIntersectAndStore(String key, String otherKey, String destKey);//keyé›†åˆä¸å¤šä¸ªé›†åˆçš„äº¤é›†å­˜å‚¨åˆ°destKeyé›†åˆä¸­Long sIntersectAndStore(String key, Collection&lt;String&gt; otherKeys, String destKey)//--------------------------------------------------------------------------------------//è·å–ä¸¤ä¸ªé›†åˆçš„å¹¶é›†Set&lt;String&gt; sUnion(String key, String otherKeys);//è·å–keyé›†åˆä¸å¤šä¸ªé›†åˆçš„å¹¶é›†Set&lt;String&gt; sUnion(String key, Collection&lt;String&gt; otherKeys);//keyé›†åˆä¸otherKeyé›†åˆçš„å¹¶é›†å­˜å‚¨åˆ°destKeyä¸­Long sUnionAndStore(String key, String otherKey, String destKey);//keyé›†åˆä¸å¤šä¸ªé›†åˆçš„å¹¶é›†å­˜å‚¨åˆ°destKeyä¸­Long sUnionAndStore(String key, Collection&lt;String&gt; otherKeys, String destKey);//-------------------------------------------------------------------------------------//è·å–ä¸¤ä¸ªé›†åˆçš„å·®é›†Set&lt;String&gt; sDifference(String key, String otherKey);//è·å–keyé›†åˆä¸å¤šä¸ªé›†åˆçš„å·®é›†Set&lt;String&gt; sDifference(String key, Collection&lt;String&gt; otherKeys);//keyé›†åˆä¸otherKeyé›†åˆçš„å·®é›†å­˜å‚¨åˆ°destKeyä¸­Long sDifference(String key, String otherKey, String destKey);//keyé›†åˆä¸å¤šä¸ªé›†åˆçš„å·®é›†å­˜å‚¨åˆ°destKeyä¸­Long sDifference(String key, Collection&lt;String&gt; otherKeys, String destKey);</code></pre><h4 id="3-ä¿®æ”¹æ“ä½œï¼š"><a href="#3-ä¿®æ”¹æ“ä½œï¼š" class="headerlink" title="3.ä¿®æ”¹æ“ä½œï¼š"></a>3.ä¿®æ”¹æ“ä½œï¼š</h4><pre><code class="java">//ç§»é™¤Long sRemove(String key, Object... values);//éšæœºç§»é™¤ä¸€ä¸ªå…ƒç´ String sPop(String key);//å°†keyé›†åˆä¸­valueå…ƒç´ ç§»åˆ°destKeyé›†åˆä¸­Boolean sMove(String key, String value, String destKey);</code></pre><h3 id="å…­ã€zsetæ•°æ®ç±»å‹æ“ä½œ"><a href="#å…­ã€zsetæ•°æ®ç±»å‹æ“ä½œ" class="headerlink" title="å…­ã€zsetæ•°æ®ç±»å‹æ“ä½œ"></a>å…­ã€zsetæ•°æ®ç±»å‹æ“ä½œ</h3><h4 id="1-æ·»åŠ æ“ä½œï¼š-1"><a href="#1-æ·»åŠ æ“ä½œï¼š-1" class="headerlink" title="1.æ·»åŠ æ“ä½œï¼š"></a>1.æ·»åŠ æ“ä½œï¼š</h4><pre><code class="java">//æ·»åŠ å…ƒç´ ,æœ‰åºé›†åˆæ˜¯æŒ‰ç…§å…ƒç´ çš„scoreå€¼ç”±å°åˆ°å¤§æ’åˆ—Boolean zAdd(String key, String value, double score);//æ‰¹é‡æ·»åŠ Long zAdd(String key, Set&lt;TypedTuple&lt;String&gt;&gt; values);//TypedTupleä½¿ç”¨TypedTuple&lt;String&gt; objectTypedTuple1 = new DefaultTypedTuple&lt;String&gt;(value, score);</code></pre><h4 id="2-è·å–æ“ä½œï¼š-1"><a href="#2-è·å–æ“ä½œï¼š-1" class="headerlink" title="2.è·å–æ“ä½œï¼š"></a>2.è·å–æ“ä½œï¼š</h4><pre><code class="java">//è·å–é›†åˆçš„å…ƒç´ , ä»å°åˆ°å¤§æ’åº, startå¼€å§‹ä½ç½®, endç»“æŸä½ç½®Set&lt;String&gt; zRange(String key, long start, long end);//è·å–é›†åˆå…ƒç´ , å¹¶ä¸”æŠŠscoreå€¼ä¹Ÿè·å–Set&lt;TypedTuple&lt;String&gt;&gt; zRangeWithScores(String key, long start, long end);//æ ¹æ®Scoreå€¼æŸ¥è¯¢é›†åˆå…ƒç´ çš„å€¼, ä»å°åˆ°å¤§æ’åºSet&lt;String&gt; zRangeByScore(String key, double min, double max);//æ ¹æ®Scoreå€¼æŸ¥è¯¢é›†åˆå…ƒç´ , ä»å°åˆ°å¤§æ’åºSet&lt;TypedTuple&lt;String&gt;&gt; zRangeByScoreWithScores(String key, double min, double max);//æ ¹æ®Scoreå€¼æŸ¥è¯¢é›†åˆå…ƒç´ , ä»å°åˆ°å¤§æ’åºSet&lt;TypedTuple&lt;String&gt;&gt; zRangeByScoreWithScores(String key, double min, double max, long start, long end);//----------------------------------------------------------------------------------//è·å–é›†åˆçš„å…ƒç´ , ä»å¤§åˆ°å°æ’åºSet&lt;String&gt; zReverseRange(String key, long start, long end);//è·å–é›†åˆçš„å…ƒç´ , ä»å¤§åˆ°å°æ’åº, å¹¶è¿”å›scoreå€¼Set&lt;TypedTuple&lt;String&gt;&gt; zReverseRangeWithScores(String key, long start, long end);//æ ¹æ®Scoreå€¼æŸ¥è¯¢é›†åˆå…ƒç´ , ä»å¤§åˆ°å°æ’åºSet&lt;String&gt; zReverseRangeByScore(String key, double min, double max);//æ ¹æ®Scoreå€¼æŸ¥è¯¢é›†åˆå…ƒç´ , ä»å¤§åˆ°å°æ’åºSet&lt;TypedTuple&lt;String&gt;&gt; zReverseRangeByScoreWithScores(String key, double min, double max);//Set&lt;String&gt; zReverseRangeByScore(String key, double min, double max, long start, long end);//-----------------------------------------------------------------------------------//è¿”å›å…ƒç´ åœ¨é›†åˆçš„æ’å,æœ‰åºé›†åˆæ˜¯æŒ‰ç…§å…ƒç´ çš„scoreå€¼ç”±å°åˆ°å¤§æ’åˆ—Long zRank(String key, Object value);//è¿”å›å…ƒç´ åœ¨é›†åˆçš„æ’å,æŒ‰å…ƒç´ çš„scoreå€¼ç”±å¤§åˆ°å°æ’åˆ—Long zReverseRank(String key, Object value);//æ ¹æ®scoreå€¼è·å–é›†åˆå…ƒç´ æ•°é‡Long zCount(String key, double min, double max);//è·å–é›†åˆå¤§å°Long zSize(String key);//è·å–é›†åˆå¤§å°Long zZCard(String key);//è·å–é›†åˆä¸­valueå…ƒç´ çš„scoreå€¼Double zScore(String key, Object value);//------------------------------------------------------------------------------------//è·å–keyå’ŒotherKeyçš„å¹¶é›†å¹¶å­˜å‚¨åœ¨destKeyä¸­Long zUnionAndStore(String key, String otherKey, String destKey);//è·å–keyå’Œå¤šä¸ªé›†åˆçš„å¹¶é›†å¹¶å­˜å‚¨åœ¨destKeyä¸­Long zUnionAndStore(String key, Collection&lt;String&gt; otherKeys, String destKey)//-----------------------------------------------------------------------------------//è·å–keyå’ŒotherKeyçš„äº¤é›†å¹¶å­˜å‚¨åœ¨destKeyä¸­Long zIntersectAndStore(String key, String otherKey, String destKey);//è·å–keyå’Œå¤šä¸ªé›†åˆçš„äº¤é›†å¹¶å­˜å‚¨åœ¨destKeyä¸­Long zIntersectAndStore(String key, Collection&lt;String&gt; otherKeys, String destKey);//-----------------------------------------------------------------------------------//ä½¿ç”¨è¿­ä»£å™¨è·å–Cursor&lt;TypedTuple&lt;String&gt;&gt; zScan(String key, ScanOptions options);</code></pre><h4 id="3-ä¿®æ”¹æ“ä½œï¼š-1"><a href="#3-ä¿®æ”¹æ“ä½œï¼š-1" class="headerlink" title="3.ä¿®æ”¹æ“ä½œï¼š"></a>3.ä¿®æ”¹æ“ä½œï¼š</h4><pre><code class="java">//ç§»é™¤Long zRemove(String key, Object... values);//å¢åŠ å…ƒç´ çš„scoreå€¼ï¼Œå¹¶è¿”å›å¢åŠ åçš„å€¼Double zIncrementScore(String key, String value, double delta);//ç§»é™¤æŒ‡å®šç´¢å¼•ä½ç½®çš„æˆå‘˜Long zRemoveRange(String key, long start, long end);//æ ¹æ®æŒ‡å®šçš„scoreå€¼çš„èŒƒå›´æ¥ç§»é™¤æˆå‘˜Long zRemoveRangeByScore(String key, double min, double max);</code></pre><h2 id="çŸ¥è¯†è¡¥å……"><a href="#çŸ¥è¯†è¡¥å……" class="headerlink" title="çŸ¥è¯†è¡¥å……"></a>çŸ¥è¯†è¡¥å……</h2><h3 id="RedisçŸ¥è¯†è¡¥å……"><a href="#RedisçŸ¥è¯†è¡¥å……" class="headerlink" title="RedisçŸ¥è¯†è¡¥å……"></a>RedisçŸ¥è¯†è¡¥å……</h3><p>Redis å¯ä»¥å­˜å‚¨é”®ä¸5ç§ä¸åŒæ•°æ®ç»“æ„ç±»å‹ä¹‹é—´çš„æ˜ å°„ï¼Œè¿™5ç§æ•°æ®ç»“æ„ç±»å‹åˆ†åˆ«ä¸ºï¼šStringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Listï¼ˆåˆ—è¡¨ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€Hashï¼ˆæ•£åˆ—ï¼‰å’Œ Zsetï¼ˆæœ‰åºé›†åˆï¼‰ã€‚   </p><table><thead><tr><th>ç»“æ„ç±»å‹</th><th>ç»“æ„å­˜å‚¨çš„å€¼</th><th>ç»“æ„çš„è¯»å†™èƒ½åŠ›</th></tr></thead><tbody><tr><td>String</td><td>å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°</td><td>å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œï¼›å¯¹è±¡å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢(increment)æˆ–è€…è‡ªå‡(decrement)</td></tr><tr><td>List</td><td>ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸²</td><td>ä»é“¾è¡¨çš„ä¸¤ç«¯æ¨å…¥æˆ–è€…å¼¹å‡ºå…ƒç´ ï¼›æ ¹æ®åç§»é‡å¯¹é“¾è¡¨è¿›è¡Œä¿®å‰ª(trim)ï¼›è¯»å–å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼›æ ¹æ®å€¼æ¥æŸ¥æ‰¾æˆ–è€…ç§»é™¤å…ƒç´ </td></tr><tr><td>Set</td><td>åŒ…å«å­—ç¬¦ä¸²çš„æ— åºæ”¶é›†å™¨(unorderedcollection)ï¼Œå¹¶ä¸”è¢«åŒ…å«çš„æ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€å„ä¸ç›¸åŒ</td><td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´ ï¼›æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºæŸä¸ªé›†åˆä¸­ï¼›è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼›ä»é›†åˆé‡Œå–å¼„éšæœºè·å–å…ƒç´ </td></tr><tr><td>Hash</td><td>åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨</td><td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹ï¼›è·å–æ‰€æœ‰é”®å€¼å¯¹</td></tr><tr><td>ZSet</td><td>å­—ç¬¦ä¸²æˆå‘˜(member)ä¸æµ®ç‚¹æ•°åˆ†å€¼(score)ä¹‹é—´çš„æœ‰åºæ˜ å°„ï¼Œå…ƒç´ çš„æ’åˆ—é¡ºåºç”±åˆ†å€¼çš„å¤§å°å†³å®š</td><td>æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ ï¼›æ ¹æ®åˆ†å€¼èŒƒå›´(range)æˆ–è€…æˆå‘˜æ¥è·å–å…ƒç´ </td></tr></tbody></table><h3 id="RedisTemplateå’ŒStringRedisTemplate"><a href="#RedisTemplateå’ŒStringRedisTemplate" class="headerlink" title="RedisTemplateå’ŒStringRedisTemplate"></a>RedisTemplateå’ŒStringRedisTemplate</h3><p>äºŒè€…ä¸»è¦åŒºåˆ«æ˜¯ä»–ä»¬ä½¿ç”¨çš„åºåˆ—åŒ–ç±»ä¸ä¸€æ ·ï¼ŒRedisTemplateä½¿ç”¨çš„æ˜¯JdkSerializationRedisSerializerï¼Œ StringRedisTemplateä½¿ç”¨çš„æ˜¯StringRedisSerializerï¼Œä¸¤è€…çš„æ•°æ®æ˜¯ä¸å…±é€šçš„ã€‚</p><h4 id="RedisTemplateï¼š"><a href="#RedisTemplateï¼š" class="headerlink" title="RedisTemplateï¼š"></a>RedisTemplateï¼š</h4><p> RedisTemplateä½¿ç”¨çš„æ˜¯JDKçš„åºåˆ—åŒ–ç­–ç•¥ï¼Œå‘Rediså­˜å…¥æ•°æ®ä¼šå°†æ•°æ®å…ˆåºåˆ—åŒ–æˆå­—èŠ‚æ•°ç»„ç„¶ååœ¨å­˜å…¥Redisæ•°æ®åº“ï¼Œè¿™ä¸ªæ—¶å€™æ‰“å¼€RedisæŸ¥çœ‹çš„æ—¶å€™ï¼Œä½ ä¼šçœ‹åˆ°ä½ çš„æ•°æ®ä¸æ˜¯ä»¥å¯è¯»çš„å½¢å¼å±•ç°çš„ï¼Œè€Œæ˜¯ä»¥å­—èŠ‚æ•°ç»„æ˜¾ç¤ºï¼Œç±»ä¼¼ä¸‹é¢ï¼š\xAC\xED\x00\x05t\x05sr\x00ã€‚  æ‰€ä»¥ä½¿ç”¨RedisTemplateå¯ä»¥ç›´æ¥æŠŠä¸€ä¸ªjavaå¯¹è±¡ç›´æ¥å­˜å‚¨åœ¨redisé‡Œé¢ï¼Œä½†æ˜¯å­˜è¿›å»çš„æ•°æ®æ˜¯ä¸æ˜“ç›´è§‚çš„è¯»çš„ï¼Œä¸é€šç”¨çš„ï¼Œå»ºè®®æœ€å¥½ä¸è¦ç›´æ¥å­˜ä¸€ä¸ªObjectå¯¹è±¡ï¼Œå¯ä»¥å˜æˆHashæ¥å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥è½¬æˆjsonæ ¼å¼çš„æ•°æ®æ¥å­˜å‚¨ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ä¹Ÿæ˜¯å¾ˆå¤šéƒ½é‡‡ç”¨jsonæ ¼å¼æ¥å­˜å‚¨çš„ã€‚</p><h4 id="StringRedisTemplate"><a href="#StringRedisTemplate" class="headerlink" title="StringRedisTemplate:"></a>StringRedisTemplate:</h4><p> StringRedisTemplateé»˜è®¤é‡‡ç”¨çš„æ˜¯Stringçš„åºåˆ—åŒ–ç­–ç•¥ï¼Œä¿å­˜çš„keyå’Œvalueéƒ½æ˜¯é‡‡ç”¨æ­¤ç­–ç•¥åºåˆ—åŒ–ä¿å­˜çš„ã€‚StringRedisTemplateæ˜¯ç»§æ‰¿RedisTemplateçš„ï¼Œè¿™ç§å¯¹redisçš„æ“æ–¹å¼æ›´ä¼˜é›…ï¼Œå› ä¸ºRedisTemplateä»¥å­—èŠ‚æ•°ç»„çš„å½¢å¼å­˜å‚¨ä¸åˆ©äºç®¡ç†ï¼Œä¹Ÿä¸é€šç”¨ã€‚  </p><h3 id="ä¸‰ã€Redisä¸Springçš„é›†æˆ"><a href="#ä¸‰ã€Redisä¸Springçš„é›†æˆ" class="headerlink" title="ä¸‰ã€Redisä¸Springçš„é›†æˆ"></a>ä¸‰ã€Redisä¸Springçš„é›†æˆ</h3><p>1.é›†æˆé…ç½®</p><pre><code class="xml">&lt;bean id=&quot;poolConfig&quot; class=&quot;redis.clients.jedis.JedisPoolConfig&quot;&gt;    &lt;property name=&quot;maxIdle&quot; value=&quot;300&quot; /&gt;    &lt;property name=&quot;maxTotal&quot; value=&quot;600&quot; /&gt;    &lt;property name=&quot;maxWaitMillis&quot; value=&quot;1000&quot; /&gt;    &lt;property name=&quot;testOnBorrow&quot; value=&quot;true&quot; /&gt;&lt;/bean&gt;&lt;bean id=&quot;jedisConnectionFactory&quot;    class=&quot;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&quot;&gt;    &lt;property name=&quot;hostName&quot; value=&quot;127.0.0.1&quot; /&gt;    &lt;property name=&quot;password&quot; value=&quot;WangFan01!&quot; /&gt;    &lt;property name=&quot;port&quot; value=&quot;6379&quot; /&gt;    &lt;property name=&quot;poolConfig&quot; ref=&quot;poolConfig&quot; /&gt;&lt;/bean&gt;&lt;bean id=&quot;redisTemplate&quot; class=&quot;org.springframework.data.redis.core.StringRedisTemplate&quot;&gt;    &lt;property name=&quot;connectionFactory&quot; ref=&quot;jedisConnectionFactory&quot; /&gt;&lt;/bean&gt;&lt;!-- è¿™é‡Œå¯ä»¥é…ç½®å¤šä¸ªredis --&gt;&lt;bean id=&quot;redisUtil&quot; class=&quot;com.wf.ew.core.utils.RedisUtil&quot;&gt;    &lt;property name=&quot;redisTemplate&quot; ref=&quot;redisTemplate&quot; /&gt;&lt;/bean&gt;</code></pre><p>2.ä½¿ç”¨RedisUtilå·¥å…·ç±»æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code class="java">@Autowiredprivate RedisUtil redisUtil;</code></pre><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><pre><code class="java">package com.wf.ew.core.utils;import org.springframework.data.redis.connection.DataType;import org.springframework.data.redis.core.Cursor;import org.springframework.data.redis.core.ScanOptions;import org.springframework.data.redis.core.StringRedisTemplate;import org.springframework.data.redis.core.ZSetOperations.TypedTuple;import java.util.Collection;import java.util.Date;import java.util.List;import java.util.Map;import java.util.Map.Entry;import java.util.Set;import java.util.concurrent.TimeUnit;/** * Rediså·¥å…·ç±» *  * @author WangFan * @date 2018-02-24 ä¸‹åˆ03:09:50 * @version 1.1 (GitHubæ–‡æ¡£: https://github.com/whvcse/RedisUtil ) */public class RedisUtil {    private StringRedisTemplate redisTemplate;    public void setRedisTemplate(StringRedisTemplate redisTemplate) {        this.redisTemplate = redisTemplate;    }    public StringRedisTemplate getRedisTemplate() {        return this.redisTemplate;    }    /** -------------------keyç›¸å…³æ“ä½œ--------------------- */    /**     * åˆ é™¤key     *      * @param key     */    public void delete(String key) {        redisTemplate.delete(key);    }    /**     * æ‰¹é‡åˆ é™¤key     *      * @param keys     */    public void delete(Collection&lt;String&gt; keys) {        redisTemplate.delete(keys);    }    /**     * åºåˆ—åŒ–key     *      * @param key     * @return     */    public byte[] dump(String key) {        return redisTemplate.dump(key);    }    /**     * æ˜¯å¦å­˜åœ¨key     *      * @param key     * @return     */    public Boolean hasKey(String key) {        return redisTemplate.hasKey(key);    }    /**     * è®¾ç½®è¿‡æœŸæ—¶é—´     *      * @param key     * @param timeout     * @param unit     * @return     */    public Boolean expire(String key, long timeout, TimeUnit unit) {        return redisTemplate.expire(key, timeout, unit);    }    /**     * è®¾ç½®è¿‡æœŸæ—¶é—´     *      * @param key     * @param date     * @return     */    public Boolean expireAt(String key, Date date) {        return redisTemplate.expireAt(key, date);    }    /**     * æŸ¥æ‰¾åŒ¹é…çš„key     *      * @param pattern     * @return     */    public Set&lt;String&gt; keys(String pattern) {        return redisTemplate.keys(pattern);    }    /**     * å°†å½“å‰æ•°æ®åº“çš„ key ç§»åŠ¨åˆ°ç»™å®šçš„æ•°æ®åº“ db å½“ä¸­     *      * @param key     * @param dbIndex     * @return     */    public Boolean move(String key, int dbIndex) {        return redisTemplate.move(key, dbIndex);    }    /**     * ç§»é™¤ key çš„è¿‡æœŸæ—¶é—´ï¼Œkey å°†æŒä¹…ä¿æŒ     *      * @param key     * @return     */    public Boolean persist(String key) {        return redisTemplate.persist(key);    }    /**     * è¿”å› key çš„å‰©ä½™çš„è¿‡æœŸæ—¶é—´     *      * @param key     * @param unit     * @return     */    public Long getExpire(String key, TimeUnit unit) {        return redisTemplate.getExpire(key, unit);    }    /**     * è¿”å› key çš„å‰©ä½™çš„è¿‡æœŸæ—¶é—´     *      * @param key     * @return     */    public Long getExpire(String key) {        return redisTemplate.getExpire(key);    }    /**     * ä»å½“å‰æ•°æ®åº“ä¸­éšæœºè¿”å›ä¸€ä¸ª key     *      * @return     */    public String randomKey() {        return redisTemplate.randomKey();    }    /**     * ä¿®æ”¹ key çš„åç§°     *      * @param oldKey     * @param newKey     */    public void rename(String oldKey, String newKey) {        redisTemplate.rename(oldKey, newKey);    }    /**     * ä»…å½“ newkey ä¸å­˜åœ¨æ—¶ï¼Œå°† oldKey æ”¹åä¸º newkey     *      * @param oldKey     * @param newKey     * @return     */    public Boolean renameIfAbsent(String oldKey, String newKey) {        return redisTemplate.renameIfAbsent(oldKey, newKey);    }    /**     * è¿”å› key æ‰€å‚¨å­˜çš„å€¼çš„ç±»å‹     *      * @param key     * @return     */    public DataType type(String key) {        return redisTemplate.type(key);    }    /** -------------------stringç›¸å…³æ“ä½œ--------------------- */    /**     * è®¾ç½®æŒ‡å®š key çš„å€¼     * @param key     * @param value     */    public void set(String key, String value) {        redisTemplate.opsForValue().set(key, value);    }    /**     * è·å–æŒ‡å®š key çš„å€¼     * @param key     * @return     */    public String get(String key) {        return redisTemplate.opsForValue().get(key);    }    /**     * è¿”å› key ä¸­å­—ç¬¦ä¸²å€¼çš„å­å­—ç¬¦     * @param key     * @param start     * @param end     * @return     */    public String getRange(String key, long start, long end) {        return redisTemplate.opsForValue().get(key, start, end);    }    /**     * å°†ç»™å®š key çš„å€¼è®¾ä¸º value ï¼Œå¹¶è¿”å› key çš„æ—§å€¼(old value)     *      * @param key     * @param value     * @return     */    public String getAndSet(String key, String value) {        return redisTemplate.opsForValue().getAndSet(key, value);    }    /**     * å¯¹ key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè·å–æŒ‡å®šåç§»é‡ä¸Šçš„ä½(bit)     *      * @param key     * @param offset     * @return     */    public Boolean getBit(String key, long offset) {        return redisTemplate.opsForValue().getBit(key, offset);    }    /**     * æ‰¹é‡è·å–     *      * @param keys     * @return     */    public List&lt;String&gt; multiGet(Collection&lt;String&gt; keys) {        return redisTemplate.opsForValue().multiGet(keys);    }    /**     * è®¾ç½®ASCIIç , å­—ç¬¦ä¸²&#39;a&#39;çš„ASCIIç æ˜¯97, è½¬ä¸ºäºŒè¿›åˆ¶æ˜¯&#39;01100001&#39;, æ­¤æ–¹æ³•æ˜¯å°†äºŒè¿›åˆ¶ç¬¬offsetä½å€¼å˜ä¸ºvalue     *      * @param key     * @param postion     *            ä½ç½®     * @param value     *            å€¼,trueä¸º1, falseä¸º0     * @return     */    public boolean setBit(String key, long offset, boolean value) {        return redisTemplate.opsForValue().setBit(key, offset, value);    }    /**     * å°†å€¼ value å…³è”åˆ° key ï¼Œå¹¶å°† key çš„è¿‡æœŸæ—¶é—´è®¾ä¸º timeout     *      * @param key     * @param value     * @param timeout     *            è¿‡æœŸæ—¶é—´     * @param unit     *            æ—¶é—´å•ä½, å¤©:TimeUnit.DAYS å°æ—¶:TimeUnit.HOURS åˆ†é’Ÿ:TimeUnit.MINUTES     *            ç§’:TimeUnit.SECONDS æ¯«ç§’:TimeUnit.MILLISECONDS     */    public void setEx(String key, String value, long timeout, TimeUnit unit) {        redisTemplate.opsForValue().set(key, value, timeout, unit);    }    /**     * åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶è®¾ç½® key çš„å€¼     *      * @param key     * @param value     * @return ä¹‹å‰å·²ç»å­˜åœ¨è¿”å›false,ä¸å­˜åœ¨è¿”å›true     */    public boolean setIfAbsent(String key, String value) {        return redisTemplate.opsForValue().setIfAbsent(key, value);    }    /**     * ç”¨ value å‚æ•°è¦†å†™ç»™å®š key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œä»åç§»é‡ offset å¼€å§‹     *      * @param key     * @param value     * @param offset     *            ä»æŒ‡å®šä½ç½®å¼€å§‹è¦†å†™     */    public void setRange(String key, String value, long offset) {        redisTemplate.opsForValue().set(key, value, offset);    }    /**     * è·å–å­—ç¬¦ä¸²çš„é•¿åº¦     *      * @param key     * @return     */    public Long size(String key) {        return redisTemplate.opsForValue().size(key);    }    /**     * æ‰¹é‡æ·»åŠ      *      * @param maps     */    public void multiSet(Map&lt;String, String&gt; maps) {        redisTemplate.opsForValue().multiSet(maps);    }    /**     * åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®š key éƒ½ä¸å­˜åœ¨     *      * @param maps     * @return ä¹‹å‰å·²ç»å­˜åœ¨è¿”å›false,ä¸å­˜åœ¨è¿”å›true     */    public boolean multiSetIfAbsent(Map&lt;String, String&gt; maps) {        return redisTemplate.opsForValue().multiSetIfAbsent(maps);    }    /**     * å¢åŠ (è‡ªå¢é•¿), è´Ÿæ•°åˆ™ä¸ºè‡ªå‡     *      * @param key     * @param value     * @return     */    public Long incrBy(String key, long increment) {        return redisTemplate.opsForValue().increment(key, increment);    }    /**     *      * @param key     * @param value     * @return     */    public Double incrByFloat(String key, double increment) {        return redisTemplate.opsForValue().increment(key, increment);    }    /**     * è¿½åŠ åˆ°æœ«å°¾     *      * @param key     * @param value     * @return     */    public Integer append(String key, String value) {        return redisTemplate.opsForValue().append(key, value);    }    /** -------------------hashç›¸å…³æ“ä½œ------------------------- */    /**     * è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼     *      * @param key     * @param field     * @return     */    public Object hGet(String key, String field) {        return redisTemplate.opsForHash().get(key, field);    }    /**     * è·å–æ‰€æœ‰ç»™å®šå­—æ®µçš„å€¼     *      * @param key     * @return     */    public Map&lt;Object, Object&gt; hGetAll(String key) {        return redisTemplate.opsForHash().entries(key);    }    /**     * è·å–æ‰€æœ‰ç»™å®šå­—æ®µçš„å€¼     *      * @param key     * @param fields     * @return     */    public List&lt;Object&gt; hMultiGet(String key, Collection&lt;Object&gt; fields) {        return redisTemplate.opsForHash().multiGet(key, fields);    }    public void hPut(String key, String hashKey, String value) {        redisTemplate.opsForHash().put(key, hashKey, value);    }    public void hPutAll(String key, Map&lt;String, String&gt; maps) {        redisTemplate.opsForHash().putAll(key, maps);    }    /**     * ä»…å½“hashKeyä¸å­˜åœ¨æ—¶æ‰è®¾ç½®     *      * @param key     * @param hashKey     * @param value     * @return     */    public Boolean hPutIfAbsent(String key, String hashKey, String value) {        return redisTemplate.opsForHash().putIfAbsent(key, hashKey, value);    }    /**     * åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå“ˆå¸Œè¡¨å­—æ®µ     *      * @param key     * @param fields     * @return     */    public Long hDelete(String key, Object... fields) {        return redisTemplate.opsForHash().delete(key, fields);    }    /**     * æŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼ŒæŒ‡å®šçš„å­—æ®µæ˜¯å¦å­˜åœ¨     *      * @param key     * @param field     * @return     */    public boolean hExists(String key, String field) {        return redisTemplate.opsForHash().hasKey(key, field);    }    /**     * ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„æŒ‡å®šå­—æ®µçš„æ•´æ•°å€¼åŠ ä¸Šå¢é‡ increment     *      * @param key     * @param field     * @param increment     * @return     */    public Long hIncrBy(String key, Object field, long increment) {        return redisTemplate.opsForHash().increment(key, field, increment);    }    /**     * ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„æŒ‡å®šå­—æ®µçš„æ•´æ•°å€¼åŠ ä¸Šå¢é‡ increment     *      * @param key     * @param field     * @param delta     * @return     */    public Double hIncrByFloat(String key, Object field, double delta) {        return redisTemplate.opsForHash().increment(key, field, delta);    }    /**     * è·å–æ‰€æœ‰å“ˆå¸Œè¡¨ä¸­çš„å­—æ®µ     *      * @param key     * @return     */    public Set&lt;Object&gt; hKeys(String key) {        return redisTemplate.opsForHash().keys(key);    }    /**     * è·å–å“ˆå¸Œè¡¨ä¸­å­—æ®µçš„æ•°é‡     *      * @param key     * @return     */    public Long hSize(String key) {        return redisTemplate.opsForHash().size(key);    }    /**     * è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å€¼     *      * @param key     * @return     */    public List&lt;Object&gt; hValues(String key) {        return redisTemplate.opsForHash().values(key);    }    /**     * è¿­ä»£å“ˆå¸Œè¡¨ä¸­çš„é”®å€¼å¯¹     *      * @param key     * @param options     * @return     */    public Cursor&lt;Entry&lt;Object, Object&gt;&gt; hScan(String key, ScanOptions options) {        return redisTemplate.opsForHash().scan(key, options);    }    /** ------------------------listç›¸å…³æ“ä½œ---------------------------- */    /**     * é€šè¿‡ç´¢å¼•è·å–åˆ—è¡¨ä¸­çš„å…ƒç´      *      * @param key     * @param index     * @return     */    public String lIndex(String key, long index) {        return redisTemplate.opsForList().index(key, index);    }    /**     * è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´      *      * @param key     * @param start     *            å¼€å§‹ä½ç½®, 0æ˜¯å¼€å§‹ä½ç½®     * @param end     *            ç»“æŸä½ç½®, -1è¿”å›æ‰€æœ‰     * @return     */    public List&lt;String&gt; lRange(String key, long start, long end) {        return redisTemplate.opsForList().range(key, start, end);    }    /**     * å­˜å‚¨åœ¨listå¤´éƒ¨     *      * @param key     * @param value     * @return     */    public Long lLeftPush(String key, String value) {        return redisTemplate.opsForList().leftPush(key, value);    }    /**     *      * @param key     * @param value     * @return     */    public Long lLeftPushAll(String key, String... value) {        return redisTemplate.opsForList().leftPushAll(key, value);    }    /**     *      * @param key     * @param value     * @return     */    public Long lLeftPushAll(String key, Collection&lt;String&gt; value) {        return redisTemplate.opsForList().leftPushAll(key, value);    }    /**     * å½“listå­˜åœ¨çš„æ—¶å€™æ‰åŠ å…¥     *      * @param key     * @param value     * @return     */    public Long lLeftPushIfPresent(String key, String value) {        return redisTemplate.opsForList().leftPushIfPresent(key, value);    }    /**     * å¦‚æœpivotå­˜åœ¨,å†pivotå‰é¢æ·»åŠ      *      * @param key     * @param pivot     * @param value     * @return     */    public Long lLeftPush(String key, String pivot, String value) {        return redisTemplate.opsForList().leftPush(key, pivot, value);    }    /**     *      * @param key     * @param value     * @return     */    public Long lRightPush(String key, String value) {        return redisTemplate.opsForList().rightPush(key, value);    }    /**     *      * @param key     * @param value     * @return     */    public Long lRightPushAll(String key, String... value) {        return redisTemplate.opsForList().rightPushAll(key, value);    }    /**     *      * @param key     * @param value     * @return     */    public Long lRightPushAll(String key, Collection&lt;String&gt; value) {        return redisTemplate.opsForList().rightPushAll(key, value);    }    /**     * ä¸ºå·²å­˜åœ¨çš„åˆ—è¡¨æ·»åŠ å€¼     *      * @param key     * @param value     * @return     */    public Long lRightPushIfPresent(String key, String value) {        return redisTemplate.opsForList().rightPushIfPresent(key, value);    }    /**     * åœ¨pivotå…ƒç´ çš„å³è¾¹æ·»åŠ å€¼     *      * @param key     * @param pivot     * @param value     * @return     */    public Long lRightPush(String key, String pivot, String value) {        return redisTemplate.opsForList().rightPush(key, pivot, value);    }    /**     * é€šè¿‡ç´¢å¼•è®¾ç½®åˆ—è¡¨å…ƒç´ çš„å€¼     *      * @param key     * @param index     *            ä½ç½®     * @param value     */    public void lSet(String key, long index, String value) {        redisTemplate.opsForList().set(key, index, value);    }    /**     * ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´      *      * @param key     * @return åˆ é™¤çš„å…ƒç´      */    public String lLeftPop(String key) {        return redisTemplate.opsForList().leftPop(key);    }    /**     * ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢     *      * @param key     * @param timeout     *            ç­‰å¾…æ—¶é—´     * @param unit     *            æ—¶é—´å•ä½     * @return     */    public String lBLeftPop(String key, long timeout, TimeUnit unit) {        return redisTemplate.opsForList().leftPop(key, timeout, unit);    }    /**     * ç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´      *      * @param key     * @return åˆ é™¤çš„å…ƒç´      */    public String lRightPop(String key) {        return redisTemplate.opsForList().rightPop(key);    }    /**     * ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢     *      * @param key     * @param timeout     *            ç­‰å¾…æ—¶é—´     * @param unit     *            æ—¶é—´å•ä½     * @return     */    public String lBRightPop(String key, long timeout, TimeUnit unit) {        return redisTemplate.opsForList().rightPop(key, timeout, unit);    }    /**     * ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨å¹¶è¿”å›     *      * @param sourceKey     * @param destinationKey     * @return     */    public String lRightPopAndLeftPush(String sourceKey, String destinationKey) {        return redisTemplate.opsForList().rightPopAndLeftPush(sourceKey,                destinationKey);    }    /**     * ä»åˆ—è¡¨ä¸­å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå°†å¼¹å‡ºçš„å…ƒç´ æ’å…¥åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨ä¸­å¹¶è¿”å›å®ƒï¼› å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢     *      * @param sourceKey     * @param destinationKey     * @param timeout     * @param unit     * @return     */    public String lBRightPopAndLeftPush(String sourceKey, String destinationKey,            long timeout, TimeUnit unit) {        return redisTemplate.opsForList().rightPopAndLeftPush(sourceKey,                destinationKey, timeout, unit);    }    /**     * åˆ é™¤é›†åˆä¸­å€¼ç­‰äºvalueå¾—å…ƒç´      *      * @param key     * @param index     *            index=0, åˆ é™¤æ‰€æœ‰å€¼ç­‰äºvalueçš„å…ƒç´ ; index&gt;0, ä»å¤´éƒ¨å¼€å§‹åˆ é™¤ç¬¬ä¸€ä¸ªå€¼ç­‰äºvalueçš„å…ƒç´ ;     *            index&lt;0, ä»å°¾éƒ¨å¼€å§‹åˆ é™¤ç¬¬ä¸€ä¸ªå€¼ç­‰äºvalueçš„å…ƒç´ ;     * @param value     * @return     */    public Long lRemove(String key, long index, String value) {        return redisTemplate.opsForList().remove(key, index, value);    }    /**     * è£å‰ªlist     *      * @param key     * @param start     * @param end     */    public void lTrim(String key, long start, long end) {        redisTemplate.opsForList().trim(key, start, end);    }    /**     * è·å–åˆ—è¡¨é•¿åº¦     *      * @param key     * @return     */    public Long lLen(String key) {        return redisTemplate.opsForList().size(key);    }    /** --------------------setç›¸å…³æ“ä½œ-------------------------- */    /**     * setæ·»åŠ å…ƒç´      *      * @param key     * @param values     * @return     */    public Long sAdd(String key, String... values) {        return redisTemplate.opsForSet().add(key, values);    }    /**     * setç§»é™¤å…ƒç´      *      * @param key     * @param values     * @return     */    public Long sRemove(String key, Object... values) {        return redisTemplate.opsForSet().remove(key, values);    }    /**     * ç§»é™¤å¹¶è¿”å›é›†åˆçš„ä¸€ä¸ªéšæœºå…ƒç´      *      * @param key     * @return     */    public String sPop(String key) {        return redisTemplate.opsForSet().pop(key);    }    /**     * å°†å…ƒç´ valueä»ä¸€ä¸ªé›†åˆç§»åˆ°å¦ä¸€ä¸ªé›†åˆ     *      * @param key     * @param value     * @param destKey     * @return     */    public Boolean sMove(String key, String value, String destKey) {        return redisTemplate.opsForSet().move(key, value, destKey);    }    /**     * è·å–é›†åˆçš„å¤§å°     *      * @param key     * @return     */    public Long sSize(String key) {        return redisTemplate.opsForSet().size(key);    }    /**     * åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«value     *      * @param key     * @param value     * @return     */    public Boolean sIsMember(String key, Object value) {        return redisTemplate.opsForSet().isMember(key, value);    }    /**     * è·å–ä¸¤ä¸ªé›†åˆçš„äº¤é›†     *      * @param key     * @param otherKey     * @return     */    public Set&lt;String&gt; sIntersect(String key, String otherKey) {        return redisTemplate.opsForSet().intersect(key, otherKey);    }    /**     * è·å–keyé›†åˆä¸å¤šä¸ªé›†åˆçš„äº¤é›†     *      * @param key     * @param otherKeys     * @return     */    public Set&lt;String&gt; sIntersect(String key, Collection&lt;String&gt; otherKeys) {        return redisTemplate.opsForSet().intersect(key, otherKeys);    }    /**     * keyé›†åˆä¸otherKeyé›†åˆçš„äº¤é›†å­˜å‚¨åˆ°destKeyé›†åˆä¸­     *      * @param key     * @param otherKey     * @param destKey     * @return     */    public Long sIntersectAndStore(String key, String otherKey, String destKey) {        return redisTemplate.opsForSet().intersectAndStore(key, otherKey,                destKey);    }    /**     * keyé›†åˆä¸å¤šä¸ªé›†åˆçš„äº¤é›†å­˜å‚¨åˆ°destKeyé›†åˆä¸­     *      * @param key     * @param otherKeys     * @param destKey     * @return     */    public Long sIntersectAndStore(String key, Collection&lt;String&gt; otherKeys,            String destKey) {        return redisTemplate.opsForSet().intersectAndStore(key, otherKeys,                destKey);    }    /**     * è·å–ä¸¤ä¸ªé›†åˆçš„å¹¶é›†     *      * @param key     * @param otherKeys     * @return     */    public Set&lt;String&gt; sUnion(String key, String otherKeys) {        return redisTemplate.opsForSet().union(key, otherKeys);    }    /**     * è·å–keyé›†åˆä¸å¤šä¸ªé›†åˆçš„å¹¶é›†     *      * @param key     * @param otherKeys     * @return     */    public Set&lt;String&gt; sUnion(String key, Collection&lt;String&gt; otherKeys) {        return redisTemplate.opsForSet().union(key, otherKeys);    }    /**     * keyé›†åˆä¸otherKeyé›†åˆçš„å¹¶é›†å­˜å‚¨åˆ°destKeyä¸­     *      * @param key     * @param otherKey     * @param destKey     * @return     */    public Long sUnionAndStore(String key, String otherKey, String destKey) {        return redisTemplate.opsForSet().unionAndStore(key, otherKey, destKey);    }    /**     * keyé›†åˆä¸å¤šä¸ªé›†åˆçš„å¹¶é›†å­˜å‚¨åˆ°destKeyä¸­     *      * @param key     * @param otherKeys     * @param destKey     * @return     */    public Long sUnionAndStore(String key, Collection&lt;String&gt; otherKeys,            String destKey) {        return redisTemplate.opsForSet().unionAndStore(key, otherKeys, destKey);    }    /**     * è·å–ä¸¤ä¸ªé›†åˆçš„å·®é›†     *      * @param key     * @param otherKey     * @return     */    public Set&lt;String&gt; sDifference(String key, String otherKey) {        return redisTemplate.opsForSet().difference(key, otherKey);    }    /**     * è·å–keyé›†åˆä¸å¤šä¸ªé›†åˆçš„å·®é›†     *      * @param key     * @param otherKeys     * @return     */    public Set&lt;String&gt; sDifference(String key, Collection&lt;String&gt; otherKeys) {        return redisTemplate.opsForSet().difference(key, otherKeys);    }    /**     * keyé›†åˆä¸otherKeyé›†åˆçš„å·®é›†å­˜å‚¨åˆ°destKeyä¸­     *      * @param key     * @param otherKey     * @param destKey     * @return     */    public Long sDifference(String key, String otherKey, String destKey) {        return redisTemplate.opsForSet().differenceAndStore(key, otherKey,                destKey);    }    /**     * keyé›†åˆä¸å¤šä¸ªé›†åˆçš„å·®é›†å­˜å‚¨åˆ°destKeyä¸­     *      * @param key     * @param otherKeys     * @param destKey     * @return     */    public Long sDifference(String key, Collection&lt;String&gt; otherKeys,            String destKey) {        return redisTemplate.opsForSet().differenceAndStore(key, otherKeys,                destKey);    }    /**     * è·å–é›†åˆæ‰€æœ‰å…ƒç´      *      * @param key     * @param otherKeys     * @param destKey     * @return     */    public Set&lt;String&gt; setMembers(String key) {        return redisTemplate.opsForSet().members(key);    }    /**     * éšæœºè·å–é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´      *      * @param key     * @return     */    public String sRandomMember(String key) {        return redisTemplate.opsForSet().randomMember(key);    }    /**     * éšæœºè·å–é›†åˆä¸­countä¸ªå…ƒç´      *      * @param key     * @param count     * @return     */    public List&lt;String&gt; sRandomMembers(String key, long count) {        return redisTemplate.opsForSet().randomMembers(key, count);    }    /**     * éšæœºè·å–é›†åˆä¸­countä¸ªå…ƒç´ å¹¶ä¸”å»é™¤é‡å¤çš„     *      * @param key     * @param count     * @return     */    public Set&lt;String&gt; sDistinctRandomMembers(String key, long count) {        return redisTemplate.opsForSet().distinctRandomMembers(key, count);    }    /**     *      * @param key     * @param options     * @return     */    public Cursor&lt;String&gt; sScan(String key, ScanOptions options) {        return redisTemplate.opsForSet().scan(key, options);    }    /**------------------zSetç›¸å…³æ“ä½œ--------------------------------*/    /**     * æ·»åŠ å…ƒç´ ,æœ‰åºé›†åˆæ˜¯æŒ‰ç…§å…ƒç´ çš„scoreå€¼ç”±å°åˆ°å¤§æ’åˆ—     *      * @param key     * @param value     * @param score     * @return     */    public Boolean zAdd(String key, String value, double score) {        return redisTemplate.opsForZSet().add(key, value, score);    }    /**     *      * @param key     * @param values     * @return     */    public Long zAdd(String key, Set&lt;TypedTuple&lt;String&gt;&gt; values) {        return redisTemplate.opsForZSet().add(key, values);    }    /**     *      * @param key     * @param values     * @return     */    public Long zRemove(String key, Object... values) {        return redisTemplate.opsForZSet().remove(key, values);    }    /**     * å¢åŠ å…ƒç´ çš„scoreå€¼ï¼Œå¹¶è¿”å›å¢åŠ åçš„å€¼     *      * @param key     * @param value     * @param delta     * @return     */    public Double zIncrementScore(String key, String value, double delta) {        return redisTemplate.opsForZSet().incrementScore(key, value, delta);    }    /**     * è¿”å›å…ƒç´ åœ¨é›†åˆçš„æ’å,æœ‰åºé›†åˆæ˜¯æŒ‰ç…§å…ƒç´ çš„scoreå€¼ç”±å°åˆ°å¤§æ’åˆ—     *      * @param key     * @param value     * @return 0è¡¨ç¤ºç¬¬ä¸€ä½     */    public Long zRank(String key, Object value) {        return redisTemplate.opsForZSet().rank(key, value);    }    /**     * è¿”å›å…ƒç´ åœ¨é›†åˆçš„æ’å,æŒ‰å…ƒç´ çš„scoreå€¼ç”±å¤§åˆ°å°æ’åˆ—     *      * @param key     * @param value     * @return     */    public Long zReverseRank(String key, Object value) {        return redisTemplate.opsForZSet().reverseRank(key, value);    }    /**     * è·å–é›†åˆçš„å…ƒç´ , ä»å°åˆ°å¤§æ’åº     *      * @param key     * @param start     *            å¼€å§‹ä½ç½®     * @param end     *            ç»“æŸä½ç½®, -1æŸ¥è¯¢æ‰€æœ‰     * @return     */    public Set&lt;String&gt; zRange(String key, long start, long end) {        return redisTemplate.opsForZSet().range(key, start, end);    }    /**     * è·å–é›†åˆå…ƒç´ , å¹¶ä¸”æŠŠscoreå€¼ä¹Ÿè·å–     *      * @param key     * @param start     * @param end     * @return     */    public Set&lt;TypedTuple&lt;String&gt;&gt; zRangeWithScores(String key, long start,            long end) {        return redisTemplate.opsForZSet().rangeWithScores(key, start, end);    }    /**     * æ ¹æ®Scoreå€¼æŸ¥è¯¢é›†åˆå…ƒç´      *      * @param key     * @param min     *            æœ€å°å€¼     * @param max     *            æœ€å¤§å€¼     * @return     */    public Set&lt;String&gt; zRangeByScore(String key, double min, double max) {        return redisTemplate.opsForZSet().rangeByScore(key, min, max);    }    /**     * æ ¹æ®Scoreå€¼æŸ¥è¯¢é›†åˆå…ƒç´ , ä»å°åˆ°å¤§æ’åº     *      * @param key     * @param min     *            æœ€å°å€¼     * @param max     *            æœ€å¤§å€¼     * @return     */    public Set&lt;TypedTuple&lt;String&gt;&gt; zRangeByScoreWithScores(String key,            double min, double max) {        return redisTemplate.opsForZSet().rangeByScoreWithScores(key, min, max);    }    /**     *      * @param key     * @param min     * @param max     * @param start     * @param end     * @return     */    public Set&lt;TypedTuple&lt;String&gt;&gt; zRangeByScoreWithScores(String key,            double min, double max, long start, long end) {        return redisTemplate.opsForZSet().rangeByScoreWithScores(key, min, max,                start, end);    }    /**     * è·å–é›†åˆçš„å…ƒç´ , ä»å¤§åˆ°å°æ’åº     *      * @param key     * @param start     * @param end     * @return     */    public Set&lt;String&gt; zReverseRange(String key, long start, long end) {        return redisTemplate.opsForZSet().reverseRange(key, start, end);    }    /**     * è·å–é›†åˆçš„å…ƒç´ , ä»å¤§åˆ°å°æ’åº, å¹¶è¿”å›scoreå€¼     *      * @param key     * @param start     * @param end     * @return     */    public Set&lt;TypedTuple&lt;String&gt;&gt; zReverseRangeWithScores(String key,            long start, long end) {        return redisTemplate.opsForZSet().reverseRangeWithScores(key, start,                end);    }    /**     * æ ¹æ®Scoreå€¼æŸ¥è¯¢é›†åˆå…ƒç´ , ä»å¤§åˆ°å°æ’åº     *      * @param key     * @param min     * @param max     * @return     */    public Set&lt;String&gt; zReverseRangeByScore(String key, double min,            double max) {        return redisTemplate.opsForZSet().reverseRangeByScore(key, min, max);    }    /**     * æ ¹æ®Scoreå€¼æŸ¥è¯¢é›†åˆå…ƒç´ , ä»å¤§åˆ°å°æ’åº     *      * @param key     * @param min     * @param max     * @return     */    public Set&lt;TypedTuple&lt;String&gt;&gt; zReverseRangeByScoreWithScores(            String key, double min, double max) {        return redisTemplate.opsForZSet().reverseRangeByScoreWithScores(key,                min, max);    }    /**     *      * @param key     * @param min     * @param max     * @param start     * @param end     * @return     */    public Set&lt;String&gt; zReverseRangeByScore(String key, double min,            double max, long start, long end) {        return redisTemplate.opsForZSet().reverseRangeByScore(key, min, max,                start, end);    }    /**     * æ ¹æ®scoreå€¼è·å–é›†åˆå…ƒç´ æ•°é‡     *      * @param key     * @param min     * @param max     * @return     */    public Long zCount(String key, double min, double max) {        return redisTemplate.opsForZSet().count(key, min, max);    }    /**     * è·å–é›†åˆå¤§å°     *      * @param key     * @return     */    public Long zSize(String key) {        return redisTemplate.opsForZSet().size(key);    }    /**     * è·å–é›†åˆå¤§å°     *      * @param key     * @return     */    public Long zZCard(String key) {        return redisTemplate.opsForZSet().zCard(key);    }    /**     * è·å–é›†åˆä¸­valueå…ƒç´ çš„scoreå€¼     *      * @param key     * @param value     * @return     */    public Double zScore(String key, Object value) {        return redisTemplate.opsForZSet().score(key, value);    }    /**     * ç§»é™¤æŒ‡å®šç´¢å¼•ä½ç½®çš„æˆå‘˜     *      * @param key     * @param start     * @param end     * @return     */    public Long zRemoveRange(String key, long start, long end) {        return redisTemplate.opsForZSet().removeRange(key, start, end);    }    /**     * æ ¹æ®æŒ‡å®šçš„scoreå€¼çš„èŒƒå›´æ¥ç§»é™¤æˆå‘˜     *      * @param key     * @param min     * @param max     * @return     */    public Long zRemoveRangeByScore(String key, double min, double max) {        return redisTemplate.opsForZSet().removeRangeByScore(key, min, max);    }    /**     * è·å–keyå’ŒotherKeyçš„å¹¶é›†å¹¶å­˜å‚¨åœ¨destKeyä¸­     *      * @param key     * @param otherKey     * @param destKey     * @return     */    public Long zUnionAndStore(String key, String otherKey, String destKey) {        return redisTemplate.opsForZSet().unionAndStore(key, otherKey, destKey);    }    /**     *      * @param key     * @param otherKeys     * @param destKey     * @return     */    public Long zUnionAndStore(String key, Collection&lt;String&gt; otherKeys,            String destKey) {        return redisTemplate.opsForZSet()                .unionAndStore(key, otherKeys, destKey);    }    /**     * äº¤é›†     *      * @param key     * @param otherKey     * @param destKey     * @return     */    public Long zIntersectAndStore(String key, String otherKey,            String destKey) {        return redisTemplate.opsForZSet().intersectAndStore(key, otherKey,                destKey);    }    /**     * äº¤é›†     *      * @param key     * @param otherKeys     * @param destKey     * @return     */    public Long zIntersectAndStore(String key, Collection&lt;String&gt; otherKeys,            String destKey) {        return redisTemplate.opsForZSet().intersectAndStore(key, otherKeys,                destKey);    }    /**     *      * @param key     * @param options     * @return     */    public Cursor&lt;TypedTuple&lt;String&gt;&gt; zScan(String key, ScanOptions options) {        return redisTemplate.opsForZSet().scan(key, options);    }}</code></pre>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é«˜å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisæŠ€æœ¯æ€»ç»“</title>
      <link href="/2020/01/15/3.%20redis/redis%E6%80%BB%E7%BB%93/"/>
      <url>/2020/01/15/3.%20redis/redis%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢çš„è¯"><a href="#å†™åœ¨å‰é¢çš„è¯" class="headerlink" title="å†™åœ¨å‰é¢çš„è¯"></a>å†™åœ¨å‰é¢çš„è¯</h2><p>ç½‘ä¸ŠJavaçš„èµ„æ–™é›¶é›¶æ•£æ•£ï¼Œç”šè‡³æœ‰ä¸€äº›é”™è¯¯ï¼Œä½œè€…å¸Œæœ›èƒ½ç»“åˆè‡ªå·±çš„å®é™…å¼€å‘ç»éªŒå’Œé¢è¯•ç»éªŒï¼Œå¯¹RedisçŸ¥è¯†ä½“ç³»è¿›è¡Œç³»ç»Ÿæ¢³ç†ã€‚</p><p>æœ¬æ–‡å‚è€ƒä¸»è¦ã€å¼•ç”¨ã€‘ä¸­çš„å†…å®¹ï¼Œå¹¶ç»“åˆè‡ªå·±çš„æ—¥å¸¸ç§¯ç´¯ï¼Œæ¬¢è¿ç•™è¨€äº¤æµæŒ‡æ­£ã€‚</p><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><ul><li><strong>æ³¨ï¼šæœ¬æ–‡ä¸»è¦å‚è€ƒ</strong></li><li><a href="https://mp.weixin.qq.com/s/vXBFscXqDcXS_VaIERplMQï¼" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/vXBFscXqDcXS_VaIERplMQï¼</a><ul><li><a href="https://github.com/AobingJava/JavaFamily" target="_blank" rel="noopener">https://github.com/AobingJava/JavaFamily</a></li><li><a href="https://github.com/Snailclimb/JavaGuide" target="_blank" rel="noopener">https://github.com/Snailclimb/JavaGuide</a></li></ul></li></ul><h2 id="åŸºç¡€ç¯‡"><a href="#åŸºç¡€ç¯‡" class="headerlink" title="åŸºç¡€ç¯‡"></a>åŸºç¡€ç¯‡</h2><h3 id="è°ˆè°ˆä½ å¯¹ç¼“å­˜çš„ç†è§£"><a href="#è°ˆè°ˆä½ å¯¹ç¼“å­˜çš„ç†è§£" class="headerlink" title="è°ˆè°ˆä½ å¯¹ç¼“å­˜çš„ç†è§£"></a>è°ˆè°ˆä½ å¯¹ç¼“å­˜çš„ç†è§£</h3><p><img alt="image-20200526204006874" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf64w2sw7uj30pz0dfwtk.jpg" class="lazyload"></p><h3 id="Redis-ä¼˜ç¼ºç‚¹"><a href="#Redis-ä¼˜ç¼ºç‚¹" class="headerlink" title="Redis ä¼˜ç¼ºç‚¹"></a>Redis ä¼˜ç¼ºç‚¹</h3><h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><ul><li><strong>è¯»å†™æ€§èƒ½ä¼˜å¼‚</strong>ï¼Œ Redisèƒ½è¯»çš„é€Ÿåº¦æ˜¯ <code>110000</code> æ¬¡/sï¼Œå†™çš„é€Ÿåº¦æ˜¯ <code>81000</code> æ¬¡/sã€‚</li><li><strong>æ”¯æŒæ•°æ®æŒä¹…åŒ–</strong>ï¼Œæ”¯æŒ AOF å’Œ RDB ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ã€‚</li><li><strong>æ”¯æŒäº‹åŠ¡</strong>ï¼ŒRedis çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼ŒåŒæ—¶ Redis è¿˜æ”¯æŒå¯¹å‡ ä¸ªæ“ä½œåˆå¹¶åçš„åŸå­æ€§æ‰§è¡Œã€‚</li><li><strong>æ•°æ®ç»“æ„ä¸°å¯Œ</strong>ï¼Œé™¤äº†æ”¯æŒ string ç±»å‹çš„ value å¤–è¿˜æ”¯æŒ hashã€setã€zsetã€list ç­‰æ•°æ®ç»“æ„ã€‚</li><li><strong>æ”¯æŒä¸»ä»å¤åˆ¶</strong>ï¼Œä¸»æœºä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æœºï¼Œå¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»ï¼Œå¤šç§é›†ç¾¤æ–¹æ¡ˆã€‚</li></ul><h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ul><li>æ•°æ®åº“ <strong>å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶</strong>ï¼Œä¸èƒ½ç”¨ä½œæµ·é‡æ•°æ®çš„é«˜æ€§èƒ½è¯»å†™ï¼Œå› æ­¤ Redis é€‚åˆçš„åœºæ™¯ä¸»è¦å±€é™åœ¨è¾ƒå°æ•°æ®é‡çš„é«˜æ€§èƒ½æ“ä½œå’Œè¿ç®—ä¸Šã€‚</li><li>Redis <strong>ä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½</strong>ï¼Œä¸»æœºä»æœºçš„å®•æœºéƒ½ä¼šå¯¼è‡´å‰ç«¯éƒ¨åˆ†è¯»å†™è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…æœºå™¨é‡å¯æˆ–è€…æ‰‹åŠ¨åˆ‡æ¢å‰ç«¯çš„ IP æ‰èƒ½æ¢å¤ã€‚</li><li>ä¸»æœºå®•æœºï¼Œå®•æœºå‰æœ‰éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»æœºï¼Œåˆ‡æ¢ IP åè¿˜ä¼šå¼•å…¥æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé™ä½äº† <strong>ç³»ç»Ÿçš„å¯ç”¨æ€§</strong>ã€‚</li><li><strong>Redis è¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹</strong>ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ä¸ºé¿å…è¿™ä¸€é—®é¢˜ï¼Œè¿ç»´äººå‘˜åœ¨ç³»ç»Ÿä¸Šçº¿æ—¶å¿…é¡»ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œè¿™å¯¹èµ„æºé€ æˆäº†å¾ˆå¤§çš„æµªè´¹ã€‚</li></ul><h4 id="Redis-å’Œ-Memcached-æœ‰å•¥åŒºåˆ«ï¼Œä¸ºå•¥é€‰Redisï¼Ÿ"><a href="#Redis-å’Œ-Memcached-æœ‰å•¥åŒºåˆ«ï¼Œä¸ºå•¥é€‰Redisï¼Ÿ" class="headerlink" title="Redis å’Œ Memcached æœ‰å•¥åŒºåˆ«ï¼Œä¸ºå•¥é€‰Redisï¼Ÿ"></a>Redis å’Œ Memcached æœ‰å•¥åŒºåˆ«ï¼Œä¸ºå•¥é€‰Redisï¼Ÿ</h4><ul><li><strong>Redis</strong> ç›¸æ¯” <strong>Memcached</strong> æ¥è¯´ï¼Œæ‹¥æœ‰æ›´å¤šçš„æ•°æ®ç»“æ„ï¼Œèƒ½æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®æ“ä½œã€‚å¦‚æœéœ€è¦ç¼“å­˜èƒ½å¤Ÿæ”¯æŒæ›´å¤æ‚çš„ç»“æ„å’Œæ“ä½œï¼Œ <strong>Redis</strong> ä¼šæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</li><li><strong>Redis</strong> åŸç”Ÿæ”¯æŒé›†ç¾¤æ¨¡å¼ï¼Œè€Œ <strong>Memcached</strong> æ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ã€‚</li><li>æ€§èƒ½å¯¹æ¯”ï¼šç”±äº <strong>Redis</strong> åªä½¿ç”¨å•æ ¸ï¼Œè€Œ <strong>Memcached</strong> å¯ä»¥ä½¿ç”¨å¤šæ ¸ï¼Œæ‰€ä»¥å¹³å‡æ¯ä¸€ä¸ªæ ¸ä¸Š <strong>Redis</strong> åœ¨å­˜å‚¨å°æ•°æ®æ—¶æ¯” <strong>Memcached</strong> æ€§èƒ½æ›´é«˜ã€‚è€Œåœ¨ 100k ä»¥ä¸Šçš„æ•°æ®ä¸­ï¼Œ<strong>Memcached</strong> æ€§èƒ½è¦é«˜äº <strong>Redis</strong>ï¼Œè™½ç„¶ <strong>Redis</strong> æœ€è¿‘ä¹Ÿåœ¨å­˜å‚¨å¤§æ•°æ®çš„æ€§èƒ½ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œä½†æ˜¯æ¯”èµ· <strong>Memcached</strong>ï¼Œè¿˜æ˜¯ç¨æœ‰é€Šè‰²ã€‚</li></ul><h3 id="Redis-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ"><a href="#Redis-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ"></a>Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</h3><p>ç®€å•æ€»ç»“ï¼š</p><ol><li><strong>çº¯å†…å­˜æ“ä½œ</strong>ï¼šè¯»å–ä¸éœ€è¦è¿›è¡Œç£ç›˜ I/Oï¼Œæ‰€ä»¥æ¯”ä¼ ç»Ÿæ•°æ®åº“è¦å¿«ä¸Šä¸å°‘ï¼›<em>(ä½†ä¸è¦æœ‰è¯¯åŒºè¯´ç£ç›˜å°±ä¸€å®šæ…¢ï¼Œä¾‹å¦‚ Kafka å°±æ˜¯ä½¿ç”¨ç£ç›˜é¡ºåºè¯»å–ä½†ä»ç„¶è¾ƒå¿«)</em></li><li><strong>å•çº¿ç¨‹ï¼Œæ— é”ç«äº‰</strong>ï¼šè¿™ä¿è¯äº†æ²¡æœ‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸ä¼šå› ä¸ºå¤šçº¿ç¨‹çš„ä¸€äº›æ“ä½œè€Œé™ä½æ€§èƒ½ï¼›</li><li><strong>å¤šè·¯ I/O å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡ I/O</strong>ï¼šé‡‡ç”¨å¤šè·¯ I/O å¤ç”¨æŠ€æœ¯å¯ä»¥è®©å•ä¸ªçº¿ç¨‹é«˜æ•ˆçš„å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥è¯·æ±‚ï¼ˆå°½é‡å‡å°‘ç½‘ç»œ IO çš„æ—¶é—´æ¶ˆè€—ï¼‰ï¼›</li><li><strong>é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼ŒåŠ ä¸Šåº•å±‚åšäº†å¤§é‡ä¼˜åŒ–</strong>ï¼šRedis å¯¹äºåº•å±‚çš„æ•°æ®ç»“æ„å’Œå†…å­˜å ç”¨åšäº†å¤§é‡çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚ä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²ä½¿ç”¨ä¸åŒçš„ç»“æ„ä½“è¡¨ç¤ºï¼ŒHyperLogLog çš„å¯†é›†å‹å­˜å‚¨ç»“æ„ç­‰ç­‰..</li></ol><p><img alt="image-20200512111931582" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gepi08qesvj30tv0d3qak.jpg" class="lazyload"></p><p>â€‹    å¤šä¸ªSocketå¯èƒ½ä¼šå¹¶å‘äº§ç”Ÿä¸åŒçš„æ“ä½œï¼Œæ¯ä¸ªæ“ä½œå¯¹åº”ä¸åŒçš„æ–‡ä»¶äº‹ä»¶ï¼Œä½†æ˜¯ IO å¤šè·¯å¤ç”¨ç¨‹åºä¼šç›‘å¬å¤šä¸ª Socketï¼Œä¼šå°† Socket äº§ç”Ÿçš„äº‹ä»¶æ”¾å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œäº‹ä»¶åˆ†æ´¾å™¨æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªäº‹ä»¶ï¼ŒæŠŠè¯¥äº‹ä»¶äº¤ç»™å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚</p><h3 id="Redis-æœ‰å“ªäº›æ•°æ®ç»“æ„"><a href="#Redis-æœ‰å“ªäº›æ•°æ®ç»“æ„" class="headerlink" title="Redis æœ‰å“ªäº›æ•°æ®ç»“æ„"></a>Redis æœ‰å“ªäº›æ•°æ®ç»“æ„</h3><p><strong>Redis</strong> å¯ä»¥å­˜å‚¨ <strong>é”®</strong> å’Œ <strong>ä¸åŒç±»å‹æ•°æ®ç»“æ„å€¼</strong> ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚é”®çš„ç±»å‹åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œå€¼é™¤äº†æ”¯æŒæœ€ <strong>åŸºç¡€çš„äº”ç§æ•°æ®ç±»å‹</strong> å¤–ï¼Œè¿˜æ”¯æŒä¸€äº› <strong>é«˜çº§æ•°æ®ç±»å‹</strong>ï¼š</p><p><img alt="image-20200512155746023" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gepq1ryhqzj30i40bvaci.jpg" class="lazyload"></p><blockquote><p>â€œ</p><p>ä¸€å®šè¦è¯´å‡ºä¸€äº›é«˜çº§æ•°æ®ç»“æ„ <em>(å½“ç„¶ä½ è‡ªå·±ä¹Ÿè¦äº†è§£.. ä¸‹é¢ä¼šè¯´åˆ°çš„åˆ«æ‹…å¿ƒ)</em>ï¼Œè¿™æ ·é¢è¯•å®˜çš„çœ¼ç›æ‰ä¼šäº®ã€‚</p><p>å¯é‡ç‚¹äº†è§£<strong>HyperLogLog</strong>å’ŒPub/Sub</p><p><strong>pub/subæœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ</strong></p><p>åœ¨æ¶ˆè´¹è€…ä¸‹çº¿çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œå¾—ä½¿ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—å¦‚<strong>RocketMQ</strong>ç­‰ã€‚</p></blockquote><h3 id="å®é™…é¡¹ç›®ç¼“å­˜åº”ç”¨åœºæ™¯"><a href="#å®é™…é¡¹ç›®ç¼“å­˜åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…é¡¹ç›®ç¼“å­˜åº”ç”¨åœºæ™¯"></a>å®é™…é¡¹ç›®ç¼“å­˜åº”ç”¨åœºæ™¯</h3><h4 id="String"><a href="#String" class="headerlink" title="String"></a><strong>String</strong></h4><ul><li>å…¨å±€è®¢å•å·</li><li>åˆ†å¸ƒå¼Sessionå…±äº«ï¼ˆå¦åˆ™ä»ä¸€ä¸ªé¡µé¢è·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢å¯èƒ½Sessionå°±è¿‡æœŸäº†ï¼‰</li><li>åˆ†å¸ƒå¼é”</li></ul><h4 id="Hashï¼šç›¸å½“äºåµŒå¥—Map"><a href="#Hashï¼šç›¸å½“äºåµŒå¥—Map" class="headerlink" title="Hashï¼šç›¸å½“äºåµŒå¥—Map"></a><strong>Hash</strong>ï¼šç›¸å½“äºåµŒå¥—Map</h4><ul><li>å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯ç­‰</li></ul><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>bigkeyé—®é¢˜</li></ul><h4 id="List"><a href="#List" class="headerlink" title="List"></a><strong>List</strong></h4><ul><li>å¾®ä¿¡æ¨é€æ¶ˆæ¯åˆ—è¡¨</li><li>å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼ˆè§£å†³redisæ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼‰<ul><li><strong>rpush</strong>ç”Ÿäº§æ¶ˆæ¯ï¼Œ<strong>lpop</strong>æ¶ˆè´¹æ¶ˆæ¯ã€‚å½“lpopæ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦é€‚å½“sleepä¸€ä¼šå†é‡è¯•ã€‚å¦å¤–listè¿˜æœ‰ä¸ªæŒ‡ä»¤å«<strong>blpop</strong>ï¼Œåœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œå®ƒä¼šé˜»å¡ä½ç›´åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚</li></ul></li></ul><h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a><strong>Set</strong></h4><ul><li>Ipé»‘åå•</li><li>å¾®åšå…³æ³¨å–äº¤é›†</li></ul><h4 id="ZSet"><a href="#ZSet" class="headerlink" title="ZSet"></a><strong>ZSet</strong></h4><ul><li><p>æ¥å£è°ƒç”¨ç”¨æˆ·TopK</p></li><li><p>ç§’æ€å®ç°</p></li></ul><h4 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h4><ul><li>å®ç°ç½‘ç«™æ‰€æœ‰ç½‘é¡µpv<strong>(æµè§ˆé‡ï¼Œç”¨æˆ·æ²¡ç‚¹ä¸€æ¬¡è®°å½•ä¸€æ¬¡)</strong>ã€uv(<strong>åŒä¸€ä¸ªç”¨æˆ·ä¸€å¤©ä¹‹å†…çš„å¤šæ¬¡è®¿é—®è¯·æ±‚åªèƒ½è®¡æ•°ä¸€æ¬¡</strong>)ç»Ÿè®¡ã€‚</li></ul><p>æ³¨âš ï¸ï¼š</p><p>åœ¨å¤§é‡æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸€å®šè¯¯å·®ã€‚<strong>HyperLogLog</strong> æä¾›äº†ä¸¤ä¸ªæŒ‡ä»¤ <code>PFADD</code> å’Œ <code>PFCOUNT</code>ï¼Œå­—é¢æ„æ€å°±æ˜¯ä¸€ä¸ªæ˜¯å¢åŠ ï¼Œå¦ä¸€ä¸ªæ˜¯è·å–è®¡æ•°ã€‚<code>PFADD</code> å’Œ <code>set</code> é›†åˆçš„ <code>SADD</code> çš„ç”¨æ³•æ˜¯ä¸€æ ·çš„ï¼Œæ¥ä¸€ä¸ªç”¨æˆ· IDï¼Œå°±å°†ç”¨æˆ· ID å¡è¿›å»å°±æ˜¯ï¼Œ<code>PFCOUNT</code> å’Œ <code>SCARD</code>çš„ç”¨æ³•æ˜¯ä¸€è‡´çš„ï¼Œç›´æ¥è·å–è®¡æ•°å€¼ã€‚</p><h4 id="GeoHash"><a href="#GeoHash" class="headerlink" title="GeoHash"></a>GeoHash</h4><ul><li>æŸ¥æ‰¾é™„è¿‘äºº</li></ul><h3 id="ä½¿ç”¨ç¼“å­˜ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#ä½¿ç”¨ç¼“å­˜ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="ä½¿ç”¨ç¼“å­˜ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>ä½¿ç”¨ç¼“å­˜ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p>ä¸€èˆ¬æ¥è¯´æœ‰å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼Œå›ç­”æ€è·¯éµç…§ <strong>æ˜¯ä»€ä¹ˆ</strong> â†’ <strong>ä¸ºä»€ä¹ˆ</strong> â†’ <strong>æ€ä¹ˆè§£å†³</strong>ï¼š</p><ol><li>ç¼“å­˜é›ªå´©é—®é¢˜ï¼›</li><li>ç¼“å­˜ç©¿é€é—®é¢˜ï¼›</li><li>ç¼“å­˜å’Œæ•°æ®åº“åŒå†™ä¸€è‡´æ€§é—®é¢˜ï¼›</li><li>å¹¶å‘å†™ç«äº‰</li></ol><h4 id="ç¼“å­˜é›ªå´©é—®é¢˜"><a href="#ç¼“å­˜é›ªå´©é—®é¢˜" class="headerlink" title="ç¼“å­˜é›ªå´©é—®é¢˜"></a>ç¼“å­˜é›ªå´©é—®é¢˜</h4><p><img alt="image-20200713092519881" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggp34jy47oj31kz0u0tu6.jpg" class="lazyload"></p><p>å¯¹äº <strong>â€œRedis æŒ‚æ‰äº†ï¼Œè¯·æ±‚å…¨éƒ¨èµ°æ•°æ®åº“â€</strong> è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æœ‰å¦‚ä¸‹çš„æ€è·¯ï¼š</p><ul><li><strong>äº‹å‘å‰</strong>ï¼šå®ç° Redis çš„é«˜å¯ç”¨(ä¸»ä»æ¶æ„ + Sentinel æˆ–è€… Redis Cluster)ï¼Œå°½é‡é¿å… Redis æŒ‚æ‰è¿™ç§æƒ…å†µå‘ç”Ÿã€‚</li><li><strong>äº‹å‘ä¸­</strong>ï¼šä¸‡ä¸€ Redis çœŸçš„æŒ‚äº†ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æœ¬åœ°ç¼“å­˜(ehcache) + é™æµ(hystrix)ï¼Œå°½é‡é¿å…æˆ‘ä»¬çš„æ•°æ®åº“è¢«å¹²æ‰(èµ·ç èƒ½ä¿è¯æˆ‘ä»¬çš„æœåŠ¡è¿˜æ˜¯èƒ½æ­£å¸¸å·¥ä½œçš„)</li><li><strong>äº‹å‘å</strong>ï¼šRedis æŒä¹…åŒ–ï¼Œé‡å¯åè‡ªåŠ¨ä»ç£ç›˜ä¸ŠåŠ è½½æ•°æ®ï¼Œå¿«é€Ÿæ¢å¤ç¼“å­˜æ•°æ®ã€‚</li></ul><h4 id="ç¼“å­˜ç©¿é€é—®é¢˜"><a href="#ç¼“å­˜ç©¿é€é—®é¢˜" class="headerlink" title="ç¼“å­˜ç©¿é€é—®é¢˜"></a>ç¼“å­˜ç©¿é€é—®é¢˜</h4><p><img alt="image-20200509211822423" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gepq38g21tj30ty0fswld.jpg" class="lazyload"></p><p> å¸ƒéš†è¿‡æ»¤å™¨çš„å®ç°ï¼šä½¿ç”¨ Google å¼€æºçš„ Guava ä¸­è‡ªå¸¦çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼ŒGuava ä¸­å¸ƒéš†è¿‡æ»¤å™¨çš„å®ç°ç®—æ˜¯æ¯”è¾ƒæƒå¨çš„ï¼Œæ‰€ä»¥å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å®ç°ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨ã€‚</p><p>å‚æ•°åšæ ¡éªŒï¼Œä¸åˆæ³•çš„å‚æ•°ç›´æ¥ä»£ç Returnï¼Œæ¯”å¦‚ï¼šid åšåŸºç¡€æ ¡éªŒï¼Œid &lt;=0çš„ç›´æ¥æ‹¦æˆªç­‰ã€‚</p><h4 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h4><p><strong>ç¼“å­˜å‡»ç©¿</strong>æ˜¯æŒ‡ä¸€ä¸ªKeyéå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹è¿™ä¸€ä¸ªç‚¹è¿›è¡Œè®¿é—®ï¼Œå½“è¿™ä¸ªKeyåœ¨å¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ç©¿ç ´ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œå°±åƒåœ¨ä¸€ä¸ªå®Œå¥½æ— æŸçš„æ¡¶ä¸Šå‡¿å¼€äº†ä¸€ä¸ªæ´ã€‚</p><p><code>è§£å†³ï¼š</code></p><p>å®šæ—¶ä»»åŠ¡åˆ·ç¼“å­˜ï¼ˆå ç”¨ç³»ç»Ÿèµ„æºã€10åˆ†é’Ÿè¿‡æœŸã€9åˆ†é’Ÿåˆ·ï¼‰ï¼Œè®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸã€‚æˆ–è€…è®¿é—®æ•°æ®åº“æ—¶åŠ ä¸Šäº’æ–¥é”å°±èƒ½æå®šäº†</p><h4 id="çƒ­ç‚¹Keyé—®é¢˜"><a href="#çƒ­ç‚¹Keyé—®é¢˜" class="headerlink" title="çƒ­ç‚¹Keyé—®é¢˜"></a>çƒ­ç‚¹Keyé—®é¢˜</h4><p><a href="https://segmentfault.com/a/1190000019745366?utm_source=tag-newest" target="_blank" rel="noopener">https://segmentfault.com/a/1190000019745366?utm_source=tag-newest</a></p><h5 id="å¦‚ä½•è§£å†³ï¼Ÿ"><a href="#å¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£å†³ï¼Ÿ"></a>å¦‚ä½•è§£å†³ï¼Ÿ</h5><p>é’ˆå¯¹äºçƒ­ç‚¹Keyçš„è§£å†³æ–¹æ¡ˆç½‘ä¸Šçš„æŸ¥æ‰¾å‡ºæ¥æ— éå°±æ˜¯ä¸¤ç§</p><ul><li>æœåŠ¡ç«¯ç¼“å­˜ï¼šå³å°†çƒ­ç‚¹æ•°æ®ç¼“å­˜è‡³æœåŠ¡ç«¯çš„å†…å­˜ä¸­</li><li>å¤‡ä»½çƒ­ç‚¹Keyï¼šå³å°† çƒ­ç‚¹Key + éšæœºæ•°ï¼Œéšæœºåˆ†é…è‡³Rediså…¶ä»–èŠ‚ç‚¹ä¸­ã€‚è¿™æ ·è®¿é—®çƒ­ç‚¹keyçš„æ—¶å€™å°±ä¸ä¼šå…¨éƒ¨å‘½ä¸­åˆ°ä¸€å°æœºå™¨ä¸Šäº†ã€‚ï¼ˆç»™hot keyåŠ ä¸Šå‰ç¼€æˆ–è€…åç¼€ï¼ŒæŠŠä¸€ä¸ªhotkey çš„æ•°é‡å˜æˆ redis å®ä¾‹ä¸ªæ•°Nçš„å€æ•°Mï¼Œä»è€Œç”±è®¿é—®ä¸€ä¸ª redis key å˜æˆè®¿é—® N * M ä¸ªredis keyï¼‰</li></ul><p>å…¶å®è¿™ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆå‰æéƒ½æ˜¯çŸ¥é“äº†çƒ­ç‚¹Keyæ˜¯ä»€ä¹ˆçš„æƒ…å†µï¼Œé‚£ä¹ˆå¦‚ä½•æ‰¾åˆ°çƒ­ç‚¹keyå‘¢ï¼Ÿ</p><h5 id="çƒ­ç‚¹æ£€æµ‹"><a href="#çƒ­ç‚¹æ£€æµ‹" class="headerlink" title="çƒ­ç‚¹æ£€æµ‹"></a>çƒ­ç‚¹æ£€æµ‹</h5><ol><li>å‡­å€Ÿç»éªŒï¼Œè¿›è¡Œé¢„ä¼°ï¼šä¾‹å¦‚æå‰çŸ¥é“äº†æŸä¸ªæ´»åŠ¨çš„å¼€å¯ï¼Œé‚£ä¹ˆå°±å°†æ­¤Keyä½œä¸ºçƒ­ç‚¹Key</li><li>å®¢æˆ·ç«¯æ”¶é›†ï¼šåœ¨æ“ä½œRedisä¹‹å‰å¯¹æ•°æ®è¿›è¡Œç»Ÿè®¡</li><li>æŠ“åŒ…è¿›è¡Œè¯„ä¼°ï¼šRedisä½¿ç”¨TCPåè®®ä¸å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œé€šä¿¡åè®®é‡‡ç”¨çš„æ˜¯RESPï¼Œæ‰€ä»¥èƒ½è¿›è¡Œæ‹¦æˆªåŒ…è¿›è¡Œè§£æ</li><li>åœ¨proxyå±‚ï¼Œå¯¹æ¯ä¸€ä¸ª redis è¯·æ±‚è¿›è¡Œæ”¶é›†ä¸ŠæŠ¥</li><li>Redisè‡ªå¸¦å‘½ä»¤æŸ¥è¯¢ï¼šRedis4.0.4ç‰ˆæœ¬æä¾›äº†<code>redis-cli â€“hotkeys</code>å°±èƒ½æ‰¾å‡ºçƒ­ç‚¹Key</li></ol><h4 id="ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´é—®é¢˜"><a href="#ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´é—®é¢˜" class="headerlink" title="ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´é—®é¢˜"></a>ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´é—®é¢˜</h4><h5 id="å¯¹äºè¯»æ“ä½œï¼Œæµç¨‹æ˜¯è¿™æ ·çš„"><a href="#å¯¹äºè¯»æ“ä½œï¼Œæµç¨‹æ˜¯è¿™æ ·çš„" class="headerlink" title="å¯¹äºè¯»æ“ä½œï¼Œæµç¨‹æ˜¯è¿™æ ·çš„"></a>å¯¹äºè¯»æ“ä½œï¼Œæµç¨‹æ˜¯è¿™æ ·çš„</h5><p>ä¸Šé¢è®²ç¼“å­˜ç©¿é€çš„æ—¶å€™ä¹Ÿæåˆ°äº†ï¼šå¦‚æœä»æ•°æ®åº“æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ã€‚</p><p>ä¸€èˆ¬æˆ‘ä»¬å¯¹<strong>è¯»æ“ä½œ</strong>çš„æ—¶å€™æœ‰è¿™ä¹ˆä¸€ä¸ª<strong>å›ºå®šçš„å¥—è·¯</strong>ï¼š</p><ul><li>å¦‚æœæˆ‘ä»¬çš„æ•°æ®åœ¨ç¼“å­˜é‡Œè¾¹æœ‰ï¼Œé‚£ä¹ˆå°±ç›´æ¥å–ç¼“å­˜çš„ã€‚</li><li>å¦‚æœç¼“å­˜é‡Œæ²¡æœ‰æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¼šå…ˆå»æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶å<strong>å°†æ•°æ®åº“æŸ¥å‡ºæ¥çš„æ•°æ®å†™åˆ°ç¼“å­˜ä¸­</strong>ã€‚</li><li>æœ€åå°†æ•°æ®è¿”å›ç»™è¯·æ±‚</li></ul><p>å¦‚æœä»…ä»…æŸ¥è¯¢çš„è¯ï¼Œç¼“å­˜çš„æ•°æ®å’Œæ•°æ®åº“çš„æ•°æ®æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬è¦<strong>æ›´æ–°</strong>æ—¶å€™å‘¢ï¼Ÿå„ç§æƒ…å†µå¾ˆå¯èƒ½å°±<strong>é€ æˆæ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®ä¸ä¸€è‡´</strong>äº†ã€‚</p><ul><li>è¿™é‡Œä¸ä¸€è‡´æŒ‡çš„æ˜¯ï¼š<strong>æ•°æ®åº“çš„æ•°æ®è·Ÿç¼“å­˜çš„æ•°æ®ä¸ä¸€è‡´</strong></li></ul><p><img alt="æ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®ä¸ä¸€è‡´" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gepq3y4879j30n20e70tr.jpg" class="lazyload"></p><p>ä»ç†è®ºä¸Šè¯´ï¼Œåªè¦æˆ‘ä»¬è®¾ç½®äº†<strong>é”®çš„è¿‡æœŸæ—¶é—´</strong>ï¼Œæˆ‘ä»¬å°±èƒ½ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®<strong>æœ€ç»ˆæ˜¯ä¸€è‡´</strong>çš„ã€‚å› ä¸ºåªè¦ç¼“å­˜æ•°æ®è¿‡æœŸäº†ï¼Œå°±ä¼šè¢«åˆ é™¤ã€‚éšåè¯»çš„æ—¶å€™ï¼Œå› ä¸ºç¼“å­˜é‡Œæ²¡æœ‰ï¼Œå°±å¯ä»¥æŸ¥æ•°æ®åº“çš„æ•°æ®ï¼Œç„¶åå°†æ•°æ®åº“æŸ¥å‡ºæ¥çš„æ•°æ®å†™å…¥åˆ°ç¼“å­˜ä¸­ã€‚</p><p>é™¤äº†è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšæ›´å¤šçš„æªæ–½æ¥<strong>å°½é‡é¿å…</strong>æ•°æ®åº“ä¸ç¼“å­˜å¤„äºä¸ä¸€è‡´çš„æƒ…å†µå‘ç”Ÿã€‚</p><h5 id="å¯¹äºæ›´æ–°æ“ä½œ"><a href="#å¯¹äºæ›´æ–°æ“ä½œ" class="headerlink" title="å¯¹äºæ›´æ–°æ“ä½œ"></a>å¯¹äºæ›´æ–°æ“ä½œ</h5><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œæ›´æ–°æ“ä½œæ—¶ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸¤ç§é€‰æ‹©ï¼š</p><ul><li>å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†æ“ä½œç¼“å­˜</li><li>å…ˆæ“ä½œç¼“å­˜ï¼Œå†æ“ä½œæ•°æ®åº“</li></ul><p>é¦–å…ˆï¼Œè¦æ˜ç¡®çš„æ˜¯ï¼Œæ— è®ºæˆ‘ä»¬é€‰æ‹©å“ªä¸ªï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›è¿™<strong>ä¸¤ä¸ªæ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥</strong>ã€‚æ‰€ä»¥ï¼Œè¿™ä¼šæ¼”å˜æˆä¸€ä¸ª<strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>çš„é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>å¦‚æœåŸå­æ€§è¢«ç ´åäº†</strong>ï¼Œå¯èƒ½ä¼šæœ‰ä»¥ä¸‹çš„æƒ…å†µï¼š</p><ul><li><strong>æ“ä½œæ•°æ®åº“æˆåŠŸäº†ï¼Œæ“ä½œç¼“å­˜å¤±è´¥äº†</strong>ã€‚</li><li><strong>æ“ä½œç¼“å­˜æˆåŠŸäº†ï¼Œæ“ä½œæ•°æ®åº“å¤±è´¥äº†</strong>ã€‚</li></ul><blockquote><p>å¦‚æœç¬¬ä¸€æ­¥å·²ç»å¤±è´¥äº†ï¼Œæˆ‘ä»¬ç›´æ¥è¿”å›Exceptionå‡ºå»å°±å¥½äº†ï¼Œç¬¬äºŒæ­¥æ ¹æœ¬ä¸ä¼šæ‰§è¡Œã€‚</p></blockquote><p>ä¸‹é¢æˆ‘ä»¬å…·ä½“æ¥åˆ†æä¸€ä¸‹å§ã€‚</p><h5 id="æ“ä½œç¼“å­˜"><a href="#æ“ä½œç¼“å­˜" class="headerlink" title="æ“ä½œç¼“å­˜"></a>æ“ä½œç¼“å­˜</h5><p>æ“ä½œç¼“å­˜ä¹Ÿæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p><ul><li>æ›´æ–°ç¼“å­˜</li><li>åˆ é™¤ç¼“å­˜</li></ul><p>ä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯é‡‡å–<strong>åˆ é™¤ç¼“å­˜</strong>ç¼“å­˜ç­–ç•¥çš„ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ol><li>é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œæ— è®ºæ˜¯å…ˆæ“ä½œæ•°æ®åº“è¿˜æ˜¯åæ“ä½œæ•°æ®åº“è€Œè¨€ï¼Œå¦‚æœåŠ ä¸Šæ›´æ–°ç¼“å­˜ï¼Œé‚£å°±<strong>æ›´åŠ å®¹æ˜“</strong>å¯¼è‡´æ•°æ®åº“ä¸ç¼“å­˜æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚(åˆ é™¤ç¼“å­˜<strong>ç›´æ¥å’Œç®€å•</strong>å¾ˆå¤š)</li><li>å¦‚æœæ¯æ¬¡æ›´æ–°äº†æ•°æ®åº“ï¼Œéƒ½è¦æ›´æ–°ç¼“å­˜ã€è¿™é‡ŒæŒ‡çš„æ˜¯é¢‘ç¹æ›´æ–°çš„åœºæ™¯ï¼Œè¿™ä¼šè€—è´¹ä¸€å®šçš„æ€§èƒ½ã€‘ï¼Œå€’ä¸å¦‚ç›´æ¥åˆ é™¤æ‰ã€‚ç­‰å†æ¬¡è¯»å–æ—¶ï¼Œç¼“å­˜é‡Œæ²¡æœ‰ï¼Œé‚£æˆ‘åˆ°æ•°æ®åº“æ‰¾ï¼Œåœ¨æ•°æ®åº“æ‰¾åˆ°å†å†™åˆ°ç¼“å­˜é‡Œè¾¹(ä½“ç°<strong>æ‡’åŠ è½½</strong>)</li></ol><p>åŸºäºè¿™ä¸¤ç‚¹ï¼Œå¯¹äºç¼“å­˜åœ¨æ›´æ–°æ—¶è€Œè¨€ï¼Œéƒ½æ˜¯å»ºè®®æ‰§è¡Œ<strong>åˆ é™¤</strong>æ“ä½œï¼</p><h6 id="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜"><a href="#å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜" class="headerlink" title="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜"></a>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</h6><p>æ­£å¸¸çš„æƒ…å†µæ˜¯è¿™æ ·çš„ï¼š</p><ul><li>å…ˆæ“ä½œæ•°æ®åº“ï¼ŒæˆåŠŸï¼›</li><li>å†åˆ é™¤ç¼“å­˜ï¼Œä¹ŸæˆåŠŸï¼›</li></ul><p>å¦‚æœåŸå­æ€§è¢«ç ´åäº†ï¼š</p><ul><li>ç¬¬ä¸€æ­¥æˆåŠŸ(æ“ä½œæ•°æ®åº“)ï¼Œç¬¬äºŒæ­¥å¤±è´¥(åˆ é™¤ç¼“å­˜)ï¼Œä¼šå¯¼è‡´<strong>æ•°æ®åº“é‡Œæ˜¯æ–°æ•°æ®ï¼Œè€Œç¼“å­˜é‡Œæ˜¯æ—§æ•°æ®</strong>ã€‚</li><li>å¦‚æœç¬¬ä¸€æ­¥(æ“ä½œæ•°æ®åº“)å°±å¤±è´¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›é”™è¯¯(Exception)ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´ã€‚</li></ul><p>å¦‚æœåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œå‡ºç°æ•°æ®åº“ä¸ç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„<strong>æ¦‚ç‡ç‰¹åˆ«ä½</strong>ï¼Œä¹Ÿä¸æ˜¯æ²¡æœ‰ï¼š</p><ul><li>ç¼“å­˜<strong>åˆšå¥½</strong>å¤±æ•ˆ</li><li>çº¿ç¨‹AæŸ¥è¯¢æ•°æ®åº“ï¼Œå¾—ä¸€ä¸ªæ—§å€¼</li><li>çº¿ç¨‹Bå°†æ–°å€¼å†™å…¥æ•°æ®åº“</li><li>çº¿ç¨‹Båˆ é™¤ç¼“å­˜</li><li>çº¿ç¨‹Aå°†æŸ¥åˆ°çš„æ—§å€¼å†™å…¥ç¼“å­˜</li></ul><p>è¦è¾¾æˆä¸Šè¿°æƒ…å†µï¼Œè¿˜æ˜¯è¯´ä¸€å¥<strong>æ¦‚ç‡ç‰¹åˆ«ä½</strong>ï¼š</p><blockquote><p>å› ä¸ºè¿™ä¸ªæ¡ä»¶éœ€è¦å‘ç”Ÿåœ¨è¯»ç¼“å­˜æ—¶ç¼“å­˜å¤±æ•ˆï¼Œè€Œä¸”å¹¶å‘ç€æœ‰ä¸€ä¸ªå†™æ“ä½œã€‚è€Œå®é™…ä¸Šæ•°æ®åº“çš„å†™æ“ä½œä¼šæ¯”è¯»æ“ä½œæ…¢å¾—å¤šï¼Œè€Œä¸”è¿˜è¦é”è¡¨ï¼Œ<strong>è€Œè¯»æ“ä½œå¿…éœ€åœ¨å†™æ“ä½œå‰è¿›å…¥æ•°æ®åº“æ“ä½œï¼Œè€Œåˆè¦æ™šäºå†™æ“ä½œæ›´æ–°ç¼“å­˜</strong>ï¼Œæ‰€æœ‰çš„è¿™äº›æ¡ä»¶éƒ½å…·å¤‡çš„æ¦‚ç‡åŸºæœ¬å¹¶ä¸å¤§ã€‚</p></blockquote><p>å¯¹äºè¿™ç§ç­–ç•¥ï¼Œå…¶å®æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼š<code>Cache Aside Pattern</code></p><p><strong>åˆ é™¤ç¼“å­˜å¤±è´¥çš„è§£å†³æ€è·¯</strong>ï¼š</p><ul><li>å°†éœ€è¦åˆ é™¤çš„keyå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­</li><li>è‡ªå·±æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å¾—éœ€è¦åˆ é™¤çš„key</li><li><strong>ä¸æ–­é‡è¯•åˆ é™¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸ</strong></li></ul><h6 id="å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“"><a href="#å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“" class="headerlink" title="å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“"></a>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</h6><p>æ­£å¸¸æƒ…å†µæ˜¯è¿™æ ·çš„ï¼š</p><ul><li>å…ˆåˆ é™¤ç¼“å­˜ï¼ŒæˆåŠŸï¼›</li><li>å†æ›´æ–°æ•°æ®åº“ï¼Œä¹ŸæˆåŠŸï¼›</li></ul><p>å¦‚æœåŸå­æ€§è¢«ç ´åäº†ï¼š</p><ul><li>ç¬¬ä¸€æ­¥æˆåŠŸ(åˆ é™¤ç¼“å­˜)ï¼Œç¬¬äºŒæ­¥å¤±è´¥(æ›´æ–°æ•°æ®åº“)ï¼Œæ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®è¿˜æ˜¯ä¸€è‡´çš„ã€‚</li><li>å¦‚æœç¬¬ä¸€æ­¥(åˆ é™¤ç¼“å­˜)å°±å¤±è´¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›é”™è¯¯(Exception)ï¼Œæ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®è¿˜æ˜¯ä¸€è‡´çš„ã€‚</li></ul><p>çœ‹èµ·æ¥æ˜¯å¾ˆç¾å¥½ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å¹¶å‘åœºæ™¯ä¸‹åˆ†æä¸€ä¸‹ï¼Œå°±çŸ¥é“è¿˜æ˜¯æœ‰é—®é¢˜çš„äº†ï¼š</p><ul><li>çº¿ç¨‹Aåˆ é™¤äº†ç¼“å­˜</li><li>çº¿ç¨‹BæŸ¥è¯¢ï¼Œå‘ç°ç¼“å­˜å·²ä¸å­˜åœ¨</li><li>çº¿ç¨‹Bå»æ•°æ®åº“æŸ¥è¯¢å¾—åˆ°æ—§å€¼</li><li>çº¿ç¨‹Bå°†æ—§å€¼å†™å…¥ç¼“å­˜</li><li>çº¿ç¨‹Aå°†æ–°å€¼å†™å…¥æ•°æ®åº“</li></ul><p>æ‰€ä»¥ä¹Ÿä¼šå¯¼è‡´æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p><strong>å¹¶å‘ä¸‹è§£å†³æ•°æ®åº“ä¸ç¼“å­˜ä¸ä¸€è‡´çš„æ€è·¯</strong>ï¼š</p><ul><li>å°†åˆ é™¤ç¼“å­˜ã€ä¿®æ”¹æ•°æ®åº“ã€è¯»å–ç¼“å­˜ç­‰çš„æ“ä½œç§¯å‹åˆ°<strong>é˜Ÿåˆ—</strong>é‡Œè¾¹ï¼Œå®ç°<strong>ä¸²è¡ŒåŒ–</strong>ã€‚</li></ul><h6 id="å¯¹æ¯”ä¸¤ç§ç­–ç•¥"><a href="#å¯¹æ¯”ä¸¤ç§ç­–ç•¥" class="headerlink" title="å¯¹æ¯”ä¸¤ç§ç­–ç•¥"></a>å¯¹æ¯”ä¸¤ç§ç­–ç•¥</h6><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä¸¤ç§ç­–ç•¥å„è‡ªæœ‰ä¼˜ç¼ºç‚¹ï¼š</p><ul><li><p>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</p></li><li><ul><li>åœ¨é«˜å¹¶å‘ä¸‹è¡¨ç°ä¸å¦‚æ„ï¼Œåœ¨åŸå­æ€§è¢«ç ´åæ—¶è¡¨ç°ä¼˜å¼‚</li></ul></li><li><p>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜(<code>Cache Aside Pattern</code>è®¾è®¡æ¨¡å¼)</p></li><li><ul><li>åœ¨é«˜å¹¶å‘ä¸‹è¡¨ç°ä¼˜å¼‚ï¼Œåœ¨åŸå­æ€§è¢«ç ´åæ—¶è¡¨ç°ä¸å¦‚æ„</li></ul></li></ul><h6 id="å…¶ä»–ä¿éšœæ•°æ®ä¸€è‡´çš„æ–¹æ¡ˆä¸èµ„æ–™"><a href="#å…¶ä»–ä¿éšœæ•°æ®ä¸€è‡´çš„æ–¹æ¡ˆä¸èµ„æ–™" class="headerlink" title="å…¶ä»–ä¿éšœæ•°æ®ä¸€è‡´çš„æ–¹æ¡ˆä¸èµ„æ–™"></a>å…¶ä»–ä¿éšœæ•°æ®ä¸€è‡´çš„æ–¹æ¡ˆä¸èµ„æ–™</h6><p>å¯ä»¥ç”¨<strong>databus</strong>æˆ–è€…é˜¿é‡Œçš„<strong>canalç›‘å¬binlog</strong>è¿›è¡Œæ›´æ–°ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><p>ç¼“å­˜æ›´æ–°çš„å¥—è·¯</p></li><li><ul><li><a href="https://coolshell.cn/articles/17416.html" target="_blank" rel="noopener">https://coolshell.cn/articles/17416.html</a></li></ul></li><li><p>å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</p></li><li><ul><li><a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-consistence.md" target="_blank" rel="noopener">https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-consistence.md</a></li></ul></li><li><p>åˆ†å¸ƒå¼ä¹‹æ•°æ®åº“å’Œç¼“å­˜åŒå†™ä¸€è‡´æ€§æ–¹æ¡ˆè§£æ</p></li><li><ul><li><a href="https://zhuanlan.zhihu.com/p/48334686" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/48334686</a></li></ul></li><li><p>Cache Aside Pattern</p></li><li><ul><li><a href="https://blog.csdn.net/z50l2o08e2u4aftor9a/article/details/81008933" target="_blank" rel="noopener">https://blog.csdn.net/z50l2o08e2u4aftor9a/article/details/81008933</a></li></ul></li></ul><h4 id="å¤šç³»ç»Ÿå¹¶å‘æ“ä½œRediså¸¦æ¥çš„é—®é¢˜"><a href="#å¤šç³»ç»Ÿå¹¶å‘æ“ä½œRediså¸¦æ¥çš„é—®é¢˜" class="headerlink" title="å¤šç³»ç»Ÿå¹¶å‘æ“ä½œRediså¸¦æ¥çš„é—®é¢˜"></a>å¤šç³»ç»Ÿå¹¶å‘æ“ä½œRediså¸¦æ¥çš„é—®é¢˜</h4><p>å—¯å—¯è¿™ä¸ªé—®é¢˜æˆ‘ä»¥å‰å¼€å‘çš„æ—¶å€™é‡åˆ°è¿‡ï¼Œå…¶å®å¹¶å‘è¿‡ç¨‹ä¸­ç¡®å®ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·çš„æƒ…å†µ</p><p><a href="https://camo.githubusercontent.com/c8b38486a5e9ceb1986873a609d04e042e08fb89/68747470733a2f2f747661312e73696e61696d672e636e2f6c617267652f30303679386d4e366c79316738737a7274306779776a333073653065346161792e6a7067" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/c8b38486a5e9ceb1986873a609d04e042e08fb89/68747470733a2f2f747661312e73696e61696d672e636e2f6c617267652f30303679386d4e366c79316738737a7274306779776a333073653065346161792e6a7067" class="lazyload"></a></p><p>ç³»ç»ŸAã€Bã€Cä¸‰ä¸ªç³»ç»Ÿï¼Œåˆ†åˆ«å»æ“ä½œ<strong>Redis</strong>çš„åŒä¸€ä¸ªKeyï¼Œæœ¬æ¥é¡ºåºæ˜¯1ï¼Œ2ï¼Œ3æ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯å› ä¸ºç³»ç»ŸAç½‘ç»œçªç„¶æŠ–åŠ¨äº†ä¸€ä¸‹ï¼ŒBï¼ŒCåœ¨ä»–å‰é¢æ“ä½œäº†<strong>Redis</strong>ï¼Œè¿™æ ·æ•°æ®ä¸å°±é”™äº†ä¹ˆã€‚</p><p>å°±å¥½æ¯”ä¸‹å•ï¼Œæ”¯ä»˜ï¼Œé€€æ¬¾ä¸‰ä¸ªé¡ºåºä½ å˜äº†ï¼Œä½ å…ˆé€€æ¬¾ï¼Œå†ä¸‹å•ï¼Œå†æ”¯ä»˜ï¼Œé‚£æµç¨‹å°±ä¼šå¤±è´¥ï¼Œé‚£æ•°æ®ä¸å°±ä¹±äº†ï¼Ÿä½ è®¢å•è¿˜æ²¡ç”Ÿæˆä½ å´æ”¯ä»˜ï¼Œé€€æ¬¾äº†ï¼Ÿæ˜æ˜¾èµ°ä¸é€šäº†ï¼Œè¿™åœ¨çº¿ä¸Šæ˜¯å¾ˆææ€–çš„äº‹æƒ…ã€‚</p><p><code>å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</code></p><p>æˆ‘ä»¬å¯ä»¥æ‰¾ä¸ªç®¡å®¶å¸®æˆ‘ä»¬ç®¡ç†å¥½æ•°æ®çš„å˜›ï¼</p><p><a href="https://camo.githubusercontent.com/e4aca07aad0c7448a19d9678700853b0299fc5a8/68747470733a2f2f747661312e73696e61696d672e636e2f6c617267652f30303679386d4e366c793167387430616a79636a796a33307165306a6f7134682e6a7067" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/e4aca07aad0c7448a19d9678700853b0299fc5a8/68747470733a2f2f747661312e73696e61696d672e636e2f6c617267652f30303679386d4e366c793167387430616a79636a796a33307165306a6f7134682e6a7067" class="lazyload"></a></p><p>1ã€æŸä¸ªæ—¶åˆ»ï¼Œå¤šä¸ªç³»ç»Ÿå®ä¾‹éƒ½å»æ›´æ–°æŸä¸ª keyã€‚å¯ä»¥åŸºäº <strong>Zookeeper</strong> å®ç°åˆ†å¸ƒå¼é”ã€‚æ¯ä¸ªç³»ç»Ÿé€šè¿‡ <strong>Zookeeper</strong> è·å–åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿åŒä¸€æ—¶é—´ï¼Œåªèƒ½æœ‰ä¸€ä¸ªç³»ç»Ÿå®ä¾‹åœ¨æ“ä½œæŸä¸ª Keyï¼Œåˆ«äººéƒ½ä¸å…è®¸è¯»å’Œå†™ã€‚</p><p>2ã€ä½ è¦å†™å…¥ç¼“å­˜çš„æ•°æ®ï¼Œéƒ½æ˜¯ä» <strong>MySQL</strong> é‡ŒæŸ¥å‡ºæ¥çš„ï¼Œéƒ½å¾—å†™å…¥ <strong>MySQL</strong> ä¸­ï¼Œå†™å…¥ <strong>MySQL</strong> ä¸­çš„æ—¶å€™å¿…é¡»ä¿å­˜ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œä» <strong>MySQL</strong> æŸ¥å‡ºæ¥çš„æ—¶å€™ï¼Œæ—¶é—´æˆ³ä¹ŸæŸ¥å‡ºæ¥ã€‚</p><p>æ¯æ¬¡è¦<strong>å†™ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­</strong>ä¸€ä¸‹å½“å‰è¿™ä¸ª Value çš„æ—¶é—´æˆ³æ˜¯å¦æ¯”ç¼“å­˜é‡Œçš„ Value çš„æ—¶é—´æˆ³è¦æ–°ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥å†™ï¼Œå¦åˆ™ï¼Œå°±ä¸èƒ½ç”¨æ—§çš„æ•°æ®è¦†ç›–æ–°çš„æ•°æ®ã€‚</p><h2 id="æŒä¹…åŒ–ç¯‡"><a href="#æŒä¹…åŒ–ç¯‡" class="headerlink" title="æŒä¹…åŒ–ç¯‡"></a>æŒä¹…åŒ–ç¯‡</h2><h3 id="ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼Ÿ</h3><p><strong>Redis</strong> çš„æ•°æ® <strong>å…¨éƒ¨å­˜å‚¨</strong> åœ¨ <strong>å†…å­˜</strong> ä¸­ï¼Œå¦‚æœ <strong>çªç„¶å®•æœº</strong>ï¼Œæ•°æ®å°±ä¼šå…¨éƒ¨ä¸¢å¤±ï¼Œå› æ­¤å¿…é¡»æœ‰ä¸€å¥—æœºåˆ¶æ¥ä¿è¯ Redis çš„æ•°æ®ä¸ä¼šå› ä¸ºæ•…éšœè€Œä¸¢å¤±ï¼Œè¿™ç§æœºåˆ¶å°±æ˜¯ Redis çš„ <strong>æŒä¹…åŒ–æœºåˆ¶</strong>ï¼Œå®ƒä¼šå°†å†…å­˜ä¸­çš„æ•°æ®åº“çŠ¶æ€ <strong>ä¿å­˜åˆ°ç£ç›˜</strong> ä¸­ã€‚</p><p>ä¸¤è€…å¯åŒæ—¶å…±å­˜ï¼Œå…ˆåŠ è½½.aofã€‚</p><h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li>åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œä¹Ÿå°±æ˜¯è¡Œè¯è®²çš„Snapshotå¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œã€‚rdbä¿å­˜çš„æ˜¯dump.rdbæ–‡ä»¶ã€‚</li><li>Redisä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚</li></ul><p>æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£RDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚</p><h4 id="é…ç½®ä½¿ç”¨"><a href="#é…ç½®ä½¿ç”¨" class="headerlink" title="é…ç½®ä½¿ç”¨"></a>é…ç½®ä½¿ç”¨</h4><ul><li>é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½®ï¼Œå†·æ‹·è´åé‡æ–°ä½¿ç”¨ï¼Œå¯ä»¥cp  dump.rdb  dump_new.rdb</li><li>å‘½ä»¤saveæˆ–è€…æ˜¯bgsaveã€‚</li></ul><p>Saveï¼šsaveæ—¶åªç®¡ä¿å­˜ï¼Œå…¶å®ƒä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡.</p><p>BGSAVEï¼šRedisä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œå¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><p>å¯ä»¥é€šè¿‡lastsaveå‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´.</p><h4 id="å¦‚ä½•æ¢å¤"><a href="#å¦‚ä½•æ¢å¤" class="headerlink" title="å¦‚ä½•æ¢å¤"></a>å¦‚ä½•æ¢å¤</h4><pre><code>å°†å¤‡ä»½æ–‡ä»¶ (dump.rdb) ç§»åŠ¨åˆ° redis å®‰è£…ç›®å½•å¹¶å¯åŠ¨æœåŠ¡å³å¯CONFIG GET dirè·å–ç›®å½• </code></pre><h4 id="å¦‚ä½•åœæ­¢"><a href="#å¦‚ä½•åœæ­¢" class="headerlink" title="å¦‚ä½•åœæ­¢"></a>å¦‚ä½•åœæ­¢</h4><pre><code>åŠ¨æ€æ‰€æœ‰åœæ­¢RDBä¿å­˜è§„åˆ™çš„æ–¹æ³•ï¼šredis-cli config set save &quot;&quot;</code></pre><h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><h4 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li>ä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼Œå°†Redisæ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥(è¯»æ“ä½œä¸è®°å½•)ï¼Œ</li><li>åªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶ï¼Œredisé‡å¯æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†å†™æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œã€‚</li></ul><h4 id="é…ç½®ä½¿ç”¨-1"><a href="#é…ç½®ä½¿ç”¨-1" class="headerlink" title="é…ç½®ä½¿ç”¨"></a>é…ç½®ä½¿ç”¨</h4><ul><li>ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyes</li></ul><h4 id="åŒæ­¥é¢‘ç‡"><a href="#åŒæ­¥é¢‘ç‡" class="headerlink" title="åŒæ­¥é¢‘ç‡"></a>åŒæ­¥é¢‘ç‡</h4><p>æ¯æ¬¡ä¿®æ”¹éƒ½åŒæ­¥ï¼šappendfsync always  åŒæ­¥æ“ä½œï¼Œæ¯æ¬¡å‘ç”Ÿæ•°æ®å˜æ›´ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜ï¼Œæ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½</p><p>æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼šappendfsync everysec  å¼‚æ­¥æ“ä½œï¼Œæ¯ç§’è®°å½•å¦‚æœä¸€ç§’å†…å®•æœºï¼Œæœ‰æ•°æ®ä¸¢å¤±</p><p>ä¸åŒæ­¥ï¼šappendfsync no  ä»ä¸åŒæ­¥</p><h4 id="è¢«å†™åçš„AOFæ–‡ä»¶ä¿®å¤ï¼š"><a href="#è¢«å†™åçš„AOFæ–‡ä»¶ä¿®å¤ï¼š" class="headerlink" title="è¢«å†™åçš„AOFæ–‡ä»¶ä¿®å¤ï¼š"></a>è¢«å†™åçš„AOFæ–‡ä»¶ä¿®å¤ï¼š</h4><pre><code>redis-check-aof --fixè¿›è¡Œä¿®å¤æ¢å¤ï¼šé‡å¯redisç„¶åé‡æ–°åŠ è½½</code></pre><h3 id="RDBä¸AOFä¼˜åŠ£æ¯”å¯¹ï¼š"><a href="#RDBä¸AOFä¼˜åŠ£æ¯”å¯¹ï¼š" class="headerlink" title="RDBä¸AOFä¼˜åŠ£æ¯”å¯¹ï¼š"></a>RDBä¸AOFä¼˜åŠ£æ¯”å¯¹ï¼š</h3><p>RDBå’ŒAOFå¹¶ä¸äº’æ–¥ï¼Œå®ƒä¿©å¯ä»¥<strong>åŒæ—¶ä½¿ç”¨</strong>ã€‚</p><ul><li>RDBçš„ä¼˜ç‚¹ï¼šè½½å…¥æ—¶<strong>æ¢å¤æ•°æ®å¿«</strong>ã€æ–‡ä»¶ä½“ç§¯å°ã€‚</li><li>RDBçš„ç¼ºç‚¹ï¼šä¼šä¸€å®šç¨‹åº¦ä¸Š<strong>ä¸¢å¤±æ•°æ®</strong>(å› ä¸ºç³»ç»Ÿä¸€æ—¦åœ¨å®šæ—¶æŒä¹…åŒ–ä¹‹å‰å‡ºç°å®•æœºç°è±¡ï¼Œæ­¤å‰æ²¡æœ‰æ¥å¾—åŠå†™å…¥ç£ç›˜çš„æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚)</li><li>AOFçš„ä¼˜ç‚¹ï¼šä¸¢å¤±æ•°æ®å°‘(é»˜è®¤é…ç½®åªä¸¢å¤±ä¸€ç§’çš„æ•°æ®)ã€‚</li><li>AOFçš„ç¼ºç‚¹ï¼šæ¢å¤æ•°æ®ç›¸å¯¹è¾ƒæ…¢ï¼Œæ–‡ä»¶ä½“ç§¯å¤§</li></ul><p>å¦‚æœRedisæœåŠ¡å™¨<strong>åŒæ—¶å¼€å¯</strong>äº†RDBå’ŒAOFæŒä¹…åŒ–ï¼ŒæœåŠ¡å™¨ä¼š<strong>ä¼˜å…ˆä½¿ç”¨AOFæ–‡ä»¶</strong>æ¥è¿˜åŸæ•°æ®(å› ä¸ºAOFæ›´æ–°é¢‘ç‡æ¯”RDBæ›´æ–°é¢‘ç‡è¦é«˜ï¼Œè¿˜åŸçš„æ•°æ®æ›´å®Œå–„)ã€‚</p><p>å®é™…ç”Ÿäº§åº”rediså®•æœºçš„è¯ï¼Œåº”ä½¿ç”¨rdbè¿›è¡Œå¿«é€Ÿæ¢å¤ï¼Œç„¶åä½¿ç”¨aofè¿›è¡Œè¡¥å……å®Œæ•´ã€‚</p><h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><p>ã€€ã€€åˆ†å¸ƒå¼é”å…¶å®å¯ä»¥ç†è§£ä¸ºï¼šæ§åˆ¶åˆ†å¸ƒå¼ç³»ç»Ÿæœ‰åºçš„å»å¯¹å…±äº«èµ„æºè¿›è¡Œæ“ä½œï¼Œé€šè¿‡äº’æ–¥æ¥ä¿æŒä¸€è‡´æ€§ã€‚ ä¸¾ä¸ªä¸å¤ªæ°å½“çš„ä¾‹å­ï¼šå‡è®¾å…±äº«çš„èµ„æºå°±æ˜¯ä¸€ä¸ªæˆ¿å­ï¼Œé‡Œé¢æœ‰å„ç§ä¹¦ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå°±æ˜¯è¦è¿›å±‹çœ‹ä¹¦çš„äººï¼Œåˆ†å¸ƒå¼é”å°±æ˜¯ä¿è¯è¿™ä¸ªæˆ¿å­åªæœ‰ä¸€ä¸ªé—¨å¹¶ä¸”ä¸€æ¬¡åªæœ‰ä¸€ä¸ªäººå¯ä»¥è¿›ï¼Œè€Œä¸”é—¨åªæœ‰ä¸€æŠŠé’¥åŒ™ã€‚ç„¶åè®¸å¤šäººè¦å»çœ‹ä¹¦ï¼Œå¯ä»¥ï¼Œæ’é˜Ÿï¼Œç¬¬ä¸€ä¸ªäººæ‹¿ç€é’¥åŒ™æŠŠé—¨æ‰“å¼€è¿›å±‹çœ‹ä¹¦å¹¶ä¸”æŠŠé—¨é”ä¸Šï¼Œç„¶åç¬¬äºŒä¸ªäººæ²¡æœ‰é’¥åŒ™ï¼Œé‚£å°±ç­‰ç€ï¼Œç­‰ç¬¬ä¸€ä¸ªå‡ºæ¥ï¼Œç„¶åä½ åœ¨æ‹¿ç€é’¥åŒ™è¿›å»ï¼Œç„¶åå°±æ˜¯ä»¥æ­¤ç±»æ¨ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p>åœ¨è¯†åˆ«å®Œæˆåï¼Œå¦‚è¯†åˆ«æˆåŠŸï¼Œéœ€è¦å…ˆæŸ¥å‡ºæ¥å£å½“å‰ä½¿ç”¨æ¬¡æ•°ï¼Œåˆ¤æ–­ä¸€ä¸‹ï¼Œç„¶åç»™æ¥å£ä½¿ç”¨è¡¨è¿›è¡Œå‡ä¸€æ“ä½œï¼Œç»Ÿè®¡è¡¨è¿›è¡ŒåŠ ä¸€æ“ä½œã€‚æˆ‘ä»¬çŸ¥é“è¿™ä¸ªè¿‡ç¨‹åœ¨å¹¶å‘æ¡ä»¶ä¸‹æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä¸ºäº†ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§åœ¨æ­¤åŠ äº†åˆ†å¸ƒå¼é”ã€‚</p><p>å•æœºé”è§£å†³å•æœºå†…å­˜å…±äº«å˜é‡é—®é¢˜ï¼Œåˆ†å¸ƒå¼é”è§£å†³å¤šå°æœºå™¨å…±äº«å˜é‡é—®é¢˜ï¼Œä¾‹å¦‚å¹¶å‘æ‰£å‡åº“å­˜ã€‚</p><h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><ul><li>äº’æ–¥æ€§<ul><li>ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥æ‹¿åˆ°é”ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¯¹å…±äº«èµ„æºè¿›è¡Œæ“ä½œ</li></ul></li><li>å®‰å…¨æ€§<ul><li>åªæœ‰åŠ é”çš„æœåŠ¡æ‰èƒ½æœ‰è§£é”æƒé™ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è®©aåŠ çš„é”ï¼Œbcdéƒ½å¯ä»¥è§£é”ï¼Œå¦‚æœéƒ½èƒ½è§£é”é‚£åˆ†å¸ƒå¼é”å°±æ²¡å•¥æ„ä¹‰äº†</li><li>å¯èƒ½å‡ºç°çš„æƒ…å†µå°±æ˜¯aå»æŸ¥è¯¢å‘ç°æŒæœ‰é”ï¼Œå°±åœ¨å‡†å¤‡è§£é”ï¼Œè¿™æ—¶å€™å¿½ç„¶aæŒæœ‰çš„é”è¿‡æœŸäº†ï¼Œç„¶åbå»è·å¾—é”ï¼Œå› ä¸ºaé”è¿‡æœŸï¼Œbæ‹¿åˆ°é”ï¼Œè¿™æ—¶å€™aç»§ç»­æ‰§è¡Œç¬¬äºŒæ­¥è¿›è¡Œè§£é”å¦‚æœä¸åŠ æ ¡éªŒï¼Œå°±å°†bæŒæœ‰çš„é”å°±ç»™åˆ é™¤äº†</li></ul></li><li>é¿å…æ­»é”</li><li><ul><li>å‡ºç°æ­»é”å°±ä¼šå¯¼è‡´åç»­çš„ä»»ä½•æœåŠ¡éƒ½æ‹¿ä¸åˆ°é”,ä¸èƒ½å†å¯¹å…±äº«èµ„æºè¿›è¡Œä»»ä½•æ“ä½œäº†</li></ul></li><li>ä¿è¯åŠ é”ä¸è§£é”æ“ä½œæ˜¯åŸå­æ€§æ“ä½œ</li><li><ul><li>è¿™ä¸ªå…¶å®å±äºæ˜¯å®ç°åˆ†å¸ƒå¼é”çš„é—®é¢˜ï¼Œå‡è®¾aç”¨rediså®ç°åˆ†å¸ƒå¼é”</li><li>å‡è®¾åŠ é”æ“ä½œï¼Œæ“ä½œæ­¥éª¤åˆ†ä¸ºä¸¤æ­¥ï¼š</li><li>1ï¼Œè®¾ç½®key setï¼ˆkeyï¼Œvalueï¼‰2ï¼Œç»™keyè®¾ç½®è¿‡æœŸæ—¶é—´</li></ul></li><li><ul><li>å‡è®¾ç°åœ¨aåˆšå®ç°setåï¼Œç¨‹åºå´©äº†å°±å¯¼è‡´äº†æ²¡ç»™keyè®¾ç½®è¿‡æœŸæ—¶é—´å°±å¯¼è‡´keyä¸€ç›´å­˜åœ¨å°±å‘ç”Ÿäº†æ­»é”</li></ul></li></ul><h3 id="åˆ†å¸ƒå¼é”çš„å‡ ç§æ–¹å¼"><a href="#åˆ†å¸ƒå¼é”çš„å‡ ç§æ–¹å¼" class="headerlink" title="åˆ†å¸ƒå¼é”çš„å‡ ç§æ–¹å¼"></a>åˆ†å¸ƒå¼é”çš„å‡ ç§æ–¹å¼</h3><p>ã€€ã€€å®ç°åˆ†å¸ƒå¼é”çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œåªè¦æ»¡è¶³ä¸Šè¿°æ¡ä»¶çš„éƒ½å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ï¼Œæ¯”å¦‚æ•°æ®åº“ï¼Œredisï¼Œzookeeperï¼Œåœ¨è¿™é‡Œå°±å…ˆè®²ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”</p><h3 id="ä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”"><a href="#ä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="ä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”"></a>ä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”</h3><ul><li>ä½¿ç”¨rediså‘½ä»¤ set key value NX EX max-lock-time å®ç°åŠ é”ï¼ˆåŒæ—¶æŠŠsetnxå’Œexpireåˆæˆä¸€æ¡æŒ‡ä»¤æ¥ç”¨ï¼Œå¦åˆ™setnxä¹‹åæ‰§è¡Œexpireä¹‹å‰è¿›ç¨‹æ„å¤–crashï¼Œè¿™ä¸ªé”å°±æ°¸è¿œå¾—ä¸åˆ°é‡Šæ”¾äº†ã€‚ï¼‰</li><li>ä½¿ç”¨rediså‘½ä»¤ EVAL å®ç°è§£é”</li></ul><h4 id="åŠ é”ï¼š"><a href="#åŠ é”ï¼š" class="headerlink" title="åŠ é”ï¼š"></a>åŠ é”ï¼š</h4><pre><code class="java">Jedis jedis = new Jedis(&quot;127.0.0.1&quot;, 6379); private static final String SUCCESS = &quot;OK&quot;; /**  * åŠ é”æ“ä½œ  * @param key é”æ ‡è¯†  * @param value å®¢æˆ·ç«¯æ ‡è¯†  * @param timeOut è¿‡æœŸæ—¶é—´  */ public Boolean lock(String key,String value,Long timeOut){     String var1 = jedis.set(key,value,&quot;NX&quot;,&quot;EX&quot;,timeOut);     if(LOCK_SUCCESS.equals(var1)){         return true;     }     return false; }</code></pre><p>è§£è¯»ï¼š</p><ul><li><p>åŠ é”æ“ä½œï¼šjedis.set(key,value,â€NXâ€,â€EXâ€,timeOut)ã€ä¿è¯åŠ é”çš„åŸå­æ“ä½œã€‘</p><p>![image-20200512213852945](/Users/lilei/Library/Application Support/typora-user-images/image-20200512213852945.png)</p></li></ul><hr><h4 id="è§£é”"><a href="#è§£é”" class="headerlink" title="è§£é”"></a>è§£é”</h4><pre><code class="java">Jedis jedis = new Jedis(&quot;127.0.0.1&quot;, 6379); private static final Long UNLOCK_SUCCESS = 1L; /**  * è§£é”æ“ä½œ  * @param key é”æ ‡è¯†  * @param value å®¢æˆ·ç«¯æ ‡è¯†  * @return  */ public static Boolean unLock(String key,String value){     String luaScript = &quot;if redis.call(\&quot;get\&quot;,KEYS[1]) == ARGV[1] then return redis.call(\&quot;del\&quot;,KEYS[1]) else  return 0 end&quot;;     Object var2 = jedis.eval(luaScript,Collections.singletonList(key), Collections.singletonList(value));     if (UNLOCK_SUCCESS == var2) {         return true;     }     return false; }</code></pre><p>è§£è¯»:</p><ul><li>luaScript è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸ªluaè„šæœ¬ï¼Œä»£è¡¨çš„æ„æ€æ˜¯å¦‚æœæ ¹æ®keyæ‹¿åˆ°çš„valueè·Ÿä¼ å…¥çš„valueç›¸åŒå°±æ‰§è¡Œdelï¼Œå¦åˆ™å°±è¿”å›0ã€ä¿è¯å®‰å…¨æ€§ã€‘</li><li>jedis.eval(String,list,list);è¿™ä¸ªå‘½ä»¤å°±æ˜¯å»æ‰§è¡Œluaè„šæœ¬ï¼ŒKEYSçš„é›†åˆå°±æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼ŒARGVçš„é›†åˆå°±æ˜¯ç¬¬ä¸‰å‚æ•°ã€ä¿è¯è§£é”çš„åŸå­æ“ä½œã€‘</li></ul><p>ä¸Šè¿°å°±å®ç°äº†æ€ä¹ˆä½¿ç”¨rediså»æ­£ç¡®çš„å®ç°åˆ†å¸ƒå¼é”ï¼Œä½†æ˜¯æœ‰ä¸ªå°ç¼ºé™·å°±æ˜¯é”è¿‡æœŸæ—¶é—´è¦è®¾ç½®ä¸ºå¤šå°‘åˆé€‚ï¼Œè¿™ä¸ªå…¶å®è¿˜æ˜¯éœ€è¦å»æ ¹æ®ä¸šåŠ¡åœºæ™¯è€ƒé‡ä¸€ä¸‹çš„</p><hr><h4 id="é‡è¯•æœºåˆ¶ï¼š"><a href="#é‡è¯•æœºåˆ¶ï¼š" class="headerlink" title="é‡è¯•æœºåˆ¶ï¼šã€€ã€€"></a>é‡è¯•æœºåˆ¶ï¼šã€€ã€€</h4><p>ä¸Šé¢é‚£åªæ˜¯è®²äº†åŠ é”ä¸è§£é”çš„æ“ä½œï¼Œè¯•æƒ³ä¸€ä¸‹å¦‚æœåœ¨ä¸šåŠ¡ä¸­å»æ‹¿é”å¦‚æœæ²¡æœ‰æ‹¿åˆ°æ˜¯åº”è¯¥é˜»å¡ç€ä¸€ç›´ç­‰å¾…è¿˜æ˜¯ç›´æ¥è¿”å›ï¼Œè¿™ä¸ªé—®é¢˜å…¶å®å¯ä»¥å†™ä¸€ä¸ªé‡è¯•æœºåˆ¶ï¼Œæ ¹æ®é‡è¯•æ¬¡æ•°å’Œé‡è¯•æ—¶é—´åšä¸€ä¸ªå¾ªç¯å»æ‹¿é”ï¼Œå½“ç„¶è¿™ä¸ªé‡è¯•çš„æ¬¡æ•°å’Œæ—¶é—´è®¾å¤šå°‘åˆé€‚ï¼Œæ˜¯éœ€è¦æ ¹æ®è‡ªèº«ä¸šåŠ¡å»è¡¡é‡çš„</p><pre><code class="java">/** * é‡è¯•æœºåˆ¶ * @param key é”æ ‡è¯† * @param value å®¢æˆ·ç«¯æ ‡è¯† * @param timeOut è¿‡æœŸæ—¶é—´ * @param retry é‡è¯•æ¬¡æ•° * @param sleepTime é‡è¯•é—´éš”æ—¶é—´ * @return */public Boolean lockRetry(String key,String value,Long timeOut,Integer retry,Long sleepTime){    Boolean flag = false;    try {        for (int i=0;i&lt;retry;i++){            flag = lock(key,value,timeOut);            if(flag){                break;            }            Thread.sleep(sleepTime);        }    }catch (Exception e){        e.printStackTrace();    }    return flag;}</code></pre><h3 id="è¿›é˜¶åˆ†å¸ƒå¼é”"><a href="#è¿›é˜¶åˆ†å¸ƒå¼é”" class="headerlink" title="è¿›é˜¶åˆ†å¸ƒå¼é”"></a>è¿›é˜¶åˆ†å¸ƒå¼é”</h3><p>ä»¥ä¸Šå®ç°æ–¹å¼ä¼šå‡ºç°å¹¶å‘ç«äº‰ï¼Œç³»ç»Ÿå¼‚å¸¸å¯¼è‡´é”æœªé‡Šæ”¾ï¼Œé”è¿‡æœŸæ—¶é—´ä¸åˆç†ï¼Œå½“å‰çº¿ç¨‹é”è¢«å…¶ä»–çº¿ç¨‹è§£é”ç­‰é—®é¢˜ã€‚ä»¥ä¸‹ä¸ºä¼˜åŒ–æ–¹æ¡ˆï¼š</p><h4 id="stringRedisTemplateå®ç°-è‡ªå®šä¹‰é€»è¾‘"><a href="#stringRedisTemplateå®ç°-è‡ªå®šä¹‰é€»è¾‘" class="headerlink" title="stringRedisTemplateå®ç°(è‡ªå®šä¹‰é€»è¾‘)"></a>stringRedisTemplateå®ç°(è‡ªå®šä¹‰é€»è¾‘)</h4><pre><code class="java">        /**     * æ¨¡æ‹Ÿç§’æ€åœºæ™¯ï¼Œåˆ©ç”¨Rediså®ç°åˆ†å¸ƒå¼é”ï¼ˆåŸç”Ÿå®ç°ï¼‰     */    @Test    public void test1() {        // è®¾ç½®clientIdï¼Œé¿å…åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹è‡ªå·±çš„é”è¢«ä»–äººè§£äº†      // è¿™é‡Œå¯ä»¥åŠ ä¸ŠrequestIdæ”¾åœ¨valueé‡Œé¢ï¼Œåœ¨finallyé‡Šæ”¾é”ä¹‹å‰åˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯å½“å‰è¯·æ±‚çš„é”        String clientId = UUID.randomUUID().toString();        String lockKey = &quot;lock&quot;;        try {            // åŠ é”            // è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º10sï¼Œé¿å…ç³»ç»Ÿå¼‚å¸¸å¯¼è‡´é”æ— æ³•é‡Šæ”¾ï¼ˆä¸å®‰å…¨å‡çº§ï¼‰            Boolean result = stringRedisTemplate.opsForValue().setIfAbsent(lockKey, clientId, 10, TimeUnit.SECONDS);            if (!result) {                return;            }            //è·å–å½“å‰åº“å­˜            int stock = Integer.parseInt(Objects.requireNonNull(stringRedisTemplate.opsForValue().get(&quot;stock&quot;)));            if (stock &gt; 0) {                int realStock = stock - 1;                stringRedisTemplate.opsForValue().set(&quot;stock&quot;, realStock + &quot;&quot;);                System.out.println(&quot;æ‰£å‡æˆåŠŸï¼Œå‰©ä½™åº“å­˜&quot; + realStock);            } else {                System.out.println(&quot;åº“å­˜ä¸è¶³&quot;);            }        } catch (Exception e) {            System.out.println(e.getMessage());        } finally {            // é‡Šæ”¾é”            if (clientId.equals(stringRedisTemplate.opsForValue().get(lockKey))) {                stringRedisTemplate.delete(lockKey);            }        }    }</code></pre><h4 id="Redissonå®ç°"><a href="#Redissonå®ç°" class="headerlink" title="Redissonå®ç°"></a>Redissonå®ç°</h4><p>é€šè¿‡ <code>eval</code> å‘½ä»¤æ¥æ‰§è¡Œ <em>Lua</em> è„šæœ¬ï¼Œä¿è¯åŸå­æ€§</p><p>é»˜è®¤30Sè¿‡æœŸæ—¶é—´</p><pre><code class="java">/**     * æ¨¡æ‹Ÿç§’æ€åœºæ™¯ï¼Œåˆ©ç”¨Redissonå®ç°åˆ†å¸ƒå¼é”     *     * SpringBooté›†æˆredisson(å•æœº,é›†ç¾¤,å“¨å…µ)ï¼šå‚è€ƒ https://www.jianshu.com/p/2b19dec72ab0     *     * è¿™é‡Œç®€å•å®ç°     */    @Test    public void test2() {        String lockKey = &quot;lock&quot;;        RLock redissonLock = redisson.getLock(lockKey);        try {            // åŠ é”            redissonLock.lock();            //è·å–å½“å‰åº“å­˜            int stock = Integer.parseInt(Objects.requireNonNull(stringRedisTemplate.opsForValue().get(&quot;stock&quot;)));            if (stock &gt; 0) {                int realStock = stock - 1;                stringRedisTemplate.opsForValue().set(&quot;stock&quot;, realStock + &quot;&quot;);                System.out.println(&quot;æ‰£å‡æˆåŠŸï¼Œå‰©ä½™åº“å­˜&quot; + realStock);            } else {                System.out.println(&quot;åº“å­˜ä¸è¶³&quot;);            }        } catch (Exception e) {            System.out.println(e.getMessage());        } finally {            // é‡Šæ”¾é”            redissonLock.unlock();        }    }</code></pre><pre><code class="java">@SpringBootApplication@MapperScan(&quot;com.example.mapper&quot;)public class RedisApplication {    public static void main(String[] args) {        SpringApplication.run(RedisApplication.class, args);    }    @Bean    public Redisson redisson() {        // å•æœºæ¨¡å¼        Config config = new Config();        config.useSingleServer().setAddress(&quot;redis://172.16.219.215:6379&quot;).setDatabase(0);        return (Redisson) Redisson.create(config);    }}</code></pre><h4 id="Redissonåº•å±‚åŸç†"><a href="#Redissonåº•å±‚åŸç†" class="headerlink" title="Redissonåº•å±‚åŸç†"></a>Redissonåº•å±‚åŸç†</h4><p><img alt="image-20200526165243747" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf5ybg4v0ej30tq0f8dlu.jpg" class="lazyload"></p><p>åŸºæœ¬åŒè‡ªå·±stringRedisTemplateå®ç°çš„é€»è¾‘ï¼Œè¡¥å……ï¼šçœ‹é—¨é”åœ¨åŸçº¿ç¨‹ä¸­å¼€å¯ä¸€ä¸ªå­çº¿ç¨‹ï¼Œå®šæ—¶æ£€æµ‹çˆ¶çº¿ç¨‹çš„é”æ˜¯å¦è¿˜å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿›è¡Œé”ç»­å‘½ã€‚</p><p>åŠ é”å’Œè§£é”ï¼ˆåˆ¤æ–­é”å­˜åœ¨å³åˆ é™¤é”ï¼‰éƒ½é€šè¿‡ç”¨luaè„šæœ¬ä¿è¯äº†è‡ªå·±çš„åŸå­æ€§ã€‚</p><h3 id="åˆ†å¸ƒå¼é”æ€§èƒ½ä¼˜åŒ–"><a href="#åˆ†å¸ƒå¼é”æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="åˆ†å¸ƒå¼é”æ€§èƒ½ä¼˜åŒ–"></a>åˆ†å¸ƒå¼é”æ€§èƒ½ä¼˜åŒ–</h3><p>å…¶å®è¯´å‡ºæ¥ä¹Ÿå¾ˆç®€å•ï¼Œç›¸ä¿¡å¾ˆå¤šäººçœ‹è¿‡javaé‡Œçš„<strong>ConcurrentHashMap</strong>çš„æºç å’Œåº•å±‚åŸç†ï¼Œåº”è¯¥çŸ¥é“é‡Œé¢çš„æ ¸å¿ƒæ€è·¯ï¼Œå°±æ˜¯<strong>åˆ†æ®µåŠ é”</strong>ï¼</p><p>æŠŠæ•°æ®åˆ†æˆå¾ˆå¤šä¸ªæ®µï¼Œæ¯ä¸ªæ®µæ˜¯ä¸€ä¸ªå•ç‹¬çš„é”ï¼Œæ‰€ä»¥å¤šä¸ªçº¿ç¨‹è¿‡æ¥å¹¶å‘ä¿®æ”¹æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥å¹¶å‘çš„ä¿®æ”¹ä¸åŒæ®µçš„æ•°æ®ã€‚ä¸è‡³äºè¯´ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ç‹¬å ä¿®æ”¹ConcurrentHashMapä¸­çš„æ•°æ®ã€‚</p><p>å¦å¤–ï¼ŒJava 8ä¸­æ–°å¢äº†ä¸€ä¸ªLongAdderç±»ï¼Œä¹Ÿæ˜¯é’ˆå¯¹Java 7ä»¥å‰çš„AtomicLongè¿›è¡Œçš„ä¼˜åŒ–ï¼Œè§£å†³çš„æ˜¯CASç±»æ“ä½œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ä¹è§‚é”æ€è·¯ï¼Œä¼šå¯¼è‡´å¤§é‡çº¿ç¨‹é•¿æ—¶é—´é‡å¤å¾ªç¯ã€‚</p><p>LongAdderä¸­ä¹Ÿæ˜¯é‡‡ç”¨äº†ç±»ä¼¼çš„åˆ†æ®µCASæ“ä½œï¼Œå¤±è´¥åˆ™è‡ªåŠ¨è¿ç§»åˆ°ä¸‹ä¸€ä¸ªåˆ†æ®µè¿›è¡ŒCASçš„æ€è·¯ã€‚</p><p>å…¶å®åˆ†å¸ƒå¼é”çš„ä¼˜åŒ–æ€è·¯ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¹‹å‰æˆ‘ä»¬æ˜¯åœ¨å¦å¤–ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ä¸‹è½åœ°äº†è¿™ä¸ªæ–¹æ¡ˆåˆ°ç”Ÿäº§ä¸­ï¼Œä¸æ˜¯åœ¨åº“å­˜è¶…å–é—®é¢˜é‡Œç”¨çš„ã€‚</p><p>ä½†æ˜¯åº“å­˜è¶…å–è¿™ä¸ªä¸šåŠ¡åœºæ™¯ä¸é”™ï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç”¨è¿™ä¸ªåœºæ™¯æ¥è¯´ä¸€ä¸‹ã€‚å¤§å®¶çœ‹çœ‹ä¸‹é¢çš„å›¾ï¼š</p><p><img alt="image-20200526170441392" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf5ynus807j30jz0phwmw.jpg" class="lazyload"></p><p>å…¶å®è¿™å°±æ˜¯åˆ†æ®µåŠ é”ã€‚ä½ æƒ³ï¼Œå‡å¦‚ä½ ç°åœ¨iphoneæœ‰1000ä¸ªåº“å­˜ï¼Œé‚£ä¹ˆä½ å®Œå…¨å¯ä»¥ç»™æ‹†æˆ20ä¸ªåº“å­˜æ®µï¼Œè¦æ˜¯ä½ æ„¿æ„ï¼Œå¯ä»¥åœ¨æ•°æ®åº“çš„è¡¨é‡Œå»º20ä¸ªåº“å­˜å­—æ®µï¼Œæ¯”å¦‚stock_01ï¼Œstock_02ï¼Œç±»ä¼¼è¿™æ ·çš„ï¼Œä¹Ÿå¯ä»¥åœ¨redisä¹‹ç±»çš„åœ°æ–¹æ”¾20ä¸ªåº“å­˜keyã€‚</p><p>æ€»ä¹‹ï¼Œå°±æ˜¯æŠŠä½ çš„1000ä»¶åº“å­˜ç»™ä»–æ‹†å¼€ï¼Œæ¯ä¸ªåº“å­˜æ®µæ˜¯50ä»¶åº“å­˜ï¼Œæ¯”å¦‚stock_01å¯¹åº”50ä»¶åº“å­˜ï¼Œstock_02å¯¹åº”50ä»¶åº“å­˜ã€‚</p><p>æ¥ç€ï¼Œæ¯ç§’1000ä¸ªè¯·æ±‚è¿‡æ¥äº†ï¼Œå¥½ï¼æ­¤æ—¶å…¶å®å¯ä»¥æ˜¯è‡ªå·±å†™ä¸€ä¸ªç®€å•çš„éšæœºç®—æ³•ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯éšæœºåœ¨20ä¸ªåˆ†æ®µåº“å­˜é‡Œï¼Œé€‰æ‹©ä¸€ä¸ªè¿›è¡ŒåŠ é”ã€‚</p><p>bingoï¼è¿™æ ·å°±å¥½äº†ï¼ŒåŒæ—¶å¯ä»¥æœ‰æœ€å¤š20ä¸ªä¸‹å•è¯·æ±‚ä¸€èµ·æ‰§è¡Œï¼Œæ¯ä¸ªä¸‹å•è¯·æ±‚é”äº†ä¸€ä¸ªåº“å­˜åˆ†æ®µï¼Œç„¶ååœ¨ä¸šåŠ¡é€»è¾‘é‡Œé¢ï¼Œå°±å¯¹æ•°æ®åº“æˆ–è€…æ˜¯Redisä¸­çš„é‚£ä¸ªåˆ†æ®µåº“å­˜è¿›è¡Œæ“ä½œå³å¯ï¼ŒåŒ…æ‹¬æŸ¥åº“å­˜ -&gt; åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ -&gt; æ‰£å‡åº“å­˜ã€‚</p><p>è¿™ç›¸å½“äºä»€ä¹ˆå‘¢ï¼Ÿç›¸å½“äºä¸€ä¸ª20æ¯«ç§’ï¼Œå¯ä»¥å¹¶å‘å¤„ç†æ‰20ä¸ªä¸‹å•è¯·æ±‚ï¼Œé‚£ä¹ˆ1ç§’ï¼Œä¹Ÿå°±å¯ä»¥ä¾æ¬¡å¤„ç†æ‰20 * 50  = 1000ä¸ªå¯¹iphoneçš„ä¸‹å•è¯·æ±‚äº†ã€‚</p><p>ä¸€æ—¦å¯¹æŸä¸ªæ•°æ®åšäº†åˆ†æ®µå¤„ç†ä¹‹åï¼Œæœ‰ä¸€ä¸ªå‘å¤§å®¶ä¸€å®šè¦æ³¨æ„ï¼š==å°±æ˜¯å¦‚æœæŸä¸ªä¸‹å•è¯·æ±‚ï¼Œå’”åš“åŠ é”ï¼Œç„¶åå‘ç°è¿™ä¸ªåˆ†æ®µåº“å­˜é‡Œçš„åº“å­˜ä¸è¶³äº†ï¼Œæ­¤æ—¶å’‹åŠï¼Ÿ==</p><p><strong>è¿™æ—¶ä½ å¾—è‡ªåŠ¨é‡Šæ”¾é”ï¼Œç„¶åç«‹é©¬æ¢ä¸‹ä¸€ä¸ªåˆ†æ®µåº“å­˜ï¼Œå†æ¬¡å°è¯•åŠ é”åå°è¯•å¤„ç†ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸€å®šè¦å®ç°ã€‚</strong></p><h2 id="Redis-3ç§è¿‡æœŸç­–ç•¥ï¼Ÿ"><a href="#Redis-3ç§è¿‡æœŸç­–ç•¥ï¼Ÿ" class="headerlink" title="Redis 3ç§è¿‡æœŸç­–ç•¥ï¼Ÿ"></a>Redis 3ç§è¿‡æœŸç­–ç•¥ï¼Ÿ</h2><h3 id="3ç§ç­–ç•¥å„è‡ªçš„ç‰¹ç‚¹"><a href="#3ç§ç­–ç•¥å„è‡ªçš„ç‰¹ç‚¹" class="headerlink" title="3ç§ç­–ç•¥å„è‡ªçš„ç‰¹ç‚¹"></a>3ç§ç­–ç•¥å„è‡ªçš„ç‰¹ç‚¹</h3><ul><li><strong>å®šæ—¶åˆ é™¤</strong><ul><li>å«ä¹‰ï¼šåœ¨è®¾ç½®keyçš„è¿‡æœŸæ—¶é—´çš„åŒæ—¶ï¼Œä¸ºè¯¥keyåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œè®©å®šæ—¶å™¨åœ¨keyçš„è¿‡æœŸæ—¶é—´æ¥ä¸´æ—¶ï¼Œå¯¹keyè¿›è¡Œåˆ é™¤</li><li>ä¼˜ç‚¹ï¼šä¿è¯å†…å­˜è¢«å°½å¿«é‡Šæ”¾</li><li>ç¼ºç‚¹ï¼š<ul><li>è‹¥è¿‡æœŸkeyå¾ˆå¤šï¼Œåˆ é™¤è¿™äº›keyä¼šå ç”¨å¾ˆå¤šçš„CPUæ—¶é—´ï¼Œåœ¨CPUæ—¶é—´ç´§å¼ çš„æƒ…å†µä¸‹ï¼ŒCPUä¸èƒ½æŠŠæ‰€æœ‰çš„æ—¶é—´ç”¨æ¥åšè¦ç´§çš„äº‹å„¿ï¼Œè¿˜éœ€è¦å»èŠ±æ—¶é—´åˆ é™¤è¿™äº›key</li><li>å®šæ—¶å™¨çš„åˆ›å»ºè€—æ—¶ï¼Œè‹¥ä¸ºæ¯ä¸€ä¸ªè®¾ç½®è¿‡æœŸæ—¶é—´çš„keyåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼ˆå°†ä¼šæœ‰å¤§é‡çš„å®šæ—¶å™¨äº§ç”Ÿï¼‰ï¼Œæ€§èƒ½å½±å“ä¸¥é‡</li><li>æ²¡äººç”¨</li></ul></li></ul></li><li><strong>æƒ°æ€§åˆ é™¤</strong><ul><li>å«ä¹‰ï¼škeyè¿‡æœŸçš„æ—¶å€™ä¸åˆ é™¤ï¼Œæ¯æ¬¡ä»æ•°æ®åº“è·å–keyçš„æ—¶å€™å»æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œè‹¥è¿‡æœŸï¼Œåˆ™åˆ é™¤ï¼Œè¿”å›nullã€‚</li><li>ä¼˜ç‚¹ï¼šåˆ é™¤æ“ä½œåªå‘ç”Ÿåœ¨ä»æ•°æ®åº“å–å‡ºkeyçš„æ—¶å€™å‘ç”Ÿï¼Œè€Œä¸”åªåˆ é™¤å½“å‰keyï¼Œæ‰€ä»¥å¯¹CPUæ—¶é—´çš„å ç”¨æ˜¯æ¯”è¾ƒå°‘çš„ï¼Œè€Œä¸”æ­¤æ—¶çš„åˆ é™¤æ˜¯å·²ç»åˆ°äº†éåšä¸å¯çš„åœ°æ­¥ï¼ˆå¦‚æœæ­¤æ—¶è¿˜ä¸åˆ é™¤çš„è¯ï¼Œæˆ‘ä»¬å°±ä¼šè·å–åˆ°äº†å·²ç»è¿‡æœŸçš„keyäº†ï¼‰</li><li>ç¼ºç‚¹ï¼šè‹¥å¤§é‡çš„keyåœ¨è¶…å‡ºè¶…æ—¶æ—¶é—´åï¼Œå¾ˆä¹…ä¸€æ®µæ—¶é—´å†…ï¼Œéƒ½æ²¡æœ‰è¢«è·å–è¿‡ï¼Œé‚£ä¹ˆå¯èƒ½å‘ç”Ÿå†…å­˜æ³„éœ²ï¼ˆæ— ç”¨çš„åƒåœ¾å ç”¨äº†å¤§é‡çš„å†…å­˜ï¼‰</li></ul></li><li><strong>å®šæœŸåˆ é™¤</strong><ul><li>å«ä¹‰ï¼šæ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡åˆ é™¤(åœ¨redis.confé…ç½®æ–‡ä»¶è®¾ç½®hzï¼Œ1såˆ·æ–°çš„é¢‘ç‡)è¿‡æœŸkeyæ“ä½œ</li><li>ä¼˜ç‚¹ï¼š<ul><li>é€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œçš„æ—¶é•¿å’Œé¢‘ç‡ï¼Œæ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹CPUæ—¶é—´çš„å ç”¨â€“å¤„ç†â€å®šæ—¶åˆ é™¤â€çš„ç¼ºç‚¹</li><li>å®šæœŸåˆ é™¤è¿‡æœŸkeyâ€“å¤„ç†â€æƒ°æ€§åˆ é™¤â€çš„ç¼ºç‚¹</li></ul></li><li>ç¼ºç‚¹<ul><li>åœ¨å†…å­˜å‹å¥½æ–¹é¢ï¼Œä¸å¦‚â€å®šæ—¶åˆ é™¤â€</li><li>åœ¨CPUæ—¶é—´å‹å¥½æ–¹é¢ï¼Œä¸å¦‚â€æƒ°æ€§åˆ é™¤â€</li></ul></li><li>éš¾ç‚¹<ul><li>åˆç†è®¾ç½®åˆ é™¤æ“ä½œçš„æ‰§è¡Œæ—¶é•¿ï¼ˆæ¯æ¬¡åˆ é™¤æ‰§è¡Œå¤šé•¿æ—¶é—´ï¼‰å’Œæ‰§è¡Œé¢‘ç‡ï¼ˆæ¯éš”å¤šé•¿æ—¶é—´åšä¸€æ¬¡åˆ é™¤ï¼‰ï¼ˆè¿™ä¸ªè¦æ ¹æ®æœåŠ¡å™¨è¿è¡Œæƒ…å†µæ¥å®šäº†ï¼‰</li></ul></li></ul></li></ul><p>çœ‹å®Œä¸Šé¢ä¸‰ç§ç­–ç•¥åå¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š<br>å®šæ—¶åˆ é™¤å’Œå®šæœŸåˆ é™¤ä¸ºä¸»åŠ¨åˆ é™¤ï¼šRedisä¼šå®šæœŸä¸»åŠ¨æ·˜æ±°ä¸€æ‰¹å·²è¿‡å»çš„key</p><p>æƒ°æ€§åˆ é™¤ä¸ºè¢«åŠ¨åˆ é™¤ï¼šç”¨åˆ°çš„æ—¶å€™æ‰ä¼šå»æ£€éªŒkeyæ˜¯ä¸æ˜¯å·²è¿‡æœŸï¼Œè¿‡æœŸå°±åˆ é™¤</p><p>æƒ°æ€§åˆ é™¤ä¸ºredisæœåŠ¡å™¨å†…ç½®ç­–ç•¥</p><p>å®šæœŸåˆ é™¤å¯ä»¥é€šè¿‡ï¼š</p><ul><li>ç¬¬ä¸€ã€é…ç½®redis.conf çš„hzé€‰é¡¹ï¼Œé»˜è®¤ä¸º10 ï¼ˆå³1ç§’æ‰§è¡Œ10æ¬¡ï¼Œ100msä¸€æ¬¡ï¼Œå€¼è¶Šå¤§è¯´æ˜åˆ·æ–°é¢‘ç‡è¶Šå¿«ï¼Œæœ€Redisæ€§èƒ½æŸè€—ä¹Ÿè¶Šå¤§ï¼‰ </li><li>ç¬¬äºŒã€é…ç½®redis.confçš„maxmemoryæœ€å¤§å€¼ï¼Œå½“å·²ç”¨å†…å­˜è¶…è¿‡maxmemoryé™å®šæ—¶ï¼Œå°±ä¼šè§¦å‘ä¸»åŠ¨æ¸…ç†ç­–ç•¥</li></ul><h3 id="Redisé‡‡ç”¨çš„è¿‡æœŸç­–ç•¥"><a href="#Redisé‡‡ç”¨çš„è¿‡æœŸç­–ç•¥" class="headerlink" title="Redisé‡‡ç”¨çš„è¿‡æœŸç­–ç•¥"></a>Redisé‡‡ç”¨çš„è¿‡æœŸç­–ç•¥</h3><p>æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤</p><ul><li>æƒ°æ€§åˆ é™¤æµç¨‹<ul><li>åœ¨è¿›è¡Œgetæˆ–setnxç­‰æ“ä½œæ—¶ï¼Œå…ˆæ£€æŸ¥keyæ˜¯å¦è¿‡æœŸï¼Œ</li><li>è‹¥è¿‡æœŸï¼Œåˆ é™¤keyï¼Œç„¶åæ‰§è¡Œç›¸åº”æ“ä½œï¼›</li><li>è‹¥æ²¡è¿‡æœŸï¼Œç›´æ¥æ‰§è¡Œç›¸åº”æ“ä½œ</li></ul></li><li>å®šæœŸåˆ é™¤æµç¨‹ï¼ˆç®€å•è€Œè¨€ï¼Œå¯¹æŒ‡å®šä¸ªæ•°ä¸ªåº“çš„æ¯ä¸€ä¸ªåº“éšæœºåˆ é™¤å°äºç­‰äºæŒ‡å®šä¸ªæ•°ä¸ªè¿‡æœŸkeyï¼‰<ul><li>éå†æ¯ä¸ªæ•°æ®åº“ï¼ˆå°±æ˜¯redis.confä¸­é…ç½®çš„â€databaseâ€æ•°é‡ï¼Œé»˜è®¤ä¸º16ï¼‰</li><li>æ£€æŸ¥å½“å‰åº“ä¸­çš„æŒ‡å®šä¸ªæ•°ä¸ªkeyï¼ˆé»˜è®¤æ˜¯æ¯ä¸ªåº“<strong>éšæœº</strong>æ£€æŸ¥20ä¸ªkeyï¼Œæ³¨æ„ç›¸å½“äºè¯¥å¾ªç¯æ‰§è¡Œ20æ¬¡ï¼Œå¾ªç¯ä½“æ—¶ä¸‹è¾¹çš„æè¿°ï¼‰</li><li>å¦‚æœå½“å‰åº“ä¸­æ²¡æœ‰ä¸€ä¸ªkeyè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œç›´æ¥æ‰§è¡Œä¸‹ä¸€ä¸ªåº“çš„éå†</li><li>éšæœºè·å–ä¸€ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œæ£€æŸ¥è¯¥keyæ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸï¼Œåˆ é™¤key</li><li>åˆ¤æ–­å®šæœŸåˆ é™¤æ“ä½œæ˜¯å¦å·²ç»è¾¾åˆ°æŒ‡å®šæ—¶é•¿ï¼Œè‹¥å·²ç»è¾¾åˆ°ï¼Œç›´æ¥é€€å‡ºå®šæœŸåˆ é™¤ã€‚</li></ul></li></ul><p>==æœ€åå°±æ˜¯å¦‚æœçš„å¦‚æœï¼Œå®šæœŸæ²¡åˆ ï¼Œæˆ‘ä¹Ÿæ²¡æŸ¥è¯¢ï¼Œé‚£å¯å’‹æ•´ï¼Ÿ==</p><h2 id="Redis-çš„æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"><a href="#Redis-çš„æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Redis çš„æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"></a>Redis çš„æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h2><p>æˆ‘ä»¬é€šè¿‡é…ç½®redis.confä¸­çš„maxmemoryè¿™ä¸ªå€¼æ¥å¼€å¯å†…å­˜æ·˜æ±°åŠŸèƒ½ã€‚æ ¹æ®ç”¨æˆ·è®¾ç½®çš„é€å‡ºç­–ç•¥ï¼Œé€‰å‡ºå¾…é€å‡ºçš„keyï¼Œç›´åˆ°å½“å‰å†…å­˜å°äºæœ€å¤§å†…å­˜å€¼ä¸ºæ­¢ã€‚</p><h3 id="Redis-æœ‰å…­ç§æ·˜æ±°ç­–ç•¥"><a href="#Redis-æœ‰å…­ç§æ·˜æ±°ç­–ç•¥" class="headerlink" title="Redis æœ‰å…­ç§æ·˜æ±°ç­–ç•¥"></a>Redis æœ‰å…­ç§æ·˜æ±°ç­–ç•¥</h3><table><thead><tr><th align="left">ç­–ç•¥</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">volatile-lru</td><td align="left">ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„ KV é›†ä¸­ä¼˜å…ˆå¯¹æœ€è¿‘<strong>æœ€å°‘ä½¿ç”¨</strong>(less recently used)çš„æ•°æ®æ·˜æ±°</td></tr><tr><td align="left">volitile-ttl</td><td align="left">ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„ KV é›†ä¸­ä¼˜å…ˆå¯¹<strong>å‰©ä½™æ—¶é—´çŸ­</strong>(time to live)çš„æ•°æ®æ·˜æ±°</td></tr><tr><td align="left">volitile-random</td><td align="left">ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„ KV é›†ä¸­<strong>éšæœº</strong>é€‰æ‹©æ•°æ®æ·˜æ±°</td></tr><tr><td align="left">allkeys-lru</td><td align="left">ä»æ‰€æœ‰ KV é›†ä¸­ä¼˜å…ˆå¯¹<strong>æœ€è¿‘æœ€å°‘ä½¿ç”¨</strong>(less recently used)çš„æ•°æ®æ·˜æ±°</td></tr><tr><td align="left">allKeys-random</td><td align="left">ä»æ‰€æœ‰ KV é›†ä¸­<strong>éšæœºé€‰æ‹©</strong>æ•°æ®æ·˜æ±°</td></tr><tr><td align="left">noeviction</td><td align="left"><strong>ä¸æ·˜æ±°</strong>ç­–ç•¥ï¼Œè‹¥è¶…è¿‡æœ€å¤§å†…å­˜ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</td></tr></tbody></table><h3 id="4-0-ç‰ˆæœ¬åå¢åŠ ä»¥ä¸‹ä¸¤ç§"><a href="#4-0-ç‰ˆæœ¬åå¢åŠ ä»¥ä¸‹ä¸¤ç§" class="headerlink" title="4.0 ç‰ˆæœ¬åå¢åŠ ä»¥ä¸‹ä¸¤ç§"></a>4.0 ç‰ˆæœ¬åå¢åŠ ä»¥ä¸‹ä¸¤ç§</h3><ul><li>volatile-lfuï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­æŒ‘é€‰æœ€ä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li><li>allkeys-lfuï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€ä¸ç»å¸¸ä½¿ç”¨çš„ keyã€‚</li></ul><h3 id="æ‰‹å†™ä¸€ä¸ªLRUç®—æ³•ï¼Ÿ"><a href="#æ‰‹å†™ä¸€ä¸ªLRUç®—æ³•ï¼Ÿ" class="headerlink" title="æ‰‹å†™ä¸€ä¸ªLRUç®—æ³•ï¼Ÿ"></a>æ‰‹å†™ä¸€ä¸ªLRUç®—æ³•ï¼Ÿ</h3><pre><code class="java">public class LRUCache&lt;K, V&gt; extends LinkedHashMap&lt;K, V&gt; {        private int maxEntries;        public LRUCache(int maxEntries){        // è¿™å—å°±æ˜¯è®¾ç½®ä¸€ä¸ªhashmapçš„åˆå§‹å¤§å°ï¼ŒåŒæ—¶æœ€åä¸€ä¸ªtrueæŒ‡çš„æ˜¯è®©linkedhashmapæŒ‰ç…§è®¿é—®é¡ºåºæ¥è¿›è¡Œæ’åºï¼Œæœ€è¿‘è®¿é—®çš„æ”¾åœ¨å¤´ï¼Œæœ€è€è®¿é—®çš„å°±åœ¨å°¾            super(16, 0.75f, true);            this.maxEntries = maxEntries;        }        @Override        protected boolean removeEldestEntry(Entry&lt;K, V&gt; eldest) {        // è¿™ä¸ªæ„æ€å°±æ˜¯è¯´å½“mapä¸­çš„æ•°æ®é‡å¤§äºæŒ‡å®šçš„ç¼“å­˜ä¸ªæ•°çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨åˆ é™¤æœ€è€çš„æ•°æ®            return size() &gt; maxEntries;        }    }   </code></pre><h2 id="Rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ"><a href="#Rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="Rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ"></a>Rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ</h2><ol><li><p>Master æœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬å†…å­˜å¿«ç…§å’Œ AOF æ—¥å¿—æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸è¦å¯ç”¨å†…å­˜å¿«ç…§åšæŒä¹…åŒ–ã€‚</p></li><li><p>å¦‚æœæ•°æ®æ¯”è¾ƒå…³é”®ï¼ŒæŸä¸ª Slave å¼€å¯ AOF å¤‡ä»½æ•°æ®ï¼Œç­–ç•¥ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ã€‚</p></li><li><p>Redis Sentinalç€çœ¼äºé«˜å¯ç”¨ï¼Œåœ¨masterå®•æœºæ—¶ä¼šè‡ªåŠ¨å°†slaveæå‡ä¸ºmasterï¼Œç»§ç»­æä¾›æœåŠ¡ã€‚Redis Clusterç€çœ¼äºæ‰©å±•æ€§ï¼Œåœ¨å•ä¸ªrediså†…å­˜ä¸è¶³æ—¶ï¼Œä½¿ç”¨Clusterè¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€‚</p></li></ol><h3 id="é‚£ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œæˆ‘ä»¬ç°åœ¨æœåŠ¡å™¨éƒ½æ˜¯å¤šæ ¸çš„ï¼Œé‚£ä¸æ˜¯å¾ˆæµªè´¹ï¼Ÿ"><a href="#é‚£ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œæˆ‘ä»¬ç°åœ¨æœåŠ¡å™¨éƒ½æ˜¯å¤šæ ¸çš„ï¼Œé‚£ä¸æ˜¯å¾ˆæµªè´¹ï¼Ÿ" class="headerlink" title="é‚£ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œæˆ‘ä»¬ç°åœ¨æœåŠ¡å™¨éƒ½æ˜¯å¤šæ ¸çš„ï¼Œé‚£ä¸æ˜¯å¾ˆæµªè´¹ï¼Ÿ"></a>é‚£ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œæˆ‘ä»¬ç°åœ¨æœåŠ¡å™¨éƒ½æ˜¯å¤šæ ¸çš„ï¼Œé‚£ä¸æ˜¯å¾ˆæµªè´¹ï¼Ÿ</h3><p>æ˜¯çš„ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å•æœºå¼€å¤šä¸ª<strong>Rediså®ä¾‹</strong>å˜›ã€‚</p><hr><h2 id="Redisé«˜å¯ç”¨"><a href="#Redisé«˜å¯ç”¨" class="headerlink" title="Redisé«˜å¯ç”¨"></a>Redisé«˜å¯ç”¨</h2><h3 id="Redisçš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ"><a href="#Redisçš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ" class="headerlink" title="Redisçš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ"></a>Redisçš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ</h3><h4 id="å…¨é‡åŒæ­¥-æ–°å¢salveç»“ç‚¹"><a href="#å…¨é‡åŒæ­¥-æ–°å¢salveç»“ç‚¹" class="headerlink" title="å…¨é‡åŒæ­¥(æ–°å¢salveç»“ç‚¹)"></a>å…¨é‡åŒæ­¥(æ–°å¢salveç»“ç‚¹)</h4><p>Rediså¯ä»¥ä½¿ç”¨ä¸»ä»åŒæ­¥ï¼Œä»ä»åŒæ­¥ã€‚ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œä¸»èŠ‚ç‚¹åšä¸€æ¬¡bgsaveï¼Œå¹¶åŒæ—¶å°†åç»­ä¿®æ”¹æ“ä½œè®°å½•(<strong>å¤åˆ¶åç§»é‡</strong>)åˆ°å†…å­˜buffer(<strong>å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</strong>)ï¼Œå¾…å®Œæˆåå°†RDBæ–‡ä»¶å…¨é‡åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹ï¼Œå¤åˆ¶èŠ‚ç‚¹æ¥å—å®Œæˆåå°†<strong>RDB</strong>é•œåƒåŠ è½½åˆ°å†…å­˜ã€‚åŠ è½½å®Œæˆåï¼Œå†é€šçŸ¥ä¸»èŠ‚ç‚¹å°†æœŸé—´ä¿®æ”¹çš„æ“ä½œè®°å½•åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹è¿›è¡Œé‡æ”¾å°±å®Œæˆäº†åŒæ­¥è¿‡ç¨‹ã€‚åç»­çš„å¢é‡æ•°æ®é€šè¿‡<strong>AOF</strong>æ—¥å¿—åŒæ­¥å³å¯ï¼Œæœ‰ç‚¹ç±»ä¼¼æ•°æ®åº“çš„binlogã€‚</p><h4 id="éƒ¨åˆ†é‡æ–°åŒæ­¥-æ–­çº¿é‡è¿"><a href="#éƒ¨åˆ†é‡æ–°åŒæ­¥-æ–­çº¿é‡è¿" class="headerlink" title="éƒ¨åˆ†é‡æ–°åŒæ­¥(æ–­çº¿é‡è¿)"></a>éƒ¨åˆ†é‡æ–°åŒæ­¥(æ–­çº¿é‡è¿)</h4><p>éƒ¨åˆ†é‡åŒæ­¥å¯ä»¥è®©æˆ‘ä»¬æ–­çº¿åé‡è¿<strong>åªéœ€è¦åŒæ­¥ç¼ºå¤±çš„æ•°æ®</strong>ï¼Œéƒ¨åˆ†é‡åŒæ­¥åŠŸèƒ½ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>ä¸»ä»æœåŠ¡å™¨çš„<strong>å¤åˆ¶åç§»é‡</strong></li><li>ä¸»æœåŠ¡å™¨çš„<strong>å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</strong></li><li>æœåŠ¡å™¨è¿è¡Œçš„ID(<strong>run ID</strong>)</li></ul><p>é¦–å…ˆæˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„åè¯ï¼š</p><p>å¤åˆ¶åç§»é‡ï¼šæ‰§è¡Œå¤åˆ¶çš„åŒæ–¹éƒ½ä¼š<strong>åˆ†åˆ«ç»´æŠ¤</strong>ä¸€ä¸ªå¤åˆ¶åç§»é‡</p><ul><li>ä¸»æœåŠ¡å™¨æ¯æ¬¡ä¼ æ’­Nä¸ªå­—èŠ‚ï¼Œå°±å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡åŠ ä¸ŠN</li><li>ä»æœåŠ¡å™¨æ¯æ¬¡æ”¶åˆ°ä¸»æœåŠ¡å™¨çš„Nä¸ªå­—èŠ‚ï¼Œå°±å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡åŠ ä¸ŠN</li></ul><p>é€šè¿‡<strong>å¯¹æ¯”ä¸»ä»å¤åˆ¶çš„åç§»é‡</strong>ï¼Œå°±å¾ˆå®¹æ˜“çŸ¥é“ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®æ˜¯å¦å¤„äºä¸€è‡´æ€§çš„çŠ¶æ€ï¼</p><p><img alt="image-20200515094924540" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gesw9lel9ej30fi0p2jxj.jpg" class="lazyload"></p><p>é‚£æ–­çº¿é‡è¿ä»¥åï¼Œä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€PSYNCå‘½ä»¤ï¼ŒæŠ¥å‘Šç°åœ¨çš„åç§»é‡æ˜¯36ï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨è¯¥å¯¹ä»æœåŠ¡å™¨æ‰§è¡Œå®Œæ•´é‡åŒæ­¥è¿˜æ˜¯éƒ¨åˆ†é‡åŒæ­¥å‘¢ï¼Ÿï¼Ÿè¿™å°±äº¤ç”±<strong>å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</strong>æ¥å†³å®šã€‚</p><p>å½“ä¸»æœåŠ¡å™¨è¿›è¡Œå‘½ä»¤ä¼ æ’­æ—¶ï¼Œä¸ä»…ä»…ä¼šå°†å†™å‘½ä»¤å‘é€ç»™æ‰€æœ‰çš„ä»æœåŠ¡å™¨ï¼Œè¿˜ä¼šå°†å†™å‘½ä»¤<strong>å…¥é˜Ÿåˆ°å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</strong>é‡Œé¢(è¿™ä¸ªå¤§å°å¯ä»¥è°ƒçš„)ã€‚å¦‚æœå¤åˆ¶ç§¯å‹ç¼“å†²åŒº<strong>å­˜åœ¨</strong>ä¸¢å¤±çš„åç§»é‡çš„æ•°æ®ï¼Œé‚£å°±æ‰§è¡Œéƒ¨åˆ†é‡åŒæ­¥ï¼Œå¦åˆ™æ‰§è¡Œå®Œæ•´é‡åŒæ­¥ã€‚</p><p>æœåŠ¡å™¨è¿è¡Œçš„ID(<strong>run ID</strong>)å®é™…ä¸Šå°±æ˜¯ç”¨æ¥æ¯”å¯¹IDæ˜¯å¦ç›¸åŒã€‚å¦‚æœä¸ç›¸åŒï¼Œåˆ™è¯´æ˜ä»æœåŠ¡å™¨æ–­çº¿ä¹‹å‰å¤åˆ¶çš„ä¸»æœåŠ¡å™¨å’Œå½“å‰è¿æ¥çš„ä¸»æœåŠ¡å™¨æ˜¯ä¸¤å°æœåŠ¡å™¨ï¼Œè¿™å°±ä¼šè¿›è¡Œå®Œæ•´é‡åŒæ­¥ã€‚</p><h3 id="Redisé«˜å¯ç”¨é…ç½®ï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰"><a href="#Redisé«˜å¯ç”¨é…ç½®ï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰" class="headerlink" title="Redisé«˜å¯ç”¨é…ç½®ï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰"></a>Redisé«˜å¯ç”¨é…ç½®ï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰</h3><p>è¯¦è§å¦‚ä¸‹é“¾æ¥ï¼š</p><blockquote><p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/database/Redis/redis-collection/Redis(9)â€”â€”é›†ç¾¤å…¥é—¨å®è·µæ•™ç¨‹.md" target="_blank" rel="noopener">https://github.com/Snailclimb/JavaGuide/blob/master/docs/database/Redis/redis-collection/Redis(9)%E2%80%94%E2%80%94%E9%9B%86%E7%BE%A4%E5%85%A5%E9%97%A8%E5%AE%9E%E8%B7%B5%E6%95%99%E7%A8%8B.md</a></p><p>ä»‹ç»äº†Redisä¸»ä»ã€å“¨å…µã€é›†ç¾¤å¦‚ä½•å®è·µï¼ŒåŠå…¶åŸç†ã€‚ä»¥ä¸‹ä»…ä»é¢è¯•çƒ­ç‚¹è¿›è¡Œæ¢³ç†ï¼š</p></blockquote><h4 id="å“¨å…µ"><a href="#å“¨å…µ" class="headerlink" title="å“¨å…µ"></a>å“¨å…µ</h4><p>åœ¨ <strong>å“¨å…µç³»ç»Ÿ</strong> ä¸­ï¼ŒèŠ‚ç‚¹åˆ†ä¸º <strong>æ•°æ®èŠ‚ç‚¹</strong> å’Œ <strong>å“¨å…µèŠ‚ç‚¹</strong>ï¼šå‰è€…å­˜å‚¨æ•°æ®ï¼Œåè€…å®ç°é¢å¤–çš„æ§åˆ¶åŠŸèƒ½ã€‚åœ¨ <strong>é›†ç¾¤</strong> ä¸­ï¼Œæ²¡æœ‰æ•°æ®èŠ‚ç‚¹ä¸éæ•°æ®èŠ‚ç‚¹ä¹‹åˆ†ï¼š<strong>æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å­˜å‚¨æ•°æ®ï¼Œä¹Ÿéƒ½å‚ä¸é›†ç¾¤çŠ¶æ€çš„ç»´æŠ¤</strong>ã€‚ä¸ºæ­¤ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œéƒ½æä¾›äº†ä¸¤ä¸ª TCP ç«¯å£ï¼š</p><ul><li><strong>æ™®é€šç«¯å£ï¼š</strong> å³æˆ‘ä»¬åœ¨å‰é¢æŒ‡å®šçš„ç«¯å£ <em>(7000ç­‰)</em>ã€‚æ™®é€šç«¯å£ä¸»è¦ç”¨äºä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡ <em>ï¼ˆä¸å•æœºèŠ‚ç‚¹ç±»ä¼¼ï¼‰</em>ï¼›ä½†åœ¨èŠ‚ç‚¹é—´æ•°æ®è¿ç§»æ—¶ä¹Ÿä¼šä½¿ç”¨ã€‚</li><li><strong>é›†ç¾¤ç«¯å£ï¼š</strong> ç«¯å£å·æ˜¯æ™®é€šç«¯å£ + 10000 <em>ï¼ˆ10000æ˜¯å›ºå®šå€¼ï¼Œæ— æ³•æ”¹å˜ï¼‰</em>ï¼Œå¦‚ <code>7000</code> èŠ‚ç‚¹çš„é›†ç¾¤ç«¯å£ä¸º <code>17000</code>ã€‚<strong>é›†ç¾¤ç«¯å£åªç”¨äºèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡</strong>ï¼Œå¦‚æ­å»ºé›†ç¾¤ã€å¢å‡èŠ‚ç‚¹ã€æ•…éšœè½¬ç§»ç­‰æ“ä½œæ—¶èŠ‚ç‚¹é—´çš„é€šä¿¡ï¼›ä¸è¦ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥é›†ç¾¤æ¥å£ã€‚ä¸ºäº†ä¿è¯é›†ç¾¤å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œåœ¨é…ç½®é˜²ç«å¢™æ—¶ï¼Œè¦åŒæ—¶å¼€å¯æ™®é€šç«¯å£å’Œé›†ç¾¤ç«¯å£ã€‚</li></ul><h4 id="Redis-é›†ç¾¤"><a href="#Redis-é›†ç¾¤" class="headerlink" title="Redis é›†ç¾¤"></a>Redis é›†ç¾¤</h4><p><a href="https://camo.githubusercontent.com/1f82de60e5ec7e3529eee05500b2f8dc425b0e86/68747470733a2f2f75706c6f61642d696d616765732e6a69616e7368752e696f2f75706c6f61645f696d616765732f373839363839302d353136656234613934363534353161362e706e673f696d6167654d6f6772322f6175746f2d6f7269656e742f7374726970253743696d61676556696577322f322f772f31323430" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/1f82de60e5ec7e3529eee05500b2f8dc425b0e86/68747470733a2f2f75706c6f61642d696d616765732e6a69616e7368752e696f2f75706c6f61645f696d616765732f373839363839302d353136656234613934363534353161362e706e673f696d6167654d6f6772322f6175746f2d6f7269656e742f7374726970253743696d61676556696577322f322f772f31323430" class="lazyload"></a></p><p><em>ä¸Šå›¾</em> å±•ç¤ºäº† <strong>Redis Cluster</strong> å…¸å‹çš„æ¶æ„å›¾ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ª Redis èŠ‚ç‚¹éƒ½ <strong>äº’ç›¸ä¸¤ä¸¤ç›¸è¿</strong>ï¼Œå®¢æˆ·ç«¯ä»»æ„ <strong>ç›´è¿</strong> åˆ°é›†ç¾¤ä¸­çš„ <strong>ä»»æ„ä¸€å°</strong>ï¼Œå°±å¯ä»¥å¯¹å…¶ä»– Redis èŠ‚ç‚¹è¿›è¡Œ <strong>è¯»å†™</strong> çš„æ“ä½œã€‚</p><h5 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h5><p><a href="https://camo.githubusercontent.com/a7f2e3397b72776ba3243e4ef4c209cdf24e104a/68747470733a2f2f75706c6f61642d696d616765732e6a69616e7368752e696f2f75706c6f61645f696d616765732f373839363839302d663635633731636136383131633633342e706e673f696d6167654d6f6772322f6175746f2d6f7269656e742f7374726970253743696d61676556696577322f322f772f31323430" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/a7f2e3397b72776ba3243e4ef4c209cdf24e104a/68747470733a2f2f75706c6f61642d696d616765732e6a69616e7368752e696f2f75706c6f61645f696d616765732f373839363839302d663635633731636136383131633633342e706e673f696d6167654d6f6772322f6175746f2d6f7269656e742f7374726970253743696d61676556696577322f322f772f31323430" class="lazyload"></a></p><p>Redis é›†ç¾¤ä¸­å†…ç½®äº† <code>16384</code> (16<em>2^10^)ä¸ªå“ˆå¸Œæ§½ã€‚å½“å®¢æˆ·ç«¯è¿æ¥åˆ° Redis é›†ç¾¤ä¹‹åï¼Œä¼šåŒæ—¶å¾—åˆ°ä¸€ä»½å…³äºè¿™ä¸ª *</em>é›†ç¾¤çš„é…ç½®ä¿¡æ¯<strong>ï¼Œå½“å®¢æˆ·ç«¯å…·ä½“å¯¹æŸä¸€ä¸ª <code>key</code> å€¼è¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šè®¡ç®—å‡ºå®ƒçš„ä¸€ä¸ª Hash å€¼ï¼Œç„¶åæŠŠç»“æœå¯¹ <code>16384</code> **æ±‚ä½™æ•°</strong>ï¼Œè¿™æ ·æ¯ä¸ª <code>key</code> éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨ <code>0-16383</code> ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œ<strong>Redis ä¼šæ ¹æ®èŠ‚ç‚¹æ•°é‡å¤§è‡´å‡ç­‰çš„å°†å“ˆå¸Œæ§½æ˜ å°„åˆ°ä¸åŒçš„èŠ‚ç‚¹</strong>ã€‚</p><h5 id="é›†ç¾¤çš„ä¸»è¦ä½œç”¨"><a href="#é›†ç¾¤çš„ä¸»è¦ä½œç”¨" class="headerlink" title="é›†ç¾¤çš„ä¸»è¦ä½œç”¨"></a>é›†ç¾¤çš„ä¸»è¦ä½œç”¨</h5><ol><li><strong>æ•°æ®åˆ†åŒºï¼š</strong> æ•°æ®åˆ†åŒº <em>(æˆ–ç§°æ•°æ®åˆ†ç‰‡)</em> æ˜¯é›†ç¾¤æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚é›†ç¾¤å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œ<strong>ä¸€æ–¹é¢</strong> çªç ´äº† Redis å•æœºå†…å­˜å¤§å°çš„é™åˆ¶ï¼Œ<strong>å­˜å‚¨å®¹é‡å¤§å¤§å¢åŠ </strong>ï¼›<strong>å¦ä¸€æ–¹é¢</strong> æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½å¯ä»¥å¯¹å¤–æä¾›è¯»æœåŠ¡å’Œå†™æœåŠ¡ï¼Œ<strong>å¤§å¤§æé«˜äº†é›†ç¾¤çš„å“åº”èƒ½åŠ›</strong>ã€‚Redis å•æœºå†…å­˜å¤§å°å—é™é—®é¢˜ï¼Œåœ¨ä»‹ç»æŒä¹…åŒ–å’Œä¸»ä»å¤åˆ¶æ—¶éƒ½æœ‰æåŠï¼Œä¾‹å¦‚ï¼Œå¦‚æœå•æœºå†…å­˜å¤ªå¤§ï¼Œ<code>bgsave</code> å’Œ <code>bgrewriteaof</code> çš„ <code>fork</code> æ“ä½œå¯èƒ½å¯¼è‡´ä¸»è¿›ç¨‹é˜»å¡ï¼Œä¸»ä»ç¯å¢ƒä¸‹ä¸»æœºåˆ‡æ¢æ—¶å¯èƒ½å¯¼è‡´ä»èŠ‚ç‚¹é•¿æ—¶é—´æ— æ³•æä¾›æœåŠ¡ï¼Œå…¨é‡å¤åˆ¶é˜¶æ®µä¸»èŠ‚ç‚¹çš„å¤åˆ¶ç¼“å†²åŒºå¯èƒ½æº¢å‡ºâ€¦â€¦</li><li><strong>é«˜å¯ç”¨ï¼š</strong> é›†ç¾¤æ”¯æŒä¸»ä»å¤åˆ¶å’Œä¸»èŠ‚ç‚¹çš„ <strong>è‡ªåŠ¨æ•…éšœè½¬ç§»</strong> <em>ï¼ˆä¸å“¨å…µç±»ä¼¼ï¼‰</em>ï¼Œå½“ä»»ä¸€èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œé›†ç¾¤ä»ç„¶å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚</li></ol><h4 id="æ•°æ®åˆ†åŒºæ–¹æ¡ˆç®€æ"><a href="#æ•°æ®åˆ†åŒºæ–¹æ¡ˆç®€æ" class="headerlink" title="æ•°æ®åˆ†åŒºæ–¹æ¡ˆç®€æ"></a>æ•°æ®åˆ†åŒºæ–¹æ¡ˆç®€æ</h4><h5 id="æ–¹æ¡ˆä¸€ï¼šå“ˆå¸Œå€¼-èŠ‚ç‚¹æ•°"><a href="#æ–¹æ¡ˆä¸€ï¼šå“ˆå¸Œå€¼-èŠ‚ç‚¹æ•°" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šå“ˆå¸Œå€¼ % èŠ‚ç‚¹æ•°"></a>æ–¹æ¡ˆä¸€ï¼šå“ˆå¸Œå€¼ % èŠ‚ç‚¹æ•°</h5><p>å“ˆå¸Œå–ä½™åˆ†åŒºæ€è·¯éå¸¸ç®€å•ï¼šè®¡ç®— <code>key</code> çš„ hash å€¼ï¼Œç„¶åå¯¹èŠ‚ç‚¹æ•°é‡è¿›è¡Œå–ä½™ï¼Œä»è€Œå†³å®šæ•°æ®æ˜ å°„åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šã€‚</p><p>ä¸è¿‡è¯¥æ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œ<strong>å½“æ–°å¢æˆ–åˆ å‡èŠ‚ç‚¹æ—¶</strong>ï¼ŒèŠ‚ç‚¹æ•°é‡å‘ç”Ÿå˜åŒ–ï¼Œç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦ <strong>é‡æ–°è®¡ç®—æ˜ å°„å…³ç³»</strong>ï¼Œå¼•å‘å¤§è§„æ¨¡æ•°æ®è¿ç§»ã€‚</p><h5 id="æ–¹æ¡ˆäºŒï¼šä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº"><a href="#æ–¹æ¡ˆäºŒï¼šä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº"></a>æ–¹æ¡ˆäºŒï¼šä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº</h5><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å°† <strong>æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´</strong> ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼ŒèŒƒå›´æ˜¯ *[0 , 2^32^-1]*ï¼Œå¯¹äºæ¯ä¸€ä¸ªæ•°æ®ï¼Œæ ¹æ® <code>key</code> è®¡ç®— hash å€¼ï¼Œç¡®æ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œç„¶åä»æ­¤ä½ç½®æ²¿é¡ºæ—¶é’ˆè¡Œèµ°ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥æ˜ å°„åˆ°çš„æœåŠ¡å™¨ï¼š</p><p><a href="https://camo.githubusercontent.com/4d3da71d2cd7d407dcec94f611221b0a6d79dc3e/68747470733a2f2f75706c6f61642d696d616765732e6a69616e7368752e696f2f75706c6f61645f696d616765732f373839363839302d343065386132633039366338646139322e706e673f696d6167654d6f6772322f6175746f2d6f7269656e742f7374726970253743696d61676556696577322f322f772f31323430" target="_blank" rel="noopener"><img alt="img" data-src="https://camo.githubusercontent.com/4d3da71d2cd7d407dcec94f611221b0a6d79dc3e/68747470733a2f2f75706c6f61642d696d616765732e6a69616e7368752e696f2f75706c6f61645f696d616765732f373839363839302d343065386132633039366338646139322e706e673f696d6167654d6f6772322f6175746f2d6f7269656e742f7374726970253743696d61676556696577322f322f772f31323430" class="lazyload"></a></p><p>ä¸å“ˆå¸Œå–ä½™åˆ†åŒºç›¸æ¯”ï¼Œä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºå°† <strong>å¢å‡èŠ‚ç‚¹çš„å½±å“é™åˆ¶åœ¨ç›¸é‚»èŠ‚ç‚¹</strong>ã€‚ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå¦‚æœåœ¨ <code>node1</code> å’Œ <code>node2</code> ä¹‹é—´å¢åŠ  <code>node5</code>ï¼Œåˆ™åªæœ‰ <code>node2</code> ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®ä¼šè¿ç§»åˆ° <code>node5</code>ï¼›å¦‚æœå»æ‰ <code>node2</code>ï¼Œåˆ™åŸ <code>node2</code> ä¸­çš„æ•°æ®åªä¼šè¿ç§»åˆ° <code>node4</code> ä¸­ï¼Œåªæœ‰ <code>node4</code> ä¼šå—å½±å“ã€‚</p><p>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºçš„ä¸»è¦é—®é¢˜åœ¨äºï¼Œå½“ <strong>èŠ‚ç‚¹æ•°é‡è¾ƒå°‘</strong> æ—¶ï¼Œå¢åŠ æˆ–åˆ å‡èŠ‚ç‚¹ï¼Œ<strong>å¯¹å•ä¸ªèŠ‚ç‚¹çš„å½±å“å¯èƒ½å¾ˆå¤§</strong>ï¼Œé€ æˆæ•°æ®çš„ä¸¥é‡ä¸å¹³è¡¡ã€‚è¿˜æ˜¯ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå¦‚æœå»æ‰ <code>node2</code>ï¼Œ<code>node4</code> ä¸­çš„æ•°æ®ç”±æ€»æ•°æ®çš„ <code>1/4</code> å·¦å³å˜ä¸º <code>1/2</code> å·¦å³ï¼Œä¸å…¶ä»–èŠ‚ç‚¹ç›¸æ¯”è´Ÿè½½è¿‡é«˜ã€‚</p><h5 id="æ–¹æ¡ˆä¸‰ï¼šå¸¦æœ‰è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº"><a href="#æ–¹æ¡ˆä¸‰ï¼šå¸¦æœ‰è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº" class="headerlink" title="æ–¹æ¡ˆä¸‰ï¼šå¸¦æœ‰è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº"></a>æ–¹æ¡ˆä¸‰ï¼šå¸¦æœ‰è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº</h5><p>è¯¥æ–¹æ¡ˆåœ¨ <strong>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºçš„åŸºç¡€ä¸Š</strong>ï¼Œå¼•å…¥äº† <strong>è™šæ‹ŸèŠ‚ç‚¹</strong> çš„æ¦‚å¿µã€‚==Redis é›†ç¾¤ä½¿ç”¨çš„ä¾¿æ˜¯è¯¥æ–¹æ¡ˆ==ï¼Œå…¶ä¸­çš„è™šæ‹ŸèŠ‚ç‚¹ç§°ä¸º <strong>æ§½ï¼ˆslotï¼‰</strong>ã€‚æ§½æ˜¯ä»‹äºæ•°æ®å’Œå®é™…èŠ‚ç‚¹ä¹‹é—´çš„è™šæ‹Ÿæ¦‚å¿µï¼Œæ¯ä¸ª<strong>å®é™…èŠ‚ç‚¹åŒ…å«ä¸€å®šæ•°é‡çš„æ§½</strong>ï¼Œ<strong>æ¯ä¸ªæ§½åŒ…å«å“ˆå¸Œå€¼åœ¨ä¸€å®šèŒƒå›´å†…çš„æ•°æ®</strong>ã€‚</p><p>åœ¨ä½¿ç”¨äº†æ§½çš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºä¸­ï¼Œ<strong>æ§½æ˜¯æ•°æ®ç®¡ç†å’Œè¿ç§»çš„åŸºæœ¬å•ä½</strong>ã€‚æ§½ <strong>è§£è€¦</strong> äº† <strong>æ•°æ®å’Œå®é™…èŠ‚ç‚¹</strong> ä¹‹é—´çš„å…³ç³»ï¼Œå¢åŠ æˆ–åˆ é™¤èŠ‚ç‚¹å¯¹ç³»ç»Ÿçš„å½±å“å¾ˆå°ã€‚ä»ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œç³»ç»Ÿä¸­æœ‰ <code>4</code> ä¸ªå®é™…èŠ‚ç‚¹ï¼Œå‡è®¾ä¸ºå…¶åˆ†é… <code>16</code> ä¸ªæ§½(0-15)ï¼›</p><ul><li>æ§½ 0-3 ä½äº node1ï¼›4-7 ä½äº node2ï¼›ä»¥æ­¤ç±»æ¨â€¦.</li></ul><p>å¦‚æœæ­¤æ—¶åˆ é™¤ <code>node2</code>ï¼Œåªéœ€è¦å°†æ§½ 4-7 é‡æ–°åˆ†é…å³å¯ï¼Œä¾‹å¦‚æ§½ 4-5 åˆ†é…ç»™ <code>node1</code>ï¼Œæ§½ 6 åˆ†é…ç»™ <code>node3</code>ï¼Œæ§½ 7 åˆ†é…ç»™ <code>node4</code>ï¼›å¯ä»¥çœ‹å‡ºåˆ é™¤ <code>node2</code> åï¼Œæ•°æ®åœ¨å…¶ä»–èŠ‚ç‚¹çš„åˆ†å¸ƒä»ç„¶è¾ƒä¸ºå‡è¡¡ã€‚</p><h4 id="èŠ‚ç‚¹é€šä¿¡æœºåˆ¶ç®€æ"><a href="#èŠ‚ç‚¹é€šä¿¡æœºåˆ¶ç®€æ" class="headerlink" title="èŠ‚ç‚¹é€šä¿¡æœºåˆ¶ç®€æ"></a>èŠ‚ç‚¹é€šä¿¡æœºåˆ¶ç®€æ</h4><p>é›†ç¾¤çš„å»ºç«‹ç¦»ä¸å¼€èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ï¼Œä¾‹å¦‚æˆ‘ä»¬ä¸Šè®¿åœ¨ <em>å¿«é€Ÿä½“éªŒ</em> ä¸­åˆšå¯åŠ¨å…­ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¹‹åé€šè¿‡ <code>redis-cli</code> å‘½ä»¤å¸®åŠ©æˆ‘ä»¬æ­å»ºèµ·æ¥äº†é›†ç¾¤ï¼Œå®é™…ä¸ŠèƒŒåæ¯ä¸ªé›†ç¾¤ä¹‹é—´çš„ä¸¤ä¸¤è¿æ¥æ˜¯é€šè¿‡äº† <code>CLUSTER MEET</code> å‘½ä»¤å‘é€ <code>MEET</code> æ¶ˆæ¯å®Œæˆçš„ï¼Œä¸‹é¢æˆ‘ä»¬å±•å¼€è¯¦ç»†è¯´è¯´ã€‚</p><h4 id="æ•°æ®ç»“æ„ç®€æ"><a href="#æ•°æ®ç»“æ„ç®€æ" class="headerlink" title="æ•°æ®ç»“æ„ç®€æ"></a>æ•°æ®ç»“æ„ç®€æ</h4><p>èŠ‚ç‚¹éœ€è¦ä¸“é—¨çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨é›†ç¾¤çš„çŠ¶æ€ã€‚æ‰€è°“é›†ç¾¤çš„çŠ¶æ€ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬ï¼šé›†ç¾¤æ˜¯å¦å¤„äºä¸Šçº¿çŠ¶æ€ã€é›†ç¾¤ä¸­æœ‰å“ªäº›èŠ‚ç‚¹ã€èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ã€èŠ‚ç‚¹çš„ä¸»ä»çŠ¶æ€ã€æ§½çš„åˆ†å¸ƒâ€¦â€¦</p><p>èŠ‚ç‚¹ä¸ºäº†å­˜å‚¨é›†ç¾¤çŠ¶æ€è€Œæä¾›çš„æ•°æ®ç»“æ„ä¸­ï¼Œæœ€å…³é”®çš„æ˜¯ <code>clusterNode</code> å’Œ <code>clusterState</code> ç»“æ„ï¼šå‰è€…è®°å½•äº†ä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ï¼Œåè€…è®°å½•äº†é›†ç¾¤ä½œä¸ºä¸€ä¸ªæ•´ä½“çš„çŠ¶æ€ã€‚</p><h5 id="clusterNode-ç»“æ„"><a href="#clusterNode-ç»“æ„" class="headerlink" title="clusterNode ç»“æ„"></a>clusterNode ç»“æ„</h5><p><code>clusterNode</code> ç»“æ„ä¿å­˜äº† <strong>ä¸€ä¸ªèŠ‚ç‚¹çš„å½“å‰çŠ¶æ€</strong>ï¼ŒåŒ…æ‹¬åˆ›å»ºæ—¶é—´ã€èŠ‚ç‚¹ idã€ip å’Œç«¯å£å·ç­‰ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šç”¨ä¸€ä¸ª <code>clusterNode</code> ç»“æ„è®°å½•è‡ªå·±çš„çŠ¶æ€ï¼Œå¹¶ä¸ºé›†ç¾¤å†…æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹éƒ½åˆ›å»ºä¸€ä¸ª <code>clusterNode</code> ç»“æ„æ¥è®°å½•èŠ‚ç‚¹çŠ¶æ€ã€‚</p><p>ä¸‹é¢åˆ—ä¸¾äº† <code>clusterNode</code> çš„éƒ¨åˆ†å­—æ®µï¼Œå¹¶è¯´æ˜äº†å­—æ®µçš„å«ä¹‰å’Œä½œç”¨ï¼š</p><pre><code class="java">typedef struct clusterNode {    //èŠ‚ç‚¹åˆ›å»ºæ—¶é—´    mstime_t ctime;    //èŠ‚ç‚¹id    char name[REDIS_CLUSTER_NAMELEN];    //èŠ‚ç‚¹çš„ipå’Œç«¯å£å·    char ip[REDIS_IP_STR_LEN];    int port;    //èŠ‚ç‚¹æ ‡è¯†ï¼šæ•´å‹ï¼Œæ¯ä¸ªbitéƒ½ä»£è¡¨äº†ä¸åŒçŠ¶æ€ï¼Œå¦‚èŠ‚ç‚¹çš„ä¸»ä»çŠ¶æ€ã€æ˜¯å¦åœ¨çº¿ã€æ˜¯å¦åœ¨æ¡æ‰‹ç­‰    int flags;    //é…ç½®çºªå…ƒï¼šæ•…éšœè½¬ç§»æ—¶èµ·ä½œç”¨ï¼Œç±»ä¼¼äºå“¨å…µçš„é…ç½®çºªå…ƒ    uint64_t configEpoch;    //æ§½åœ¨è¯¥èŠ‚ç‚¹ä¸­çš„åˆ†å¸ƒï¼šå ç”¨16384/8ä¸ªå­—èŠ‚ï¼Œ16384ä¸ªæ¯”ç‰¹ï¼›æ¯ä¸ªæ¯”ç‰¹å¯¹åº”ä¸€ä¸ªæ§½ï¼šæ¯”ç‰¹å€¼ä¸º1ï¼Œåˆ™è¯¥æ¯”ç‰¹å¯¹åº”çš„æ§½åœ¨èŠ‚ç‚¹ä¸­ï¼›æ¯”ç‰¹å€¼ä¸º0ï¼Œåˆ™è¯¥æ¯”ç‰¹å¯¹åº”çš„æ§½ä¸åœ¨èŠ‚ç‚¹ä¸­    unsigned char slots[16384/8];    //èŠ‚ç‚¹ä¸­æ§½çš„æ•°é‡    int numslots;    â€¦â€¦â€¦â€¦} clusterNode;</code></pre><p>é™¤äº†ä¸Šè¿°å­—æ®µï¼Œ<code>clusterNode</code> è¿˜åŒ…å«èŠ‚ç‚¹è¿æ¥ã€ä¸»ä»å¤åˆ¶ã€æ•…éšœå‘ç°å’Œè½¬ç§»éœ€è¦çš„ä¿¡æ¯ç­‰ã€‚</p><h5 id="clusterState-ç»“æ„"><a href="#clusterState-ç»“æ„" class="headerlink" title="clusterState ç»“æ„"></a>clusterState ç»“æ„</h5><p><code>clusterState</code> ç»“æ„ä¿å­˜äº†åœ¨å½“å‰èŠ‚ç‚¹è§†è§’ä¸‹ï¼Œé›†ç¾¤æ‰€å¤„çš„çŠ¶æ€ã€‚ä¸»è¦å­—æ®µåŒ…æ‹¬ï¼š</p><pre><code class="java">typedef struct clusterState {    //è‡ªèº«èŠ‚ç‚¹    clusterNode *myself;    //é…ç½®çºªå…ƒ    uint64_t currentEpoch;    //é›†ç¾¤çŠ¶æ€ï¼šåœ¨çº¿è¿˜æ˜¯ä¸‹çº¿    int state;    //é›†ç¾¤ä¸­è‡³å°‘åŒ…å«ä¸€ä¸ªæ§½çš„èŠ‚ç‚¹æ•°é‡    int size;    //å“ˆå¸Œè¡¨ï¼ŒèŠ‚ç‚¹åç§°-&gt;clusterNodeèŠ‚ç‚¹æŒ‡é’ˆ    dict *nodes;    //æ§½åˆ†å¸ƒä¿¡æ¯ï¼šæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘clusterNodeç»“æ„çš„æŒ‡é’ˆï¼›å¦‚æœæ§½è¿˜æ²¡æœ‰åˆ†é…ç»™ä»»ä½•èŠ‚ç‚¹ï¼Œåˆ™ä¸ºNULL    clusterNode *slots[16384];    â€¦â€¦â€¦â€¦} clusterState;</code></pre><p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>clusterState</code> è¿˜åŒ…æ‹¬æ•…éšœè½¬ç§»ã€æ§½è¿ç§»ç­‰éœ€è¦çš„ä¿¡æ¯ã€‚</p><h2 id="å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚ä½•å°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ"><a href="#å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚ä½•å°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ" class="headerlink" title="å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚ä½•å°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ"></a>å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚ä½•å°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ</h2><p>ä½¿ç”¨ <code>keys</code> æŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ã€‚ä½†æ˜¯è¦æ³¨æ„ keys æŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ <code>scan</code> æŒ‡ä»¤ï¼Œ<code>scan</code> æŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„ <code>key</code> åˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨ <code>keys</code> æŒ‡ä»¤é•¿ã€‚</p><h2 id="å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸRehashäº†è§£å—ï¼Ÿ"><a href="#å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸRehashäº†è§£å—ï¼Ÿ" class="headerlink" title="å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸRehashäº†è§£å—ï¼Ÿ"></a>å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸRehashäº†è§£å—ï¼Ÿ</h2><h3 id="å…ˆæ€»ä½“èŠä¸€ä¸‹-Redis-ä¸­çš„å­—å…¸"><a href="#å…ˆæ€»ä½“èŠä¸€ä¸‹-Redis-ä¸­çš„å­—å…¸" class="headerlink" title="å…ˆæ€»ä½“èŠä¸€ä¸‹ Redis ä¸­çš„å­—å…¸"></a>å…ˆæ€»ä½“èŠä¸€ä¸‹ Redis ä¸­çš„å­—å…¸</h3><p>å­—å…¸æ˜¯ Redis æœåŠ¡å™¨ä¸­å‡ºç°æœ€ä¸ºé¢‘ç¹çš„å¤åˆå‹æ•°æ®ç»“æ„ã€‚é™¤äº† <strong>hash</strong> ç»“æ„çš„æ•°æ®ä¼šç”¨åˆ°å­—å…¸å¤–ï¼Œæ•´ä¸ª Redis æ•°æ®åº“çš„æ‰€æœ‰ <code>key</code> å’Œ <code>value</code> ä¹Ÿç»„æˆäº†ä¸€ä¸ª <strong>å…¨å±€å­—å…¸</strong>ï¼Œè¿˜æœ‰å¸¦è¿‡æœŸæ—¶é—´çš„ <code>key</code> ä¹Ÿæ˜¯ä¸€ä¸ªå­—å…¸ã€‚<em>(å­˜å‚¨åœ¨ RedisDb æ•°æ®ç»“æ„ä¸­)</em></p><h3 id="è¯´æ˜å­—å…¸å†…éƒ¨ç»“æ„å’Œ-rehash"><a href="#è¯´æ˜å­—å…¸å†…éƒ¨ç»“æ„å’Œ-rehash" class="headerlink" title="è¯´æ˜å­—å…¸å†…éƒ¨ç»“æ„å’Œ rehash"></a>è¯´æ˜å­—å…¸å†…éƒ¨ç»“æ„å’Œ rehash</h3><p>å­—å…¸ç»“æ„å†…éƒ¨åŒ…å« <strong>ä¸¤ä¸ª hashtable</strong>ï¼Œé€šå¸¸æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ª <code>hashtable</code> æœ‰å€¼ï¼Œä½†æ˜¯åœ¨å­—å…¸æ‰©å®¹ç¼©å®¹æ—¶ï¼Œéœ€è¦åˆ†é…æ–°çš„ <code>hashtable</code>ï¼Œç„¶åè¿›è¡Œ <strong>æ¸è¿›å¼æ¬è¿</strong> <em>(rehash)</em>ï¼Œè¿™æ—¶å€™ä¸¤ä¸ª <code>hashtable</code> åˆ†åˆ«å­˜å‚¨æ—§çš„å’Œæ–°çš„ <code>hashtable</code>ï¼Œå¾…æ¬è¿ç»“æŸåï¼Œæ—§çš„å°†è¢«åˆ é™¤ï¼Œæ–°çš„ <code>hashtable</code> å–è€Œä»£ä¹‹ã€‚</p><p>æ¸è¿›å¼å“ˆå¸Œ(rehashing)çš„æœºåˆ¶æ¥æé«˜å­—å…¸çš„ç¼©æ”¾æ•ˆç‡ï¼Œé¿å… rehash å¯¹æœåŠ¡å™¨æ€§èƒ½é€ æˆå½±å“ï¼Œæ¸è¿›å¼ rehash çš„å¥½å¤„åœ¨äºå®ƒé‡‡å–åˆ†è€Œæ²»ä¹‹çš„æ–¹å¼ï¼Œ å°† rehash é”®å€¼å¯¹æ‰€éœ€çš„è®¡ç®—å·¥ä½œå‡æ‘Šåˆ°å¯¹å­—å…¸çš„æ¯ä¸ªæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾å’Œæ›´æ–°æ“ä½œä¸Šï¼Œ ä»è€Œé¿å…äº†é›†ä¸­å¼ rehash è€Œå¸¦æ¥çš„åºå¤§è®¡ç®—é‡ã€‚</p><p>å³ redisä¸­ï¼Œæ¯æ¬¡æ’å…¥é”®å€¼å¯¹æ—¶ï¼Œéƒ½ä¼šæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚å¦‚æœæ»¡è¶³æ‰©å®¹æ¡ä»¶ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ã€‚</p><h3 id="æ‰©ç¼©å®¹çš„æ¡ä»¶"><a href="#æ‰©ç¼©å®¹çš„æ¡ä»¶" class="headerlink" title="æ‰©ç¼©å®¹çš„æ¡ä»¶"></a>æ‰©ç¼©å®¹çš„æ¡ä»¶</h3><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“ hash è¡¨ä¸­ <strong>å…ƒç´ çš„ä¸ªæ•°è¶…è¿‡äº†å“ˆå¸Œè¡¨çš„é•¿åº¦æ—¶</strong>ï¼Œå°±ä¼šå¼€å§‹æ‰©å®¹ï¼Œæ‰©å®¹çš„æ–°æ•°ç»„æ˜¯ <strong>åŸæ•°ç»„å¤§å°çš„ 2 å€</strong>ã€‚ä¸è¿‡å¦‚æœ Redis æ­£åœ¨åš <code>bgsave(æŒä¹…åŒ–å‘½ä»¤)</code>ï¼Œä¸ºäº†å‡å°‘å†…å­˜ä¹Ÿå¾—è¿‡å¤šåˆ†ç¦»ï¼ŒRedis å°½é‡ä¸å»æ‰©å®¹ï¼Œä½†æ˜¯å¦‚æœ hash è¡¨éå¸¸æ»¡äº†ï¼Œ<strong>è¾¾åˆ°äº†å“ˆå¸Œè¡¨é•¿åº¦çš„ 5 å€äº†</strong>ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼š <strong>å¼ºåˆ¶æ‰©å®¹</strong>ã€‚</p><p>å½“ hash è¡¨å› ä¸ºå…ƒç´ é€æ¸è¢«åˆ é™¤å˜å¾—è¶Šæ¥è¶Šç¨€ç–æ—¶ï¼ŒRedis ä¼šå¯¹ hash è¡¨è¿›è¡Œç¼©å®¹æ¥å‡å°‘ hash è¡¨çš„ç¬¬ä¸€ç»´æ•°ç»„ç©ºé—´å ç”¨ã€‚æ‰€ç”¨çš„æ¡ä»¶æ˜¯ <strong>å…ƒç´ ä¸ªæ•°ä½äºå“ˆå¸Œè¡¨æ•°ç»„é•¿åº¦çš„ 10%</strong>ï¼Œç¼©å®¹ä¸ä¼šè€ƒè™‘ Redis æ˜¯å¦åœ¨åš <code>bgsave</code>ã€‚</p><hr><h2 id="æ•°æ®ç»“æ„ç¯‡"><a href="#æ•°æ®ç»“æ„ç¯‡" class="headerlink" title="æ•°æ®ç»“æ„ç¯‡"></a>æ•°æ®ç»“æ„ç¯‡</h2><h3 id="ç®€è¿°ä¸€ä¸‹-Redis-å¸¸ç”¨æ•°æ®ç»“æ„åŠå®ç°ï¼Ÿ"><a href="#ç®€è¿°ä¸€ä¸‹-Redis-å¸¸ç”¨æ•°æ®ç»“æ„åŠå®ç°ï¼Ÿ" class="headerlink" title="ç®€è¿°ä¸€ä¸‹ Redis å¸¸ç”¨æ•°æ®ç»“æ„åŠå®ç°ï¼Ÿ"></a>ç®€è¿°ä¸€ä¸‹ Redis å¸¸ç”¨æ•°æ®ç»“æ„åŠå®ç°ï¼Ÿ</h3><p>é¦–å…ˆåœ¨ Redis å†…éƒ¨ä¼šä½¿ç”¨ä¸€ä¸ª <strong>RedisObject</strong> å¯¹è±¡æ¥è¡¨ç¤ºæ‰€æœ‰çš„ <code>key</code> å’Œ <code>value</code>ï¼š</p><p>å…¶æ¬¡ Redis ä¸ºäº† <strong>å¹³è¡¡ç©ºé—´å’Œæ—¶é—´æ•ˆç‡</strong>ï¼Œé’ˆå¯¹ <code>value</code> çš„å…·ä½“ç±»å‹åœ¨åº•å±‚ä¼šé‡‡ç”¨ä¸åŒçš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œä¸‹å›¾å±•ç¤ºäº†ä»–ä»¬ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼š</p><p>![image-20200509220059797](/Users/lilei/Library/Application Support/typora-user-images/image-20200509220059797.png)</p><p><code>Stringï¼š</code></p><p>â€‹        åŠ¨æ€å­—ç¬¦ä¸²ï¼Œå†…éƒ¨ç»“æ„å®ç°ä¸Šç±»ä¼¼äºJavaçš„ArrayListï¼Œçº¯ æ•°å­—ç”¨long</p><p><code>Listï¼š</code></p><p>â€‹        Redis æ—©æœŸç‰ˆæœ¬å­˜å‚¨ list åˆ—è¡¨æ•°æ®ç»“æ„ä½¿ç”¨çš„æ˜¯<code>å‹ç¼©åˆ—è¡¨ ziplist</code> å’Œæ™®é€šçš„<code>åŒå‘é“¾è¡¨ linkedlist</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å…ƒç´ å°‘æ—¶ä½¿ç”¨ ziplistï¼Œå½“å…ƒç´ å¤šæ—¶ç”¨ linkedlistã€‚ä½†è€ƒè™‘åˆ°é“¾è¡¨çš„é™„åŠ ç©ºé—´ç›¸å¯¹è¾ƒé«˜ï¼Œ<code>prev</code> å’Œ <code>next</code> æŒ‡é’ˆå°±è¦å å» <code>16</code> ä¸ªå­—èŠ‚ï¼ˆ64 ä½æ“ä½œç³»ç»Ÿå ç”¨ <code>8</code> ä¸ªå­—èŠ‚ï¼‰ï¼Œå¦å¤–æ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜éƒ½æ˜¯å•ç‹¬åˆ†é…ï¼Œä¼šåŠ å‰§å†…å­˜çš„ç¢ç‰‡åŒ–ï¼Œå½±å“å†…å­˜ç®¡ç†æ•ˆç‡ã€‚</p><p>åæ¥ Redis æ–°ç‰ˆæœ¬ï¼ˆ3.2ï¼‰å¯¹åˆ—è¡¨æ•°æ®ç»“æ„è¿›è¡Œäº†æ”¹é€ ï¼Œ<u>ä½¿ç”¨ <code>quicklist</code> ä»£æ›¿äº† <code>ziplist</code> å’Œ <code>linkedlist</code></u>ã€‚</p><p><code>Hashï¼š</code></p><p>â€‹        HashMapã€‚</p><p><code>Setï¼š</code></p><p>â€‹        Hashtable</p><p><code>ZSetï¼š</code></p><p>â€‹        zsetçš„ç¼–ç æœ‰<strong>ziplist</strong>å’Œ<strong>skiplist</strong>ä¸¤ç§ã€‚<br>â€‹         åº•å±‚åˆ†åˆ«ä½¿ç”¨<strong>ziplistï¼ˆå‹ç¼©é“¾è¡¨ï¼‰</strong>å’Œ<strong>skiplistï¼ˆè·³è¡¨ï¼‰</strong>å®ç°ã€‚</p><p>å½“zsetæ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ï¼Œä½¿ç”¨ziplistï¼š</p><blockquote><ol><li>ä¿å­˜çš„å…ƒç´ å°‘äº128ä¸ª</li><li>ä¿å­˜çš„æ‰€æœ‰å…ƒç´ å¤§å°éƒ½å°äº64å­—èŠ‚</li></ol></blockquote><p>â€‹        ziplist ç¼–ç çš„æœ‰åºé›†åˆå¯¹è±¡ä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚å®ç°ï¼Œæ¯ä¸ªé›†åˆå…ƒç´ ä½¿ç”¨ä¸¤ä¸ªç´§æŒ¨åœ¨ä¸€èµ·çš„å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹æ¥ä¿å­˜ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¿å­˜å…ƒç´ çš„æˆå‘˜ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹ä¿å­˜å…ƒç´ çš„åˆ†å€¼ã€‚å¹¶ä¸”å‹ç¼©åˆ—è¡¨å†…çš„é›†åˆå…ƒç´ æŒ‰åˆ†å€¼ä»å°åˆ°å¤§çš„é¡ºåºè¿›è¡Œæ’åˆ—ï¼Œå°çš„æ”¾ç½®åœ¨é è¿‘è¡¨å¤´çš„ä½ç½®ï¼Œå¤§çš„æ”¾ç½®åœ¨é è¿‘è¡¨å°¾çš„ä½ç½®ã€‚</p><p>â€‹        skipliståº•å±‚å®ç°ä½¿ç”¨äº†ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼Œhash+è·³è¡¨ï¼Œhashçš„ä½œç”¨å°±æ˜¯å…³è”å…ƒç´ valueå’Œæƒé‡scoreï¼Œä¿éšœå…ƒç´ valueçš„å”¯ä¸€æ€§ï¼Œå¯ä»¥é€šè¿‡å…ƒç´ valueæ‰¾åˆ°ç›¸åº”çš„scoreå€¼ã€‚è·³è·ƒåˆ—è¡¨çš„ç›®çš„åœ¨äºç»™å…ƒç´  <code>score</code> æ’åºï¼Œæ ¹æ®scoreçš„èŒƒå›´è·å–å…ƒç´ åˆ—è¡¨ã€‚</p><p><code>GeoHashï¼š</code></p><p>åœ¨ä½¿ç”¨ <strong>Redis</strong> è¿›è¡Œ <strong>Geo æŸ¥è¯¢</strong> æ—¶ï¼Œæˆ‘ä»¬è¦æ—¶åˆ»æƒ³åˆ°å®ƒçš„å†…éƒ¨ç»“æ„å®é™…ä¸Šåªæ˜¯ä¸€ä¸ª <strong>zset(skiplist)</strong>ã€‚é€šè¿‡ zset çš„ <code>score</code> æ’åºå°±å¯ä»¥å¾—åˆ°åæ ‡é™„è¿‘çš„å…¶ä»–å…ƒç´  <em>(å®é™…æƒ…å†µè¦å¤æ‚ä¸€äº›ï¼Œä¸è¿‡è¿™æ ·ç†è§£è¶³å¤Ÿäº†)</em>ï¼Œé€šè¿‡å°† <code>score</code> è¿˜åŸæˆåæ ‡å€¼å°±å¯ä»¥å¾—åˆ°å…ƒç´ çš„åŸå§‹åæ ‡äº†ã€‚</p><p>å½“ä¸¤ä¸ªåæ ‡å…ƒç´ çš„è·ç¦»ä¸æ˜¯å¾ˆè¿œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç®€å•åˆ©ç”¨ <strong>å‹¾è‚¡å®šç†</strong> å°±èƒ½å¤Ÿå¾—å‡ºä»–ä»¬ä¹‹é—´çš„ <strong>è·ç¦»</strong>ã€‚</p><h3 id="HyperLogLog-æœ‰äº†è§£å—ï¼Ÿ"><a href="#HyperLogLog-æœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="HyperLogLog æœ‰äº†è§£å—ï¼Ÿ"></a>HyperLogLog æœ‰äº†è§£å—ï¼Ÿ</h3><blockquote><ul><li><a href="http://mp.weixin.qq.com/s?__biz=MzUyMTg0NDA2Ng==&mid=2247484012&idx=1&sn=3624989d388d17331e1f7ad78fc7a257&chksm=f9d5a661cea22f7781ed997d05afee8f28da52a0013691961915a2831780e481ae94b6e9a1ae&scene=21##wechat_redirect" target="_blank" rel="noopener">Redis(4)â€”â€”ç¥å¥‡çš„HyperLoglogè§£å†³ç»Ÿè®¡é—®é¢˜</a></li></ul></blockquote><h3 id="å¸ƒéš†è¿‡æ»¤å™¨æœ‰äº†è§£å—ï¼Ÿ"><a href="#å¸ƒéš†è¿‡æ»¤å™¨æœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨æœ‰äº†è§£å—ï¼Ÿ"></a>å¸ƒéš†è¿‡æ»¤å™¨æœ‰äº†è§£å—ï¼Ÿ</h3><blockquote><ul><li><a href="http://mp.weixin.qq.com/s?__biz=MzUyMTg0NDA2Ng==&mid=2247484022&idx=1&sn=a98c479b4cac96c6af45f219a7c0bde4&chksm=f9d5a67bcea22f6d03b30ce8660f3f3ded294390fd394e138a40a439d0f96d56c8dda2082203&scene=21##wechat_redirect" target="_blank" rel="noopener">Redis(5)â€”â€”äº¿çº§æ•°æ®è¿‡æ»¤å’Œå¸ƒéš†è¿‡æ»¤å™¨</a></li></ul></blockquote><h3 id="è·³è·ƒè¡¨æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸåŸç†ï¼Ÿ"><a href="#è·³è·ƒè¡¨æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸåŸç†ï¼Ÿ" class="headerlink" title="è·³è·ƒè¡¨æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸåŸç†ï¼Ÿ"></a>è·³è·ƒè¡¨æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸåŸç†ï¼Ÿ</h3><blockquote><p>â€œ</p><p>è¿™æ˜¯ Redis ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œ<strong>å»ºè®®é˜…è¯»</strong> ä¹‹å‰å†™è¿‡çš„æ–‡ç« ï¼Œé‡Œé¢è¯¦ç»†ä»‹ç»äº†åŸç†å’Œä¸€äº›ç»†èŠ‚ï¼š</p><ul><li><a href="http://mp.weixin.qq.com/s?__biz=MzUyMTg0NDA2Ng==&mid=2247484000&idx=1&sn=a7e02adebea31535c3870cc514719493&chksm=f9d5a66dcea22f7b7cdf210993cbe6c057c0456967ac106d76c89fdd76ed5cb271c879a83f3e&scene=21##wechat_redirect" target="_blank" rel="noopener">Redis(2)â€”â€”è·³è·ƒè¡¨</a></li></ul></blockquote><h3 id="GeoHash-äº†è§£å—ï¼Ÿ"><a href="#GeoHash-äº†è§£å—ï¼Ÿ" class="headerlink" title="GeoHash äº†è§£å—ï¼Ÿ"></a>GeoHash äº†è§£å—ï¼Ÿ</h3><blockquote><p>â€œ</p><p><strong>å»ºè®®é˜…è¯»</strong> ä¹‹å‰çš„ç³»åˆ—æ–‡ç« ï¼š</p><ul><li><a href="http://mp.weixin.qq.com/s?__biz=MzUyMTg0NDA2Ng==&mid=2247484027&idx=1&sn=6237212c01a009be9a5ca88e0e50a46d&chksm=f9d5a676cea22f603e06d1e61d6293985c8ddb063621b1cdf2696da2eaeb1681e307ef2a3f20&scene=21##wechat_redirect" target="_blank" rel="noopener">Redis(6)â€”â€”GeoHashæŸ¥æ‰¾é™„è¿‘çš„äºº</a></li></ul></blockquote><h3 id="å‹ç¼©åˆ—è¡¨äº†è§£å—ï¼Ÿ"><a href="#å‹ç¼©åˆ—è¡¨äº†è§£å—ï¼Ÿ" class="headerlink" title="å‹ç¼©åˆ—è¡¨äº†è§£å—ï¼Ÿ"></a>å‹ç¼©åˆ—è¡¨äº†è§£å—ï¼Ÿ</h3><p>è¿™æ˜¯ Redis <strong>ä¸ºäº†èŠ‚çº¦å†…å­˜</strong> è€Œä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œ<strong>zset</strong> å’Œ <strong>hash</strong> å®¹å™¨å¯¹è±¡ä¼šåœ¨å…ƒç´ ä¸ªæ•°è¾ƒå°‘çš„æ—¶å€™ï¼Œé‡‡ç”¨å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰è¿›è¡Œå­˜å‚¨ã€‚å‹ç¼©åˆ—è¡¨æ˜¯ <strong>ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´</strong>ï¼Œå…ƒç´ ä¹‹é—´ç´§æŒ¨ç€å­˜å‚¨ï¼Œæ²¡æœ‰ä»»ä½•å†—ä½™ç©ºéš™ã€‚</p><blockquote><p>â€œ</p><p>å› ä¸ºä¹‹å‰è‡ªå·±ä¹Ÿæ²¡æœ‰å­¦ä¹ è¿‡ï¼Œæ‰€ä»¥æ‰¾äº†ä¸€ç¯‡æ¯”è¾ƒå¥½æ¯”è¾ƒå®¹æ˜“ç†è§£çš„æ–‡ç« ï¼š</p><ul><li>å›¾è§£Redisä¹‹æ•°æ®ç»“æ„ç¯‡â€”â€”å‹ç¼©åˆ—è¡¨ - <a href="https://mp.weixin.qq.com/s?__biz=MzU3OTk1MjMyMA==&mid=2247483700&idx=1&sn=8613dcc63a6419af2b941a64c2c58534&scene=21##wechat_redirect" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/nba0FUEAVRs0vi24KUoyQg</a></li><li>è¿™ä¸€ç¯‡ç¨å¾®åº•å±‚ç¨å¾®ç¡¬æ ¸ä¸€ç‚¹ï¼š<a href="http://www.web-lovers.com/redis-source-ziplist.html" target="_blank" rel="noopener">http://www.web-lovers.com/redis-source-ziplist.html</a></li></ul></blockquote><h3 id="å¿«é€Ÿåˆ—è¡¨-quicklist-äº†è§£å—ï¼Ÿ"><a href="#å¿«é€Ÿåˆ—è¡¨-quicklist-äº†è§£å—ï¼Ÿ" class="headerlink" title="å¿«é€Ÿåˆ—è¡¨ quicklist äº†è§£å—ï¼Ÿ"></a>å¿«é€Ÿåˆ—è¡¨ quicklist äº†è§£å—ï¼Ÿ</h3><p>Redis æ—©æœŸç‰ˆæœ¬å­˜å‚¨ list åˆ—è¡¨æ•°æ®ç»“æ„ä½¿ç”¨çš„æ˜¯å‹ç¼©åˆ—è¡¨ ziplist å’Œæ™®é€šçš„åŒå‘é“¾è¡¨ linkedlistï¼Œä¹Ÿå°±æ˜¯è¯´å½“å…ƒç´ å°‘æ—¶ä½¿ç”¨ ziplistï¼Œå½“å…ƒç´ å¤šæ—¶ç”¨ linkedlistã€‚ä½†è€ƒè™‘åˆ°é“¾è¡¨çš„é™„åŠ ç©ºé—´ç›¸å¯¹è¾ƒé«˜ï¼Œ<code>prev</code> å’Œ <code>next</code> æŒ‡é’ˆå°±è¦å å» <code>16</code> ä¸ªå­—èŠ‚ï¼ˆ64 ä½æ“ä½œç³»ç»Ÿå ç”¨ <code>8</code> ä¸ªå­—èŠ‚ï¼‰ï¼Œå¦å¤–æ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜éƒ½æ˜¯å•ç‹¬åˆ†é…ï¼Œä¼šå®¶å…·å†…å­˜çš„ç¢ç‰‡åŒ–ï¼Œå½±å“å†…å­˜ç®¡ç†æ•ˆç‡ã€‚</p><p>åæ¥ Redis æ–°ç‰ˆæœ¬ï¼ˆ3.2ï¼‰å¯¹åˆ—è¡¨æ•°æ®ç»“æ„è¿›è¡Œäº†æ”¹é€ ï¼Œä½¿ç”¨ <code>quicklist</code> ä»£æ›¿äº† <code>ziplist</code> å’Œ <code>linkedlist</code>ã€‚</p><blockquote><p>â€œ</p><p>åŒä¸Š..å»ºè®®é˜…è¯»ä¸€ä¸‹ä»¥ä¸‹çš„æ–‡ç« ï¼š</p><ul><li>Redisåˆ—è¡¨list åº•å±‚åŸç† - <a href="https://zhuanlan.zhihu.com/p/102422311" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/102422311</a></li></ul></blockquote><h3 id="Stream-ç»“æ„æœ‰äº†è§£å—ï¼Ÿ"><a href="#Stream-ç»“æ„æœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="Stream ç»“æ„æœ‰äº†è§£å—ï¼Ÿ"></a>Stream ç»“æ„æœ‰äº†è§£å—ï¼Ÿ</h3><p><strong>Redis Stream</strong> ä»æ¦‚å¿µä¸Šæ¥è¯´ï¼Œå°±åƒæ˜¯ä¸€ä¸ª <strong>ä»…è¿½åŠ å†…å®¹</strong> çš„ <strong>æ¶ˆæ¯é“¾è¡¨</strong>ï¼ŒæŠŠæ‰€æœ‰åŠ å…¥çš„æ¶ˆæ¯éƒ½ä¸€ä¸ªä¸€ä¸ªä¸²èµ·æ¥ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ ID å’Œå†…å®¹ï¼Œè¿™å¾ˆç®€å•ï¼Œè®©å®ƒå¤æ‚çš„æ˜¯ä» Kafka å€Ÿé‰´çš„å¦ä¸€ç§æ¦‚å¿µï¼š<strong>æ¶ˆè´¹è€…ç»„(Consumer Group)</strong> <em>(æ€è·¯ä¸€è‡´ï¼Œå®ç°ä¸åŒ)</em>ï¼š</p><p><img alt="img" data-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" class="lazyload"></p><p>ä¸Šå›¾å°±å±•ç¤ºäº†ä¸€ä¸ªå…¸å‹çš„ <strong>Stream</strong> ç»“æ„ã€‚æ¯ä¸ª Stream éƒ½æœ‰å”¯ä¸€çš„åç§°ï¼Œå®ƒå°±æ˜¯ Redis çš„ <code>key</code>ï¼Œåœ¨æˆ‘ä»¬é¦–æ¬¡ä½¿ç”¨ <code>xadd</code> æŒ‡ä»¤è¿½åŠ æ¶ˆæ¯æ—¶è‡ªåŠ¨åˆ›å»ºã€‚æˆ‘ä»¬å¯¹å›¾ä¸­çš„ä¸€äº›æ¦‚å¿µåšä¸€ä¸‹è§£é‡Šï¼š</p><ul><li><strong>Consumer Group</strong>ï¼šæ¶ˆè´¹è€…ç»„ï¼Œå¯ä»¥ç®€å•çœ‹æˆè®°å½•æµçŠ¶æ€çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚æ¶ˆè´¹è€…æ—¢å¯ä»¥é€‰æ‹©ä½¿ç”¨ <code>XREAD</code> å‘½ä»¤è¿›è¡Œ <strong>ç‹¬ç«‹æ¶ˆè´¹</strong>ï¼Œä¹Ÿå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶åŠ å…¥ä¸€ä¸ªæ¶ˆè´¹è€…ç»„è¿›è¡Œ <strong>ç»„å†…æ¶ˆè´¹</strong>ã€‚åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…çš„æ¶ˆè´¹è€…å…±äº«æ‰€æœ‰çš„ Stream ä¿¡æ¯ï¼Œ<strong>åŒä¸€æ¡æ¶ˆæ¯åªä¼šæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹åˆ°</strong>ï¼Œè¿™æ ·å°±å¯ä»¥åº”ç”¨åœ¨åˆ†å¸ƒå¼çš„åº”ç”¨åœºæ™¯ä¸­æ¥ä¿è¯æ¶ˆæ¯çš„å”¯ä¸€æ€§ã€‚</li><li><strong>last_delivered_id</strong>ï¼šç”¨æ¥è¡¨ç¤ºæ¶ˆè´¹è€…ç»„æ¶ˆè´¹åœ¨ Stream ä¸Š <strong>æ¶ˆè´¹ä½ç½®</strong> çš„æ¸¸æ ‡ä¿¡æ¯ã€‚æ¯ä¸ªæ¶ˆè´¹è€…ç»„éƒ½æœ‰ä¸€ä¸ª Stream å†… <strong>å”¯ä¸€çš„åç§°</strong>ï¼Œæ¶ˆè´¹è€…ç»„ä¸ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œéœ€è¦ä½¿ç”¨ <code>XGROUP CREATE</code> æŒ‡ä»¤æ¥æ˜¾å¼åˆ›å»ºï¼Œå¹¶ä¸”éœ€è¦æŒ‡å®šä»å“ªä¸€ä¸ªæ¶ˆæ¯ ID å¼€å§‹æ¶ˆè´¹ï¼Œç”¨æ¥åˆå§‹åŒ– <code>last_delivered_id</code> è¿™ä¸ªå˜é‡ã€‚</li><li><strong>pending_ids</strong>ï¼šæ¯ä¸ªæ¶ˆè´¹è€…å†…éƒ¨éƒ½æœ‰çš„ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œç”¨æ¥è¡¨ç¤º <strong>å·²ç»</strong> è¢«å®¢æˆ·ç«¯ <strong>è·å–</strong>ï¼Œä½†æ˜¯ <strong>è¿˜æ²¡æœ‰ ack</strong> çš„æ¶ˆæ¯ã€‚è®°å½•çš„ç›®çš„æ˜¯ä¸ºäº† <strong>ä¿è¯å®¢æˆ·ç«¯è‡³å°‘æ¶ˆè´¹äº†æ¶ˆæ¯ä¸€æ¬¡</strong>ï¼Œè€Œä¸ä¼šåœ¨ç½‘ç»œä¼ è¾“çš„ä¸­é€”ä¸¢å¤±è€Œæ²¡æœ‰å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰ ackï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡é‡Œé¢çš„æ¶ˆæ¯ ID å°±ä¼šè¶Šæ¥è¶Šå¤šï¼Œä¸€æ—¦æŸä¸ªæ¶ˆæ¯è¢« ackï¼Œå®ƒå°±ä¼šå¯¹åº”å¼€å§‹å‡å°‘ã€‚è¿™ä¸ªå˜é‡ä¹Ÿè¢« Redis å®˜æ–¹ç§°ä¸º <strong>PEL</strong> <em>(Pending Entries List)</em>ã€‚</li></ul><h4 id="Stream-æ¶ˆæ¯å¤ªå¤šæ€ä¹ˆåŠï¼Ÿ"><a href="#Stream-æ¶ˆæ¯å¤ªå¤šæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="Stream æ¶ˆæ¯å¤ªå¤šæ€ä¹ˆåŠï¼Ÿ"></a>Stream æ¶ˆæ¯å¤ªå¤šæ€ä¹ˆåŠï¼Ÿ</h4><p>å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œè¦æ˜¯æ¶ˆæ¯ç§¯ç´¯å¤ªå¤šï¼ŒStream çš„é“¾è¡¨å²‚ä¸æ˜¯å¾ˆé•¿ï¼Œå†…å®¹ä¼šä¸ä¼šçˆ†æ‰å°±æ˜¯ä¸ªé—®é¢˜äº†ã€‚<code>xdel</code> æŒ‡ä»¤åˆä¸ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œå®ƒåªæ˜¯ç»™æ¶ˆæ¯åšäº†ä¸ªæ ‡å¿—ä½ã€‚</p><p>Redis è‡ªç„¶è€ƒè™‘åˆ°äº†è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥å®ƒæä¾›äº†ä¸€ä¸ªå®šé•¿ Stream åŠŸèƒ½ã€‚åœ¨ <code>xadd</code> çš„æŒ‡ä»¤æä¾›ä¸€ä¸ªå®šé•¿é•¿åº¦ <code>maxlen</code>ï¼Œå°±å¯ä»¥å°†è€çš„æ¶ˆæ¯å¹²æ‰ï¼Œç¡®ä¿æœ€å¤šä¸è¶…è¿‡æŒ‡å®šé•¿åº¦ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼š</p><pre><code>&gt; XADD mystream MAXLEN 2 * value 11526654998691-0&gt; XADD mystream MAXLEN 2 * value 21526654999635-0&gt; XADD mystream MAXLEN 2 * value 31526655000369-0&gt; XLEN mystream(integer) 2&gt; XRANGE mystream - +1) 1) 1526654999635-0   2) 1) &quot;value&quot;      2) &quot;2&quot;2) 1) 1526655000369-0   2) 1) &quot;value&quot;      2) &quot;3&quot;</code></pre><p>å¦‚æœä½¿ç”¨ <code>MAXLEN</code> é€‰é¡¹ï¼Œå½“ Stream çš„è¾¾åˆ°æŒ‡å®šé•¿åº¦åï¼Œè€çš„æ¶ˆæ¯ä¼šè‡ªåŠ¨è¢«æ·˜æ±°æ‰ï¼Œå› æ­¤ Stream çš„å¤§å°æ˜¯æ’å®šçš„ã€‚ç›®å‰è¿˜æ²¡æœ‰é€‰é¡¹è®© Stream åªä¿ç•™ç»™å®šæ•°é‡çš„æ¡ç›®ï¼Œå› ä¸ºä¸ºäº†ä¸€è‡´åœ°è¿è¡Œï¼Œè¿™æ ·çš„å‘½ä»¤å¿…é¡»åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…é˜»å¡ä»¥æ·˜æ±°æ¶ˆæ¯ã€‚<em>(ä¾‹å¦‚åœ¨æ·»åŠ æ•°æ®çš„é«˜å³°æœŸé—´ï¼Œä½ ä¸å¾—ä¸é•¿æš‚åœæ¥æ·˜æ±°æ—§æ¶ˆæ¯å’Œæ·»åŠ æ–°çš„æ¶ˆæ¯)</em></p><p>å¦å¤–ä½¿ç”¨ <code>MAXLEN</code> é€‰é¡¹çš„èŠ±é”€æ˜¯å¾ˆå¤§çš„ï¼ŒStream ä¸ºäº†èŠ‚çœå†…å­˜ç©ºé—´ï¼Œé‡‡ç”¨äº†ä¸€ç§ç‰¹æ®Šçš„ç»“æ„è¡¨ç¤ºï¼Œè€Œè¿™ç§ç»“æ„çš„è°ƒæ•´æ˜¯éœ€è¦é¢å¤–çš„èŠ±é”€çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§å¸¦æœ‰ <code>~</code> çš„ç‰¹æ®Šå‘½ä»¤ï¼š</p><pre><code>XADD mystream MAXLEN ~ 1000 * ... entry fields here ...</code></pre><p>å®ƒä¼šåŸºäºå½“å‰çš„ç»“æ„åˆç†åœ°å¯¹èŠ‚ç‚¹æ‰§è¡Œè£å‰ªï¼Œæ¥ä¿è¯è‡³å°‘ä¼šæœ‰ <code>1000</code> æ¡æ•°æ®ï¼Œå¯èƒ½æ˜¯ <code>1010</code> ä¹Ÿå¯èƒ½æ˜¯ <code>1030</code>ã€‚</p><h4 id="PEL-æ˜¯å¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±çš„ï¼Ÿ"><a href="#PEL-æ˜¯å¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±çš„ï¼Ÿ" class="headerlink" title="PEL æ˜¯å¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±çš„ï¼Ÿ"></a>PEL æ˜¯å¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±çš„ï¼Ÿ</h4><p>åœ¨å®¢æˆ·ç«¯æ¶ˆè´¹è€…è¯»å– Stream æ¶ˆæ¯æ—¶ï¼ŒRedis æœåŠ¡å™¨å°†æ¶ˆæ¯å›å¤ç»™å®¢æˆ·ç«¯çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯çªç„¶æ–­å¼€äº†è¿æ¥ï¼Œæ¶ˆæ¯å°±ä¸¢å¤±äº†ã€‚ä½†æ˜¯ PEL é‡Œå·²ç»ä¿å­˜äº†å‘å‡ºå»çš„æ¶ˆæ¯ IDï¼Œå¾…å®¢æˆ·ç«¯é‡æ–°è¿ä¸Šä¹‹åï¼Œå¯ä»¥å†æ¬¡æ”¶åˆ° PEL ä¸­çš„æ¶ˆæ¯ ID åˆ—è¡¨ã€‚ä¸è¿‡æ­¤æ—¶ <code>xreadgroup</code> çš„èµ·å§‹æ¶ˆæ¯ ID ä¸èƒ½ä¸ºå‚æ•° <code>&gt;</code> ï¼Œè€Œå¿…é¡»æ˜¯ä»»æ„æœ‰æ•ˆçš„æ¶ˆæ¯ IDï¼Œä¸€èˆ¬å°†å‚æ•°è®¾ä¸º <code>0-0</code>ï¼Œè¡¨ç¤ºè¯»å–æ‰€æœ‰çš„ PEL æ¶ˆæ¯ä»¥åŠè‡ª <code>last_delivered_id</code> ä¹‹åçš„æ–°æ¶ˆæ¯ã€‚</p><h4 id="å’Œ-Kafka-å¯¹æ¯”èµ·æ¥å‘¢ï¼Ÿ"><a href="#å’Œ-Kafka-å¯¹æ¯”èµ·æ¥å‘¢ï¼Ÿ" class="headerlink" title="å’Œ Kafka å¯¹æ¯”èµ·æ¥å‘¢ï¼Ÿ"></a>å’Œ Kafka å¯¹æ¯”èµ·æ¥å‘¢ï¼Ÿ</h4><p>Redis åŸºäºå†…å­˜å­˜å‚¨ï¼Œè¿™æ„å‘³ç€å®ƒä¼šæ¯”åŸºäºç£ç›˜çš„ Kafka å¿«ä¸Šä¸€äº›ï¼Œä¹Ÿæ„å‘³ç€ä½¿ç”¨ Redis æˆ‘ä»¬ <strong>ä¸èƒ½é•¿æ—¶é—´å­˜å‚¨å¤§é‡æ•°æ®</strong>ã€‚ä¸è¿‡å¦‚æœæ‚¨æƒ³ä»¥ <strong>æœ€å°å»¶è¿Ÿ</strong> å®æ—¶å¤„ç†æ¶ˆæ¯çš„è¯ï¼Œæ‚¨å¯ä»¥è€ƒè™‘ Redisï¼Œä½†æ˜¯å¦‚æœ <strong>æ¶ˆæ¯å¾ˆå¤§å¹¶ä¸”åº”è¯¥é‡ç”¨æ•°æ®</strong> çš„è¯ï¼Œåˆ™åº”è¯¥é¦–å…ˆè€ƒè™‘ä½¿ç”¨ Kafkaã€‚</p><p>å¦å¤–ä»æŸäº›è§’åº¦æ¥è¯´ï¼Œ<code>Redis Stream</code> ä¹Ÿæ›´é€‚ç”¨äºå°å‹ã€å»‰ä»·çš„åº”ç”¨ç¨‹åºï¼Œå› ä¸º <code>Kafka</code> ç›¸å¯¹æ¥è¯´æ›´éš¾é…ç½®ä¸€äº›ã€‚</p><blockquote><p>â€œ</p><p><strong>æ¨èé˜…è¯»</strong> ä¹‹å‰çš„ç³»åˆ—æ–‡ç« ï¼Œé‡Œé¢ <strong>ä¹Ÿå¯¹ Pub/ Sub åšäº†è¯¦ç»†çš„æè¿°</strong>ï¼š</p><ul><li><a href="http://mp.weixin.qq.com/s?__biz=MzUyMTg0NDA2Ng==&mid=2247484039&idx=1&sn=99866e4cc6c842dc6d50d68a362d53a8&chksm=f9d5a68acea22f9cf6d972c23809520137957bd26ce7e6c6cb4f4ed11ddcbbc9938c1a56eb46&scene=21##wechat_redirect" target="_blank" rel="noopener">Redis(8)â€”â€”å‘å¸ƒ/è®¢é˜…ä¸Stream</a></li></ul></blockquote><script src="https://readmore.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>    const btw = new BTWPlugin();    btw.init({        id: 'post-content',        blogId: '24566-1633176031733-929',        name: 'ç®€å‡¡ä¸¶',        qrcode: 'https://codebear-images.oss-cn-beijing.aliyuncs.com/getqrcode.jpeg',        keyword: '666',    });</script>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é«˜å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
